---
import { allPages } from '~/content';
import { isCmsEntry, isEnglishEntry } from '~/content.config';
import { isLogoKey } from '~/data/logos';
import { getLanguageFromURL, stripLangFromSlug } from '~/util/path-utils';
import CardsNav from './NavGrid/CardsNav.astro';

const lang = getLanguageFromURL(Astro.url.pathname);
const featuredCmsGuides = allPages.filter(isCmsEntry).filter((entry) => entry.data.featuredListing);
const enFeaturedCmsGuides = featuredCmsGuides.filter(isEnglishEntry);
---

<CardsNav
	size="large"
	links={enFeaturedCmsGuides.map(({ id, data }) => {
		const slugWithoutLang = stripLangFromSlug(id);
		const localizedSlug = `${lang}/${slugWithoutLang}`;
		const translation = featuredCmsGuides.find((page) => localizedSlug === page.id);
		return {
			title: translation?.data.service || data.service,
			href: `/${localizedSlug}/`,
			logo: { brand: isLogoKey(id.split('/').pop()), size: 'large', shape: 'rounded' },
			description: translation?.data.featuredListing?.tagline || data.featuredListing!.tagline,
		};
	})}
/>
