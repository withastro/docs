---
type: integration
title: '@astrojs/cloudflare'
description: '@astrojs/cloudflare SSR ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ Astro í”„ë¡œì íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.'
sidebar:
  label: Cloudflare
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/cloudflare/'
category: adapter
i18nReady: true
---

import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { Tabs, TabItem, Steps } from '@astrojs/starlight/components';

ì´ ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ë©´ Astroê°€ [ìš”ì²­ ì‹œ ë Œë”ë§ë˜ëŠ” ë¼ìš°íŠ¸](/ko/guides/on-demand-rendering/)ë¥¼ [Cloudflare](https://www.cloudflare.com/)ì— ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Astroë¥¼ ì •ì  ì‚¬ì´íŠ¸ ë¹Œë”ë¡œ ì‚¬ìš©í•˜ëŠ” ê²½ìš° ì–´ëŒ‘í„°ê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

[Cloudflare ë°°í¬ ê°€ì´ë“œ](/ko/guides/deploy/cloudflare/)ì—ì„œ Astro ì‚¬ì´íŠ¸ë¥¼ ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì„¸ìš”.

## ì™œ Astro Cloudflareì¸ê°€?

Cloudflare [ê°œë°œì í”Œë«í¼](https://developers.cloudflare.com/)ì„ ì‚¬ìš©í•˜ë©´ ìŠ¤í† ë¦¬ì§€ ë° AIì™€ ê°™ì€ ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ì—¬ í’€ìŠ¤íƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ê°œë°œí•˜ê³ , ì´ ëª¨ë“  ê²ƒì„ ê¸€ë¡œë²Œ ì—ì§€ ë„¤íŠ¸ì›Œí¬ì— ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì–´ëŒ‘í„°ëŠ” Cloudflareë¥¼ í†µí•´ ë°°í¬í•  ìˆ˜ ìˆë„ë¡ Astro í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•©ë‹ˆë‹¤.

## ì„¤ì¹˜

Astroì—ëŠ” ê³µì‹ í†µí•© ì„¤ì •ì„ ìë™í™”í•˜ëŠ” `astro add` ëª…ë ¹ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ê²½ìš° ëŒ€ì‹  [í†µí•©ì„ ìˆ˜ë™ìœ¼ë¡œ ì„¤ì¹˜](#ìˆ˜ë™-ì„¤ì¹˜)í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Astro í”„ë¡œì íŠ¸ì—ì„œ SSRì„ í™œì„±í™”í•˜ë ¤ë©´ `astro add` ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ Cloudflare ì–´ëŒ‘í„°ë¥¼ ì¶”ê°€í•˜ì„¸ìš”. ê·¸ëŸ¬ë©´ `@astrojs/cloudflare`ê°€ ì„¤ì¹˜ë˜ê³  `astro.config.mjs` íŒŒì¼ì´ í•œ ë²ˆì— ì ì ˆí•˜ê²Œ ë³€ê²½ë©ë‹ˆë‹¤.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add cloudflare
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add cloudflare
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add cloudflare
  ```
  </Fragment>
</PackageManagerTabs>

### ìˆ˜ë™ ì„¤ì¹˜

ë¨¼ì €, ì„ í˜¸í•˜ëŠ” íŒ¨í‚¤ì§€ ê´€ë¦¬ìë¥¼ ì‚¬ìš©í•˜ì—¬ `@astrojs/cloudflare` ì–´ëŒ‘í„°ë¥¼ í”„ë¡œì íŠ¸ ì¢…ì†ì„±ì— ì¶”ê°€í•˜ì„¸ìš”.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/cloudflare
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/cloudflare
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/cloudflare
  ```
  </Fragment>
</PackageManagerTabs>

ê·¸ëŸ° ë‹¤ìŒ ì–´ëŒ‘í„°ì™€ ì›í•˜ëŠ” [ìš”ì²­ ì‹œ ë Œë”ë§ ëª¨ë“œ](/ko/guides/on-demand-rendering/)ë¥¼ `astro.config.mjs` íŒŒì¼ì— ì¶”ê°€í•˜ì„¸ìš”.

```js title="astro.config.mjs" ins={2,5-6}
import { defineConfig } from 'astro/config';
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  output: 'server',
  adapter: cloudflare(),
});
```

## ì˜µì…˜

Cloudflare ì–´ëŒ‘í„°ëŠ” ë‹¤ìŒ ì˜µì…˜ì„ í—ˆìš©í•©ë‹ˆë‹¤.

### `cloudflareModules`

<p>
**íƒ€ì…:** `true | false`<br />
**ê¸°ë³¸ê°’:** `true`
</p>

[`.wasm`, `.bin`, `.txt` ëª¨ë“ˆì˜ ê°€ì ¸ì˜¤ê¸°](#cloudflare-ëª¨ë“ˆ-ê°€ì ¸ì˜¤ê¸°)ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì€ ê¸°ë³¸ì ìœ¼ë¡œ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë¹„í™œì„±í™”í•˜ë ¤ë©´ `cloudflareModules: false`ë¡œ ì„¤ì •í•˜ì„¸ìš”.

### imageService

<p>
**íƒ€ì…:** `'passthrough' | 'cloudflare' | 'compile' | 'custom'`<br />
**ê¸°ë³¸ê°’:** `'compile'`
</p>

ì–´ëŒ‘í„°ì—ì„œ ì‚¬ìš©ë˜ëŠ” ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. í˜¸í™˜ë˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ê°€ êµ¬ì„±ë˜ë©´ ì–´ëŒ‘í„°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `compile` ëª¨ë“œë¡œ ì„¤ì •ë©ë‹ˆë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ì „ì—­ì ìœ¼ë¡œ êµ¬ì„±ëœ ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

* **`cloudflare`:** [Cloudflare Image Resizing](https://developers.cloudflare.com/images/image-resizing/) ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* **`passthrough`:** ê¸°ì¡´ [`noop`](/ko/guides/images/#ë¬´ì‘ë™-íŒ¨ìŠ¤ìŠ¤ë£¨-ì„œë¹„ìŠ¤-êµ¬ì„±) ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* **`compile`:** Astroì˜ ê¸°ë³¸ ì„œë¹„ìŠ¤ (sharp)ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ ë¹Œë“œ ì‹œ ì‚¬ì „ ë Œë”ë§ëœ ê²½ë¡œì—ì„œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì£¼ë¬¸í˜• ë Œë”ë§ í˜ì´ì§€ì— ëŒ€í•œ SSR ì¤‘ì—ëŠ” ëª¨ë“  `astro:assets` ê¸°ëŠ¥ì´ ë¹„í™œì„±í™”ë©ë‹ˆë‹¤.
* **`custom`:** í•­ìƒ [ì´ë¯¸ì§€ ì˜µì…˜](/ko/reference/configuration-reference/#ì´ë¯¸ì§€-ì˜µì…˜)ì— êµ¬ì„±ëœ ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. **ì´ ì˜µì…˜ì€ êµ¬ì„±ëœ ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ê°€ Cloudflareì˜ `workerd` ëŸ°íƒ€ì„ì—ì„œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**


```js title="astro.config.mjs" ins={6}
import {defineConfig} from "astro/config";
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  adapter: cloudflare({
     imageService: 'cloudflare'
  }),
  output: 'server'
})
```

### platformProxy

Cloudflare ëŸ°íƒ€ì„ì´ `astro dev`ì— ì¶”ê°€ë˜ëŠ”ì§€ ì—¬ë¶€ì™€ ë°©ë²•ì„ ê²°ì •í•©ë‹ˆë‹¤. ì—¬ê¸°ì—ëŠ” ë¡œì»¬ `workerd` ë°”ì¸ë”©ì— ëŒ€í•œ í”„ë¡ì‹œì™€ Cloudflare íŠ¹ì • ê°’ì˜ ì—ë®¬ë ˆì´ì…˜ì´ í¬í•¨ë˜ì–´ ìˆì–´ Node.js ê°œë°œ í”„ë¡œì„¸ìŠ¤ì—ì„œ ëŸ°íƒ€ì„ì„ ì—ë®¬ë ˆì´ì…˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [Cloudflare ëŸ°íƒ€ì„](#cloudflare-ëŸ°íƒ€ì„)ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì„¸ìš”.

:::note
ì œê³µë˜ëŠ” í”„ë¡ì‹œëŠ” ìµœì„ ì„ ë‹¤í•´ ì‹¤ì œ í”„ë¡œë•ì…˜ì„ ì—ë®¬ë ˆì´ì…˜í•œ ê²ƒì…ë‹ˆë‹¤. ìµœëŒ€í•œ ì‹¤ì œì™€ ë¹„ìŠ·í•˜ê²Œ ì„¤ê³„ë˜ì—ˆìœ¼ë‚˜ ì•½ê°„ì˜ ì°¨ì´ì™€ ë¶ˆì¼ì¹˜ê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::

#### platformProxy.enabled
<p>
**íƒ€ì…:** `{ enabled?: boolean }`<br />
**ê¸°ë³¸ê°’:** `{ enabled: false }`
</p>

`enabled` ì†ì„±ì„ ì‚¬ìš©í•˜ë©´ `astro dev`ì—ì„œ Cloudflare ëŸ°íƒ€ì„ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### platformProxy.configPath
<p>
**íƒ€ì…:** `{ configPath?: string }`<br />
**ê¸°ë³¸ê°’:** `{ configPath: 'wrangler.toml' }`
</p>

`configPath`ë¥¼ ì‚¬ìš©í•˜ë©´ Astro í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ë¥¼ ê¸°ì¤€ìœ¼ë¡œ Wrangler êµ¬ì„± íŒŒì¼ì„ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### platformProxy.experimentalJsonConfig
<p>
**íƒ€ì…:** `{ experimentalJsonConfig?: boolean }`<br />
**ê¸°ë³¸ê°’:** `{ experimentalJsonConfig?: false }`
</p>

`experimentalJsonConfig` ì†ì„±ì€ ìœ í‹¸ë¦¬í‹°ê°€ JSON êµ¬ì„± íŒŒì¼ (ì˜ˆ: `wrangler.json`)ì„ ì½ëŠ”ì§€ ì—¬ë¶€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

#### platformProxy.persist
<p>
**íƒ€ì…:** `{ persist?: boolean | { path: string } }`<br />
**ê¸°ë³¸ê°’:** `{ persist: true }`
</p>

`persist` ì†ì„±ì€ ë°”ì¸ë”© ë°ì´í„°ê°€ ì§€ì†ë˜ëŠ”ì§€ ì—¬ë¶€ì™€ ìœ„ì¹˜ë¥¼ ì •ì˜í•©ë‹ˆë‹¤. `true`ëŠ” Wranglerì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ìœ„ì¹˜ë¥¼ ê¸°ë³¸ê°’ìœ¼ë¡œ ì§€ì •í•˜ë¯€ë¡œ ë‘˜ ê°„ì— ë°ì´í„°ë¥¼ ê³µìœ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `false`ì¸ ê²½ìš° ë°ì´í„°ê°€ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥ë˜ì§€ ì•Šê³ , íŒŒì¼ ì‹œìŠ¤í…œì—ì„œ ì½ì„ ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤.

:::note
`wrangler`ì˜ `--persist-to` ì˜µì…˜ì€ ë‚´ë¶€ì ìœ¼ë¡œ `v3`ë¼ëŠ” í•˜ìœ„ ë””ë ‰í„°ë¦¬ë¥¼ ì¶”ê°€í•˜ì§€ë§Œ `@astrojs/cloudflare` `persist` ì†ì„±ì€ ê·¸ë ‡ì§€ ì•ŠìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ `wrangler dev --persist-to ./my-directory`ë¥¼ ì‹¤í–‰í•˜ëŠ” ê²ƒê³¼ ë™ì¼í•œ ìœ„ì¹˜ë¥¼ ì¬ì‚¬ìš©í•˜ë ¤ë©´ `persist: { path: "./my-directory/v3" }`ì„ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.
:::

ë‹¤ìŒ êµ¬ì„±ì€ ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•  ë•Œ Cloudflare ëŸ°íƒ€ì„ì„ í™œì„±í™”í•˜ê³  `wrangler.json` êµ¬ì„± íŒŒì¼ (ì‹¤í—˜ì )ì„ ì‚¬ìš©í•˜ëŠ” ì˜ˆë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤. ë˜í•œ íŒŒì¼ ì‹œìŠ¤í…œì— ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê¸° ìœ„í•œ ì‚¬ìš©ì ì •ì˜ ìœ„ì¹˜ë¥¼ â€‹â€‹ì§€ì •í•©ë‹ˆë‹¤.

```js
import cloudflare from '@astrojs/cloudflare';
import { defineConfig } from 'astro/config';

export default defineConfig({
	adapter: cloudflare({
		platformProxy: {
			enabled: true,
			configPath: 'wrangler.json',
			experimentalJsonConfig: true,
			persist: {
				path: './.cache/wrangler/v3'
			},
		},
	}),
});
```
### routes.extend

Cloudflare Workersì—ì„œëŠ” ì´ ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [Cloudflare Workersì—ì„œì˜ ë¼ìš°íŒ…](#cloudflare-workersì˜-ë¼ìš°íŒ…)ì„ ì°¸ì¡°í•˜ì„¸ìš”.

Cloudflare Pagesì—ì„œ ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ìš”ì²­ ì‹œ ìƒì„±ë˜ëŠ” ê²½ë¡œë¥¼ ê²°ì •í•˜ê¸° ìœ„í•´ ìƒì„±ëœ `_routes.json` íŒŒì¼ì— ì‚¬ìš©ì ì§€ì • íŒ¨í„´ (ì˜ˆ: `/fonts/*`)ì„ ì¶”ê°€í•˜ê±°ë‚˜ ì œì™¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ìë™ìœ¼ë¡œ ìƒì„±í•  ìˆ˜ ì—†ëŠ” ê²½ë¡œ íŒ¨í„´ì„ ì¶”ê°€í•´ì•¼ í•˜ê±°ë‚˜ ì‚¬ì „ ë Œë”ë§ëœ ê²½ë¡œë¥¼ ì œì™¸í•´ì•¼ í•˜ëŠ” ê²½ìš° ìœ ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ì ì§€ì • ê²½ë¡œ íŒ¨í„´ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì€ [Cloudflareì˜ ë¼ìš°íŒ… ë¬¸ì„œ](https://developers.cloudflare.com/pages/functions/routing/#functions-invocation-routes)ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì§€ì •ëœ ê²½ë¡œëŠ” ìë™ìœ¼ë¡œ ì¤‘ë³µ ì œê±°ë˜ì§€ ì•Šìœ¼ë©° ê¸°ì¡´ ê²½ë¡œì— ê·¸ëŒ€ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤.

#### routes.extend.include

<p>
**íƒ€ì…:** `{ pattern: string }[]`<br />
**ê¸°ë³¸ê°’:** `undefined`
</p>

Cloudflare ì–´ëŒ‘í„°ê°€ ìš”ì²­ ì‹œ ìƒì„±í•  ì¶”ê°€ ê²½ë¡œë¥¼ `routes.extend.include` ë°°ì—´ì— êµ¬ì„±í•©ë‹ˆë‹¤.

#### routes.extend.exclude

<p>
**íƒ€ì…:** `{ pattern: string }[]`<br />
**ê¸°ë³¸ê°’:** `undefined`
</p>

ì£¼ë¬¸í˜• ë Œë”ë§ì—ì„œ ì œì™¸í•  ê²½ë¡œë¥¼ `routes.extend.exclude` ë°°ì—´ì— êµ¬ì„±í•©ë‹ˆë‹¤. ëŒ€ì‹  ì´ëŸ¬í•œ ê²½ë¡œëŠ” ì‚¬ì „ ë Œë”ë§ë˜ì–´ ì •ì ìœ¼ë¡œ ì œê³µë˜ë©° SSR í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë˜í•œ ì´ ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ SSR í•¨ìˆ˜ë¥¼ í†µí•´ ìš”ì²­ì„ ë¼ìš°íŒ…í•˜ì§€ ì•Šê³ ë„ ì •ì  ìì‚° (ì˜ˆ: ì´ë¯¸ì§€, ê¸€ê¼´, CSS, js, html, txt, json ë“±) íŒŒì¼ì„ ì§ì ‘ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js title="astro.config.mjs"
export default defineConfig({
  adapter: cloudflare({
    routes: {
      extend: {
        include: [{ pattern: '/static' }], // ì£¼ë¬¸í˜• ë Œë”ë§ì„ ìœ„í•´ ì‚¬ì „ ë Œë”ë§ëœ í˜ì´ì§€ë¥¼ SSR í•¨ìˆ˜ë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.
        exclude: [{ pattern: '/pagefind/*' }], // ë¹Œë“œ ì‹œ ì •ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” Starlightì˜ pagefind ê²€ìƒ‰ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
      }
    },
  }),
});
```

### sessionKVBindingName
<p>
**íƒ€ì…:** `string`<br />
**ê¸°ë³¸ê°’:** `SESSION`
<Since v="5.6.0" />
</p>

`sessionKVBindingName` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì— ì‚¬ìš©ë˜ëŠ” KV ë°”ì¸ë”©ì˜ ì´ë¦„ì„ ì§€ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `SESSION`ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ, ì‚¬ìš©ì ì •ì˜ KV ë°”ì¸ë”© ì´ë¦„ê³¼ ì¼ì¹˜í•˜ë„ë¡ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì„¸ì…˜](#ì„¸ì…˜)ì„ ì°¸ì¡°í•˜ì„¸ìš”.

```js title="astro.config.mjs" "MY_SESSION_BINDING"
export default defineConfig({
  adapter: cloudflare({
    sessionKVBindingName: 'MY_SESSION_BINDING',
  }),
});
```

## Cloudflare ëŸ°íƒ€ì„

### ì‚¬ìš©

Cloudflare ëŸ°íƒ€ì„ì€ í™˜ê²½ ë³€ìˆ˜ì™€ Cloudflare ë¦¬ì†ŒìŠ¤ì— ëŒ€í•œ ë°”ì¸ë”© ì ‘ê·¼ ê¶Œí•œì„ ì œê³µí•©ë‹ˆë‹¤.
Cloudflare ëŸ°íƒ€ì„ì€ `wrangler.toml`/`wrangler.json` êµ¬ì„± íŒŒì¼ì— ìˆëŠ” ë°”ì¸ë”©ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

`Astro.locals.runtime`ì—ì„œ ë°”ì¸ë”©ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```astro title="src/pages/index.astro"
---
const { env } = Astro.locals.runtime;
---
```

`context.locals`ë¥¼ í†µí•´ API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ ëŸ°íƒ€ì„ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js title="src/pages/api/someFile.js"
export function GET(context) {
  const runtime = context.locals.runtime;

  return new Response('Some body');
}
```

Cloudflare ë¬¸ì„œì—ì„œ [ì§€ì›ë˜ëŠ” ëª¨ë“  ë°”ì¸ë”© ëª©ë¡](https://developers.cloudflare.com/workers/wrangler/api/#supported-bindings)ì„ í™•ì¸í•˜ì„¸ìš”.


### í™˜ê²½ ë³€ìˆ˜ ë° ë¹„ë°€

Cloudflare ëŸ°íƒ€ì„ì€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì¼ì¢…ì˜ ë°”ì¸ë”©ìœ¼ë¡œ ì·¨ê¸‰í•©ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´, `wrangler.json`ì—ì„œ ë‹¤ìŒê³¼ ê°™ì´ [í™˜ê²½ ë³€ìˆ˜](https://developers.cloudflare.com/workers/configuration/environment-variables/#add-environment-variables-via-wrangler)ë¥¼ ì •ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json title="wrangler.json"
{
  "vars" : {
    "MY_VARIABLE": "test"
  }
}
```

ë¹„ë°€ì€ ì•”í˜¸í™”ëœ í…ìŠ¤íŠ¸ ê°’ì„ Workerì— ì—°ê²°í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” íŠ¹ë³„í•œ ìœ í˜•ì˜ í™˜ê²½ ë³€ìˆ˜ì…ë‹ˆë‹¤. ì„¤ì • í›„ì—ëŠ” ë³´ì´ì§€ ì•Šë„ë¡ ë‹¤ë¥´ê²Œ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

`secrets`ë¥¼ ì •ì˜í•˜ë ¤ë©´ Wrangler êµ¬ì„± íŒŒì¼ì´ ì•„ë‹Œ [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/)ë¥¼ í†µí•´ ì¶”ê°€í•˜ì„¸ìš”.

```bash
npx wrangler secret put <KEY>
```

ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ë¹„ë°€ì„ ì„¤ì •í•˜ë ¤ë©´ Astro í”„ë¡œì íŠ¸ì˜ ë£¨íŠ¸ì— `.dev.vars` íŒŒì¼ë„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

```ini title=".dev.vars"
DB_PASSWORD=myPassword
```

ê·¸ëŸ¬ë©´ `Astro.locals.runtime`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `env` ê°ì²´ë¥¼ í†µí•´ ë¹„ë°€ì„ í¬í•¨í•œ í™˜ê²½ ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```astro title="src/pages/index.astro"
---
const { env } = Astro.locals.runtime;
const myVariable = env.MY_VARIABLE;
const secret = env.DB_PASSWORD;
---
```

Cloudflare í™˜ê²½ ë³€ìˆ˜ì™€ ë¹„ë°€ì€ [`astro:env` API](/ko/guides/environment-variables/#íƒ€ì…-ì•ˆì „-í™˜ê²½-ë³€ìˆ˜)ì™€ í˜¸í™˜ë©ë‹ˆë‹¤.

### íƒ€ì… ì„¤ì •

`wrangler`ëŠ” ë°”ì¸ë”©ì„ ìœ„í•œ TypeScript íƒ€ì…ì„ ìƒì„±í•˜ëŠ” `types` ëª…ë ¹ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ íƒ€ì…ì„ ì„¤ì •í•˜ì§€ ì•Šê³ ë„ localsì˜ íƒ€ì…ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [Cloudflare ë¬¸ì„œ](https://developers.cloudflare.com/workers/wrangler/commands/#types)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

êµ¬ì„± íŒŒì¼ (ì˜ˆ: `wrangler.toml`, `.dev.vars`)ì„ ë³€ê²½í•  ë•Œë§ˆë‹¤ `wrangler types`ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

:::note
ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ëª…ë ¹ë³´ë‹¤ ë¨¼ì € `wrangler types`ë¥¼ ì‹¤í–‰í•˜ëŠ” pnpm ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```json title="package.json"
{
  "scripts": {
    "dev": "wrangler types && astro dev",
    "start": "wrangler types && astro dev",
    "build": "wrangler types && astro check && astro build",
    "preview": "wrangler types && astro preview",
    "astro": "astro"
  }
}
```
:::

`Runtime`ì„ ì‚¬ìš©í•˜ì—¬ `runtime` ê°ì²´ì˜ íƒ€ì…ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts title="src/env.d.ts"
type Runtime = import('@astrojs/cloudflare').Runtime<Env>;

declare namespace App {
  interface Locals extends Runtime {
    otherLocals: {
      test: string;
    };
  }
}
```

## Cloudflare í”Œë«í¼

### Headers

Astro í”„ë¡œì íŠ¸ì˜ `public/` í´ë”ì— `_headers` íŒŒì¼ì„ ì¶”ê°€í•˜ì—¬ [ì‚¬ìš©ì ì •ì˜ í—¤ë”](https://developers.cloudflare.com/pages/platform/headers/)ë¥¼ ì‘ë‹µì— ì²¨ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ íŒŒì¼ì€ ë¹Œë“œ ì¶œë ¥ ë””ë ‰í„°ë¦¬ì— ë³µì‚¬ë©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì€ Cloudflare Workersì™€ Pagesì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Assets
Astroê°€ ë¹Œë“œí•œ ìì‚°ì€ ëª¨ë‘ í•´ì‹œë¡œ ì´ë¦„ì´ ì§€ì •ë˜ë¯€ë¡œ ê¸´ ìºì‹œ í—¤ë”ê°€ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ Cloudflareì˜ AstroëŠ” ì´ëŸ¬í•œ íŒŒì¼ì— ëŒ€í•œ í—¤ë”ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

### Redirects

ìš”ì²­ì„ ë‹¤ë¥¸ URLë¡œ ë¦¬ë””ë ‰ì…˜í•˜ê¸° ìœ„í•´ [ì‚¬ìš©ì ì •ì˜ ë¦¬ë””ë ‰ì…˜](https://developers.cloudflare.com/pages/platform/redirects/)ì„ ì„ ì–¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë ¤ë©´ Astro í”„ë¡œì íŠ¸ì˜ `public/` í´ë”ì— `_redirects` íŒŒì¼ì„ ì¶”ê°€í•˜ì„¸ìš”. ì´ íŒŒì¼ì€ ë¹Œë“œ ì¶œë ¥ ë””ë ‰í„°ë¦¬ë¡œ ë³µì‚¬ë©ë‹ˆë‹¤.

ì´ ê¸°ëŠ¥ì€ Cloudflare Workersì™€ Pagesì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Routes
#### Cloudflare Workersì˜ ë¼ìš°íŒ…

ì •ì  ìì‚° ë¼ìš°íŒ…ì€ ë¹Œë“œ ë””ë ‰í„°ë¦¬ (ì˜ˆ: `./dist`)ì˜ íŒŒì¼ êµ¬ì¡°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•©ë‹ˆë‹¤. ì¼ì¹˜í•˜ëŠ” í•­ëª©ì´ ì—†ìœ¼ë©´ SSRì„ ìœ„í•´ Workerë¡œ ëŒ€ì²´ë©ë‹ˆë‹¤. [Cloudflare Workersë¥¼ ì‚¬ìš©í•œ ì •ì  ìì‚° ë¼ìš°íŒ…](https://developers.cloudflare.com/workers/static-assets/routing/)ì— ëŒ€í•´ ìì„¸íˆ ì•Œì•„ë³´ì„¸ìš”.

[Cloudflare Pages](#cloudflare-pagesì˜-ë¼ìš°íŒ…)ì™€ ë‹¬ë¦¬ Workersì—ì„œëŠ” `_routes.json` íŒŒì¼ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í˜„ì¬ Cloudflare ì–´ëŒ‘í„°ëŠ” í•­ìƒ ì´ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ë ¤ë©´ `public/` í´ë”ì— `.assetsignore` íŒŒì¼ì„ ë§Œë“¤ê³  ë‹¤ìŒ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”.
  ```txt title="public/.assetsignore"
  _worker.js
  _routes.json
  ```

#### Cloudflare Pagesì˜ ë¼ìš°íŒ…

Cloudflare Pagesì˜ [ë¼ìš°íŒ…](https://developers.cloudflare.com/pages/platform/functions/routing/#functions-invocation-routes)ì€ `_routes.json` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì–´ë–¤ ìš”ì²­ì´ ì„œë²„ í•¨ìˆ˜ë¡œ ë¼ìš°íŒ…ë˜ê³  ì–´ë–¤ ìš”ì²­ì´ ì •ì  ìì‚°ìœ¼ë¡œ ì œê³µë˜ëŠ”ì§€ ê²°ì •í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ `_routes.json` íŒŒì¼ì€ í”„ë¡œì íŠ¸ì˜ íŒŒì¼ ë° êµ¬ì„±ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

ì–´ëŒ‘í„° êµ¬ì„±ì—ì„œ [ë”°ë¼ì•¼ í•˜ëŠ” ì¶”ê°€ ë¼ìš°íŒ… íŒ¨í„´ì„ ì§€ì •](#routesextend)í•˜ê±°ë‚˜, ì‚¬ìš©ì ì •ì˜ `_routes.json` íŒŒì¼ì„ ë§Œë“¤ì–´ ìë™ ìƒì„±ì„ ì™„ì „íˆ ë®ì–´ì“¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‚¬ìš©ì ì •ì˜ `public/_routes.json`íŒŒì¼ì„ ìƒì„±í•˜ë©´ ìë™ ìƒì„±ì´ ì¬ì •ì˜ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [ì‚¬ìš©ì ì§€ì • `_routes.json` ìƒì„±ì— ëŒ€í•œ Cloudflare ë¬¸ì„œ](https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

## ì„¸ì…˜

[Astro ì„¸ì…˜ API](/ko/guides/sessions/)ë¥¼ ì‚¬ìš©í•˜ë©´ ìš”ì²­ ê°„ì— ì‚¬ìš©ì ë°ì´í„°ë¥¼ ì‰½ê²Œ ì €ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ì ë°ì´í„° ë° í™˜ê²½ ì„¤ì •, ì‡¼í•‘ ì¹´íŠ¸, ì¸ì¦ ìê²© ì¦ëª…ê³¼ ê°™ì€ ìš©ë„ë¡œ í™œìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¿ í‚¤ ì €ì¥ì†Œì™€ëŠ” ë‹¬ë¦¬ ë°ì´í„° í¬ê¸°ì— ì œí•œì´ ì—†ìœ¼ë©°, ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œë„ ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

Cloudflare ì–´ëŒ‘í„°ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš° AstroëŠ” ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ë¥¼ ìœ„í•´ [Workers KV](https://developers.cloudflare.com/kv/)ë¥¼ ìë™ìœ¼ë¡œ êµ¬ì„±í•©ë‹ˆë‹¤. ì„¸ì…˜ì„ ì‚¬ìš©í•˜ê¸° ì „ì— ë°ì´í„°ë¥¼ ì €ì¥í•  KV ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  Wrangler êµ¬ì„± íŒŒì¼ì— KV ë°”ì¸ë”©ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ AstroëŠ” KV ë°”ì¸ë”© ì´ë¦„ì´ `SESSION`ì¼ ê²ƒìœ¼ë¡œ ì˜ˆìƒí•˜ì§€ë§Œ, ì–´ëŒ‘í„° êµ¬ì„±ì—ì„œ [`sessionKVBindingName`](#sessionkvbindingname) ì˜µì…˜ì„ ì„¤ì •í•˜ì—¬ ì›í•˜ëŠ” ë‹¤ë¥¸ ì´ë¦„ì„ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<Steps>

1. Wrangler CLIë¥¼ ì‚¬ìš©í•˜ì—¬ KV ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ìƒˆ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ IDë¥¼ ê¸°ë¡í•´ ë‘ì„¸ìš”.

   ```sh
   npx wrangler kv namespace create "SESSION"
   ```

2. Wrangler êµ¬ì„±ì—ì„œ KV ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„ ì–¸í•˜ê³ , ë„¤ì„ìŠ¤í˜ì´ìŠ¤ IDë¥¼ ì´ì „ ëª…ë ¹ì—ì„œ ë°˜í™˜ëœ IDë¡œ ì„¤ì •í•©ë‹ˆë‹¤.

    <Tabs>
      <TabItem label="wrangler.json">
        ```json title="wrangler.json" "<KV_NAMESPACE_ID>"
        {
          "kv_namespaces": [
            {
              "binding": "SESSION",
              "id": "<KV_NAMESPACE_ID>"
            }
          ]
        }
        ```
      </TabItem>
      <TabItem label="wrangler.toml">
        ```toml title="wrangler.toml" "<KV_NAMESPACE_ID>"
        kv_namespaces = [
          { binding = "SESSION", id = "<KV_NAMESPACE_ID>" }
        ]
        ```
      </TabItem>
    </Tabs>

3. ê·¸ëŸ¬ë©´ ì„œë²„ ì½”ë“œì—ì„œ ì„¸ì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ```astro title="src/components/CartButton.astro" "Astro.session?.get('cart')"
    ---
    export const prerender = false;
    const cart = await Astro.session?.get('cart');
    ---

    <a href="/checkout">ğŸ›’ {cart?.length ?? 0} items</a>
    ```

</Steps>

:::note
Cloudflare KVì— ì“°ëŠ” ì‘ì—…ì€ ë¦¬ì „ ê°„ì— [ìµœì¢… ì¼ê´€ì„±ì„ ë³´ì¥](https://developers.cloudflare.com/kv/concepts/how-kv-works/#consistency)í•©ë‹ˆë‹¤. ì¦‰, ë™ì¼í•œ ë¦¬ì „ ë‚´ì—ì„œëŠ” ë³€ê²½ ì‚¬í•­ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ë§Œ, ì „ì—­ì ìœ¼ë¡œ ì „íŒŒë˜ëŠ” ë° ìµœëŒ€ 60ì´ˆê°€ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì‚¬ìš©ìëŠ” ìš”ì²­ ê°„ì— ë¦¬ì „ì„ ì „í™˜í•  ê°€ëŠ¥ì„±ì´ ë‚®ìœ¼ë¯€ë¡œ ì´ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê² ì§€ë§Œ, VPN ì‚¬ìš©ì ë“± ì¼ë¶€ ì‚¬ìš© ì‚¬ë¡€ì—ì„œëŠ” ê³ ë ¤í•´ì•¼ í•  ì‚¬í•­ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
:::

## Cloudflare ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°

Cloudflare `workerd` ëŸ°íƒ€ì„ì€ ì¼ë¶€ [ë¹„í‘œì¤€ ëª¨ë“ˆ íƒ€ì…](https://developers.cloudflare.com/workers/wrangler/bundling/#including-non-javascript-modules) ê°€ì ¸ì˜¤ê¸°ë¥¼ ì§€ì›í•©ë‹ˆë‹¤. ëŒ€ë¶€ë¶„ì˜ ì¶”ê°€ íŒŒì¼ íƒ€ì…ì€ Astroì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- `.wasm` ë˜ëŠ” `.wasm?module`: ì¸ìŠ¤í„´ìŠ¤í™”í•  ìˆ˜ ìˆëŠ” [`WebAssembly.Module`](https://developer.mozilla.org/ko/docs/WebAssembly/JavaScript_interface/Module)ì„ ë‚´ë³´ëƒ…ë‹ˆë‹¤.
- `.bin`: íŒŒì¼ì˜ ì›ì‹œ ë°”ì´ë„ˆë¦¬ ì½˜í…ì¸ ì˜ [`ArrayBuffer`](https://developer.mozilla.org/ko/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer)ë¥¼ ë‚´ë³´ëƒ…ë‹ˆë‹¤.
- `.txt`: íŒŒì¼ ì½˜í…ì¸ ì˜ ë¬¸ìì—´ì„ ë‚´ë³´ëƒ…ë‹ˆë‹¤.

ëª¨ë“  ëª¨ë“ˆ íƒ€ì…ì€ ë‹¨ì¼ ê¸°ë³¸ê°’ì„ ë‚´ë³´ëƒ…ë‹ˆë‹¤. ëª¨ë“ˆì€ ì„œë²„ ì¸¡ì—ì„œ ë Œë”ë§ëœ í˜ì´ì§€ ë˜ëŠ” ì •ì  ì‚¬ì´íŠ¸ ìƒì„±ì„ ìœ„í•´ ì‚¬ì „ ë Œë”ë§ëœ í˜ì´ì§€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ ìš”ì²­ì˜ ìˆ«ì ë§¤ê°œë³€ìˆ˜ë¥¼ í•¨ê»˜ ì¶”ê°€í•˜ì—¬ ìš”ì²­ì— ì‘ë‹µí•˜ëŠ” Wasm ëª¨ë“ˆì„ ê°€ì ¸ì˜¤ëŠ” ì˜ˆì‹œì…ë‹ˆë‹¤.

```js title="pages/add/[a]/[b].js"
// WebAssembly ëª¨ë“ˆ ê°€ì ¸ì˜¤ê¸°
import mod from '../util/add.wasm';

// ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë¨¼ì € ì¸ìŠ¤í„´ìŠ¤í™”
const addModule: any = new WebAssembly.Instance(mod);

export async function GET(context) {
  const a = Number.parseInt(context.params.a);
  const b = Number.parseInt(context.params.b);
  return new Response(`${addModule.exports.add(a, b)}`);
}
```

ì´ ì˜ˆì‹œëŠ” ì‚¬ì†Œí•˜ì§€ë§Œ Wasmì„ ì‚¬ìš©í•˜ë©´ ì´ë¯¸ì§€ ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í¬í•¨í•˜ê±°ë‚˜ ì½ê¸° ì „ìš© ë°ì´í„° ì„¸íŠ¸ì— ëŒ€í•œ ê²€ìƒ‰ì„ ìœ„í•´ ë¯¸ë¦¬ ì¸ë±ì‹±ëœ ì‘ì€ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í¬í•¨í•˜ëŠ” ë“± ì¤‘ìš”í•œ I/Oë¥¼ í¬í•¨í•˜ì§€ ì•ŠëŠ” ê³„ì‚° ì§‘ì•½ì ì¸ ì‘ì—…ì„ ê°€ì†í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Node.js í˜¸í™˜ì„±

ê¸°ë³¸ì ìœ¼ë¡œ CloudflareëŠ” Node.js ëŸ°íƒ€ì„ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ì¼ë¶€ êµ¬ì„±ì—ì„œëŠ” Cloudflareê°€ Node.js ëŸ°íƒ€ì„ APIì˜ í•˜ìœ„ ì§‘í•©ì„ ì§€ì›í•©ë‹ˆë‹¤. Cloudflareì˜ [ë¬¸ì„œ](https://developers.cloudflare.com/workers/runtime-apis/nodejs)ì—ì„œ ì§€ì›ë˜ëŠ” Node.js ëŸ°íƒ€ì„ APIë¥¼ ì°¾ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ APIë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ í˜ì´ì§€ ë˜ëŠ” ì—”ë“œí¬ì¸íŠ¸ê°€ ì„œë²„ ì¸¡ì—ì„œ ë Œë”ë§ë˜ì–´ì•¼ í•˜ë©° (ì‚¬ì „ ë Œë”ë§ë˜ì§€ ì•ŠìŒ) `import {} from 'node:*'` ê°€ì ¸ì˜¤ê¸° êµ¬ë¬¸ì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

```js title="pages/api/endpoint.js"
export const prerender = false;
import { Buffer } from 'node:buffer';
```

ë˜í•œ `node:*` import êµ¬ë¬¸ì„ í—ˆìš©í•˜ë ¤ë©´ Astro êµ¬ì„±ì—ì„œ `vite` êµ¬ì„±ì„ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

```js title="astro.config.mjs" ins={7-11}
import {defineConfig} from "astro/config";
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  adapter: cloudflare({}),
  output: 'server',
  vite: {
		ssr: {
			external: ['node:buffer'],
		},
	},
})
```

ë˜í•œ í™œì„±í™”ë¥¼ ì§€ì›í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ Cloudflare ë¬¸ì„œë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤. ìì„¸í•œ ì§€ì¹¨ì€ [Node.js í˜¸í™˜ì„± í™œì„±í™”ì— ëŒ€í•œ Cloudflare ë¬¸ì„œ](https://developers.cloudflare.com/workers/runtime-apis/nodejs/)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

:::note[íŒ¨í‚¤ì§€ í˜¸í™˜ì„±ì— ë¯¸ì¹˜ëŠ” ì˜í–¥]
í”„ë¡œì íŠ¸ê°€ Node.js ëŸ°íƒ€ì„ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë²„ë¡œ íŒ¨í‚¤ì§€ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²½ìš°, Cloudflareì— ë°°í¬í•  ë•Œ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì œëŠ” `node:*` import êµ¬ë¬¸ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” íŒ¨í‚¤ì§€ì—ì„œ ë°œìƒí•©ë‹ˆë‹¤. íŒ¨í‚¤ì§€ê°€ ìœ„ import êµ¬ë¬¸ì„ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ íŒ¨í‚¤ì§€ ì‘ì„±ìì—ê²Œ ë¬¸ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. íŒ¨í‚¤ì§€ê°€ ì´ë¥¼ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©´ ë‹¤ë¥¸ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.
:::

## Wranglerë¡œ ë¯¸ë¦¬ë³´ê¸°

[`wrangler`](https://developers.cloudflare.com/workers/wrangler/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ë ¤ë©´ ë¯¸ë¦¬ë³´ê¸° ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.

Workersë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

```json title="package.json"
"preview": "wrangler dev ./dist"
```

Pagesë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°:

```json title="package.json"
"preview": "wrangler pages dev ./dist"
```

[`wrangler`](https://developers.cloudflare.com/workers/wrangler/)ë¥¼ ì‚¬ìš©í•˜ì—¬ ê°œë°œí•˜ë©´ [Cloudflare ë°”ì¸ë”©](https://developers.cloudflare.com/pages/platform/functions/bindings), [í™˜ê²½ ë³€ìˆ˜](https://developers.cloudflare.com/pages/platform/functions/bindings/#environment-variables), [cf ê°ì²´](https://developers.cloudflare.com/workers/runtime-apis/request/#incomingrequestcfproperties)ì— ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Wranglerì™€ í•¨ê»˜ ì‘ë™í•˜ë„ë¡ í•« ë¦¬ë¡œë“œ ë˜ëŠ” Astro ê°œë°œ ì„œë²„ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ ì‚¬ìš©ì ì •ì˜ ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. [ì»¤ë®¤ë‹ˆí‹° ì˜ˆì‹œ](https://github.com/withastro/roadmap/discussions/590)ë¥¼ ì°¸ì¡°í•˜ì„¸ìš”.

### ì˜ë¯¸ ìˆëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€

í˜„ì¬ Wranglerì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•˜ëŠ” ë™ì•ˆ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ëŠ” ì½”ë“œ ì¶•ì†Œë¡œ ì¸í•´ ê·¸ë‹¤ì§€ ìœ ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë” ë‚˜ì€ ë””ë²„ê¹…ì„ ìœ„í•´ `astro.config.mjs` íŒŒì¼ì— `vite.build.minify = false` ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js title="astro.config.mjs" ins={4-8}
export default defineConfig({
  adapter: cloudflare(),
  output: 'server',
  vite: {
    build: {
      minify: false,
    },
  },
});
```

[astro-integration]: /ko/guides/integrations-guide/
