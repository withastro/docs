---
title: Sesje
description: UdostÄ™pnianie danych pomiÄ™dzy Å¼Ä…daniami dla stron renderowanych na Å¼Ä…danie
i18nReady: true
---

import Since from '~/components/Since.astro';
import ReadMore from '~/components/ReadMore.astro';

<p>
<Since v="5.7.0" />
</p>

Sesje sÄ… uÅ¼ywane do udostÄ™pniania danych pomiÄ™dzy Å¼Ä…daniami dla [stron renderowanych na Å¼Ä…danie](/en/guides/on-demand-rendering/). 

W odrÃ³znieniu do plikÃ³w [`cookies`](/en/guides/on-demand-rendering/#cookies), sesje sÄ… przechowywane na serwerze. DziÄ™ki temu moÅ¼esz przechowywaÄ‡ wiÄ™ksze iloÅ›ci danych bez obaw o ograniczenia rozmiaru czy problemy z bezpieczeÅ„stwem.
Sesje sÄ… przydatne do przechowywania takich informacji jak dane uÅ¼ytkownika, zawartoÅ›Ä‡ koszyka czy stan formularzy. Sesje dziaÅ‚ajÄ… bez potrzeby uÅ¼ycia JavaScriptu po stronie klienta.

```astro title="src/components/CartButton.astro" {3}
---
export const prerender = false; // Nie potrzebne przy output'cie z serwera
const cart = await Astro.session?.get('cart');
---

<a href="/checkout">ğŸ›’ {cart?.length ?? 0} items</a>
```

## Konfiguracja Sesji

Sesje wymagajÄ… sterownika magazynu do przechowywania danych sesji. NiektÃ³re adaptery, takie jak: [Node](/en/guides/integrations-guide/node/#sessions), [Cloudflare](/en/guides/integrations-guide/cloudflare/#sessions), i [Netlify](/en/guides/integrations-guide/netlify/#sessions) automatycznie konfigurujÄ… domyÅ›lny sterownik. PozostaÅ‚e wymagajÄ… rÄ™cznej konfiguracji. [rÄ™czna konfiguracja sterownika](/en/reference/configuration-reference/#sessiondriver). 

```js title="astro.config.mjs" ins={4}
  {
    adapter: vercel(),
    session: {
      driver: "redis",
    },
  }
```

<ReadMore>
  Zobacz [opcje konfiguracji sesji](/en/reference/configuration-reference/#session-options) aby uzyskaÄ‡ wiÄ™cej informacji na temat konfiguracji sterownika magazynu oraz innych opcji konfiguracyjnych.
</ReadMore>


## Interakcja z danymi Sesji

Obiekt [`session`](/en/reference/api-reference/#session) Pozwala na interakcjÄ™ z przechowywanym stanem (state) uÅ¼ytkownika (np. dodanie przedmiotÃ³w do koszyka) oraz z identyfikatorem (ID) sesji (np. usuniÄ™cie pliku cookie zawierajÄ…cego ID sesji podczas wylogowywania). Objekt jest dostÄ™pny jako `Astro.session` w komponentach i stronach Astro oraz jako obiekt `context.session` w endpointach API, middleware i akcjach.

Sesja jest generowana automatycznie przy pierwszym uÅ¼yciu i moÅ¼e zostaÄ‡ ponownie wygenerowana w dowolnym momencie przy uÅ¼yciu [`session.regenerate()`](/en/reference/api-reference/#regenerate) albo usuniÄ™ta za pomocÄ… [`session.destroy()`](/en/reference/api-reference/#destroy).

W wielu przypadkach, wystarczy uÅ¼ycie [`session.get()`](/en/reference/api-reference/#get) i [`session.set()`](/en/reference/api-reference/#set). 

<ReadMore>
Zobacz [dokumentacji API Sesji](/en/reference/api-reference/#session) po wiÄ™cej szczegÃ³Å‚Ã³w.
</ReadMore>

### Komponenty i strony Astro

W komponentach i stronach`.astro` , moÅ¼liwe jest uzyskanie dostÄ™pu do obiektu sesji za poÅ›rednictwem globalnego obiektu Astro. Na przykÅ‚ad, aby wyÅ›wietliÄ‡ liczbÄ™ przedmiotÃ³w w koszyku:

```astro title="src/components/CartButton.astro" "Astro.session"
---
export const prerender = false; // Nie potrzebne przy output'cie z serwera
const cart = await Astro.session?.get('cart');
---

<a href="/checkout">ğŸ›’ {cart?.length ?? 0} items</a>
```

### Endpointy API

W endpointach API, obiekt sesji dostÄ™pny jest w obiekcie `context`. Dla przykÅ‚adu, dodanie przedmiotu do koszyka:

```ts title="src/pages/api/addToCart.ts" "context.session"
export async function POST(context: APIContext) {
  const cart = await context.session?.get('cart') || [];
	const data = await context.request.json<{ item: string }>();
  if(!data?.item) {
    return new Response('Item is required', { status: 400 });
  }
  cart.push(data.item);
  await context.session?.set('cart', cart);
  return Response.json(cart);
}
```

### Akcje (Actions)

W przypadku akcji, obiekt sesji dostÄ™pny jest w obiekcie `context`. Dla przykÅ‚adu, dodanie przedmiotu do koszyka:

```ts title="src/actions/addToCart.ts" "context.session"
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';

export const server = {
  addToCart: defineAction({
    input: z.object({ productId: z.string() }),
    handler: async (input, context) => {
      const cart = await context.session?.get('cart');
      cart.push(input.productId);
      await context.session?.set('cart', cart);
      return cart;
    },
  }),
};
```

### Middleware

:::note
Sesje nie sÄ… obsÅ‚ugiwane w middleware dziaÅ‚ajÄ…cym na krawÄ™dzi (edge middleware).
:::

W middleware, obiekt sesji dostÄ™pny jest w obiekcie `context`. Dla przykÅ‚adu, ustawienie ostatniej wizyty (`lastVisit`) podczas sesji:

```ts title="src/middleware.ts" "context.session"
import { defineMiddleware } from 'astro:middleware';

export const onRequest = defineMiddleware(async (context, next) => {
  context.session?.set('lastVisit', new Date());
  return next();
});
```

## Typy danych Sesji

DomyÅ›lnie dane sesji sÄ… nietypowane. Dowolne dane (typ danych) mogÄ… byÄ‡ przechowywane pod dowolnym kluczem. WartoÅ›ci sÄ… serializowane i deserializowane przy uÅ¼yciu biblioteki [devalue](https://github.com/Rich-Harris/devalue), tej samej, ktÃ³ra jest uÅ¼ywana w kolekcjach treÅ›ci (content collections) oraz w akcjach (actions). ObsÅ‚ugiwane typy danych sÄ… takie same i obejmujÄ…: ciÄ…gi znakÃ³w (stringi), liczby, obiekty Date, Map, Set, URL, tablice oraz zwykÅ‚e obiekty (plain objects).

Opcjonalnie moÅ¼na zdefiniowaÄ‡ [typy TypeScript](/en/guides/typescript/#extending-global-types) dla danych sesji, tworzÄ…c plik `src/env.d.ts`  i dodajÄ…c deklaracjÄ™ typu `App.SessionData`:

```ts title="src/env.d.ts"
declare namespace App {
  interface SessionData {
    user: {
      id: string;
      name: string;
    };
    cart: string[];
  }
}
```

UmoÅ¼liwia to dostÄ™p do danych sesji z wykorzystaniem sprawdzania typÃ³w (type-checking) oraz autouzupeÅ‚niania w edytorze.:

```ts title="src/components/CartButton.astro"
---
const cart = await Astro.session?.get('cart');
// const cart: string[] | undefined

const something = await Astro.session?.get('something');
// const something: any

Astro.session?.set('user', { id: 1, name: 'Houston' });
// Error: Argument of type '{ id: number; name: string }' is not assignable to parameter of type '{ id: string; name: string; }'.
---
```

:::caution
SÅ‚uÅ¼y to wyÅ‚Ä…cznie do sprawdzania typÃ³w i nie wpÅ‚ywa na dziaÅ‚anie sesji w czasie wykonywania (runtime).
NaleÅ¼y zachowaÄ‡ szczegÃ³lnÄ… ostroÅ¼noÅ›Ä‡ przy zmianie typu, gdy uÅ¼ytkownicy majÄ… juÅ¼ zapisane dane w sesji, poniewaÅ¼ moÅ¼e to spowodowaÄ‡ bÅ‚Ä™dy w czasie dziaÅ‚ania.
:::
