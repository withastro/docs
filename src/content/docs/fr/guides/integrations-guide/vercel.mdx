---
type: integration
title: '@astrojs/vercel'
description: "Apprenez √† utiliser l'adaptateur SSR @astrojs/vercel pour d√©ployer votre projet Astro."
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/vercel/'
category: adapter
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import Since from '~/components/Since.astro';

Cet adaptateur permet √† Astro de d√©ployer votre [site rendu `hybrid` ou `server`](/fr/core-concepts/rendering-modes/#rendu-√†-la-demande) sur [Vercel](https://www.vercel.com/).

Si vous utilisez Astro en tant que [constructeur de site statique](/fr/core-concepts/rendering-modes/#pr√©-rendu), vous n'avez pas besoin d'adaptateur.

Apprenez √† d√©ployer votre site Astro dans notre [Guide de d√©ploiement Vercel](/fr/guides/deploy/vercel/).

## Pourquoi Astro Vercel ?

[Vercel](https://www.vercel.com/) est une plateforme de d√©ploiement qui vous permet d'h√©berger votre site en vous connectant directement √† votre d√©p√¥t GitHub. Cet adaptateur am√©liore le processus de construction d'Astro pour pr√©parer votre projet √† √™tre d√©ploy√© via Vercel.

## Installation

Astro inclut une commande `astro add` pour automatiser l'installation des int√©grations officielles. Si vous pr√©f√©rez, vous pouvez [installer les int√©grations manuellement](#installation-manuelle) √† la place.

Ajoutez l'adaptateur Vercel pour activer SSR dans votre projet Astro avec la commande `astro add` suivante. Cela installera `@astrojs/vercel` et apportera les changements appropri√©s √† votre fichier `astro.config.mjs` en une seule √©tape.

<PackageManagerTabs>
  <Fragment slot="npm">
    ```sh
    npx astro add vercel
    ```
  </Fragment>
  <Fragment slot="pnpm">
    ```sh
    pnpm astro add vercel
    ```
  </Fragment>
  <Fragment slot="yarn">
    ```sh
    yarn astro add vercel
    ```
  </Fragment>
</PackageManagerTabs>

### Installation manuelle

Tout d'abord, ajoutez l'adaptateur `@astrojs/vercel` aux d√©pendances de votre projet en utilisant votre gestionnaire de paquets pr√©f√©r√© :

<PackageManagerTabs>
  <Fragment slot="npm">
    ```sh
    npm install @astrojs/vercel
    ```
  </Fragment>
  <Fragment slot="pnpm">
    ```sh
    pnpm add @astrojs/vercel
    ```
  </Fragment>
  <Fragment slot="yarn">
    ```sh
    yarn add @astrojs/vercel
    ```
  </Fragment>
</PackageManagerTabs>

Ensuite, ajoutez l'adaptateur et votre [mode de rendu √† la demande](/fr/core-concepts/rendering-modes/#rendu-√†-la-demande) √† votre fichier `astro.config.*` :

```js title="astro.config.mjs" ins={2, 6-7}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel(),
});
```

### Choix d'une m√©thode de d√©ploiement

Vous pouvez vous d√©ployer vers diff√©rentes cibles :

* `serverless` : SSR √† l'int√©rieur d'une [fonction Node.js](https://vercel.com/docs/concepts/functions/serverless-functions).
* `static` : g√©n√®re un site web statique en suivant les formats de sortie de Vercel, les redirections, etc.

Vous pouvez changer la cible en changeant l'importation :

```js "serverless" "static"
import vercel from '@astrojs/vercel/serverless';
import vercel from '@astrojs/vercel/static';
```

## Utilisation

üìö **[Lire le guide de d√©ploiement complet ici.](/fr/guides/deploy/vercel/)**

Vous pouvez d√©ployer par CLI (`vercel deploy`) ou en connectant votre nouveau repo dans le [Vercel Dashboard](https://vercel.com/). Vous pouvez √©galement cr√©er une version de production localement :

```sh
astro build
vercel deploy --prebuilt
```

## Configuration

Pour configurer cet adaptateur, passez un objet √† l'appel de la fonction `vercel()` dans `astro.config.mjs` :

### Web Analytics

**Type:** `VercelWebAnalyticsConfig`<br/>
**Disponible pour:** Serverless, Static<br/>
<Since v="3.8.0" pkg="@astrojs/vercel" />

Vous pouvez activer [Vercel Web Analytics](https://vercel.com/docs/concepts/analytics) en d√©finissant `webAnalytics : { enabled : true }`. Cela injectera les scripts de suivi de Vercel dans toutes vos pages.

```js title="astro.config.mjs" ins={8-10}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    webAnalytics: {
      enabled: true,
    },
  }),
});
```

### imagesConfig

**Type :** `VercelImageConfig`<br/>
**Disponible pour :** Serverless, Static
<Since v="3.3.0" pkg="@astrojs/vercel" />

Options de configuration pour [Image Optimization API de Vercel](https://vercel.com/docs/concepts/image-optimization). Voir [la documentation sur la configuration des images de Vercel](https://vercel.com/docs/build-output-api/v3/configuration#images) pour une liste compl√®te des param√®tres pris en charge.

Les propri√©t√©s `domains` et `remotePatterns` seront automatiquement remplies en utilisant [les param√®tres `image` correspondants d'Astro](/fr/reference/configuration-reference/#image-options).

```js title="astro.config.mjs" ins={8-10}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/static';

export default defineConfig({
  // ...
  output: 'static',
  adapter: vercel({
    imagesConfig: {
      sizes: [320, 640, 1280],
    },
  }),
});
```

### imageService

**Type :** `boolean`<br/>
**Disponible pour :** Serverless, Static
<Since v="3.3.0" pkg="@astrojs/vercel" />

Lorsque cette option est activ√©e, un [Service d'images](/fr/reference/image-service-reference/) aliment√© par l'API Vercel Image Optimization sera automatiquement configur√© et utilis√© en production. En d√©veloppement, le service d'image sp√©cifi√© par [`devImageService`](#devimageservice) sera utilis√© √† la place.

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/static';

export default defineConfig({
  // ...
  output: 'static',
  adapter: vercel({
    imageService: true,
  }),
});
```

```astro title="src/pages/index.astro"
---
import { Image } from 'astro:assets';
import astroLogo from '../assets/logo.png';
---

<!-- This component -->
<Image src={astroLogo} alt="Mon super logo !" />

<!-- deviendra le HTML suivant -->
<img
  src="/_vercel/image?url=_astro/logo.hash.png&w=...&q=..."
  alt="Mon super logo !"
  loading="lazy"
  decoding="async"
  width="..."
  height="..."
/>
```

### devImageService

**Type :** `'sharp' | 'squoosh' | string`<br/>
**Disponible pour :** Serverless, Static
<Since v="3.8.0" pkg="@astrojs/vercel" />
**Default**: 'sharp'

Permet de configurer le service d'images √† utiliser pour le d√©veloppement lorsque [imageService](#imageservice) est activ√©. Cela peut √™tre utile si vous ne pouvez pas installer les d√©pendances de Sharp sur votre machine de d√©veloppement, mais que l'utilisation d'un autre service d'image comme Squoosh vous permet de pr√©visualiser les images dans votre environnement de d√©veloppement. La construction n'est pas affect√©e et utilisera toujours l'optimisation d'image de Vercel.

Il peut √©galement √™tre d√©fini √† une valeur arbitraire afin d'utiliser un service d'images personnalis√© au lieu des services int√©gr√©s d'Astro.

```js title="astro.config.mjs" ins={8-9}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    imageService: true,
    devImageService: 'squoosh',
  }),
});
```

### includeFiles

**Type :** `string[]`<br/>
**Disponible pour :** Serverless

Utilisez cette propri√©t√© pour forcer l'int√©gration de fichiers dans votre fonction. C'est utile lorsque vous remarquez qu'il manque des fichiers.

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    includeFiles: ['./my-data.json'],
  }),
});
```

### excludeFiles

**Type :** `string[]`<br/>
**Disponible pour :** Serverless

Utilisez cette propri√©t√© pour exclure du processus de regroupement des fichiers qui seraient autrement inclus.

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    excludeFiles: ['./src/some_big_file.jpg'],
  }),
});
```

### maxDuration

**Type :** `number`<br/>
**Disponible pour :** Serverless

Utilisez cette propri√©t√© pour √©tendre ou limiter la dur√©e maximale (en secondes) que les fonctions Serverless peuvent ex√©cuter avant de s'arr√™ter. Voir la [documentation Vercel](https://vercel.com/docs/functions/serverless-functions/runtimes#maxduration) pour la limite par d√©faut et la limite maximale pour votre plan de compte.

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
// ...
  output: "server",
  adapter: vercel({
    maxDuration: 60
  }),
});
```

### Configuration du regroupement des fonctions

L'adaptateur Vercel combine toutes vos routes en une seule fonction par d√©faut.

Vous avez √©galement la possibilit√© de diviser les constructions en une fonction s√©par√©e pour chaque route en utilisant l'option `functionPerRoute`. Cela r√©duit la taille de chaque fonction, ce qui signifie que vous √™tes moins susceptible de d√©passer la limite de taille pour une fonction individuelle. De plus, les d√©marrages de code sont plus rapides.

V√©rifiez que votre plan Vercel comprend un nombre appropri√© de fonctions avant d'activer l'option `functionPerRoute`. Par exemple, le niveau gratuit de Vercel limite chaque d√©ploiement √† un maximum de 12 fonctions. Si votre plan Vercel est insuffisant pour le nombre de routes de votre projet, vous recevrez un message d'erreur pendant le d√©ploiement.

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    functionPerRoute: true,
  }),
});
```

### Middleware Vercel Edge 

Vous pouvez utiliser le middleware Vercel Edge pour intercepter une demande et la rediriger avant d'envoyer une r√©ponse. Le middleware de Vercel peut √™tre ex√©cut√© pour les d√©ploiements de type Edge, SSR, et statiques. Il se peut que vous n'ayez pas besoin d'installer ce paquet pour votre middleware. `@vercel/edge` n'est n√©cessaire que pour utiliser certaines fonctionnalit√©s du middleware telles que la g√©olocalisation. Pour plus d'informations, voir [la documentation de Vercel sur le middleware](https://vercel.com/docs/concepts/functions/edge-middleware).

1. Add a `middleware.js` file to the root of your project:

```js title="middleware.js"
export const config = {
  // N'ex√©cutez le middleware que sur l'itin√©raire d'administration.
  matcher: '/admin',
};

export default function middleware(request) {
  const url = new URL(request.url);
  // Vous pouvez r√©cup√©rer l'adresse IP ou les cookies ici.
  if (url.pathname === '/admin') {
    url.pathname = '/';
  }
  return Response.redirect(url);
}
   ```

2. Lorsque vous d√©veloppez localement, vous pouvez lancer `vercel dev` pour ex√©cuter le middleware. En production, Vercel s'en chargera pour vous.



:::caution
**Tentative de r√©√©criture ?** Actuellement, la r√©√©criture d'une requ√™te avec un middleware ne fonctionne que pour les fichiers statiques.
:::

### Le middleware Vercel Edge avec le middleware Astro

L'adaptateur `@astrojs/vercel/serverless` peut cr√©er automatiquement le middleware Vercel Edge √† partir d'un middleware Astro dans votre base de code.

Il s'agit d'une fonctionnalit√© opt-in, et l'option `edgeMiddleware` doit √™tre positionn√©e √† `true` :

```js title="astro.config.mjs" "edgeMiddleware: true"
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  // ...
  output: 'server',
  adapter: vercel({
    edgeMiddleware: true,
  }),
});
```

En option, vous pouvez cr√©er un fichier reconnu par l'adaptateur nomm√© `vercel-edge-middleware.(js|ts)` dans le dossier [`srcDir`](/fr/reference/configuration-reference/#srcdir) pour cr√©er [`Astro.locals`](/fr/reference/api-reference/#astrolocals).

Typings n√©cessite le paquetage [`@vercel/edge`](https://www.npmjs.com/package/@vercel/edge).

```js title="src/vercel-edge-middleware.js"
/**
 *
 * @param options.request {Request}
 * @param options.context {import("@vercel/edge").RequestContext}
 * @returns {object}
 */
export default function ({ request, context }) {
  // faire quelque chose avec la demande et le contexte
  return {
    title: "Blog de Spider-man",
  };
}
```

Si vous utilisez TypeScript, vous pouvez taper la fonction comme suit :

```ts title="src/vercel-edge-middleware.ts"
import type { RequestContext } from '@vercel/edge';

export default function ({ request, context }: { request: Request; context: RequestContext }) {
  // faire quelque chose avec la demande et le contexte
  return {
    title: "Blog de Spider-man",
  };
}
```

Les donn√©es renvoy√©es par cette fonction seront transmises au middleware Astro.

La fonction :

* doit exporter une fonction **par d√©faut** ;
* doit **renvoyer** un `objet` ;
* accepte un objet avec comme propri√©t√©s `request` et `context` ;
* `request` est typ√©e comme [`Request`](https://developer.mozilla.org/fr/docs/Web/API/Request) ;
* `contexte` est typ√© comme [`RequestContext`](https://vercel.com/docs/concepts/functions/edge-functions/vercel-edge-package#requestcontext) ;

#### Limitations et contraintes

Lorsque vous optez pour cette fonctionnalit√©, il y a quelques contraintes √† noter :

* Le middleware Vercel Edge sera toujours la **premi√®re** fonction √† recevoir la `Request` et la derni√®re fonction √† recevoir la `Response`. C'est une contrainte architecturale qui suit les [limites fix√©es par Vercel](https://vercel.com/docs/concepts/functions/edge-middleware).
* Seuls `request` et `context` peuvent √™tre utilis√©s pour produire un objet `Astro.locals`. Les op√©rations telles que les redirections, etc. doivent √™tre d√©l√©gu√©es au middleware Astro.
* Les objets `Astro.locals` **doivent √™tre s√©rialisables**. Si ce n'est pas le cas, cela entra√Ænera une **erreur d'ex√©cution**. Cela signifie que vous ne pouvez pas stocker des types complexes comme `Map`, `function`, `Set`, etc.

### Support des versions de Node.js

L'adaptateur `@astrojs/vercel` supporte des versions sp√©cifiques de Node.js pour d√©ployer votre projet Astro sur Vercel. Pour voir les versions de Node.js support√©es sur Vercel, cliquez sur l'onglet des param√®tres d'un projet et descendez jusqu'√† la section "Node.js Version".

Consultez la [documentation Vercel](https://vercel.com/docs/functions/serverless-functions/runtimes/node-js#default-and-available-versions) pour en savoir plus.


[astro-integration]: /fr/guides/integrations-guide/
