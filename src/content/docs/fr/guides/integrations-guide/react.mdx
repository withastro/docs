---
type: integration
title: '@astrojs/react'
description: "Apprenez √† utiliser l'int√©gration de framework @astrojs/react pour √©tendre la prise en charge des composants dans votre projet Astro."
sidebar:
  label: React
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/react/'
category: renderer
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import Since from '~/components/Since.astro';

Cette **[int√©gration Astro][astro-integration]** permet le rendu et l'hydratation c√¥t√© client pour vos composants [React](https://react.dev/).

## Installation

Astro inclut une commande `astro add` pour automatiser l'installation des int√©grations officielles. Si vous pr√©f√©rez, vous pouvez [installer les int√©grations manuellement](#installation-manuelle) √† la place.

Pour installer `@astrojs/react`, ex√©cutez ce qui suit depuis le r√©pertoire de votre projet et suivez les instructions :

<PackageManagerTabs>
  <Fragment slot="npm">
    ```sh
    npx astro add react
    ```
  </Fragment>
  <Fragment slot="pnpm">
    ```sh
    pnpm astro add react
    ```
  </Fragment>
  <Fragment slot="yarn">
    ```sh
    yarn astro add react
    ```
  </Fragment>
</PackageManagerTabs>

Si vous rencontrez des probl√®mes, [n'h√©sitez pas √† nous les signaler sur GitHub](https://github.com/withastro/astro/issues) et essayez les √©tapes d'installation manuelle ci-dessous.

### Installation manuelle

Tout d'abord, installez le paquet `@astrojs/react` :

<PackageManagerTabs>
  <Fragment slot="npm">
    ```sh
    npm install @astrojs/react
    ```
  </Fragment>
  <Fragment slot="pnpm">
    ```sh
    pnpm add @astrojs/react
    ```
  </Fragment>
  <Fragment slot="yarn">
    ```sh
    yarn add @astrojs/react
    ```
  </Fragment>
</PackageManagerTabs>

La plupart des gestionnaires de paquets installent √©galement les d√©pendances associ√©es. Si vous voyez un avertissement `Cannot find package 'react'` (ou similaire) lorsque vous d√©marrez Astro, vous devrez installer `react` et `react-dom` avec ses d√©finitions de type :

<PackageManagerTabs>
  <Fragment slot="npm">
    ```sh
    npm install react react-dom @types/react @types/react-dom
    ```
  </Fragment>
  <Fragment slot="pnpm">
    ```sh
    pnpm add react react-dom @types/react @types/react-dom
    ```
  </Fragment>
  <Fragment slot="yarn">
    ```sh
    yarn add react react-dom @types/react @types/react-dom
    ```
  </Fragment>
</PackageManagerTabs>

Ensuite, appliquez l'int√©gration √† votre fichier `astro.config.*` en utilisant la propri√©t√© `integrations` :

```js ins="react()" ins={2} title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

export default defineConfig({
  // ...
  integrations: [react()],
});
```

Et ajoutez le code suivant au fichier `tsconfig.json`.

```json title="tsconfig.json" ins={5-8}
{
  "extends": "astro/tsconfigs/strict",
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist"],
  "compilerOptions": {
    "jsx": "react-jsx",
    "jsxImportSource": "react"
  }
}
```

## D√©marrage

Pour utiliser votre premier composant React dans Astro, dirigez-vous vers notre [documentation sur les frameworks UI][astro-ui-frameworks]. Vous y d√©couvrirez :

* üì¶ comment les composants de framework sont charg√©s,
* üíß les options d'hydratation c√¥t√© client, et
* ü§ù les possibilit√©s de m√©langer et d'imbriquer les frameworks.

## Int√©grer des actions avec `useActionState()` (exp√©rimental)

L'int√©gration `@astrojs/react` fournit deux fonctions exp√©rimentales √† utiliser avec les [actions d'Astro][astro-actions]¬†: `experimental_withState()` et `experimental_getActionState()`.

Celles-ci sont utilis√©es avec le [hook useActionState() de React](https://fr.react.dev/reference/react/useActionState) afin de lire et de mettre √† jour l'√©tat c√¥t√© client lorsque des actions sont d√©clench√©es au moment de la soumission du formulaire.

### `experimental_withState()`

<p>

**Type¬†:** `(action: FormFn<T>) => (state: T, formData: FormData) => FormFn<T>`<br />
<Since v="4.3.2" />
</p>

Vous pouvez transmettre `experimental_withState()` et l'action que vous souhaitez d√©clencher au hook `useActionState()` de React en tant que fonction d'action du formulaire. L'exemple ci-dessous transmet une action `like` pour augmenter un compteur, avec un √©tat initial de `0` mention ¬´¬†J'aime¬†¬ª.

```jsx title="Like.tsx" ins={2,7} "useActionState"
import { actions } from 'astro:actions';
import { experimental_withState } from '@astrojs/react/actions';
import { useActionState } from "react";

export function Like({ postId }: { postId: string }) {
  const [state, action, pending] = useActionState(
    experimental_withState(actions.like),
    { data: 0, error: undefined }, // mentions ¬´ J'aime ¬ª et erreurs initiales
  );

  return (
    <form action={action}>
      <input type="hidden" name="postId" value={postId} />
      <button disabled={pending}>{state.data} ‚ù§Ô∏è</button>
    </form>
  );
}
```

La fonction `experimental_withState()` fera correspondre les types d'actions avec les attentes de React et pr√©servera les m√©tadonn√©es utilis√©es pour l'am√©lioration progressive, lui permettant de fonctionner m√™me lorsque JavaScript est d√©sactiv√© sur l'appareil de l'utilisateur.

### `experimental_getActionState()`

<p>

**Type¬†:** `(context: ActionAPIContext) => Promise<T>`<br />
<Since v="4.3.2" />
</p>

Vous pouvez acc√©der √† l'√©tat enregistr√© par `useActionState()` sur le serveur dans votre gestionnaire d'actions (`handler`) √† l'aide de `experimental_getActionState()`. Cette m√©thode accepte le [contexte de l'API d'Astro](/fr/reference/api-reference/#lobjet-de-contexte), et √©ventuellement, vous pouvez appliquer un type au r√©sultat.

L'exemple ci-dessous r√©cup√®re la valeur actuelle des mentions ¬´¬†J'aime¬†¬ª √† partir d'un compteur, typ√©e en tant que nombre, afin de cr√©er une action `like` incr√©mentielle¬†:

```ts title="actions.ts" ins={3,11}
import { defineAction, type SafeResult } from 'astro:actions';
import { z } from 'astro:schema';
import { experimental_getActionState } from '@astrojs/react/actions';

export const server = {
  like: defineAction({
    input: z.object({
      postId: z.string(),
    }),
    handler: async ({ postId }, ctx) => {
      const { data: currentLikes = 0, error } = await experimental_getActionState<SafeResult<any, number>>(ctx);
      
      // g√©rer les erreurs
      if (error) throw error;

      // √©crire dans la base de donn√©es
      return currentLikes + 1;
    },
  })
};
```

## Options

### Combinaison de plusieurs frameworks JSX

Lorsque vous utilisez plusieurs frameworks JSX (React, Preact, Solid) dans le m√™me projet, Astro doit d√©terminer quelles transformations sp√©cifiques au framework JSX doivent √™tre utilis√©es pour chacun de vos composants. Si vous n'avez ajout√© qu'une seule int√©gration de framework JSX √† votre projet, aucune configuration suppl√©mentaire n'est n√©cessaire.

Utilisez les options de configuration `include` (obligatoire) et `exclude` (optionnelle) pour sp√©cifier quels fichiers appartiennent √† quel framework. Fournissez un tableau de fichiers et/ou de dossiers √† `inclure` pour chaque framework que vous utilisez. Des caract√®res joker peuvent √™tre utilis√©s pour inclure plusieurs chemins de fichiers.

Nous recommandons de placer les composants communs du framework dans le m√™me dossier (par exemple `/composants/react/` et `/composants/solid/`) pour faciliter la sp√©cification de vos inclusions, mais ce n'est pas obligatoire :

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import preact from '@astrojs/preact';
import react from '@astrojs/react';
import svelte from '@astrojs/svelte';
import vue from '@astrojs/vue';
import solid from '@astrojs/solid-js';

export default defineConfig({
  // Permettre √† de nombreux frameworks de prendre en charge tous les diff√©rents types de composants.
  // Aucun `include` n'est n√©cessaire si vous n'utilisez qu'un seul framework JSX !
  integrations: [
    preact({
      include: ['**/preact/*'],
    }),
    react({
      include: ['**/react/*'],
    }),
    solid({
      include: ['**/solid/*'],
    }),
  ],
});
```

### Analyse syntaxique des √©l√©ments enfants

Les enfants transmis dans un composant React depuis un composant Astro sont analys√©s comme des cha√Ænes de caract√®res simples, et non comme des n≈ìuds React.

Par exemple, le composant `<ReactComponent />` ci-dessous ne recevra qu'un seul √©l√©ment enfant :

```astro
---
import ReactComponent from './ReactComponent';
---

<ReactComponent>
  <div>un</div>
  <div>deux</div>
</ReactComponent>
```

Si vous utilisez une biblioth√®que qui *attend* que plus d'un √©l√©ment enfant soit pass√©, par exemple pour qu'elle puisse placer certains √©l√©ments √† diff√©rents endroits, vous pourriez trouver cela bloquant.

Vous pouvez utiliser l'option exp√©rimentale `experimentalReactChildren` pour dire √† Astro de toujours passer les enfants √† React en tant que n≈ìuds DOM virtuels React. Il y a un co√ªt d'ex√©cution √† cela, mais cela peut aider √† la compatibilit√©.

Vous pouvez activer cette option dans la configuration de l'int√©gration de React :

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

export default defineConfig({
  // ...
  integrations: [
    react({
      experimentalReactChildren: true,
    }),
  ],
});
```

### D√©sactiver le streaming (exp√©rimental)

Astro diffuse par d√©faut la sortie des composants React. Cependant, vous pouvez d√©sactiver ce comportement en activant l'option `experimentalDisableStreaming`. Cela est particuli√®rement utile pour prendre en charge les biblioth√®ques qui ne fonctionnent pas bien avec le streaming, comme certaines solutions CSS-in-JS.

Pour d√©sactiver le streaming pour tous les composants React de votre projet, configurez `@astrojs/react` avec `experimentalDisableStreaming: true`¬†:

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

export default defineConfig({
  // ...
  integrations: [
    react({
      experimentalDisableStreaming: true,
    }),
  ],
});
```

[astro-integration]: /fr/guides/integrations-guide/

[astro-ui-frameworks]: /fr/guides/framework-components/#utilisation-des-composants-de-framework
