---
title: Guide de mise √† niveau h√©rit√©e v0.x
description: Guide archiv√© documentant les modifications entre les versions ant√©rieures √† la v1 d'Astro
sidebar:
  label: v1.0
i18nReady: false
---
import { Steps } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

Ce guide vous aidera √† effectuer la mise √† niveau gr√¢ce aux modifications majeures apport√©es aux versions ant√©rieures √† la v1 d'Astro.

Vous pouvez mettre √† jour la version d'Astro de votre projet vers la derni√®re version √† l'aide de votre gestionnaire de paquets. Si vous utilisez les int√©grations Astro, vous souhaiterez √©galement les mettre √† jour vers la derni√®re version.
<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # mettre √† jour la d√©pendance astro¬†:
  npm upgrade astro
  # ou, pour mettre √† jour toutes les d√©pendances¬†:
  npm upgrade
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # mettre √† jour la d√©pendance astro¬†:
  pnpm upgrade astro
  # ou, pour mettre √† jour toutes les d√©pendances¬†:
  pnpm upgrade
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # mettre √† jour la d√©pendance astro¬†:
  yarn upgrade astro
  # ou, pour mettre √† jour toutes les d√©pendances¬†:
  yarn upgrade
  ```
  </Fragment>
</PackageManagerTabs>

Consultez le guide ci-dessous pour conna√Ætre les principaux points saillants et pour obtenir des instructions sur la fa√ßon de g√©rer les modifications importantes.

## Astro 1.0

Astro v1.0 introduit certains changements dont vous devez √™tre conscient lors de la migration √† partir des versions v0.x et v1.0-beta. Obtenez plus de d√©tails ci-dessous.

### Mis √† jour¬†: Vite 3

Astro v1.0 est pass√© de Vite 2 √† [Vite 3](https://vite.dev/). Nous avons g√©r√© la majeure partie de la mise √† niveau pour vous dans Astro¬†; cependant, certains comportements subtils de Vite peuvent encore changer entre les versions. Reportez-vous au [Guide de migration Vite](https://vite.dev/guide/migration.html#general-changes) officiel si vous rencontrez des probl√®mes.

### Obsol√®te¬†: `Astro.canonicalURL`

Vous pouvez maintenant utiliser le nouvel assistant [`Astro.url`](/fr/reference/api-reference/#url) pour construire votre propre URL canonique √† partir de l'URL de la page/de la demande actuelle. 

```js del="Astro.canonicalURL" ins="new URL(Astro.url.pathname, Astro.site)"
// Avant :
const canonicalURL = Astro.canonicalURL;
// Apr√®s :
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
```

### Modifi√©¬†: Sp√©cificit√© du CSS √† port√©e limit√©e

La [sp√©cificit√©](https://developer.mozilla.org/fr/docs/Web/CSS/Specificity) sera d√©sormais pr√©serv√©e dans les styles CSS √† port√©e limit√©e. Ce changement fera que la plupart des styles √† port√©e limit√©e auront priorit√© sur les styles globaux. Mais ce comportement n‚Äôest plus explicitement garanti.

Techniquement, cela se fait en utilisant [la pseudo-classe `:where()`](https://developer.mozilla.org/fr/docs/Web/CSS/:where) au lieu d'utiliser les classes directement dans la sortie CSS d'Astro.

Utilisons le bloc de style suivant dans un composant Astro √† titre d'exemple¬†:

```astro
<style>
  div { color: red; } /* sp√©cificit√© 0-0-1 */
</style>
```

Auparavant, Astro transformerait cela en CSS suivant, qui a une sp√©cificit√© de `0-1-1` ‚Äî une sp√©cificit√© plus √©lev√©e que le CSS source¬†:

```css del=".astro-XXXXXX"
div.astro-XXXXXX { color: red; } /* sp√©cificit√© 0-1-1 */
```

D√©sormais, Astro enveloppe le s√©lecteur de classe avec `:where()`, en conservant la sp√©cificit√© de cr√©ation¬†:

```css ins=":where(.astro-XXXXXX)"
div:where(.astro-XXXXXX) { color: red; } /* sp√©cificit√© 0-0-1 */
```
L'augmentation de sp√©cificit√© pr√©c√©dente rendait difficile la combinaison de styles √† port√©e limit√©e dans Astro avec d'autres fichiers CSS ou biblioth√®ques de styles (par exemple Tailwind, les modules CSS, Styled Components, Stitches). Ce changement permettra aux styles √† port√©e limit√©e d'Astro de fonctionner de mani√®re coh√©rente avec ces derniers tout en pr√©servant les limites exclusives qui emp√™chent les styles de s'appliquer en dehors du composant.

:::caution
Lors de la mise √† niveau, veuillez inspecter visuellement la sortie de votre site pour vous assurer que tout est stylis√© comme pr√©vu. Sinon, recherchez votre style √† port√©e limit√©e et augmentez manuellement la sp√©cificit√© du s√©lecteur pour qu'elle corresponde √† l'ancien comportement.
:::

### Obsol√®te¬†: Composants et JSX dans Markdown

Astro ne prend plus en charge par d√©faut les composants ou les expressions JSX dans les pages Markdown. Pour un support √† long terme, vous devez migrer vers l'int√©gration [`@astrojs/mdx`](/fr/guides/integrations-guide/mdx/).

Pour faciliter la migration, un nouvel indicateur `legacy.astroFlavoredMarkdown` (supprim√© dans la version 2.0) peut √™tre utilis√© pour r√©activer les fonctionnalit√©s Markdown pr√©c√©dentes.

### Conversion des fichiers `.md` existants en `.mdx`

Si vous n'√™tes pas familier avec MDX, voici quelques √©tapes que vous pouvez suivre pour convertir rapidement un fichier ¬´ Astro Flavored Markdown ¬ª existant en MDX. Au fur et √† mesure que vous en apprendrez davantage sur MDX, n'h√©sitez pas √† explorer d'autres fa√ßons d'√©crire vos pages¬†!

<Steps>
1. Installez l'int√©gration [`@astrojs/mdx`](/fr/guides/integrations-guide/mdx/).

2. Remplacez l'extension `.md` de vos fichiers existants par `.mdx`

3. Supprimez toutes les propri√©t√©s `setup:` de votre frontmatter et √©crivez √† la place toutes les instructions d'importation sous le frontmatter.

    ```mdx del={4-5} ins={10}
    // src/pages/posts/my-post.mdx
    ---
    layout: '../../layouts/BaseLayout.astro'
    setup: |
      import ReactCounter from '../../components/ReactCounter.jsx'
    title: 'Migration vers MDX'
    date: 2022-07-26
    tags: ["markdown", "mdx", "astro"]
    ---
    import ReactCounter from '../../components/ReactCounter.jsx'

    # {frontmatter.title}

    Voici mon composant compteur, fonctionnant en MDX¬†:

    <ReactCounter client:load />
    ```

4. Mettez √† jour toutes les instructions `Astro.glob()` qui renvoient actuellement des fichiers `.md` afin qu'elles renvoient d√©sormais vos fichiers `.mdx`.

    :::caution
    L'objet renvoy√© lors de l'importation de fichiers `.mdx` (y compris √† l'aide d'Astro.glob) diff√®re de l'objet renvoy√© lors de l'importation de fichiers `.md`. Cependant, `frontmatter`, `file` et `url` fonctionnent de la m√™me mani√®re.
    :::

5. Mettez √† jour toute utilisation du composant `<Content />` pour utiliser l'exportation par d√©faut lors de l'importation de MDX¬†:

    ```astro title="src/pages/index.astro" ins=".default"
    ---
    // Importations multiples avec Astro.glob
    const mdxPosts = await Astro.glob('./posts/*.mdx');
    ---

    {mdxPosts.map(Post => <Post.default />)}
    ```
    
    ```astro title="src/pages/index.astro" ins="default as"
    ---
    // Importer une seule page
    import { default as About } from './about.mdx';
    ---

    <About />    
    ```
</Steps>

:::tip
Pendant votre transition vers MDX, vous souhaiterez peut-√™tre activer l'indicateur `legacy.astroFlavoredMarkdown` (supprim√© dans la version 2.0) et inclure les fichiers **`.md` et `.mdx`**, afin que votre site continue de fonctionner normalement avant m√™me que tous vos fichiers n‚Äôaient √©t√© convertis. Voici une fa√ßon de proc√©der¬†:

```astro
---
const mdPosts = await Astro.glob('../pages/posts/*.md');
const mdxPosts = await Astro.glob('../pages/posts/*.mdx');
const allPosts = [...mdxPosts, ...mdPosts];
---
```
:::

### Composant `<Markdown />` supprim√©

Le composant `<Markdown />` int√©gr√© √† Astro a √©t√© d√©plac√© vers un paquet s√©par√©. Pour continuer √† utiliser ce composant, vous devrez maintenant installer `@astrojs/markdown-component` et mettre √† jour vos importations en cons√©quence. Pour plus de d√©tails, voir [le README de `@astrojs/markdown`](https://github.com/withastro/astro/tree/main/packages/markdown/component).

:::tip
Astro prend d√©sormais en charge [MDX](https://mdxjs.com/) via notre [int√©gration MDX](https://github.com/withastro/astro/tree/main/packages/integrations/mdx). MDX vous donne la possibilit√© d'inclure √† la fois des composants Markdown et des composants import√©s dans le m√™me fichier. MDX peut √™tre une bonne alternative au composant `<Markdown />` en raison de sa grande communaut√© et de ses API stables.
:::

## Migration vers la version¬†1.0.0-b√™ta

Le 4 avril 2022, nous avons publi√© la version b√™ta d'Astro 1.0¬†! üéâ

Si vous venez de la v0.25 ou d'une version ant√©rieure, assurez-vous d'avoir lu et suivi le [Guide de migration v0.26](#migration-vers-la-v026) ci-dessous qui contenait plusieurs changements majeurs.

La version `v1.0.0-beta.0` d'Astro ne contenait aucune modification majeure. Vous trouverez ci-dessous de petits changements introduits pendant la p√©riode b√™ta.

### Modifi√©¬†: Flux RSS

Les flux RSS doivent maintenant √™tre g√©n√©r√©s √† l'aide du paquet `@astrojs/rss`, comme d√©crit dans notre [Guide RSS](/fr/recipes/rss/).

## Migration vers la v0.26
### Nouvelle API de configuration

Notre API de configuration a √©t√© repens√©e pour r√©soudre quelques points de confusion flagrants qui s'√©taient accumul√©s au cours de l'ann√©e derni√®re. La plupart des options de configuration viennent d'√™tre d√©plac√©es ou renomm√©es, ce qui, esp√©rons-le, constituera une mise √† jour rapide pour la plupart des utilisateurs. Quelques options ont √©t√© remani√©es plus en profondeur et peuvent n√©cessiter quelques modifications suppl√©mentaires¬†:

- `.buildOptions.site` a √©t√© remplac√© par `.site` (votre domaine d√©ploy√©) et un nouvelle option `.base` (votre sous-chemin d√©ploy√©).
- `.markdownOptions` a √©t√© remplac√© par `.markdown`, un objet de configuration essentiellement similaire avec quelques petites modifications pour simplifier la configuration de Markdown.
- `.sitemap` a √©t√© d√©plac√© dans l'int√©gration [@astrojs/sitemap](https://www.npmjs.com/package/@astrojs/sitemap).

Si vous ex√©cutez Astro avec une configuration h√©rit√©e, vous verrez un avertissement avec des instructions sur la fa√ßon de la mettre √† jour. Consultez notre [R√©f√©rence de configuration](/fr/reference/configuration-reference/) mise √† jour pour plus d'informations sur la mise √† niveau.

Consultez notre [RFC0019](https://github.com/withastro/rfcs/blob/main/proposals/0019-config-finalization.md) pour en savoir plus sur ces changements.

### Nouvelle API Markdown

Astro v0.26 publie une toute nouvelle API Markdown pour votre contenu. Cela comprenait trois changements majeurs destin√©s aux utilisateurs¬†:
- Vous pouvez d√©sormais importer du contenu Markdown directement √† l'aide d'une importation ESM (`import`/`import()`).
- Une nouvelle API `Astro.glob()`, pour des importations globales plus faciles (notamment pour Markdown).
- **CHANGEMENT DE RUPTURE¬†:** `Astro.fetchContent()` a √©t√© supprim√© et remplac√© par `Astro.glob()`
- **CHANGEMENT DE RUPTURE¬†:** Les objets Markdown ont une interface mise √† jour.

```js del={2} ins={4}
// v0.25
let allPosts = Astro.fetchContent('./posts/*.md');
// v0.26+
let allPosts = await Astro.glob('./posts/*.md');
```

Lors de la migration, faites attention √† la nouvelle interface de l'objet Markdown. Le frontmatter, par exemple, a √©t√© d√©plac√© vers la propri√©t√© `.frontmatter`, donc les r√©f√©rences telles que `post.title` devraient √™tre remplac√©es par `post.frontmatter.title`.

Cela devrait r√©soudre de nombreux probl√®mes pour les utilisateurs de Markdown, y compris de belles am√©liorations de performances pour les sites plus grands.

Consultez notre [RFC0017](https://github.com/withastro/rfcs/blob/main/proposals/0017-markdown-content-redesign.md) pour en savoir plus sur ces changements.

### Nouveau comportement de script par d√©faut

Les balises `<script>` dans les composants Astro sont d√©sormais cr√©√©es, regroup√©es et optimis√©es par d√©faut. Cela compl√®te une d√©marche √† long terme visant √† rendre la syntaxe de nos composants Astro plus coh√©rente, correspondant au comportement optimis√© par d√©faut que nos balises `<style>` poss√®dent aujourd'hui.

Cela inclut quelques changements √† prendre en compte¬†:

- **RUPTURE¬†:** `<script hoist>` est le nouveau comportement par d√©faut de `<script>`. L'attribut `hoist` a √©t√© supprim√©. Pour utiliser le nouveau comportement par d√©faut, assurez-vous qu'il n'y a pas d'autres attributs sur la balise `<script>`. Par exemple, supprimez `type="module"` si vous l'utilisiez auparavant.
- Nouvelle directive `<script is:inline>`, pour r√©tablir le comportement par d√©faut d'une balise `<script>` (non construit, d√©group√©, non modifi√© par Astro).
- Nouvelle directive `<style is:inline>`, pour laisser une balise de style en ligne dans le mod√®le de page (similaire au comportement `<script>` pr√©c√©dent).
- Nouvelle directive `<style is:global>` pour remplacer `<style global>` dans une prochaine version.

```js del={2} ins={4}
// v0.25
<script hoist type="module">
// v0.26+
<script>
```

D√©couvrez comment utiliser les [scripts c√¥t√© client](/fr/guides/client-side-scripts/) dans Astro pour obtenir plus de d√©tails.

Consultez notre [RFC0016](https://github.com/withastro/rfcs/blob/main/proposals/0016-style-script-defaults.md) pour en savoir plus sur ces changements.

### API `Astro.request` mise √† jour

La forme d'`Astro.request` est pass√©e d'un objet personnalis√© √† un objet `Request` standard. Cela fait partie d'un projet visant √† utiliser davantage d'API standards du Web, notamment en ce qui concerne SSR.

Cela inclut quelques changements √† prendre en compte¬†:

- Changez `Astro.request` pour devenir un objet [Request](https://developer.mozilla.org/fr/docs/Web/API/Request).
- D√©placez `Astro.request.params` vers `Astro.params`.
- D√©placez `Astro.request.canonicalURL` vers `Astro.canonicalURL`.

Consultez notre [RFC0018](https://github.com/withastro/rfcs/blob/main/proposals/0018-astro-request.md) pour en savoir plus sur ces changements.

### Autres changements

- Am√©lioration de l'API `Astro.slots` pour prendre en charge la transmission d'arguments aux emplacements bas√©s sur des fonctions. Cela permet la cr√©ation de composants utilitaires plus ergonomiques qui acceptent une fonction de rappel en tant qu'enfant.
- Mise √† jour du formatage de la sortie CLI, en particulier en ce qui concerne le rapport d'erreurs.
- Mise √† jour de `@astrojs/compiler`, corrigeant quelques bugs li√©s √† l'utilisation de RegExp dans frontmatter

## Migration vers la v0.25

### Les int√©grations Astro

La configuration des ¬´¬†moteurs de rendu¬†¬ª a √©t√© remplac√©e par un nouveau syst√®me d'int√©gration officiel¬†! Cela d√©bloque de nouvelles fonctionnalit√©s vraiment int√©ressantes pour Astro. Vous pouvez lire notre guide [Utilisation des int√©grations](/fr/guides/integrations-guide/) pour obtenir plus de d√©tails sur l'utilisation de ce nouveau syst√®me.

Les int√©grations remplacent notre concept original de ¬´¬†moteurs de rendu¬†¬ª et s'accompagnent de quelques modifications importantes et de nouveaux param√®tres par d√©faut pour les utilisateurs existants. Ces changements sont trait√©s ci-dessous.

#### Supprim√©¬†: Support int√©gr√© de frameworks

Auparavant, React, Preact, Svelte et Vue √©taient tous inclus par d√©faut avec Astro. √Ä partir de la version 0.25.0, Astro ne propose plus de moteur de rendu int√©gr√©. Si vous n'aviez pas d'entr√©e de configuration `renderers` d√©j√† d√©finie pour votre projet, vous devrez maintenant installer ces frameworks vous-m√™me.

Lisez notre [proc√©dure √©tape par √©tape](/fr/guides/integrations-guide/) pour savoir comment ajouter une nouvelle int√©gration Astro pour le(s) framework(s) que vous utilisez actuellement.

#### Obsol√®te¬†: Moteurs de rendu

:::note
Lisez cette section si vous avez des ¬´ moteurs de rendu ¬ª personnalis√©s d√©j√† d√©finis dans votre fichier de configuration.
:::

Le nouveau syst√®me d'int√©gration remplace l'ancien syst√®me qui utilisait `renderers`, y compris les paquets `@astrojs/renderer-*` publi√©s sur npm. √Ä l'avenir, `@astrojs/renderer-react` devient `@astrojs/react`, `@astrojs/renderer-vue` devient `@astrojs/vue`, et ainsi de suite.

**Pour migrer¬†:** mettez √† jour Astro vers `v0.25.0`, puis ex√©cutez `astro dev` ou `astro build` avec votre ancien fichier de configuration contenant l'entr√©e obsol√®te `"renderers"`. Vous verrez imm√©diatement un avis vous indiquant les modifications exactes que vous devez apporter √† votre fichier `astro.config.mjs`, en fonction de votre configuration actuelle. Vous pouvez √©galement mettre √† jour vos paquets vous-m√™me, en utilisant le tableau ci-dessous.

Pour une proc√©dure pas √† pas plus approfondie, lisez notre [guide √©tape par √©tape](/fr/guides/integrations-guide/) pour apprendre √† remplacer les moteurs de rendu existants par une nouvelle int√©gration du framework Astro.

```shell add={3-4}
# Installez vos nouvelles int√©grations et frameworks¬†:
# (Lisez la proc√©dure compl√®te¬†: https://docs.astro.build/fr/guides/integrations-guide)
npm install @astrojs/lit lit
npm install @astrojs/react react react-dom
```

```js ins={3-4,8} del={7}
// Ensuite, mettez √† jour votre fichier `astro.config.mjs`¬†:
// (Lisez la proc√©dure compl√®te¬†: https://docs.astro.build/fr/guides/integrations-guide)
import lit from '@astrojs/lit';
import react from '@astrojs/react';

export default {
  renderers: ['@astrojs/renderer-lit', '@astrojs/renderer-react'],
  integrations: [lit(), react()],
}
```

| Moteurs de rendu obsol√®tes sur npm | Int√©grations v0.25+ sur npm |
| ---------------------------------- | --------------------------- |
| @astrojs/renderer-react            | @astrojs/react              |
| @astrojs/renderer-preact           | @astrojs/preact             |
| @astrojs/renderer-solid            | @astrojs/solid-js           |
| @astrojs/renderer-vue              | @astrojs/vue                |
| @astrojs/renderer-svelte           | @astrojs/svelte             |

#### Gestion des d√©pendances homologues

:::note
Lisez cette section si¬†: Vous √™tes sur Node v14 **ou** si vous utilisez un gestionnaire de paquets autre que npm.
:::

Contrairement aux anciens moteurs de rendu, les int√©grations n'utilisent plus les frameworks eux-m√™mes (¬´¬†React¬†¬ª, ¬´¬†Svelte¬†¬ª, ¬´¬†Vue¬†¬ª, etc.) comme d√©pendances directes de l'int√©gration. Au lieu de cela, vous devez maintenant installer vos paquets de framework *en plus de* vos int√©grations.

```shell ins="react react-dom"
# Exemple¬†: installer des int√©grations et des frameworks ensemble
npm install @astrojs/react react react-dom
```

Si vous voyez un avertissement `"Cannot find package 'react'"` (ou similaire) lorsque vous d√©marrez Astro, cela signifie que vous devez installer ce paquet dans votre projet. Consultez notre [note sur les d√©pendances homologues](/fr/guides/troubleshooting/#cannot-find-package-x) dans le guide de d√©pannage pour plus d'informations.

Si vous utilisez `npm` et Node v16+, cela peut √™tre automatiquement g√©r√© pour vous par `npm`, puisque la derni√®re version de `npm` (v7+) installe automatiquement des d√©pendances homologues comme celle-ci. Dans ce cas, l'installation d'un framework tel que ¬´¬†React¬†¬ª dans votre projet est une √©tape facultative mais n√©anmoins recommand√©e.

### Mis √† jour¬†: Coloration syntaxique

Nous aimons trouver des valeurs par d√©faut sens√©es qui ¬´ fonctionnent ¬ª d√®s le d√©part. Dans ce cadre, nous avons d√©cid√© de faire de [Shiki](https://github.com/shikijs/shiki) notre nouveau colorateur de syntaxe par d√©faut. Celui-ci est pr√©configur√© avec le th√®me `github-dark`, fournissant une coloration sans configuration de vos blocs de code, et cela sans ajouter de classes CSS, feuilles de style ou JS c√¥t√© client superflus.

Consultez notre nouvelle documentation sur la coloration syntaxique pour obtenir plus de d√©tails. **Si vous pr√©f√©rez conserver Prism comme colorateur de syntaxe,** d√©finissez l'option `syntaxHighlight` sur `'prism'` dans la configuration de markdown de votre projet.

#### Le composant `<Prism />` a une nouvelle maison

Dans le cadre de notre mission visant √† garder le noyau d'Astro aussi simple que possible, nous avons d√©plac√© le composant `Prism` int√©gr√© de `astro/components` vers le paquet `@astrojs/prism`. Vous pouvez maintenant importer ce composant depuis `@astrojs/prism` comme ceci¬†:

```astro
---
import { Prism } from '@astrojs/prism';
---
```

√âtant donn√© que le paquet `@astrojs/prism` est toujours fourni avec le noyau `astro`, vous n'aurez pas besoin d'installer quoi que ce soit de nouveau, ni d'ajouter Prism en tant qu'int√©gration¬†! Cependant, notez que nous _pr√©voyons_ d'extraire `@astrojs/prism` (et la coloration syntaxique de Prism en g√©n√©ral) dans un paquet distinct et installable √† l'avenir. Consultez la r√©f√©rence de l'API du composant `<Prism />` pour en savoir plus.

### Mise √† niveau de l'analyseur CSS

Notre analyseur CSS interne a √©t√© mis √† jour et offre une meilleure prise en charge de la syntaxe CSS avanc√©e, comme les requ√™tes de conteneur. Cela devrait √™tre un changement pratiquement invisible pour la plupart des utilisateurs, mais nous esp√©rons que les utilisateurs avanc√©s appr√©cieront la prise en charge des nouvelles fonctionnalit√©s CSS.

## Migration vers la v0.24

:::note
La nouvelle strat√©gie de construction est activ√©e par d√©faut sur 0.24. Si vous rencontrez un probl√®me, vous pouvez continuer √† utiliser l'ancienne strat√©gie de construction en passant l'indicateur `--legacy-build`. Veuillez [ouvrir un ticket](https://github.com/withastro/astro/issues/new/choose) afin que nous puissions r√©soudre les probl√®mes li√©s √† la nouvelle strat√©gie de construction.
:::

La version 0.24 a introduit une nouvelle strat√©gie de *construction statique* qui modifie le comportement de quelques fonctionnalit√©s. Dans les versions pr√©c√©dentes d'Astro, ce comportement √©tait disponible avec un indicateur d'adh√©sion¬†: `--experimental-static-build`.

Pour √™tre pr√™t pour la transition, soyez conscient des modifications suivantes qui seront n√©cessaires pour passer √† ce nouveau moteur de construction. Vous pouvez apporter ces modifications √† votre base de code √† tout moment afin d'√™tre pr√™t plus t√¥t que pr√©vu.

### Obsol√®te¬†: `Astro.resolve()`

`Astro.resolve()` vous permet d'obtenir des URL r√©solues vers des ressources que vous pourriez vouloir r√©f√©rencer dans le navigateur. Ceci √©tait le plus couramment utilis√© √† l'int√©rieur des balises `<link>` et `<img>` pour charger des fichiers CSS et des images selon les besoins. Malheureusement, cela ne fonctionnera plus car Astro construit d√©sormais les ressources au *moment de la construction* plut√¥t qu'au *moment du rendu*. Vous souhaiterez mettre √† niveau les r√©f√©rences de vos ressources vers l‚Äôune des options √©volutives suivantes disponibles √† l‚Äôavenir¬†:

#### Comment r√©soudre les fichiers CSS

**1. Importation ESM (Recommand√©)**

**Exemple¬†:** `import './style.css';`  
**Quand l'utiliser¬†:** Si votre fichier CSS r√©side dans le r√©pertoire `src/` et que vous souhaitez des fonctionnalit√©s automatiques de cr√©ation et d'optimisation CSS.

Utilisez une importation ESM pour ajouter du CSS √† la page. Astro d√©tecte ces importations CSS, puis construit, optimise et ajoute automatiquement le CSS √† la page. C'est le moyen le plus simple de migrer depuis `Astro.resolve()` tout en conservant la cr√©ation/regroupement automatique fourni par Astro.

```astro
---
// Exemple¬†: Astro inclura et optimisera automatiquement ce CSS pour vous
import './style.css';
---
<html><!-- Votre page ici --></html>
```

L'importation de fichiers CSS devrait fonctionner partout o√π les importations ESM sont prises en charge, notamment¬†:
- les fichiers JavaScript
- les fichiers TypeScript
- le frontmatter du composant Astro
- des composants n'utilisant pas la syntaxe Astro comme React, Svelte et d'autres

Lorsqu'un fichier CSS est import√© √† l'aide de cette m√©thode, toutes les instructions `@import` sont √©galement r√©solues et int√©gr√©es dans le fichier CSS import√©. Toutes les r√©f√©rences `url()` sont √©galement r√©solues par rapport au fichier source, et toutes les ressources r√©f√©renc√©es avec `url()` seront incluses dans la version finale.

**2. Chemin d'URL absolu**

**Exemple¬†:** `<link href="/style.css">`  
**Quand l'utiliser¬†:** Si votre fichier CSS r√©side √† l'int√©rieur de `public/` et que vous pr√©f√©rez cr√©er vous-m√™me votre √©l√©ment HTML `link`.

Vous pouvez r√©f√©rencer n'importe quel fichier √† l'int√©rieur du r√©pertoire `public/` en utilisant un chemin d'URL absolu dans votre mod√®le de composant. C'est une bonne option si vous souhaitez contr√¥ler vous-m√™me la balise `<link>` sur la page. Cependant, cette approche ignore √©galement le traitement CSS, le regroupement et les optimisations fournis par Astro lorsque vous utilisez la m√©thode `import` d√©crite ci-dessus.

Nous vous recommandons d'utiliser l'approche `import` plut√¥t que l'approche URL absolue, car elle offre par d√©faut les meilleures performances et fonctionnalit√©s CSS possibles.

#### Comment r√©soudre les fichiers JavaScript

**1. Chemin d'URL absolu**

**Exemple¬†:** `<script src="/some-external-script.js" />`  
**Quand l'utiliser¬†:** Si votre fichier JavaScript r√©side dans `public/`.

Vous pouvez r√©f√©rencer n'importe quel fichier √† l'int√©rieur du r√©pertoire `public/` un utilisant un chemin d'URL absolu dans vos mod√®les de composants Astro. Il s'agit d'une bonne option par d√©faut pour les scripts externes, car elle vous permet de contr√¥ler vous-m√™me la balise `<script>` sur la page.

Notez que cette approche ignore le traitement, le regroupement et les optimisations JavaScript fournis par Astro lorsque vous utilisez la m√©thode `import` d√©crite ci-dessous. Cependant, cela peut √™tre pr√©f√©rable pour tous les scripts externes qui ont d√©j√† √©t√© publi√©s et minifi√©s s√©par√©ment d'Astro. Si votre script a √©t√© t√©l√©charg√© √† partir d'une source externe, cette m√©thode est probablement pr√©f√©rable.

**2. Importation ESM via `<script hoist>`**

**Exemple¬†:** `<script hoist>import './some-external-script.js';</script>`  
**Quand l'utiliser¬†:** Si votre script externe r√©side √† l'int√©rieur de `src/` _et_ s'il prend en charge le type de module ESM.

Utilisez une importation ESM √† l'int√©rieur d'un √©l√©ment `<script hoist>` dans votre mod√®le Astro, et Astro inclura le fichier JavaScript dans votre version finale. Astro d√©tecte ces importations JavaScript c√¥t√© client, puis cr√©e, optimise et ajoute automatiquement le JavaScript √† la page. C'est le moyen le plus simple de migrer depuis `Astro.resolve()` tout en conservant la cr√©ation/le regroupement automatique fourni par Astro.

```astro
<script hoist>
  import './some-external-script.js';
</script>
```

Notez qu'Astro regroupera ce script externe avec le reste de votre JavaScript c√¥t√© client et le chargera dans le contexte du script `type="module"`. Certains fichiers JavaScript plus anciens peuvent ne pas √™tre √©crits pour le contexte `module`, auquel cas il faudra peut-√™tre les mettre √† jour pour utiliser cette m√©thode.

#### Comment r√©soudre les images et autres ressources

**1. Chemin d'URL absolu (Recommended)**

**Exemple¬†:** `<img src="/penguin.png">`  
**Quand l'utiliser¬†:** Si votre ressource r√©side √† l'int√©rieur de `public/`.

Si vous placez vos images √† l'int√©rieur de `public/`, vous pouvez les r√©f√©rencer en toute s√©curit√© par un chemin d'URL absolu directement dans vos mod√®les de composants. Il s'agit du moyen le plus simple de r√©f√©rencer une ressource que vous pouvez utiliser aujourd'hui, et il est recommand√© √† la plupart des utilisateurs qui d√©butent avec Astro.

**2. Importation ESM**

**Exemple¬†:** `import imgUrl from './penguin.png'`  
**Quand l'utiliser¬†:** Si votre ressource r√©side dans le r√©pertoire `src/` et que vous souhaitez des fonctionnalit√©s d'optimisation automatique telles que le hachage de nom de fichier.

Cela fonctionne √† l'int√©rieur de n'importe quel composant JavaScript ou Astro et renvoie une URL r√©solue vers l'image finale. Une fois que vous avez l'URL r√©solue, vous pouvez l'utiliser n'importe o√π dans le mod√®le de composant.

```astro
---
// Exemple¬†: Astro inclura ce fichier image dans votre version finale
import imgUrl from './penguin.png';
---
<img src={imgUrl} />
```

De la m√™me mani√®re qu'Astro g√®re CSS, l'importation ESM permet √† Astro d'effectuer automatiquement quelques optimisations de construction simples. Par exemple, toute ressource √† l'int√©rieur de `src/` qui est import√©e √† l'aide d'une importation ESM (ex¬†: `import imgUrl from './penguin.png'`) verra son nom de fichier hach√© automatiquement. Cela peut vous permettre de mettre en cache le fichier de mani√®re plus agressive sur le serveur, am√©liorant ainsi les performances de l'utilisateur. √Ä l‚Äôavenir, Astro pourrait ajouter d‚Äôautres optimisations comme celle-ci.

**Astuce¬†:** Si vous n'aimez pas les importations ESM statiques, Astro prend √©galement en charge les importations ESM dynamiques. Nous ne recommandons cette option que si vous pr√©f√©rez cette syntaxe¬†: `<img src={(await import('./penguin.png')).default} />`.

### Obsol√®te¬†: Traitement par d√©faut de `<script>`

Auparavant, tous les √©l√©ments `<script>` √©taient lus √† partir de la sortie HTML finale et trait√©s + regroup√©s automatiquement. Ce comportement n'est plus le comportement par d√©faut. √Ä partir de la version 0.24, vous devez accepter le traitement des √©l√©ments `<script>` via l'attribut `hoist`. Le `type="module"` est √©galement requis pour les modules remont√©s.

```astro
<script>
  // Sera rendu dans le HTML exactement comme √©crit¬†!
  // Les importations ESM ne seront pas r√©solues par rapport au fichier.
</script>
<script type="module" hoist>
  // Transform√©¬†! Regroup√©¬†! Les importations ESM fonctionnent, m√™me vers les paquets npm.
</script>
```

## Migration vers la v0.23

### Erreur Sass manquante

```
Preprocessor dependency "sass" not found. Did you install it?
```

Dans notre qu√™te visant √† r√©duire la taille de l'installation via NPM, nous avons d√©plac√© [Sass](https://sass-lang.com/) vers une d√©pendance facultative. Si vous utilisez Sass dans votre projet, vous devez vous assurer d'ex√©cuter `npm install sass --save-dev` pour l'enregistrer en tant que d√©pendance.

### Obsol√®te¬†: HTML sans √©chappement

Dans Astro v0.23+, le contenu HTML non √©chapp√© dans les expressions est d√©sormais obsol√®te.
Dans les versions futures, le contenu des expressions aura des cha√Ænes √©chapp√©es pour se prot√©ger contre toute injection HTML involontaire.

```astro del={1} ins={2}
<h1>{title}</h1> <!-- <h1>Hello <strong>World</strong></h1> -->
<h1>{title}</h1> <!-- <h1>Hello &lt;strong&gt;World&lt;/strong&gt;</h1> -->
```

Pour continuer √† injecter du HTML sans √©chappement, vous pouvez maintenant utiliser `set:html`.

```astro del={1} ins={2}
<h1>{title}</h1>
<h1 set:html={title} />
```

Pour √©viter un √©l√©ment enveloppant, `set:html` peut fonctionner avec `<Fragment>`.

```astro del={1} ins={2}
<h1>{title}!</h1>
<h1><Fragment set:html={title}>!</h1>
```

Vous pouvez √©galement vous prot√©ger contre l'injection HTML involontaire avec `set:text`.

```astro
<h1 set:text={title} /> <!-- <h1>Hello &lt;strong&gt;World&lt;/strong&gt;</h1> -->
```

## Migration vers la v0.21

### Vite

√Ä partir de la v0.21, Astro est construit avec [Vite].
Par cons√©quent, les configurations √©crites dans `snowpack.config.mjs` doivent √™tre d√©plac√©es vers `astro.config.mjs`.

```js
// @ts-check

/** @type {import('astro').AstroUserConfig} */
export default {
  renderers: [],
  vite: {
    plugins: [],
  },
};
```

Pour en savoir plus sur la configuration de Vite, veuillez visiter leur [guide de configuration](https://vite.dev/config/).

#### Les extensions de Vite

Dans Astro v0.21+, les plugins Vite peuvent √™tre configur√©s dans `astro.config.mjs`.

```js ins={4-6}
import { imagetools } from 'vite-imagetools';

export default {
  vite: {
    plugins: [imagetools()],
  },
};
```

Pour en savoir plus sur les plugins Vite, veuillez consulter leur [guide des plugins](https://vite.dev/guide/using-plugins.html).

#### Modifications apport√©es par Vite aux moteurs de rendu

Dans Astro v0.21+, les plugins doivent d√©sormais utiliser `viteConfig()`.

```js del={8-9} ins={2,10-23}
// renderer-svelte/index.js
import { svelte } from '@sveltejs/vite-plugin-svelte';

export default {
  name: '@astrojs/renderer-svelte',
  client: './client.js',
  server: './server.js',
  snowpackPlugin: '@snowpack/plugin-svelte',
  snowpackPluginOptions: { compilerOptions: { hydratable: true } },
  viteConfig() {
    return {
      optimizeDeps: {
        include: ['@astrojs/renderer-svelte/client.js', 'svelte', 'svelte/internal'],
        exclude: ['@astrojs/renderer-svelte/server.js'],
      },
      plugins: [
        svelte({
          emitCss: true,
          compilerOptions: { hydratable: true },
        }),
      ],
    };
  },
}
```

Pour en savoir plus sur les plugins Vite, veuillez consulter leur [guide des plugins](https://vite.dev/guide/using-plugins.html).

:::note
Dans les versions pr√©c√©dentes, ceux-ci √©taient configur√©s avec `snowpackPlugin` ou `snowpackPluginOptions`.
:::

### Alias

Dans Astro v0.21+, des alias d'importation peuvent √™tre ajout√©s dans `tsconfig.json`.

```json add={4-6}
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/components/*": ["src/components/*"]
    }
  }
}
```

_Ces alias sont int√©gr√©s automatiquement dans [VSCode](https://code.visualstudio.com/docs/languages/jsconfig) et d'autres √©diteurs._

### Extensions de fichiers dans les importations

Dans Astro v0.21+, les fichiers doivent √™tre r√©f√©renc√©s par leur extension r√©elle, exactement comme sur le disque. Dans cet exemple, `Div.tsx` devrait √™tre r√©f√©renc√© comme `Div.tsx`, et non comme `Div.jsx`.

```js del={1} ins={2}
import Div from './Div.jsx' // Astro v0.20
import Div from './Div.tsx' // Astro v0.21
```

Ce m√™me changement s'applique √† un fichier compil√© vers CSS comme `Div.scss`¬†:

```astro del={1} ins={2}
<link rel="stylesheet" href={Astro.resolve('./Div.css')}>
<link rel="stylesheet" href={Astro.resolve('./Div.scss')}>
```

### Supprim√©¬†: Composants dans le frontmatter

Auparavant, vous pouviez cr√©er des mini composants Astro √† l'int√©rieur du frontmatter d'Astro, en utilisant la syntaxe JSX au lieu de la syntaxe des composants d'Astro. Cela a toujours √©t√© une sorte de bidouillage, mais dans le nouveau compilateur, cela est devenu impossible √† prendre en charge. Nous esp√©rons r√©introduire cette fonctionnalit√© dans une future version d'Astro en utilisant une API diff√©rente, non JSX.

Pour migrer vers la v0.21+, veuillez convertir tous les composants JSX Astro (c'est-√†-dire tous les composants Astro cr√©√©s dans le cadre d'un autre composant) en composants autonomes.

### Modifications relatives aux styles

#### Pr√©fixeur automatique

Le pr√©fixeur automatique (`autoprefixer`) n‚Äôest plus ex√©cut√© par d√©faut. Pour l'activer¬†:

<Steps>
1. Installez la derni√®re version (`npm install autoprefixer`)

2. Cr√©ez un fichier `postcss.config.cjs` √† la racine de votre projet avec¬†:
   ```js
   module.exports = {
     plugins: {
       autoprefixer: {},
     },
   };
   ```
</Steps>

#### Tailwind CSS

Assurez-vous que PostCSS est install√©. Ceci √©tait facultatif dans les versions pr√©c√©dentes, mais est d√©sormais obligatoire¬†:

<Steps>
1. Installez la derni√®re version de postcss (`npm install -D postcss`)

2. Cr√©ez un fichier `postcss.config.cjs` √† la racine de votre projet avec¬†:
   ```js
   module.exports = {
     plugins: {
       tailwindcss: {},
     },
   };
   ```
   Pour plus d'informations, lisez la [documentation de Tailwind CSS](https://tailwindcss.com/docs/installation#add-tailwind-as-a-post-css-plugin)
</Steps>

### Probl√®mes connus

#### Les importations au sommet

Dans Astro v0.21+, un bug a √©t√© introduit qui n√©cessite que les importations √† l'int√©rieur des composants soient en haut de votre frontmatter.

```astro
---
import Component from '../components/Component.astro'
const whereShouldIPutMyImports = "on top!"
---
```

[vite]: https://vite.dev
