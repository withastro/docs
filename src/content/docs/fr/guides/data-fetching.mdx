---
title: R√©cup√©ration de donn√©es
description: Apprenez √† r√©cup√©rer des donn√©es distantes avec Astro √† l'aide de l'API fetch.
i18nReady: true
---

Les fichiers `.astro` peuvent r√©cup√©rer des donn√©es distantes pour vous aider √† g√©n√©rer de vos pages.

## `fetch()` dans Astro

Tous les [composants Astro](/fr/basics/astro-components/) ont acc√®s √† la [fonction globale `fetch()`](https://developer.mozilla.org/fr/docs/Web/API/fetch) dans le script de leur composant pour effectuer des requ√™tes HTTP aux API en utilisant l'URL compl√®te (par exemple https://example.com/api).
En outre, vous pouvez construire une URL vers les pages et les points d'extr√©mit√© de votre projet qui sont affich√©s √† la demande sur le serveur en utilisant `new URL("/api", Astro.url)`.

Cet appel sera ex√©cut√© au moment de la construction (Build), et les donn√©es seront disponibles pour le mod√®le de composant afin de g√©n√©rer du HTML dynamique. Si le mode [SSR](/fr/guides/on-demand-rendering/) est activ√©, tous les appels de recherche seront ex√©cut√©s au moment de l'ex√©cution.

üí° Profitez de la fonctionnalit√© "[**top-level await (EN)**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/await#top_level_await)" √† l'int√©rieur de votre Script de composant Astro.

üí° Transmettre les donn√©es r√©cup√©r√©es aux composants Astro et aux composants du framework, en tant que props.

```astro /await fetch\\(.*?\\)/
---
// src/components/User.astro
import Contact from '../components/Contact.jsx';
import Location from '../components/Location.astro';

const response = await fetch('https://randomuser.me/api/');
const data = await response.json();
const randomUser = data.results[0];
---
<!-- Les donn√©es r√©cup√©r√©es lors de la construction peuvent √™tre rendues en HTML -->
<h1>Utilisateur</h1>
<h2>{randomUser.name.first} {randomUser.name.last}</h2>

<!-- Les donn√©es r√©cup√©r√©es lors de la construction peuvent √™tre transmises aux composants en tant que props -->
<Contact client:load email={randomUser.email} />
<Location city={randomUser.location.city} />
```

:::note
N'oubliez pas que toutes les donn√©es des composants Astro sont r√©cup√©r√©es lors du rendu du composant.

Votre site Astro d√©ploy√© r√©cup√©rera les donn√©es **une seule fois, au moment de la construction (Build)**. En d√©veloppement, vous verrez les donn√©es r√©cup√©r√©es lors du rafra√Æchissement des composants. Si vous avez besoin de r√©cup√©rer des donn√©es plusieurs fois c√¥t√© client, utilisez un [composant de Framework](/fr/guides/framework-components/) ou un [script cot√© client](/fr/guides/client-side-scripts/) dans un composant Astro.
:::


## `fetch()` dans les Composants de Framework

La fonction `fetch()` est √©galement disponible globalement dans tous les [composants de Framework](/fr/guides/framework-components/) :

```tsx title="src/components/Movies.tsx" /await fetch\\(.*?\\)/
import type { FunctionalComponent } from 'preact';

const data = await fetch('https://example.com/movies.json').then((response) =>
  response.json()
);

// Les composants dont le rendu est effectu√© au moment de la construction se connectent √©galement √† la console (CLI).
// Lorsqu'ils sont rendus avec une directive client:*, ils se connectent √©galement √† la console du navigateur.
console.log(data);

const Movies: FunctionalComponent = () => {
  // Affiche le r√©sultat sur la page
  return <div>{JSON.stringify(data)}</div>;
};

export default Movies;
```


### Requ√™tes GraphQL

Astro peut aussi utiliser `fetch()` pour interroger un serveur GraphQL avec n'importe quelle requ√™te GraphQL valide.

```astro title="src/components/Film.astro" "await fetch"
---
const response = await fetch("https://swapi-graphql.netlify.app/.netlify/functions/index",
  {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      query: `
        query getFilm ($id:ID!) {
          film(id: $id) {
            title
            releaseDate
          }
        }
      `,
      variables: {
        id: "ZmlsbXM6MQ==",
      },
    }),
  });

const json = await response.json();
const { film } = json.data;
---
<h1>Recherche d'informations sur Star Wars : Un nouvel espoir</h1>
<h2>Titre : {film.title}</h2>
<p>Ann√©e : {film.releaseDate}</p>
```


## R√©cup√©rer √† partir d'un Headless CMS

Les composants Astro peuvent r√©cup√©rer des donn√©es de votre CMS pr√©f√©r√© et les restituer sous forme de contenu de page. Gr√¢ce aux [routes dynamiques](/fr/guides/routing/#routes-dynamiques), les composants peuvent m√™me g√©n√©rer des pages bas√©es sur le contenu de votre CMS.

Consultez nos [Guides CMS](/fr/guides/cms/) pour plus de d√©tails sur l'int√©gration d'Astro avec des CMS headless comme Storyblok, Contentful et WordPress.

## Ressources communautaires

- [Cr√©er une application fullstack avec Astro + GraphQL (EN)](https://robkendal.co.uk/blog/how-to-build-astro-site-with-graphql/)
