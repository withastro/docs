---
title: Payload CMS & Astro
description: Ajouter du contenu √† votre projet Astro en utilisant Payload comme CMS
sidebar:
  label: Payload CMS
type: cms
stub: true
service: Payload CMS
i18nReady: true
---
import { Steps } from '@astrojs/starlight/components';

[PayloadCMS](https://payloadcms.com/) est un syst√®me de gestion de contenu open-source qui peut √™tre utilis√© pour fournir du contenu √† votre projet Astro.

## Int√©gration avec Astro

### Pr√©requis

1. **Un projet Astro** - Si vous n'avez pas encore de projet Astro, notre [Guide d'installation](/fr/install-and-setup/) vous permettra d'√™tre op√©rationnel en un rien de temps.
2. **Une base de donn√©es MongoDB** - PayloadCMS vous demandera une cha√Æne de connexion MongoDB lors de la cr√©ation d'un nouveau projet. Vous pouvez en installer une localement ou utiliser [MongoDBAtlas](https://www.mongodb.com/) pour h√©berger une base de donn√©es sur le web gratuitement.
3. **Une API REST PayloadCMS** - Cr√©ez un projet [PayloadCMS](https://payloadcms.com/docs/getting-started/installation) et connectez-le √† votre base de donn√©es MongoDB pendant l'installation.

:::note[Choix d'un mod√®le]
Lors de l'installation de PayloadCMS, il vous sera demand√© si vous souhaitez utiliser un mod√®le.

Le choix d'un des mod√®les disponibles √† cette √©tape (tel que 'blog') g√©n√®re automatiquement des collections suppl√©mentaires que vous pouvez utiliser. Sinon, vous devrez cr√©er manuellement vos collections PayloadCMS.
:::

### Configurer Astro pour votre collection PayloadCMS

Votre mod√®le de projet Payload contiendra un fichier appel√© Posts.ts dans `src/collections/`. Si vous n'avez pas choisi un mod√®le lors de l'installation qui a cr√©√© une collection de contenu pour vous, vous pouvez cr√©er une nouvelle collection Payload CMS en ajoutant ce fichier de configuration manuellement. L'exemple ci-dessous montre ce fichier pour une collection appel√©e `posts` qui n√©cessite les champs `title`, `content` et `slug` :

```ts title="src/collections/Posts.ts"
import { CollectionConfig } from "payload/types";

const Posts: CollectionConfig = {
  slug: "posts",
  admin: {
    useAsTitle: "title",
  },
  access: {
    read: () => true,
  },

  fields: [
    {
      name: "title",
      type: "text",
      required: true,
    },
    {
      name: "content",
      type: "text",
      required: true,
    },
    {
      name: "slug",
      type: "text",
      required: true,
    },
  ],
};

export default Posts;
```

<Steps>
1. Importez et ajoutez `Users` (disponible dans tous les projets PayloadCMS) et toutes les autres collections (par exemple `Posts`) aux collections disponibles dans le fichier `payload.config.ts`.
    ```ts title="src/payload.config.ts" ins={4, 5, 12}
    import { buildConfig } from "payload/config";
    import path from "path";

    import Users from "./collections/Users";
    import Posts from "./collections/Posts";

    export default buildConfig({
      serverURL: "http://localhost:4321",
      admin: {
        user: Users.slug,
      },
      collections: [Users, Posts],
      typescript: {
        outputFile: path.resolve(__dirname, "payload-types.ts"),
      },
      graphQL: {
        schemaOutputFile: path.resolve(__dirname, "generated-schema.graphql"),
      },
    });
    ```

    Une nouvelle collection appel√©e "Posts" appara√Ætra dans votre tableau de bord PayloadCMS √† c√¥t√© de la collection "Users". 

2. Entrez dans la collection "Posts" et cr√©ez un nouveau message. Apr√®s l'avoir enregistr√©, vous remarquerez que l'URL de l'API appara√Æt dans le coin inf√©rieur droit.

3. Avec le serveur de d√©veloppement en cours d'ex√©cution, ouvrez `http://localhost:4321/api/posts` dans votre navigateur. Vous devriez voir un fichier JSON contenant le message que vous avez cr√©√© en tant qu'objet.
    ```json
    {
      "docs":[
          {
            "id":"64098b16483b0f06a7e20ed4",
            "title":"Astro & PayloadCMS Title üöÄ",
            "content":"Astro & PayloadCMS Content",
            "slug":"astro-payloadcms-slug",
            "createdAt":"2023-03-09T07:30:30.837Z",
            "updatedAt":"2023-03-09T07:30:30.837Z"
          }
      ],
      "totalDocs":1,
      "limit":10,
      "totalPages":1,
      "page":1,
      "pagingCounter":1,
      "hasPrevPage":false,
      "hasNextPage":false,
      "prevPage":null,
      "nextPage":null
    }
    ```
</Steps>

:::tip
Par d√©faut, Astro et PayloadCMS utilisent le port 4321. Vous pouvez changer le port de PayloadCMS dans le fichier `src/server.ts`. N'oubliez pas de mettre √† jour le `serverURL` dans `src/payload.config.ts` √©galement.
:::

### R√©cup√©rer des donn√©es

R√©cup√©rez les donn√©es de PayloadCMS via l'URL unique de l'API REST de votre site et la route de votre contenu (par d√©faut, PayloadCMS monte toutes les routes via `/api`). Ensuite, vous pouvez rendre les propri√©t√©s de vos donn√©es en utilisant la directive Astro `set:html=""`.

Avec votre message, PayloadCMS renverra des m√©tadonn√©es de premier niveau. Les documents r√©els sont imbriqu√©s dans le tableau `docs`.

Par exemple, pour afficher une liste de titres d'articles et leur contenu :

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("http://localhost:5000/api/posts") // http://localhost:4321/api/posts by default
const posts = await res.json()
---

<HomeLayout title='Blog Astro'>
	{
    posts.docs.map((post) => (
        <h2 set:html={post.title} />
        <p set:html={post.content} />
    ))
	}
</HomeLayout>
```

## Cr√©er un blog avec PayloadCMS et Astro

Cr√©ez une page d'index de blog `src/pages/index.astro` pour lister chacun de vos articles avec un lien vers sa propre page.

La recherche via l'API renvoie un tableau d'objets (posts) qui incluent, entre autres, les propri√©t√©s suivantes :

- `title`
- `content`
- `slug`

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("http://localhost:5000/api/posts") // http://localhost:4321/api/posts par d√©faut
const posts = await res.json()
---

<HomeLayout title='Astro Blog'>
	<h1>Astro + PayloadCMS üöÄ</h1>
	<h2>Liste d'articles de blog :</h2>
	<ul>
		{
			posts.docs.map((post) =>(
				<li>
					<a href={`posts/${post.slug}`} set:html={post.title} />
				</li>
			))
		}
	</ul>
</HomeLayout>
```

### Utiliser l'API PayloadCMS pour g√©n√©rer des pages

Cr√©er une page `src/pages/posts/[slug].astro` pour [g√©n√©rer dynamiquement une page](/fr/guides/routing/#routes-dynamiques) pour chaque post.

```astro title="src/pages/posts/[slug].astro"
---
import PostLayout from "../../layouts/PostLayout.astro"

const {title, content} = Astro.props

// La fonction getStaticPaths() est n√©cessaire pour les sites statiques sous Astro.
// Si vous utilisez le SSR, vous n'aurez pas besoin de cette fonction.
export async function getStaticPaths() {
    let data = await fetch("http://localhost:5000/api/posts")
    let posts = await data.json()

    return posts.docs.map((post) => {
        return {
            params: {slug: post.slug},
            props: {title: post.title, content: post.content},
        };
    });
} 
---
<PostLayout title={title}>
    <article>
        <h1 set:html={title} />
        <p set:html={content} />
    </article>
</PostLayout>
```

### Publier votre site

Pour d√©ployer votre site, consultez notre [guide de d√©ploiement](/fr/guides/deploy/) et suivez les instructions de votre h√©bergeur pr√©f√©r√©.

## Ressources communautaires 

- D√©couvrez [l'int√©gration Astro officielle du CMS Payload](https://github.com/payloadcms/payload/tree/main/examples/astro).
- Essayez ce [template Payload CMS & Astro](https://github.com/Lambdo-Labs/payloadcms-astro-template).
- Consultez [Astroad](https://github.com/mooxl/astroad) pour un d√©veloppement facile et un d√©ploiement VPS avec Docker.
