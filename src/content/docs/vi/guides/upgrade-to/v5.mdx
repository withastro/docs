---
title: NÃ¢ng cáº¥p lÃªn Astro v5
description: CÃ¡ch nÃ¢ng cáº¥p dá»± Ã¡n cá»§a báº¡n lÃªn Astro v5.0.
sidebar:
  label: v5.0
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import { Steps } from '@astrojs/starlight/components';
import ReadMore from '~/components/ReadMore.astro'
import SourcePR from '~/components/SourcePR.astro'

HÆ°á»›ng dáº«n nÃ y sáº½ giÃºp báº¡n di chuyá»ƒn tá»« Astro v4 sang Astro v5.

Cáº§n nÃ¢ng cáº¥p dá»± Ã¡n cÅ© hÆ¡n lÃªn v4 trÆ°á»›c? Xem [hÆ°á»›ng dáº«n di chuyá»ƒn cÅ© hÆ¡n](/vi/guides/upgrade-to/v4/) cá»§a chÃºng tÃ´i.

Cáº§n xem tÃ i liá»‡u v4? Truy cáº­p [phiÃªn báº£n cÅ© hÆ¡n cá»§a trang tÃ i liá»‡u nÃ y (báº£n snapshot v4.16 khÃ´ng Ä‘Æ°á»£c duy trÃ¬)](https://v4.docs.astro.build/).

## NÃ¢ng cáº¥p Astro

Cáº­p nháº­t phiÃªn báº£n Astro cá»§a dá»± Ã¡n báº¡n lÃªn phiÃªn báº£n má»›i nháº¥t báº±ng trÃ¬nh quáº£n lÃ½ gÃ³i:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # NÃ¢ng cáº¥p Astro vÃ  cÃ¡c integration chÃ­nh thá»©c cÃ¹ng nhau
  npx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # NÃ¢ng cáº¥p Astro vÃ  cÃ¡c integration chÃ­nh thá»©c cÃ¹ng nhau
  pnpm dlx @astrojs/upgrade
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # NÃ¢ng cáº¥p Astro vÃ  cÃ¡c integration chÃ­nh thá»©c cÃ¹ng nhau
  yarn dlx @astrojs/upgrade
  ```
  </Fragment>
</PackageManagerTabs>

Báº¡n cÅ©ng cÃ³ thá»ƒ [nÃ¢ng cáº¥p cÃ¡c integration Astro thá»§ cÃ´ng](/vi/guides/integrations-guide/#manual-upgrading) náº¿u cáº§n, vÃ  báº¡n cÅ©ng cÃ³ thá»ƒ cáº§n nÃ¢ng cáº¥p cÃ¡c dependency khÃ¡c trong dá»± Ã¡n.

:::note[Cáº§n tiáº¿p tá»¥c?]
Sau khi nÃ¢ng cáº¥p Astro, báº¡n cÃ³ thá»ƒ khÃ´ng cáº§n thay Ä‘á»•i gÃ¬ trong dá»± Ã¡n cá»§a mÃ¬nh!

NhÆ°ng náº¿u báº¡n gáº·p lá»—i hoáº·c hÃ nh vi báº¥t thÆ°á»ng, vui lÃ²ng kiá»ƒm tra bÃªn dÆ°á»›i nhá»¯ng gÃ¬ Ä‘Ã£ thay Ä‘á»•i cÃ³ thá»ƒ cáº§n cáº­p nháº­t trong dá»± Ã¡n cá»§a báº¡n.
:::

Astro v5.0 bao gá»“m [nhá»¯ng thay Ä‘á»•i cÃ³ thá»ƒ phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch](#breaking-changes), cÅ©ng nhÆ° viá»‡c xÃ³a bá» vÃ  deprecated má»™t sá»‘ tÃ­nh nÄƒng.

Náº¿u dá»± Ã¡n cá»§a báº¡n khÃ´ng hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i sau khi nÃ¢ng cáº¥p lÃªn v5.0, hÃ£y kiá»ƒm tra hÆ°á»›ng dáº«n nÃ y Ä‘á»ƒ biáº¿t tá»•ng quan vá» táº¥t cáº£ cÃ¡c thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch vÃ  hÆ°á»›ng dáº«n cÃ¡ch cáº­p nháº­t codebase cá»§a báº¡n.

Xem [changelog cá»§a Astro](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) Ä‘á»ƒ biáº¿t ghi chÃº phÃ¡t hÃ nh Ä‘áº§y Ä‘á»§.

## NÃ¢ng cáº¥p Dependencies

Báº¥t ká»³ nÃ¢ng cáº¥p lá»›n nÃ o Ä‘á»‘i vá»›i dependencies cá»§a Astro Ä‘á»u cÃ³ thá»ƒ gÃ¢y ra thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch trong dá»± Ã¡n cá»§a báº¡n.

### Vite 6.0

Astro v5.0 nÃ¢ng cáº¥p lÃªn Vite v6.0 lÃ m development server vÃ  production bundler.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng Shiki transformers Ä‘Æ°á»£c truyá»n cho `markdown.shikiConfig.transformers`, báº¡n pháº£i Ä‘áº£m báº£o ráº±ng chÃºng khÃ´ng sá»­ dá»¥ng hook `postprocess`. Hook nÃ y khÃ´ng cÃ²n cháº¡y trÃªn code blocks trong file `.md` vÃ  `.mdx`. (Xem [tÃ i liá»‡u Shiki vá» transformer hooks](https://shiki.style/guide/transformers#transformer-hooks) Ä‘á»ƒ biáº¿t thÃªm thÃ´ng tin).

Code blocks trong file `.mdoc` vÃ  component `<Code />` tÃ­ch há»£p cá»§a Astro khÃ´ng sá»­ dá»¥ng plugin rehype Shiki ná»™i bá»™ vÃ  khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng.

<ReadMore>Äá»c thÃªm vá» [syntax highlighting trong Astro](/vi/guides/syntax-highlighting/).</ReadMore>

### Thay Ä‘á»•i: HÃ nh vi `charset=utf-8` tá»± Ä‘á»™ng cho cÃ¡c trang Markdown vÃ  MDX

<SourcePR number="12231" title="Unset charset=utf-8 content-type for md/mdx pages"/>

Trong Astro 4.0, cÃ¡c trang Markdown vÃ  MDX (náº±m trong `src/pages/`) tá»± Ä‘á»™ng pháº£n há»“i vá»›i `charset=utf-8` trong header `Content-Type`, cho phÃ©p render cÃ¡c kÃ½ tá»± khÃ´ng pháº£i ASCII trong trang cá»§a báº¡n.

Astro 5.0 cáº­p nháº­t hÃ nh vi Ä‘á»ƒ thÃªm tháº» `<meta charset="utf-8">` thay vÃ o Ä‘Ã³, vÃ  chá»‰ cho cÃ¡c trang khÃ´ng sá»­ dá»¥ng thuá»™c tÃ­nh frontmatter `layout` Ä‘áº·c biá»‡t cá»§a Astro. TÆ°Æ¡ng tá»± cho cÃ¡c trang MDX, Astro sáº½ chá»‰ thÃªm tháº» náº¿u ná»™i dung MDX khÃ´ng import component `Layout` bao bá»c.

Náº¿u cÃ¡c trang Markdown hoáº·c MDX cá»§a báº¡n sá»­ dá»¥ng thuá»™c tÃ­nh frontmatter `layout`, hoáº·c náº¿u ná»™i dung trang MDX import component `Layout` bao bá»c, thÃ¬ HTML encoding sáº½ Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi component layout Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh thay vÃ o Ä‘Ã³, vÃ  tháº» `<meta charset="utf-8">` sáº½ khÃ´ng Ä‘Æ°á»£c thÃªm vÃ o trang cá»§a báº¡n theo máº·c Ä‘á»‹nh.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n yÃªu cáº§u `charset=utf-8` Ä‘á»ƒ render trang cá»§a mÃ¬nh má»™t cÃ¡ch chÃ­nh xÃ¡c, hÃ£y Ä‘áº£m báº£o ráº±ng cÃ¡c component layout cá»§a báº¡n chá»©a tháº» `<meta charset="utf-8">`. Báº¡n cÃ³ thá»ƒ cáº§n thÃªm Ä‘iá»u nÃ y náº¿u báº¡n chÆ°a lÃ m nhÆ° váº­y.

<ReadMore>Äá»c thÃªm vá» [Markdown layouts](/vi/basics/layouts/#markdown-layouts).</ReadMore>

### Thay Ä‘á»•i: Metadata cá»¥ thá»ƒ cá»§a Astro Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m trong cÃ¡c plugin remark vÃ  rehype

<SourcePR number="11861" title="Clean up Astro metadata in vfile.data"/>

Trong Astro 4.x, metadata cá»¥ thá»ƒ cá»§a Astro Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m vÃ o `vfile.data` trong cÃ¡c plugin remark vÃ  rehype Ä‘Æ°á»£c Ä‘Ã­nh kÃ¨m á»Ÿ cÃ¡c vá»‹ trÃ­ khÃ¡c nhau vá»›i tÃªn khÃ´ng nháº¥t quÃ¡n.

Astro 5 dá»n dáº¹p API vÃ  metadata giá» Ä‘Ã¢y Ä‘Æ°á»£c Ä‘á»•i tÃªn nhÆ° bÃªn dÆ°á»›i:

 - `vfile.data.__astroHeadings` -> `vfile.data.astro.headings`
 - `vfile.data.imagePaths` -> `vfile.data.astro.imagePaths`

Kiá»ƒu cá»§a `imagePaths` cÅ©ng Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t tá»« `Set<string>` thÃ nh `string[]`. Metadata `vfile.data.astro.frontmatter` Ä‘Æ°á»£c giá»¯ nguyÃªn.

#### TÃ´i nÃªn lÃ m gÃ¬?

Máº·c dÃ¹ chÃºng tÃ´i khÃ´ng coi nhá»¯ng API nÃ y lÃ  cÃ´ng khai, chÃºng cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p bá»Ÿi cÃ¡c plugin remark vÃ  rehype muá»‘n tÃ¡i sá»­ dá»¥ng metadata cá»§a Astro. Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng nhá»¯ng API nÃ y, hÃ£y Ä‘áº£m báº£o truy cáº­p chÃºng á»Ÿ cÃ¡c vá»‹ trÃ­ má»›i.

<ReadMore>Äá»c thÃªm vá» [sá»­ dá»¥ng Markdown plugins trong Astro](/vi/guides/markdown-content/#markdown-plugins).</ReadMore>

### Thay Ä‘á»•i: cáº¥u hÃ¬nh image endpoint

<SourcePR number="11908" title="Allow customising the route of the image endpoint"/>

Trong Astro 4.x, báº¡n cÃ³ thá»ƒ thiáº¿t láº­p má»™t endpoint trong cáº¥u hÃ¬nh `image` Ä‘á»ƒ sá»­ dá»¥ng cho tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh.

Astro 5.0 cho phÃ©p báº¡n tÃ¹y chá»‰nh `route` vÃ  `entrypoint` cá»§a config `image.endpoint`. Äiá»u nÃ y cÃ³ thá»ƒ há»¯u Ã­ch trong cÃ¡c tÃ¬nh huá»‘ng ngÃ¡ch nÆ¡i route máº·c Ä‘á»‹nh `/_image` xung Ä‘á»™t vá»›i route hiá»‡n cÃ³ hoáº·c thiáº¿t láº­p local server cá»§a báº¡n.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘Ã£ tÃ¹y chá»‰nh `image.endpoint` trÆ°á»›c Ä‘Ã¢y, hÃ£y di chuyá»ƒn endpoint nÃ y sang thuá»™c tÃ­nh `endpoint.entrypoint` má»›i. TÃ¹y chá»n, báº¡n cÃ³ thá»ƒ tÃ¹y chá»‰nh má»™t `route`:

```js title="astro.config.mjs" del={5} ins={6-9}
import { defineConfig } from "astro/config";

defineConfig({
  image: {
    endpoint: './src/image-endpoint.ts',
    endpoint: {
      route: "/image",
      entrypoint: "./src/image_endpoint.ts"
    }
  },
})
```

<ReadMore>Äá»c thÃªm vá» [thiáº¿t láº­p endpoint Ä‘á»ƒ sá»­ dá»¥ng cho tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh](/vi/reference/configuration-reference/#imageendpoint).</ReadMore>

### Thay Ä‘á»•i: hÃ nh vi resolve `build.client` vÃ  `build.server`

<SourcePR number="11916" title="Fix build.client and build.server resolve behaviour" />

Trong Astro v4.x, cÃ¡c tÃ¹y chá»n `build.client` vÃ  `build.server` Ä‘Æ°á»£c ghi chÃ©p Ä‘á»ƒ resolve tÆ°Æ¡ng Ä‘á»‘i tá»« tÃ¹y chá»n `outDir`, nhÆ°ng nÃ³ khÃ´ng luÃ´n hoáº¡t Ä‘á»™ng nhÆ° mong Ä‘á»£i.

Astro 5.0 sá»­a hÃ nh vi Ä‘á»ƒ resolve chÃ­nh xÃ¡c tá»« tÃ¹y chá»n `outDir`. VÃ­ dá»¥, náº¿u `outDir` Ä‘Æ°á»£c thiáº¿t láº­p thÃ nh `./dist/nested/`, thÃ¬ theo máº·c Ä‘á»‹nh:

- `build.client` sáº½ resolve thÃ nh `<root>/dist/nested/client/`
- `build.server` sáº½ resolve thÃ nh `<root>/dist/nested/server/`

TrÆ°á»›c Ä‘Ã¢y cÃ¡c giÃ¡ trá»‹ Ä‘Æ°á»£c resolve khÃ´ng chÃ­nh xÃ¡c:

- `build.client` Ä‘Æ°á»£c resolve thÃ nh `<root>/dist/nested/dist/client/`
- `build.server` Ä‘Æ°á»£c resolve thÃ nh `<root>/dist/nested/dist/server/`

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang dá»±a vÃ o cÃ¡c build paths trÆ°á»›c Ä‘Ã¢y, hÃ£y Ä‘áº£m báº£o ráº±ng code dá»± Ã¡n cá»§a báº¡n Ä‘Æ°á»£c cáº­p nháº­t cho cÃ¡c build paths má»›i.

<ReadMore>Äá»c thÃªm vá» [tÃ¹y chá»n cáº¥u hÃ¬nh `build` trong Astro](/vi/reference/configuration-reference/#build-options).</ReadMore>

### Thay Ä‘á»•i: JS dependencies trong config file khÃ´ng cÃ²n Ä‘Æ°á»£c xá»­ lÃ½ bá»Ÿi Vite

<SourcePR number="11819" title="Set external: true when loading astro config"/>

Trong Astro 4.x, cÃ¡c JS dependencies Ä‘Æ°á»£c liÃªn káº¿t cá»¥c bá»™ (vÃ­ dá»¥: `npm link`, trong monorepo, v.v.) cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c tÃ­nh nÄƒng Vite nhÆ° `import.meta.glob` khi Ä‘Æ°á»£c import bá»Ÿi file config Astro.

Astro 5 cáº­p nháº­t luá»“ng loading config Astro Ä‘á»ƒ bá» qua viá»‡c xá»­ lÃ½ cÃ¡c JS dependencies Ä‘Æ°á»£c liÃªn káº¿t cá»¥c bá»™ vá»›i Vite. CÃ¡c dependencies export raw TypeScript files khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng. Thay vÃ o Ä‘Ã³, nhá»¯ng JS dependencies nÃ y sáº½ Ä‘Æ°á»£c import bÃ¬nh thÆ°á»ng bá»Ÿi Node.js runtime giá»‘ng nhÆ° cÃ¡c dependencies khÃ¡c tá»« `node_modules`.

Thay Ä‘á»•i nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n vÃ¬ hÃ nh vi trÆ°á»›c Ä‘Ã¢y gÃ¢y ra nháº§m láº«n giá»¯a cÃ¡c tÃ¡c giáº£ integration ngÆ°á»i Ä‘Ã£ test vá»›i má»™t gÃ³i hoáº¡t Ä‘á»™ng cá»¥c bá»™, nhÆ°ng khÃ´ng hoáº¡t Ä‘á»™ng khi Ä‘Æ°á»£c published. NÃ³ cÅ©ng háº¡n cháº¿ viá»‡c sá»­ dá»¥ng cÃ¡c CJS-only dependencies vÃ¬ Vite yÃªu cáº§u code pháº£i lÃ  ESM. Máº·c dÃ¹ thay Ä‘á»•i nÃ y chá»‰ áº£nh hÆ°á»Ÿng Ä‘áº¿n JS dependencies, cÅ©ng Ä‘Æ°á»£c khuyáº¿n nghá»‹ cho cÃ¡c gÃ³i export JavaScript thay vÃ¬ raw TypeScript khi cÃ³ thá»ƒ Ä‘á»ƒ ngÄƒn viá»‡c sá»­ dá»¥ng Vite-specific tÃ¬nh cá» vÃ¬ nÃ³ lÃ  chi tiáº¿t triá»ƒn khai cá»§a luá»“ng loading config cá»§a Astro.

#### TÃ´i nÃªn lÃ m gÃ¬?

Äáº£m báº£o cÃ¡c JS dependencies Ä‘Æ°á»£c liÃªn káº¿t cá»¥c bá»™ cá»§a báº¡n Ä‘Æ°á»£c build trÆ°á»›c khi cháº¡y dá»± Ã¡n Astro. Sau Ä‘Ã³, viá»‡c loading config sáº½ hoáº¡t Ä‘á»™ng nhÆ° trÆ°á»›c.

<ReadMore>Äá»c thÃªm vá» [cÃ i Ä‘áº·t cáº¥u hÃ¬nh Vite trong Astro](/vi/reference/configuration-reference/#vite).</ReadMore>

### Thay Ä‘á»•i: URLs Ä‘Æ°á»£c tráº£ vá» bá»Ÿi `paginate()`

<SourcePR number="11253" title="Add base to paginate"/>

Trong Astro v4.x, URL Ä‘Æ°á»£c tráº£ vá» bá»Ÿi `paginate()` (vÃ­ dá»¥: `page.url.next`, `page.url.first`, v.v.) khÃ´ng bao gá»“m giÃ¡ trá»‹ Ä‘Æ°á»£c thiáº¿t láº­p cho `base` trong config Astro cá»§a báº¡n. Báº¡n pháº£i thÃªm thá»§ cÃ´ng giÃ¡ trá»‹ Ä‘Ã£ cáº¥u hÃ¬nh cho `base` vÃ o URL path.

Astro 5.0 tá»± Ä‘á»™ng bao gá»“m giÃ¡ trá»‹ `base` trong `page.url`.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng function `paginate()` cho nhá»¯ng URLs nÃ y, hÃ£y xÃ³a báº¥t ká»³ giÃ¡ trá»‹ `base` hiá»‡n cÃ³ nÃ o vÃ¬ giá» Ä‘Ã¢y nÃ³ Ä‘Æ°á»£c thÃªm cho báº¡n:

```astro del={16} ins={17}
---
export async function getStaticPaths({ paginate }) {
  const astronautPages = [{
    astronaut: 'Neil Armstrong',
  }, {
    astronaut: 'Buzz Aldrin',
  }, {
    astronaut: 'Sally Ride',
  }, {
    astronaut: 'John Glenn',
  }];
  return paginate(astronautPages, { pageSize: 1 });
}
const { page } = Astro.props;
// `base: /'docs'` Ä‘Æ°á»£c cáº¥u hÃ¬nh trong `astro.config.mjs`
const prev = "/docs" + page.url.prev;
const prev = page.url.prev;
---
<a id="prev" href={prev}>Back</a>
```

<ReadMore>Äá»c thÃªm vá» [pagination trong Astro](/vi/guides/routing/#pagination).</ReadMore>

### Thay Ä‘á»•i: giÃ¡ trá»‹ thuá»™c tÃ­nh HTML khÃ´ng boolean

<SourcePR number="11660" title="Fix attribute rendering for boolean values (take 2)"/>

Trong Astro v4.x, [thuá»™c tÃ­nh HTML khÃ´ng boolean](https://developer.mozilla.org/en-US/docs/Glossary/Boolean/HTML) cÃ³ thá»ƒ khÃ´ng bao gá»“m giÃ¡ trá»‹ cá»§a chÃºng khi Ä‘Æ°á»£c render thÃ nh HTML.

Astro v5.0 render cÃ¡c giÃ¡ trá»‹ má»™t cÃ¡ch rÃµ rÃ ng nhÆ° `="true"` hoáº·c `="false"`, khá»›p vá»›i xá»­ lÃ½ thuá»™c tÃ­nh thÃ­ch há»£p trong browsers.

Trong cÃ¡c vÃ­ dá»¥ `.astro` sau, chá»‰ `allowfullscreen` lÃ  thuá»™c tÃ­nh boolean:

```astro
<!-- src/pages/index.astro -->
<!-- `allowfullscreen` lÃ  thuá»™c tÃ­nh boolean -->
<p allowfullscreen={true}></p>
<p allowfullscreen={false}></p>
<!-- `inherit` *khÃ´ng* lÃ  thuá»™c tÃ­nh boolean -->
<p inherit={true}></p>
<p inherit={false}></p>
<!-- Thuá»™c tÃ­nh `data-*` khÃ´ng pháº£i lÃ  thuá»™c tÃ­nh boolean -->
<p data-light={true}></p>
<p data-light={false}></p>
```

Astro v5.0 giá» Ä‘Ã¢y báº£o tá»“n thuá»™c tÃ­nh data Ä‘áº§y Ä‘á»§ vá»›i giÃ¡ trá»‹ cá»§a nÃ³ khi render HTML cá»§a cÃ¡c thuá»™c tÃ­nh khÃ´ng boolean:

```astro del={5,8,10} ins={6,9,11}
<p allowfullscreen></p>
<p></p>

<p inherit="true"></p>
<p inherit></p>
<p inherit="false"></p>

<p data-light></p>
<p data-light="true"></p>
<p></p>
<p data-light="false"></p>
```

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n dá»±a vÃ o giÃ¡ trá»‹ thuá»™c tÃ­nh, vÃ­ dá»¥, Ä‘á»ƒ Ä‘á»‹nh vá»‹ elements hoáº·c Ä‘á»ƒ render cÃ³ Ä‘iá»u kiá»‡n, hÃ£y cáº­p nháº­t code cá»§a báº¡n Ä‘á»ƒ khá»›p vá»›i giÃ¡ trá»‹ thuá»™c tÃ­nh khÃ´ng boolean má»›i:

```js del={1,4} ins={2,5}
el.getAttribute('inherit') === ''
el.getAttribute('inherit') === 'false'

el.hasAttribute('data-light')
el.dataset.light === 'true'
```

<ReadMore>Äá»c thÃªm vá» [sá»­ dá»¥ng HTML attributes trong Astro](/vi/reference/astro-syntax/#dynamic-attributes).</ReadMore>

### Thay Ä‘á»•i: thÃªm giÃ¡ trá»‹ vÃ o `context.locals`

<SourcePR number="11987" title="TODOs"/>

Trong Astro 4.x, cÃ³ thá»ƒ thay tháº¿ hoÃ n toÃ n object `locals` trong middleware, API endpoints, vÃ  pages khi thÃªm giÃ¡ trá»‹ má»›i.

Astro 5.0 yÃªu cáº§u báº¡n append giÃ¡ trá»‹ vÃ o object `locals` hiá»‡n cÃ³ mÃ  khÃ´ng xÃ³a nÃ³. Locals trong middleware, API endpoints, vÃ  pages, khÃ´ng thá»ƒ bá»‹ ghi Ä‘Ã¨ hoÃ n toÃ n ná»¯a.

#### TÃ´i nÃªn lÃ m gÃ¬?

NÆ¡i báº¡n trÆ°á»›c Ä‘Ã¢y Ä‘ang ghi Ä‘Ã¨ object, bÃ¢y giá» báº¡n pháº£i thay vÃ o Ä‘Ã³ assign giÃ¡ trá»‹ cho nÃ³:

```js title="src/middleware.js" del={1,5} ins={2,6}
ctx.locals = {
Object.assign(ctx.locals, {
  one: 1,
  two: 2
}
})
```

<ReadMore>Xem thÃªm vá» [lÆ°u trá»¯ dá»¯ liá»‡u trong `context.locals`](/vi/guides/middleware/#storing-data-in-contextlocals).</ReadMore>

### Thay Ä‘á»•i: `params` khÃ´ng cÃ²n Ä‘Æ°á»£c decoded

<SourcePR number="12079" title="decode pathname early, don't decode params"/>

Trong Astro v4.x, `params` Ä‘Æ°á»£c truyá»n cho `getStaticPath()` tá»± Ä‘á»™ng Ä‘Æ°á»£c decoded báº±ng `decodeURIComponent`.

Astro v5.0 khÃ´ng cÃ²n decode giÃ¡ trá»‹ cá»§a `params` Ä‘Æ°á»£c truyá»n cho `getStaticPaths`. Báº¡n pháº£i decode chÃºng thá»§ cÃ´ng náº¿u cáº§n.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n trÆ°á»›c Ä‘Ã¢y dá»±a vÃ o viá»‡c decoding tá»± Ä‘á»™ng, hÃ£y sá»­ dá»¥ng `decodeURI` khi truyá»n `params`.

```astro title="src/pages/[id].astro" del={4} ins={5}
---
export function getStaticPaths() {
  return [
    { params: { id: "%5Bpage%5D" } },
    { params: { id: decodeURI("%5Bpage%5D") } },
  ]
}

const { id } = Astro.params;
---
```

LÆ°u Ã½ ráº±ng viá»‡c sá»­ dá»¥ng [`decodeURIComponent`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/decodeURIComponent) khÃ´ng Ä‘Æ°á»£c khuyáº¿n nghá»‹ cho `getStaticPaths` vÃ¬ nÃ³ decode nhiá»u kÃ½ tá»± hÆ¡n má»©c cáº§n thiáº¿t, vÃ­ dá»¥ `/`, `?`, `#` vÃ  nhiá»u hÆ¡n ná»¯a.

<ReadMore>Äá»c thÃªm vá» [táº¡o dynamic routes vá»›i `params`](/vi/guides/routing/#static-ssg-mode).</ReadMore>

### Thay Ä‘á»•i: Type `RouteData` Ä‘Æ°á»£c thay tháº¿ bá»Ÿi `IntegrationsRouteData` (Integrations API)

<SourcePR number="11864" title="send `IntegrationRouteData` to integrations"/>

Trong Astro v4.x, kiá»ƒu `entryPoints` bÃªn trong hooks `astro:build:ssr` vÃ  `astro:build:done` lÃ  `RouteData`.

Astro v5.0 kiá»ƒu `entryPoints` giá» Ä‘Ã¢y lÃ  `IntegrationRouteData`, chá»©a má»™t táº­p con cá»§a kiá»ƒu `RouteData`. CÃ¡c trÆ°á»ng `isIndex` vÃ  `fallbackRoutes` Ä‘Ã£ Ä‘Æ°á»£c xÃ³a.

#### TÃ´i nÃªn lÃ m gÃ¬?

Cáº­p nháº­t adapter cá»§a báº¡n Ä‘á»ƒ thay Ä‘á»•i kiá»ƒu cá»§a `entryPoints` tá»« `RouteData` thÃ nh `IntegrationRouteData`.

```js del={1,4} ins={2,5}
import type {RouteData} from 'astro';
import type {IntegrationRouteData} from "astro"

function useRoute(route: RouteData) {
function useRoute(route: IntegrationRouteData) {
}
```

<ReadMore>Xem [API reference cho `IntegrationRouteData`](/vi/reference/integrations-reference/#integrationroutedata-type-reference).</ReadMore>

### Thay Ä‘á»•i: `distURL` giá» Ä‘Ã¢y lÃ  má»™t máº£ng (Integrations API)

<SourcePR number="11864" title="send `IntegrationRouteData` to integrations"/>

Trong Astro v4.x, `RouteData.distURL` lÃ  `undefined` hoáº·c má»™t `URL`.

Astro v5.0 cáº­p nháº­t hÃ¬nh dáº¡ng cá»§a `IntegrationRouteData.distURL` thÃ nh `undefined` hoáº·c má»™t máº£ng `URL`s. Äiá»u nÃ y sá»­a lá»—i trÆ°á»›c Ä‘Ã³ vÃ¬ má»™t route cÃ³ thá»ƒ táº¡o nhiá»u file trÃªn disk, Ä‘áº·c biá»‡t khi sá»­ dá»¥ng dynamic routes nhÆ° `[slug]` hoáº·c `[...slug]`.

#### TÃ´i nÃªn lÃ m gÃ¬?

Cáº­p nháº­t code cá»§a báº¡n Ä‘á»ƒ xá»­ lÃ½ `IntegrationRouteData.distURL` nhÆ° má»™t máº£ng.

```js del={2-4} ins={5-9}
if (route.distURL) {
  if (route.distURL.endsWith('index.html')) {
    // lÃ m gÃ¬ Ä‘Ã³
  }
  for (const url of route.distURL) {
    if (url.endsWith('index.html')) {
      // lÃ m gÃ¬ Ä‘Ã³
    }
  }
}
```

<ReadMore>Xem [API reference cho `IntegrationRouteData`](/vi/reference/integrations-reference/#integrationroutedata-type-reference).</ReadMore>

### Thay Ä‘á»•i: Äá»‘i sá»‘ Ä‘Æ°á»£c truyá»n cho `app.render()` (Adapter API)

<SourcePR number="11987" title="TODOs"/>

Trong Astro 4.x, phÆ°Æ¡ng thá»©c Adapter API `app.render()` cÃ³ thá»ƒ nháº­n ba Ä‘á»‘i sá»‘: má»™t `request` báº¯t buá»™c, má»™t object tÃ¹y chá»n hoáº·c object `routeData`, vÃ  `locals`.

Astro 5.0 káº¿t há»£p hai Ä‘á»‘i sá»‘ cuá»‘i nÃ y thÃ nh má»™t Ä‘á»‘i sá»‘ tÃ¹y chá»n duy nháº¥t cÃ³ tÃªn `renderOptions`.

#### TÃ´i nÃªn lÃ m gÃ¬?

Truyá»n má»™t object lÃ m Ä‘á»‘i sá»‘ thá»© hai cho `app.render()`, cÃ³ thá»ƒ bao gá»“m `routeData` vÃ  `locals` nhÆ° cÃ¡c thuá»™c tÃ­nh.

```js del={1} ins={2}
const response = await app.render(request, routeData, locals);
const response = await app.render(request, {routeData, locals});
```

<ReadMore>Xem [Adapter API reference cho `renderOptions`](/vi/reference/adapter-reference/#renderoptions).</ReadMore>

### Thay Ä‘á»•i: Thuá»™c tÃ­nh trÃªn `supportedAstroFeatures` (Adapter API)

<SourcePR number="11806" title="rework supportedAstroFeatures"/>

Trong Astro 4.x, `supportedAstroFeatures`, cho phÃ©p cÃ¡c tÃ¡c giáº£ adapter chá»‰ Ä‘á»‹nh nhá»¯ng tÃ­nh nÄƒng mÃ  integration cá»§a há» há»— trá»£, bao gá»“m thuá»™c tÃ­nh `assets` Ä‘á»ƒ chá»‰ Ä‘á»‹nh nhá»¯ng dá»‹ch vá»¥ hÃ¬nh áº£nh nÃ o cá»§a Astro Ä‘Æ°á»£c há»— trá»£.

Astro 5.0 thay tháº¿ thuá»™c tÃ­nh nÃ y báº±ng thuá»™c tÃ­nh `sharpImageService` chuyÃªn dá»¥ng, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c Ä‘á»‹nh liá»‡u adapter cÃ³ tÆ°Æ¡ng thÃ­ch vá»›i dá»‹ch vá»¥ hÃ¬nh áº£nh sharp tÃ­ch há»£p hay khÃ´ng.

v5.0 cÅ©ng thÃªm giÃ¡ trá»‹ `limited` má»›i cho cÃ¡c thuá»™c tÃ­nh khÃ¡c nhau cá»§a `supportedAstroFeatures` cho adapters, cho biáº¿t adapter tÆ°Æ¡ng thÃ­ch vá»›i tÃ­nh nÄƒng, nhÆ°ng vá»›i má»™t sá»‘ háº¡n cháº¿. Äiá»u nÃ y há»¯u Ã­ch cho cÃ¡c adapters há»— trá»£ má»™t tÃ­nh nÄƒng, nhÆ°ng khÃ´ng trong táº¥t cáº£ cÃ¡c trÆ°á»ng há»£p hoáº·c vá»›i táº¥t cáº£ cÃ¡c tÃ¹y chá»n.

NgoÃ i ra, giÃ¡ trá»‹ cá»§a cÃ¡c thuá»™c tÃ­nh khÃ¡c nhau trÃªn `supportedAstroFeatures` cho adapters giá» Ä‘Ã¢y cÃ³ thá»ƒ lÃ  objects, vá»›i thuá»™c tÃ­nh `support` vÃ  `message`. Ná»™i dung cá»§a thuá»™c tÃ­nh `message` sáº½ hiá»ƒn thá»‹ thÃ´ng bÃ¡o há»¯u Ã­ch trong Astro CLI khi adapter khÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i má»™t tÃ­nh nÄƒng. Äiá»u nÃ y Ä‘áº·c biá»‡t há»¯u Ã­ch vá»›i giÃ¡ trá»‹ `limited` má»›i, Ä‘á»ƒ giáº£i thÃ­ch cho ngÆ°á»i dÃ¹ng táº¡i sao support bá»‹ háº¡n cháº¿.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng thuá»™c tÃ­nh `assets`, hÃ£y xÃ³a nÃ³ vÃ¬ nÃ³ khÃ´ng cÃ²n kháº£ dá»¥ng. Äá»ƒ chá»‰ Ä‘á»‹nh ráº±ng adapter cá»§a báº¡n há»— trá»£ dá»‹ch vá»¥ hÃ¬nh áº£nh sharp tÃ­ch há»£p, hÃ£y thay tháº¿ Ä‘iá»u nÃ y báº±ng `sharpImageService`.

Báº¡n cÅ©ng cÃ³ thá»ƒ muá»‘n cáº­p nháº­t cÃ¡c tÃ­nh nÄƒng Ä‘Æ°á»£c há»— trá»£ vá»›i tÃ¹y chá»n `limited` má»›i vÃ  bao gá»“m thÃ´ng bÃ¡o vá» support cá»§a adapter.

```ts title="my-adapter.mjs" del={2-6} ins={7-10}
supportedAstroFeatures: {
  assets: {
    supportKind: "stable",
    isSharpCompatible: true,
    isSquooshCompatible: true,
  },
  sharpImageService: {
    support: "limited",
    message: 'Adapter nÃ y há»— trá»£ dá»‹ch vá»¥ hÃ¬nh áº£nh sharp tÃ­ch há»£p, nhÆ°ng vá»›i má»™t sá»‘ háº¡n cháº¿.'
  }
}
```

<ReadMore>Äá»c thÃªm vá» [chá»‰ Ä‘á»‹nh cÃ¡c tÃ­nh nÄƒng Astro Ä‘Æ°á»£c há»— trá»£ trong adapter](/vi/reference/adapter-reference/#astro-features).</ReadMore>

### ÄÃ£ xÃ³a: HÃ¬nh dáº¡ng Ä‘á»‹nh nghÄ©a deprecated cho dev toolbar apps (Dev Toolbar API)

<SourcePR number="11987" title="Remove deprecated dev toolbar app shape"/>

Trong Astro 4.x, khi xÃ¢y dá»±ng dev toolbar app, váº«n cÃ³ thá»ƒ sá»­ dá»¥ng signature `addDevToolbarApp(string);` Ä‘Ã£ deprecated trÆ°á»›c Ä‘Ã¢y. CÃ¡c thuá»™c tÃ­nh `id`, `title`, vÃ  `icon` Ä‘á»ƒ Ä‘á»‹nh nghÄ©a app sau Ä‘Ã³ Ä‘Æ°á»£c cung cáº¥p thÃ´ng qua default export cá»§a `entrypoint` cá»§a app.

Astro 5.0 xÃ³a hoÃ n toÃ n tÃ¹y chá»n nÃ y á»§ng há»™ hÃ¬nh dáº¡ng object hiá»‡n táº¡i khi Ä‘á»‹nh nghÄ©a dev toolbar app trong integration trá»±c quan hÆ¡n vÃ  cho phÃ©p Astro cung cáº¥p lá»—i tá»‘t hÆ¡n khi toolbar apps khÃ´ng load chÃ­nh xÃ¡c.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng hÃ¬nh dáº¡ng deprecated, hÃ£y cáº­p nháº­t dev toolbar app Ä‘á»ƒ sá»­ dá»¥ng hÃ¬nh dáº¡ng má»›i:

```js title="my-integration.mjs" del={1-2} ins={4-10}
// HÃ¬nh dáº¡ng cÅ©
addDevToolbarApp("./my-dev-toolbar-app.mjs");

// HÃ¬nh dáº¡ng má»›i
addDevToolbarApp({
  id: "my-app",
  name: "My App",
  icon: "<svg>...</svg>",
  entrypoint: "./my-dev-toolbar-app.mjs",
});
```

```js title="my-dev-toolbar-app.mjs" del={2-4}
export default {
  id: 'my-dev-toolbar-app',
  title: 'My Dev Toolbar App',
  icon: 'ğŸš€',
  init() {
    // ...
  }
}
```

<ReadMore>Äá»c thÃªm vá» [phÃ¡t triá»ƒn dev toolbar app cho Astro báº±ng Dev Toolbar API](/vi/reference/dev-toolbar-app-reference/).</ReadMore>

### ÄÃ£ xÃ³a: cáº¥u hÃ¬nh Typescript trong `create-astro`

<SourcePR number="12083" title="create-astro updates"/>

Trong Astro v4.x, cÃ³ thá»ƒ chá»n giá»¯a ba cÃ i Ä‘áº·t TypeScript cá»§a Astro khi táº¡o dá»± Ã¡n má»›i báº±ng `create astro`, báº±ng cÃ¡ch tráº£ lá»i cÃ¢u há»i hoáº·c báº±ng cÃ¡ch truyá»n flag `--typescript` liÃªn quan vá»›i cÃ i Ä‘áº·t TypeScript mong muá»‘n.

Astro 5.0 cáº­p nháº­t lá»‡nh CLI `create astro` Ä‘á»ƒ xÃ³a cÃ¢u há»i TypeScript vÃ  flag `--typescript` liÃªn quan. Preset "strict" giá» Ä‘Ã¢y lÃ  máº·c Ä‘á»‹nh cho táº¥t cáº£ cÃ¡c dá»± Ã¡n má»›i Ä‘Æ°á»£c táº¡o vá»›i command line vÃ  khÃ´ng cÃ²n cÃ³ thá»ƒ tÃ¹y chá»‰nh Ä‘iá»u nÃ y vÃ o thá»i Ä‘iá»ƒm Ä‘Ã³. Tuy nhiÃªn, template TypeScript váº«n cÃ³ thá»ƒ Ä‘Æ°á»£c thay Ä‘á»•i thá»§ cÃ´ng trong `tsconfig.json`.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng flag `--typescript` vá»›i `create-astro`, hÃ£y xÃ³a nÃ³ khá»i lá»‡nh cá»§a báº¡n.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```diff lang=shell
  -npm create astro@latest -- --template <example-name> --typescript strict
  +npm create astro@latest -- --template <example-name>
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```diff lang=shell
  -pnpm create astro@latest --template <example-name> --typescript strict
  +pnpm create astro@latest --template <example-name>
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```diff lang=shell
  -yarn create astro --template <example-name> --typescript strict
  +yarn create astro --template <example-name>
  ```
  </Fragment>
</PackageManagerTabs>

<ReadMore>Xem [táº¥t cáº£ cÃ¡c flag lá»‡nh `create astro` kháº£ dá»¥ng](https://github.com/withastro/astro/blob/main/packages/create-astro/README.md)</ReadMore>

## TÃ i nguyÃªn cá»™ng Ä‘á»“ng

Biáº¿t má»™t tÃ i nguyÃªn tá»‘t cho Astro v5.0? [Chá»‰nh sá»­a trang nÃ y](https://github.com/withastro/docs/edit/main/src/content/docs/vi/guides/upgrade-to/v5.mdx) vÃ  thÃªm link bÃªn dÆ°á»›i!

## Váº¥n Ä‘á» Ä‘Ã£ biáº¿t

Vui lÃ²ng kiá»ƒm tra [issues cá»§a Astro trÃªn GitHub](https://github.com/withastro/astro/issues/) Ä‘á»ƒ biáº¿t báº¥t ká»³ váº¥n Ä‘á» nÃ o Ä‘Æ°á»£c bÃ¡o cÃ¡o, hoáº·c Ä‘á»ƒ tá»± mÃ¬nh file issue.

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng cÃ¡c plugin, cáº¥u hÃ¬nh hoáº·c API cá»¥ thá»ƒ cá»§a Vite, hÃ£y kiá»ƒm tra [hÆ°á»›ng dáº«n di chuyá»ƒn Vite](https://vite.dev/guide/migration.html) Ä‘á»ƒ biáº¿t cÃ¡c thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch vÃ  nÃ¢ng cáº¥p dá»± Ã¡n cá»§a báº¡n khi cáº§n.

### `@astrojs/mdx`

<SourcePR number="11741" title="Cleanup unused JSX code"/>

Trong Astro v4.x, Astro thá»±c hiá»‡n xá»­ lÃ½ JSX ná»™i bá»™ cho integration `@astrojs/mdx`.

Astro v5.0 chuyá»ƒn trÃ¡ch nhiá»‡m xá»­ lÃ½ vÃ  render JSX vÃ  MDX trá»±c tiáº¿p cho gÃ³i `@astrojs/mdx`. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  Astro 5.0 khÃ´ng cÃ²n tÆ°Æ¡ng thÃ­ch vá»›i cÃ¡c phiÃªn báº£n cÅ© hÆ¡n cá»§a integration MDX.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u dá»± Ã¡n cá»§a báº¡n bao gá»“m cÃ¡c file `.mdx`, báº¡n pháº£i nÃ¢ng cáº¥p `@astrojs/mdx` lÃªn phiÃªn báº£n má»›i nháº¥t (v4.0.0) Ä‘á»ƒ JSX cá»§a báº¡n cÃ³ thá»ƒ Ä‘Æ°á»£c xá»­ lÃ½ Ä‘Ãºng cÃ¡ch bá»Ÿi integration.

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng MDX server renderer vá»›i [Astro Container API](/vi/reference/container-reference/) thá»­ nghiá»‡m, báº¡n pháº£i cáº­p nháº­t import Ä‘á»ƒ pháº£n Ã¡nh vá»‹ trÃ­ má»›i:

```ts del={1} ins={2}
import mdxRenderer from "astro/jsx/server.js";
import mdxRenderer from "@astrojs/mdx/server.js";
```

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [sá»­ dá»¥ng MDX trong dá»± Ã¡n cá»§a báº¡n](/vi/guides/integrations-guide/mdx/).</ReadMore>

## Legacy

CÃ¡c tÃ­nh nÄƒng sau Ä‘Ã¢y hiá»‡n Ä‘Æ°á»£c coi lÃ  tÃ­nh nÄƒng legacy. ChÃºng sáº½ hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng nhÆ°ng khÃ´ng cÃ²n Ä‘Æ°á»£c khuyáº¿n nghá»‹ vÃ  Ä‘ang á»Ÿ cháº¿ Ä‘á»™ báº£o trÃ¬. ChÃºng sáº½ khÃ´ng cÃ³ cáº£i tiáº¿n trong tÆ°Æ¡ng lai vÃ  tÃ i liá»‡u sáº½ khÃ´ng Ä‘Æ°á»£c cáº­p nháº­t. Nhá»¯ng tÃ­nh nÄƒng nÃ y cuá»‘i cÃ¹ng sáº½ bá»‹ deprecated, rá»“i bá»‹ xÃ³a hoÃ n toÃ n.

### Legacy: Content Collections API v2.0

Trong Astro 4.x, content collections Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a, truy váº¥n vÃ  render báº±ng [Content Collections API Ä‘Æ°á»£c giá»›i thiá»‡u láº§n Ä‘áº§u trong Astro v2.0](https://astro.build/blog/introducing-content-collections/). Táº¥t cáº£ cÃ¡c collection entry Ä‘á»u lÃ  file cá»¥c bá»™ trong thÆ° má»¥c `src/content/` Ä‘Æ°á»£c dÃ nh riÃªng. NgoÃ i ra, [quy Æ°á»›c tÃªn file cá»§a Astro Ä‘á»ƒ loáº¡i trá»« viá»‡c xÃ¢y dá»±ng cÃ¡c trang riÃªng láº»](/vi/guides/routing/#excluding-pages) Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p vÃ o Content Collections API.

Astro 5.0 giá»›i thiá»‡u phiÃªn báº£n má»›i cá»§a content collections sá»­ dá»¥ng Content Layer API mang láº¡i má»™t sá»‘ cáº£i tiáº¿n hiá»‡u suáº¥t vÃ  kháº£ nÄƒng bá»• sung. Trong khi collections cÅ© (legacy) vÃ  má»›i (Content Layer API) cÃ³ thá»ƒ tiáº¿p tá»¥c tá»“n táº¡i cÃ¹ng nhau trong báº£n phÃ¡t hÃ nh nÃ y, cÃ³ nhá»¯ng thay Ä‘á»•i cÃ³ thá»ƒ phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch Ä‘á»‘i vá»›i cÃ¡c legacy collections hiá»‡n cÃ³.

Báº£n phÃ¡t hÃ nh nÃ y cÅ©ng xÃ³a tÃ¹y chá»n Ä‘á»ƒ thÃªm tiá»n tá»‘ tÃªn file collection entry báº±ng dáº¥u gáº¡ch dÆ°á»›i (`_`) Ä‘á»ƒ ngÄƒn cháº·n viá»‡c xÃ¢y dá»±ng route.

#### TÃ´i nÃªn lÃ m gÃ¬?

ChÃºng tÃ´i khuyáº¿n nghá»‹ [chuyá»ƒn Ä‘á»•i báº¥t ká»³ collections hiá»‡n cÃ³ nÃ o sang Content Layer API má»›i](#updating-existing-collections) cÃ ng sá»›m cÃ ng tá»‘t vÃ  táº¡o báº¥t ká»³ collections má»›i nÃ o báº±ng Content Layer API.

Náº¿u báº¡n khÃ´ng thá»ƒ chuyá»ƒn Ä‘á»•i collections cá»§a mÃ¬nh, vui lÃ²ng tham kháº£o [thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch cá»§a legacy collections](#breaking-changes-to-legacy-content-and-data-collections) Ä‘á»ƒ xem liá»‡u cÃ¡c collections hiá»‡n cÃ³ cá»§a báº¡n cÃ³ bá»‹ áº£nh hÆ°á»Ÿng vÃ  yÃªu cáº§u cáº­p nháº­t khÃ´ng.

Náº¿u báº¡n khÃ´ng thá»ƒ thá»±c hiá»‡n báº¥t ká»³ thay Ä‘á»•i nÃ o Ä‘á»‘i vá»›i collections cá»§a mÃ¬nh vÃ o thá»i Ä‘iá»ƒm nÃ y, báº¡n cÃ³ thá»ƒ [báº­t flag `legacy.collections`](#enabling-the-legacycollections-flag) sáº½ cho phÃ©p báº¡n giá»¯ collections á»Ÿ tráº¡ng thÃ¡i hiá»‡n táº¡i cho Ä‘áº¿n khi legacy flag khÃ´ng cÃ²n Ä‘Æ°á»£c há»— trá»£.

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [content collections](/vi/guides/content-collections/) Ä‘Æ°á»£c cáº­p nháº­t.</ReadMore>

##### Cáº­p nháº­t collections hiá»‡n cÃ³

Xem hÆ°á»›ng dáº«n bÃªn dÆ°á»›i Ä‘á»ƒ cáº­p nháº­t content collection hiá»‡n cÃ³ (`type: 'content'` hoáº·c `type: 'data'`) Ä‘á»ƒ sá»­ dá»¥ng Content Layer API.

<details>
<summary>HÆ°á»›ng dáº«n tá»«ng bÆ°á»›c Ä‘á»ƒ cáº­p nháº­t collection</summary>

<Steps>

1. **Di chuyá»ƒn file config ná»™i dung**. File nÃ y khÃ´ng cÃ²n náº±m trong thÆ° má»¥c `src/content/`. File nÃ y giá» Ä‘Ã¢y nÃªn tá»“n táº¡i táº¡i `src/content.config.ts`.

2. **Chá»‰nh sá»­a Ä‘á»‹nh nghÄ©a collection**. Collection cáº­p nháº­t cá»§a báº¡n yÃªu cáº§u má»™t `loader` cho biáº¿t cáº£ thÆ° má»¥c cho vá»‹ trÃ­ collection (`base`) vÃ  má»™t `pattern` xÃ¡c Ä‘á»‹nh tÃªn file vÃ  pháº§n má»Ÿ rá»™ng cá»§a collection entry Ä‘á»ƒ khá»›p. (Báº¡n cÃ³ thá»ƒ cáº§n cáº­p nháº­t vÃ­ dá»¥ bÃªn dÆ°á»›i cho phÃ¹ há»£p. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng [globster.xyz](https://globster.xyz/) Ä‘á»ƒ kiá»ƒm tra glob pattern cá»§a mÃ¬nh.) TÃ¹y chá»n chá»n collection `type` khÃ´ng cÃ²n kháº£ dá»¥ng.

    ```ts ins={3,8} del={7}
    // src/content.config.ts
    import { defineCollection, z } from 'astro:content';
    import { glob } from 'astro/loaders';

    const blog = defineCollection({
      // Äá»‘i vá»›i content layer, báº¡n khÃ´ng cÃ²n Ä‘á»‹nh nghÄ©a `type`
      type: 'content',
      loader: glob({ pattern: '**/[^_]*.{md,mdx}', base: "./src/data/blog" }),
      schema: z.object({
        title: z.string(),
        description: z.string(),
        pubDate: z.coerce.date(),
        updatedDate: z.coerce.date().optional(),
      }),
    });
    ```

3. **Thay Ä‘á»•i tham chiáº¿u tá»« `slug` sang `id`**. Content layer collections khÃ´ng cÃ³ trÆ°á»ng `slug` Ä‘Æ°á»£c dÃ nh riÃªng. Thay vÃ o Ä‘Ã³, táº¥t cáº£ cÃ¡c collections Ä‘Æ°á»£c cáº­p nháº­t sáº½ cÃ³ má»™t `id`:

    ```astro ins={7} del={6}
    // src/pages/[slug].astro
    ---
    export async function getStaticPaths() {
      const posts = await getCollection('blog');
      return posts.map((post) => ({
        params: { slug: post.slug },
        params: { slug: post.id },
        props: post,
      }));
    }
    ---
    ```
    Báº¡n cÅ©ng cÃ³ thá»ƒ cáº­p nháº­t tÃªn file Ä‘á»‹nh tuyáº¿n Ä‘á»™ng Ä‘á»ƒ khá»›p vá»›i giÃ¡ trá»‹ cá»§a tham sá»‘ `getStaticPaths()` Ä‘Ã£ thay Ä‘á»•i.

4. **Chuyá»ƒn sang function `render()` má»›i**. CÃ¡c entry khÃ´ng cÃ²n cÃ³ method `render()`, vÃ¬ chÃºng giá» Ä‘Ã¢y lÃ  cÃ¡c plain objects cÃ³ thá»ƒ serialize. Thay vÃ o Ä‘Ã³, import function `render()` tá»« `astro:content`.

    ```astro title="src/pages/index.astro" ins=", render" del={6} ins={7}
    ---
    import { getEntry, render } from 'astro:content';

    const post = await getEntry('blog', params.slug);

    const { Content, headings } = await post.render();
    const { Content, headings } = await render(post);
    ---
    <Content />
    ```
</Steps>

</details>

##### Thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch Ä‘á»‘i vá»›i legacy `content` vÃ  `data` collections

<SourcePR number="11976" title="Implement legacy collections using glob" />

Theo máº·c Ä‘á»‹nh, cÃ¡c collections sá»­ dá»¥ng thuá»™c tÃ­nh `type` cÅ© (`content` hoáº·c `data`) vÃ  khÃ´ng Ä‘á»‹nh nghÄ©a `loader` giá» Ä‘Ã¢y Ä‘Æ°á»£c triá»ƒn khai bÃªn dÆ°á»›i báº±ng cÃ¡ch sá»­ dá»¥ng `glob()` loader tÃ­ch há»£p cá»§a Content Layer API, vá»›i xá»­ lÃ½ tÆ°Æ¡ng thÃ­ch ngÆ°á»£c bá»• sung.

NgoÃ i ra, tÆ°Æ¡ng thÃ­ch ngÆ°á»£c táº¡m thá»i tá»“n táº¡i Ä‘á»ƒ giá»¯ file config ná»™i dung á»Ÿ vá»‹ trÃ­ ban Ä‘áº§u cá»§a `src/content/config.ts`.

Viá»‡c triá»ƒn khai tÆ°Æ¡ng thÃ­ch ngÆ°á»£c nÃ y cÃ³ thá»ƒ mÃ´ phá»ng háº§u háº¿t cÃ¡c tÃ­nh nÄƒng cá»§a legacy collections vÃ  sáº½ cho phÃ©p nhiá»u legacy collections tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng ngay cáº£ khi khÃ´ng cáº­p nháº­t code cá»§a báº¡n. Tuy nhiÃªn, **cÃ³ má»™t sá»‘ khÃ¡c biá»‡t vÃ  háº¡n cháº¿ cÃ³ thá»ƒ gÃ¢y ra thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch Ä‘á»‘i vá»›i cÃ¡c collections hiá»‡n cÃ³**:

  - Trong cÃ¡c phiÃªn báº£n trÆ°á»›c cá»§a Astro, collections sáº½ Ä‘Æ°á»£c táº¡o cho táº¥t cáº£ thÆ° má»¥c trong `src/content/`, ngay cáº£ khi chÃºng khÃ´ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `src/content/config.ts`. HÃ nh vi nÃ y hiá»‡n Ä‘Ã£ deprecated, vÃ  collections pháº£i luÃ´n Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `src/content.config.ts`. Äá»‘i vá»›i cÃ¡c collections hiá»‡n cÃ³, chÃºng cÃ³ thá»ƒ chá»‰ lÃ  cÃ¡c khai bÃ¡o trá»‘ng (vÃ­ dá»¥: `const blog = defineCollection({})`) vÃ  Astro sáº½ ngáº§m Ä‘á»‹nh nghÄ©a legacy collection cá»§a báº¡n theo cÃ¡ch tÆ°Æ¡ng thÃ­ch vá»›i hÃ nh vi loading má»›i.
  - TrÆ°á»ng `layout` Ä‘áº·c biá»‡t khÃ´ng Ä‘Æ°á»£c há»— trá»£ trong cÃ¡c collection entry Markdown. Thuá»™c tÃ­nh nÃ y chá»‰ dÃ nh cho cÃ¡c file trang Ä‘á»™c láº­p náº±m trong `src/pages/` vÃ  khÃ´ng cÃ³ kháº£ nÄƒng náº±m trong collection entries cá»§a báº¡n. Tuy nhiÃªn, náº¿u báº¡n Ä‘ang sá»­ dá»¥ng thuá»™c tÃ­nh nÃ y, bÃ¢y giá» báº¡n pháº£i táº¡o cÃ¡c routes Ä‘á»™ng bao gá»“m styling trang cá»§a báº¡n.
  - Thá»© tá»± sáº¯p xáº¿p cá»§a cÃ¡c collections Ä‘Æ°á»£c táº¡o lÃ  khÃ´ng xÃ¡c Ä‘á»‹nh vÃ  phá»¥ thuá»™c vÃ o ná»n táº£ng. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  náº¿u báº¡n Ä‘ang gá»i `getCollection()`, thá»© tá»± tráº£ vá» cÃ¡c entries cÃ³ thá»ƒ khÃ¡c so vá»›i trÆ°á»›c. Náº¿u báº¡n cáº§n má»™t thá»© tá»± cá»¥ thá»ƒ, báº¡n pháº£i tá»± sáº¯p xáº¿p cÃ¡c collection entries.
  - `image().refine()` khÃ´ng Ä‘Æ°á»£c há»— trá»£. Náº¿u báº¡n cáº§n xÃ¡c thá»±c cÃ¡c thuá»™c tÃ­nh cá»§a hÃ¬nh áº£nh, báº¡n sáº½ cáº§n thá»±c hiá»‡n Ä‘iá»u nÃ y táº¡i runtime trong trang hoáº·c component cá»§a mÃ¬nh.
  - Äá»‘i sá»‘ `key` cá»§a `getEntry(collection, key)` Ä‘Æ°á»£c typed lÃ  `string`, thay vÃ¬ cÃ³ types cho má»i entry.
  - TrÆ°á»›c Ä‘Ã¢y khi gá»i `getEntry(collection, key)` vá»›i má»™t chuá»—i tÄ©nh lÃ m key, kiá»ƒu tráº£ vá» khÃ´ng thá»ƒ nullable. Kiá»ƒu giá» Ä‘Ã¢y bao gá»“m `undefined` nÃªn báº¡n pháº£i kiá»ƒm tra xem entry cÃ³ Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÆ°á»›c khi sá»­ dá»¥ng káº¿t quáº£ hay khÃ´ng hoáº·c báº¡n sáº½ gáº·p lá»—i type.

##### Báº­t flag `legacy.collections`

<SourcePR number="11976" title="Implement legacy collections using glob" />

Náº¿u báº¡n chÆ°a sáºµn sÃ ng cáº­p nháº­t cÃ¡c collections hiá»‡n cÃ³, báº¡n cÃ³ thá»ƒ báº­t flag [`legacy.collections`](/vi/reference/legacy-flags/) vÃ  cÃ¡c collections hiá»‡n cÃ³ cá»§a báº¡n sáº½ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng nhÆ° trÆ°á»›c.

## Deprecated

CÃ¡c tÃ­nh nÄƒng deprecated sau Ä‘Ã¢y khÃ´ng cÃ²n Ä‘Æ°á»£c há»— trá»£ vÃ  khÃ´ng cÃ²n Ä‘Æ°á»£c ghi chÃ©p. Vui lÃ²ng cáº­p nháº­t dá»± Ã¡n cá»§a báº¡n cho phÃ¹ há»£p.

Má»™t sá»‘ tÃ­nh nÄƒng deprecated cÃ³ thá»ƒ táº¡m thá»i tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng cho Ä‘áº¿n khi chÃºng bá»‹ xÃ³a hoÃ n toÃ n. Nhá»¯ng tÃ­nh nÄƒng khÃ¡c cÃ³ thá»ƒ Ã¢m tháº§m khÃ´ng cÃ³ tÃ¡c dá»¥ng, hoáº·c nÃ©m ra lá»—i nháº¯c báº¡n cáº­p nháº­t code.

### Deprecated: `Astro.glob()`

<SourcePR number="11826" title="Deprecate glob"/>

Trong Astro v4.x, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `Astro.glob()` trong cÃ¡c component `.astro` Ä‘á»ƒ truy váº¥n nhiá»u file trong dá»± Ã¡n. Äiá»u nÃ y cÃ³ má»™t sá»‘ háº¡n cháº¿ (nÆ¡i cÃ³ thá»ƒ sá»­ dá»¥ng, hiá»‡u suáº¥t, v.v.), vÃ  viá»‡c sá»­ dá»¥ng cÃ¡c function truy váº¥n tá»« Content Collections API hoáº·c `import.meta.glob()` cá»§a chÃ­nh Vite thÆ°á»ng cung cáº¥p nhiá»u function vÃ  tÃ­nh linh hoáº¡t hÆ¡n.

Astro 5.0 deprecated `Astro.glob()` á»§ng há»™ viá»‡c sá»­ dá»¥ng `getCollection()` Ä‘á»ƒ truy váº¥n collections vÃ  `import.meta.glob()` Ä‘á»ƒ truy váº¥n cÃ¡c file nguá»“n khÃ¡c trong dá»± Ã¡n.

#### TÃ´i nÃªn lÃ m gÃ¬?

Thay tháº¿ táº¥t cáº£ viá»‡c sá»­ dá»¥ng `Astro.glob()` báº±ng `import.meta.glob()`. LÆ°u Ã½ ráº±ng `import.meta.glob()` khÃ´ng cÃ²n tráº£ vá» `Promise`, vÃ¬ váº­y báº¡n cÃ³ thá»ƒ pháº£i cáº­p nháº­t code cho phÃ¹ há»£p. Báº¡n khÃ´ng cáº§n cáº­p nháº­t [glob patterns](/vi/guides/imports/#glob-patterns).

```astro title="src/pages/blog.astro" del={2} ins={3}
---
const posts = await Astro.glob('./posts/*.md');
const posts = Object.values(import.meta.glob('./posts/*.md', { eager: true }));
---

{posts.map((post) => <li><a href={post.url}>{post.frontmatter.title}</a></li>)}
```

Khi thÃ­ch há»£p, hÃ£y xem xÃ©t sá»­ dá»¥ng [content collections](/vi/guides/content-collections/) Ä‘á»ƒ sáº¯p xáº¿p ná»™i dung cá»§a báº¡n, cÃ³ cÃ¡c function truy váº¥n má»›i hÆ¡n, hiá»‡u suáº¥t cao hÆ¡n.

Báº¡n cÅ©ng cÃ³ thá»ƒ muá»‘n xem xÃ©t sá»­ dá»¥ng cÃ¡c gÃ³i glob tá»« NPM, cháº³ng háº¡n nhÆ° [`fast-glob`](https://www.npmjs.com/package/fast-glob).

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [import files vá»›i `import.meta.glob`](/vi/guides/imports/#importmetaglob).</ReadMore>
 
### Deprecated: `functionPerRoute` (Adapter API)

<SourcePR number="11714" title="Remove functionPerRoute option"/>

Trong Astro v4.x, báº¡n cÃ³ thá»ƒ chá»n táº¡o má»™t file riÃªng cho má»—i route Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong dá»± Ã¡n, pháº£n Ã¡nh thÆ° má»¥c `src/pages/` cá»§a báº¡n trong thÆ° má»¥c build. Theo máº·c Ä‘á»‹nh, Astro phÃ¡t ra má»™t file `entry.mjs` duy nháº¥t, chá»‹u trÃ¡ch nhiá»‡m phÃ¡t ra trang Ä‘Æ°á»£c render cho má»—i request.

Astro v5.0 xÃ³a tÃ¹y chá»n opt out khá»i hÃ nh vi máº·c Ä‘á»‹nh. HÃ nh vi nÃ y giá» Ä‘Ã¢y lÃ  tiÃªu chuáº©n vÃ  khÃ´ng thá»ƒ cáº¥u hÃ¬nh.

XÃ³a thuá»™c tÃ­nh `functionPerRoute` khá»i cáº¥u hÃ¬nh `adapterFeatures` cá»§a báº¡n. NÃ³ khÃ´ng cÃ²n kháº£ dá»¥ng.

```js title="my-adapter.mjs" del={10}
export default function createIntegration() {
  return {
    name: '@matthewp/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@matthewp/my-adapter',
          serverEntrypoint: '@matthewp/my-adapter/server.js',
          adapterFeatures: {
              functionPerRoute: true
          }
        });
      },
    },
  };
}

```

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [Adapter API](/vi/reference/adapter-reference/) Ä‘á»ƒ xÃ¢y dá»±ng adapter integrations.</ReadMore>

### Deprecated: `routes` trÃªn hook `astro:build:done` (Integration API)

<SourcePR number="12329" title="feat(next): astro:routes:resolved"/>

Trong Astro v4.x, cÃ¡c integration truy cáº­p routes tá»« hook `astro:build:done`.

Astro v5.0 deprecated máº£ng `routes` Ä‘Æ°á»£c truyá»n cho hook nÃ y. Thay vÃ o Ä‘Ã³, nÃ³ expose má»™t hook `astro:routes:resolved` má»›i cháº¡y trÆ°á»›c `astro:config:done`, vÃ  báº¥t cá»© khi nÃ o route thay Ä‘á»•i trong development. NÃ³ cÃ³ táº¥t cáº£ cÃ¡c thuá»™c tÃ­nh giá»‘ng nhÆ° danh sÃ¡ch `routes` deprecated, ngoáº¡i trá»« `distURL` chá»‰ kháº£ dá»¥ng trong quÃ¡ trÃ¬nh build.

#### TÃ´i nÃªn lÃ m gÃ¬?

XÃ³a báº¥t ká»³ instance nÃ o cá»§a `routes` Ä‘Æ°á»£c truyá»n cho `astro:build:done` vÃ  thay tháº¿ báº±ng hook `astro:routes:resolved` má»›i. Truy cáº­p `distURL` trÃªn map `assets` má»›i Ä‘Æ°á»£c expose:

```js title="my-integration.mjs" ins={2,6-8,11,13-18} del={10}
const integration = () => {
    let routes
    return {
        name: 'my-integration',
        hooks: {
            'astro:routes:resolved': (params) => {
                routes = params.routes
            },
            'astro:build:done': ({
                routes
                assets
            }) => {
                for (const route of routes) {
                    const distURL = assets.get(route.pattern)
                    if (distURL) {
                        Object.assign(route, { distURL })
                    }
                }
                console.log(routes)
            }
        }
    }
}
```

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [Integration API hook `astro:routes:resolved`](/vi/reference/integrations-reference/#astroroutesresolved) Ä‘á»ƒ xÃ¢y dá»±ng integrations.</ReadMore>

## ÄÃ£ xÃ³a

CÃ¡c tÃ­nh nÄƒng sau Ä‘Ã¢y giá» Ä‘Ã¢y Ä‘Ã£ Ä‘Æ°á»£c xÃ³a hoÃ n toÃ n khá»i codebase vÃ  khÃ´ng thá»ƒ sá»­ dá»¥ng Ä‘Æ°á»£c ná»¯a. Má»™t sá»‘ tÃ­nh nÄƒng nÃ y cÃ³ thá»ƒ Ä‘Ã£ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng trong dá»± Ã¡n cá»§a báº¡n ngay cáº£ sau khi deprecated. Nhá»¯ng tÃ­nh nÄƒng khÃ¡c cÃ³ thá»ƒ Ä‘Ã£ Ã¢m tháº§m khÃ´ng cÃ³ tÃ¡c dá»¥ng.

CÃ¡c dá»± Ã¡n hiá»‡n chá»©a nhá»¯ng tÃ­nh nÄƒng Ä‘Ã£ bá»‹ xÃ³a nÃ y sáº½ khÃ´ng thá»ƒ build, vÃ  sáº½ khÃ´ng cÃ²n cÃ³ báº¥t ká»³ tÃ i liá»‡u há»— trá»£ nÃ o nháº¯c báº¡n xÃ³a nhá»¯ng tÃ­nh nÄƒng nÃ y.

### ÄÃ£ xÃ³a: Integration Lit

<SourcePR number="11680" title="Remove `@astrojs/lit`"/>

Trong Astro v4.x, [Lit](https://lit.dev/) lÃ  thÆ° viá»‡n framework Ä‘Æ°á»£c duy trÃ¬ cá»‘t lÃµi thÃ´ng qua gÃ³i `@astrojs/lit`.

Astro v5.0 xÃ³a integration vÃ  nÃ³ sáº½ khÃ´ng nháº­n Ä‘Æ°á»£c cáº­p nháº­t thÃªm cho tÆ°Æ¡ng thÃ­ch vá»›i 5.x trá»Ÿ lÃªn.

#### TÃ´i nÃªn lÃ m gÃ¬?

Báº¡n cÃ³ thá»ƒ tiáº¿p tá»¥c sá»­ dá»¥ng Lit cho client components báº±ng cÃ¡ch thÃªm tháº» script phÃ­a client. VÃ­ dá»¥:

```astro
<script>
  import "../components/MyTabs";
</script>

<my-tabs title="These are my tabs">...</my-tabs>
```

Náº¿u báº¡n quan tÃ¢m Ä‘áº¿n viá»‡c duy trÃ¬ integration Lit tá»± mÃ¬nh, báº¡n cÃ³ thá»ƒ muá»‘n sá»­ dá»¥ng [phiÃªn báº£n Ä‘Æ°á»£c published cuá»‘i cÃ¹ng cá»§a `@astrojs/lit`](https://github.com/withastro/astro/tree/astro%404.13.0/packages/integrations/lit) lÃ m Ä‘iá»ƒm khá»Ÿi Ä‘áº§u vÃ  nÃ¢ng cáº¥p cÃ¡c gÃ³i liÃªn quan.

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [integrations chÃ­nh thá»©c cá»§a Astro](/vi/guides/integrations-guide/).</ReadMore>

### ÄÃ£ xÃ³a: cháº¿ Ä‘á»™ rendering `hybrid`

<SourcePR number="11824" title="Merge output:hybrid and output:static" />

Trong Astro v4.x, Astro cung cáº¥p ba cháº¿ Ä‘á»™ rendering `output`: `'static'`, `'hybrid'`, vÃ  `'server'`

Astro v5.0 há»£p nháº¥t cáº¥u hÃ¬nh `output: 'hybrid'` vÃ  `output: 'static'` thÃ nh má»™t cáº¥u hÃ¬nh duy nháº¥t (giá» Ä‘Æ°á»£c gá»i lÃ  `'static'`) hoáº¡t Ä‘á»™ng giá»‘ng nhÆ° tÃ¹y chá»n hybrid trÆ°á»›c Ä‘Ã¢y.

KhÃ´ng cÃ²n cáº§n thiáº¿t pháº£i chá»‰ Ä‘á»‹nh `output: 'hybrid'` trong config Astro Ä‘á»ƒ sá»­ dá»¥ng cÃ¡c trang server-rendered. `output: 'static'` má»›i cÃ³ kháº£ nÄƒng nÃ y Ä‘Æ°á»£c bao gá»“m.

Astro giá» Ä‘Ã¢y sáº½ tá»± Ä‘á»™ng cho phÃ©p báº¡n opt out khá»i prerendering trong trang web tÄ©nh mÃ  khÃ´ng cáº§n thay Ä‘á»•i cáº¥u hÃ¬nh output. Báº¥t ká»³ route trang hoáº·c endpoint nÃ o Ä‘á»u cÃ³ thá»ƒ bao gá»“m `export const prerender = false` Ä‘á»ƒ Ä‘Æ°á»£c server-rendered theo yÃªu cáº§u, trong khi pháº§n cÃ²n láº¡i cá»§a trang web Ä‘Æ°á»£c táº¡o tÄ©nh.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u dá»± Ã¡n cá»§a báº¡n sá»­ dá»¥ng hybrid rendering, bÃ¢y giá» báº¡n pháº£i xÃ³a tÃ¹y chá»n `output: 'hybrid'` khá»i config Astro vÃ¬ nÃ³ khÃ´ng cÃ²n tá»“n táº¡i. Tuy nhiÃªn, khÃ´ng cáº§n thay Ä‘á»•i khÃ¡c nÃ o Ä‘á»‘i vá»›i dá»± Ã¡n cá»§a báº¡n, vÃ  báº¡n khÃ´ng nÃªn cÃ³ thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch. HÃ nh vi `'hybrid'` trÆ°á»›c Ä‘Ã¢y giá» Ä‘Ã¢y lÃ  máº·c Ä‘á»‹nh, dÆ°á»›i tÃªn má»›i `'static'`.

```js title="astro.config.mjs" del={4}
import { defineConfig } from "astro/config";

export default defineConfig({
  output: 'hybrid',
});
```

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng tÃ¹y chá»n `output: 'static'` (máº·c Ä‘á»‹nh), báº¡n cÃ³ thá»ƒ tiáº¿p tá»¥c sá»­ dá»¥ng nhÆ° trÆ°á»›c. Theo máº·c Ä‘á»‹nh, táº¥t cáº£ cÃ¡c trang cá»§a báº¡n sáº½ tiáº¿p tá»¥c Ä‘Æ°á»£c prerendered vÃ  báº¡n sáº½ cÃ³ má»™t trang web hoÃ n toÃ n tÄ©nh. Báº¡n khÃ´ng nÃªn cÃ³ thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch nÃ o Ä‘á»‘i vá»›i dá»± Ã¡n cá»§a báº¡n.

Má»™t adapter váº«n Ä‘Æ°á»£c yÃªu cáº§u Ä‘á»ƒ deploy dá»± Ã¡n Astro vá»›i báº¥t ká»³ trang server-rendered nÃ o, báº¥t ká»ƒ cháº¿ Ä‘á»™ `output` nÃ o mÃ  dá»± Ã¡n cá»§a báº¡n sá»­ dá»¥ng. Viá»‡c khÃ´ng bao gá»“m adapter sáº½ dáº«n Ä‘áº¿n cáº£nh bÃ¡o trong development vÃ  lá»—i táº¡i thá»i Ä‘iá»ƒm build.

<ReadMore>TÃ¬m hiá»ƒu thÃªm vá» [on-demand rendering trong Astro](/vi/guides/on-demand-rendering/).</ReadMore>

### ÄÃ£ xÃ³a: há»— trá»£ cho giÃ¡ trá»‹ `prerender` Ä‘á»™ng trong routes

<SourcePR number="11824" title="Merge output:hybrid and output:static" />

Trong Astro 4.x, cÃ¡c biáº¿n mÃ´i trÆ°á»ng cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thiáº¿t láº­p Ä‘á»™ng giÃ¡ trá»‹ cá»§a export `prerender` trong routes, vÃ­ dá»¥ `export const prerender = import.meta.env.SOME_VAR`.

Astro v5.0 xÃ³a há»— trá»£ cho giÃ¡ trá»‹ Ä‘á»™ng trong export `prerender`. Chá»‰ cÃ¡c giÃ¡ trá»‹ tÄ©nh `true` vÃ  `false` Ä‘Æ°á»£c há»— trá»£.

#### TÃ´i nÃªn lÃ m gÃ¬?

<Steps>

1. XÃ³a báº¥t ká»³ export `prerender` Ä‘á»™ng nÃ o trong routes cá»§a báº¡n:

    ```astro title="src/pages/blog/[slug].astro" del={2}
    ---
    export const prerender = import.meta.env.SOME_VAR;
    ---
    ```

2. Sá»­ dá»¥ng integration Astro trong file `astro.config.mjs` Ä‘á»ƒ thiáº¿t láº­p giÃ¡ trá»‹ `prerender` cáº§n Ä‘á»™ng trong hook `"astro:route:setup"`:

    ```js title="astro.config.mjs" {6-19}
    import { defineConfig } from 'astro/config';
    import { loadEnv } from 'vite';

    export default defineConfig({
      integrations: [
        {
          name: 'set-prerender',
          hooks: {
            'astro:route:setup': ({ route }) => {
              // Load environment variables tá»« file .env (náº¿u cáº§n)
              const { PRERENDER } = loadEnv(process.env.NODE_ENV, process.cwd(), '');
              // TÃ¬m routes khá»›p vá»›i tÃªn file mong Ä‘á»£i.
              if (route.component.endsWith('/blog/[slug].astro')) {
                // Thiáº¿t láº­p giÃ¡ trá»‹ prerender trÃªn routes khi cáº§n.
                route.prerender = PRERENDER;
              }
            },
          },
        }
      ],
    });
    ```

</Steps>

### ÄÃ£ xÃ³a: Dá»‹ch vá»¥ hÃ¬nh áº£nh Squoosh

<SourcePR number="11770" title="remove the squoosh image service"/>

Trong Astro 4.x, báº¡n cÃ³ thá»ƒ cáº¥u hÃ¬nh `image.service: squooshImageService()` Ä‘á»ƒ sá»­ dá»¥ng Squoosh Ä‘á»ƒ biáº¿n Ä‘á»•i hÃ¬nh áº£nh thay vÃ¬ Sharp. Tuy nhiÃªn, thÆ° viá»‡n cÆ¡ báº£n `libsquoosh` khÃ´ng cÃ²n Ä‘Æ°á»£c duy trÃ¬ vÃ  cÃ³ váº¥n Ä‘á» vá» memory vÃ  hiá»‡u suáº¥t.

Astro 5.0 xÃ³a hoÃ n toÃ n dá»‹ch vá»¥ tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh Squoosh.

#### TÃ´i nÃªn lÃ m gÃ¬?

Äá»ƒ chuyá»ƒn sang dá»‹ch vá»¥ hÃ¬nh áº£nh Sharp tÃ­ch há»£p, hÃ£y xÃ³a import `squooshImageService` khá»i config Astro cá»§a báº¡n. Theo máº·c Ä‘á»‹nh, báº¡n sáº½ sá»­ dá»¥ng Sharp cho `astro:assets`.

```ts title="astro.config.mjs" del={1, 5-7}
import { squooshImageService } from "astro/config";
import { defineConfig } from "astro/config";

export default defineConfig({
 image: {
   service: squooshImageService()
 }
});
```

Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng trÃ¬nh quáº£n lÃ½ gÃ³i nghiÃªm ngáº·t nhÆ° `pnpm`, báº¡n cÃ³ thá»ƒ cáº§n cÃ i Ä‘áº·t gÃ³i `sharp` thá»§ cÃ´ng Ä‘á»ƒ sá»­ dá»¥ng dá»‹ch vá»¥ hÃ¬nh áº£nh Sharp, máº·c dÃ¹ nÃ³ Ä‘Æ°á»£c tÃ­ch há»£p trong Astro theo máº·c Ä‘á»‹nh.

Náº¿u adapter cá»§a báº¡n khÃ´ng há»— trá»£ tá»‘i Æ°u hÃ³a hÃ¬nh áº£nh Sharp tÃ­ch há»£p cá»§a Astro, báº¡n cÃ³ thá»ƒ [cáº¥u hÃ¬nh dá»‹ch vá»¥ hÃ¬nh áº£nh no-op passthrough](/vi/guides/images/#configure-no-op-passthrough-service) Ä‘á»ƒ cho phÃ©p báº¡n sá»­ dá»¥ng cÃ¡c component `<Image />` vÃ  `<Picture />`.

NgoÃ i ra, báº¡n cÃ³ thá»ƒ muá»‘n xem xÃ©t [dá»‹ch vá»¥ hÃ¬nh áº£nh Squoosh Ä‘Æ°á»£c duy trÃ¬ bá»Ÿi cá»™ng Ä‘á»“ng](https://github.com/Princesseuh/astro-image-service-squoosh) náº¿u báº¡n khÃ´ng thá»ƒ sá»­ dá»¥ng dá»‹ch vá»¥ hÃ¬nh áº£nh Sharp.

##### Äá»‘i vá»›i adapters

Náº¿u adapter cá»§a báº¡n trÆ°á»›c Ä‘Ã¢y chá»‰ Ä‘á»‹nh tráº¡ng thÃ¡i tÆ°Æ¡ng thÃ­ch vá»›i Squoosh, bÃ¢y giá» báº¡n nÃªn xÃ³a thÃ´ng tin nÃ y khá»i cáº¥u hÃ¬nh adapter.

```js title="my-adapter.mjs" del={2-4}
supportedAstroFeatures: {
  assets: {
    isSquooshCompatible: true
  }
}
```

<ReadMore>Äá»c thÃªm vá» [cáº¥u hÃ¬nh dá»‹ch vá»¥ hÃ¬nh áº£nh máº·c Ä‘á»‹nh](/vi/guides/images/#default-image-service).</ReadMore>

### ÄÃ£ xÃ³a: má»™t sá»‘ types cÃ´ng khai

<SourcePR number="11715" title="Refactor/types"/>

Trong Astro v4.x, `@types/astro.ts` expose táº¥t cáº£ types cÃ´ng khai cho ngÆ°á»i dÃ¹ng, cho dÃ¹ chÃºng cÃ³ cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng tÃ­ch cá»±c hay chá»‰ dÃ nh cho sá»­ dá»¥ng ná»™i bá»™.

Astro v5.0 refactor file nÃ y Ä‘á»ƒ xÃ³a cÃ¡c types lá»—i thá»i vÃ  ná»™i bá»™. Viá»‡c refactor nÃ y mang láº¡i cáº£i tiáº¿n cho editor cá»§a báº¡n (vÃ­ dá»¥: completions nhanh hÆ¡n, sá»­ dá»¥ng memory tháº¥p hÆ¡n vÃ  cÃ¡c tÃ¹y chá»n completion phÃ¹ há»£p hÆ¡n). Tuy nhiÃªn, viá»‡c refactor nÃ y cÃ³ thá»ƒ gÃ¢y ra lá»—i trong má»™t sá»‘ dá»± Ã¡n Ä‘Ã£ dá»±a vÃ o cÃ¡c types khÃ´ng cÃ²n kháº£ dá»¥ng cho cÃ´ng chÃºng.

#### TÃ´i nÃªn lÃ m gÃ¬?

XÃ³a báº¥t ká»³ types nÃ o hiá»‡n gÃ¢y ra lá»—i trong dá»± Ã¡n cá»§a báº¡n vÃ¬ báº¡n khÃ´ng cÃ²n quyá»n truy cáº­p vÃ o chÃºng. ÄÃ¢y chá»§ yáº¿u lÃ  cÃ¡c API Ä‘Ã£ bá»‹ deprecated vÃ  xÃ³a trÆ°á»›c Ä‘Ã³, nhÆ°ng cÅ©ng cÃ³ thá»ƒ bao gá»“m cÃ¡c types hiá»‡n lÃ  ná»™i bá»™.

<ReadMore>Xem [types cÃ´ng khai Ä‘Æ°á»£c expose Ä‘á»ƒ sá»­ dá»¥ng](https://github.com/withastro/astro/tree/main/packages/astro/src/types/public).</ReadMore>

### Experimental Flags

CÃ¡c experimental flags sau Ä‘Ã¢y Ä‘Ã£ Ä‘Æ°á»£c xÃ³a trong Astro v5.0 vÃ  nhá»¯ng tÃ­nh nÄƒng nÃ y cÃ³ sáºµn Ä‘á»ƒ sá»­ dá»¥ng:

- `env`
- `serverIslands`

NgoÃ i ra, cÃ¡c experimental flags sau Ä‘Ã¢y Ä‘Ã£ Ä‘Æ°á»£c xÃ³a vÃ  **giá» Ä‘Ã¢y lÃ  hÃ nh vi máº·c Ä‘á»‹nh hoáº·c Ä‘Æ°á»£c khuyáº¿n nghá»‹ trong Astro v5.0**.

- `directRenderScript` (Xem bÃªn dÆ°á»›i Ä‘á»ƒ biáº¿t thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch Ä‘á»‘i vá»›i [hÃ nh vi `<script>` máº·c Ä‘á»‹nh](#script-tags-are-rendered-directly-as-declared).)
- `globalRoutePriority` (Xem bÃªn dÆ°á»›i Ä‘á»ƒ biáº¿t thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch Ä‘á»‘i vá»›i [thá»© tá»± Æ°u tiÃªn route máº·c Ä‘á»‹nh](#route-priority-order-for-injected-routes-and-redirects).)
- `contentLayer` (Xem hÆ°á»›ng dáº«n Ä‘á»ƒ [nÃ¢ng cáº¥p content collections hiá»‡n cÃ³](#legacy-v20-content-collections-api) sang Content Layer API má»›i, Ä‘Æ°á»£c Æ°a thÃ­ch.)

CÃ¡c experimental flags sau Ä‘Ã¢y Ä‘Ã£ Ä‘Æ°á»£c xÃ³a vÃ  **cÃ¡c tÃ­nh nÄƒng tÆ°Æ¡ng á»©ng khÃ´ng pháº£i lÃ  má»™t pháº§n cá»§a Astro v5.0**.

- `contentCollectionsCache`

XÃ³a nhá»¯ng experimental flags nÃ y náº¿u báº¡n Ä‘Ã£ sá»­ dá»¥ng chÃºng trÆ°á»›c Ä‘Ã¢y, vÃ  di chuyá»ƒn cáº¥u hÃ¬nh `env` cá»§a báº¡n Ä‘áº¿n root cá»§a config Astro:

```js del={5-12} ins={14-16} title="astro.config.mjs"
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    directRenderScript: true,
    globalRoutePriority: true,
    contentLayer: true,
    serverIslands: true,
    contentCollectionsCache: true,
    env: {
      schema: {...}
    }
  },
  env: {
      schema: {...}
  }
})
```

Táº¥t cáº£ nhá»¯ng tÃ­nh nÄƒng nÃ y Ä‘á»u cÃ³ sáºµn theo máº·c Ä‘á»‹nh trong Astro v5.0.

<ReadMore>Äá»c vá» nhá»¯ng tÃ­nh nÄƒng thÃº vá»‹ nÃ y vÃ  nhiá»u hÆ¡n ná»¯a trong [bÃ i Ä‘Äƒng Blog v5.0](https://astro.build/blog/astro-5/).</ReadMore>

## Thay Ä‘á»•i máº·c Ä‘á»‹nh

Má»™t sá»‘ hÃ nh vi máº·c Ä‘á»‹nh Ä‘Ã£ thay Ä‘á»•i trong Astro v5.0 vÃ  code dá»± Ã¡n cá»§a báº¡n cÃ³ thá»ƒ cáº§n cáº­p nháº­t Ä‘á»ƒ phÃ¹ há»£p vá»›i nhá»¯ng thay Ä‘á»•i nÃ y.

Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, hÃ nh Ä‘á»™ng duy nháº¥t cáº§n thiáº¿t lÃ  xem xÃ©t deployment dá»± Ã¡n hiá»‡n cÃ³ cá»§a báº¡n vÃ  Ä‘áº£m báº£o ráº±ng nÃ³ tiáº¿p tá»¥c hoáº¡t Ä‘á»™ng nhÆ° báº¡n mong Ä‘á»£i, thá»±c hiá»‡n cáº­p nháº­t code khi cáº§n. Trong má»™t sá»‘ trÆ°á»ng há»£p, cÃ³ thá»ƒ cÃ³ cÃ i Ä‘áº·t cáº¥u hÃ¬nh Ä‘á»ƒ cho phÃ©p báº¡n tiáº¿p tá»¥c sá»­ dá»¥ng hÃ nh vi máº·c Ä‘á»‹nh trÆ°á»›c Ä‘Ã³.

### Báº£o vá»‡ CSRF hiá»‡n Ä‘Æ°á»£c thiáº¿t láº­p theo máº·c Ä‘á»‹nh

<SourcePR number="11788" title="change default value of checkOrigin"/>

Trong Astro v4.x, GiÃ¡ trá»‹ máº·c Ä‘á»‹nh cá»§a `security.checkOrigin` lÃ  `false`. TrÆ°á»›c Ä‘Ã¢y, báº¡n pháº£i thiáº¿t láº­p rÃµ rÃ ng giÃ¡ trá»‹ nÃ y thÃ nh `true` Ä‘á»ƒ kÃ­ch hoáº¡t báº£o vá»‡ Cross-Site Request Forgery (CSRF).

Astro v5.0 thay Ä‘á»•i giÃ¡ trá»‹ máº·c Ä‘á»‹nh cá»§a tÃ¹y chá»n nÃ y thÃ nh `true`, vÃ  sáº½ tá»± Ä‘á»™ng kiá»ƒm tra ráº±ng header "origin" khá»›p vá»›i URL Ä‘Æ°á»£c gá»­i bá»Ÿi má»—i request trong cÃ¡c trang rendered theo yÃªu cáº§u.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n Ä‘Ã£ cáº¥u hÃ¬nh `security.checkOrigin: true` trÆ°á»›c Ä‘Ã¢y, báº¡n khÃ´ng cÃ²n cáº§n dÃ²ng nÃ y trong config Astro. ÄÃ¢y giá» Ä‘Ã¢y lÃ  máº·c Ä‘á»‹nh.

Äá»ƒ vÃ´ hiá»‡u hÃ³a hÃ nh vi nÃ y, báº¡n pháº£i thiáº¿t láº­p rÃµ rÃ ng `security.checkOrigin: false`.

```js title="astro.config.mjs" ins={3-5}
export default defineConfig({
  output: "server",
  security: {
    checkOrigin: false
  }
})
```

<ReadMore>Äá»c thÃªm vá» [tÃ¹y chá»n cáº¥u hÃ¬nh báº£o máº­t](/vi/reference/configuration-reference/#security)</ReadMore>

### Thá»© tá»± Æ°u tiÃªn route cho injected routes vÃ  redirects

<SourcePR number="11798" title="Remove legacy route prioritization"/>

Trong Astro v4.x, `experimental.globalRoutePriority` lÃ  má»™t flag tÃ¹y chá»n Ä‘áº£m báº£o ráº±ng injected routes, file-based routes vÃ  redirects Ä‘á»u Ä‘Æ°á»£c Æ°u tiÃªn báº±ng cÃ¡ch sá»­ dá»¥ng [quy táº¯c thá»© tá»± Æ°u tiÃªn route cho táº¥t cáº£ routes](/vi/guides/routing/#route-priority-order). Äiá»u nÃ y cho phÃ©p kiá»ƒm soÃ¡t nhiá»u hÆ¡n viá»‡c Ä‘á»‹nh tuyáº¿n trong dá»± Ã¡n cá»§a báº¡n báº±ng cÃ¡ch khÃ´ng tá»± Ä‘á»™ng Æ°u tiÃªn cÃ¡c loáº¡i routes nháº¥t Ä‘á»‹nh vÃ  tiÃªu chuáº©n hÃ³a thá»© tá»± Æ°u tiÃªn route.

Astro v5.0 xÃ³a experimental flag nÃ y vÃ  lÃ m Ä‘Ã¢y lÃ  hÃ nh vi máº·c Ä‘á»‹nh má»›i trong Astro: redirects vÃ  injected routes giá» Ä‘Ã¢y Ä‘Æ°á»£c Æ°u tiÃªn báº±ng nhau cÃ¹ng vá»›i file-based project routes.

LÆ°u Ã½ ráº±ng Ä‘Ã¢y Ä‘Ã£ lÃ  hÃ nh vi máº·c Ä‘á»‹nh trong Starlight, vÃ  khÃ´ng nÃªn áº£nh hÆ°á»Ÿng Ä‘áº¿n cÃ¡c dá»± Ã¡n Starlight Ä‘Ã£ cáº­p nháº­t.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u dá»± Ã¡n cá»§a báº¡n bao gá»“m injected routes hoáº·c redirects, vui lÃ²ng kiá»ƒm tra ráº±ng routes cá»§a báº¡n Ä‘ang xÃ¢y dá»±ng URL trang nhÆ° mong Ä‘á»£i. Má»™t vÃ­ dá»¥ vá» hÃ nh vi má»›i mong Ä‘á»£i Ä‘Æ°á»£c hiá»ƒn thá»‹ bÃªn dÆ°á»›i.

Trong má»™t dá»± Ã¡n chá»©a cÃ¡c routes sau:

- File-based route: `/blog/post/[pid]`
- File-based route: `/[page]`
- Injected route: `/blog/[...slug]`
- Redirect: `/blog/tags/[tag] -> /[tag]`
- Redirect: `/posts -> /blog`

CÃ¡c URL sau sáº½ Ä‘Æ°á»£c xÃ¢y dá»±ng (thay vÃ¬ theo thá»© tá»± Æ°u tiÃªn route cá»§a Astro v4.x):

- `/blog/tags/astro` Ä‘Æ°á»£c xÃ¢y dá»±ng bá»Ÿi redirect Ä‘áº¿n `/tags/[tag]` (thay vÃ¬ injected route `/blog/[...slug]`)
- `/blog/post/0` Ä‘Æ°á»£c xÃ¢y dá»±ng bá»Ÿi file-based route `/blog/post/[pid]` (thay vÃ¬ injected route `/blog/[...slug]`)
- `/posts` Ä‘Æ°á»£c xÃ¢y dá»±ng bá»Ÿi redirect Ä‘áº¿n `/blog` (thay vÃ¬ file-based route `/[page]`)

Trong trÆ°á»ng há»£p route conflicts, nÆ¡i hai routes cÃ³ thá»© tá»± Æ°u tiÃªn báº±ng nhau cá»‘ gáº¯ng xÃ¢y dá»±ng cÃ¹ng má»™t URL, Astro sáº½ log cáº£nh bÃ¡o xÃ¡c Ä‘á»‹nh cÃ¡c routes xung Ä‘á»™t.

<ReadMore>Äá»c thÃªm vá» [quy táº¯c thá»© tá»± Æ°u tiÃªn route](/vi/guides/routing/#route-priority-order).</ReadMore>

### Tháº» `<script>` Ä‘Æ°á»£c render trá»±c tiáº¿p nhÆ° Ä‘Ã£ khai bÃ¡o

<SourcePR number="11791" title="Make directRenderScript the default"/>

Trong Astro v4.x, `experimental.directRenderScript` lÃ  má»™t flag tÃ¹y chá»n Ä‘á»ƒ render trá»±c tiáº¿p `<scripts>` nhÆ° Ä‘Ã£ khai bÃ¡o trong file `.astro` (bao gá»“m cÃ¡c tÃ­nh nÄƒng hiá»‡n cÃ³ nhÆ° TypeScript, import `node_modules`, vÃ  deduplicate scripts). Chiáº¿n lÆ°á»£c nÃ y ngÄƒn cÃ¡c scripts Ä‘Æ°á»£c thá»±c thi á»Ÿ nhá»¯ng nÆ¡i chÃºng khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng. NgoÃ i ra, cÃ¡c scripts Ä‘Æ°á»£c render cÃ³ Ä‘iá»u kiá»‡n trÆ°á»›c Ä‘Ã¢y Ä‘Æ°á»£c ngáº§m inlined, nhÆ° thá»ƒ má»™t directive `is:inline` Ä‘Æ°á»£c tá»± Ä‘á»™ng thÃªm vÃ o chÃºng.

Astro 5.0 xÃ³a experimental flag nÃ y vÃ  lÃ m Ä‘Ã¢y lÃ  hÃ nh vi máº·c Ä‘á»‹nh má»›i trong Astro: scripts khÃ´ng cÃ²n Ä‘Æ°á»£c hoisted lÃªn `<head>`, nhiá»u scripts trÃªn má»™t trang khÃ´ng cÃ²n Ä‘Æ°á»£c bundle cÃ¹ng nhau, vÃ  tháº» `<script>` cÃ³ thá»ƒ can thiá»‡p vÃ o CSS styling. NgoÃ i ra, cÃ¡c scripts Ä‘Æ°á»£c render cÃ³ Ä‘iá»u kiá»‡n khÃ´ng cÃ²n Ä‘Æ°á»£c ngáº§m inlined.

#### TÃ´i nÃªn lÃ m gÃ¬?

Vui lÃ²ng xem xÃ©t cÃ¡c tháº» `<script>` cá»§a báº¡n vÃ  Ä‘áº£m báº£o chÃºng hoáº¡t Ä‘á»™ng nhÆ° mong muá»‘n.

Náº¿u báº¡n trÆ°á»›c Ä‘Ã¢y cÃ³ cÃ¡c tháº» `<script>` Ä‘Æ°á»£c render cÃ³ Ä‘iá»u kiá»‡n, báº¡n sáº½ cáº§n thÃªm thuá»™c tÃ­nh `is:inline` Ä‘á»ƒ báº£o tá»“n hÃ nh vi giá»‘ng nhÆ° trÆ°á»›c:

```astro title="src/components/MyComponent.astro" ins="is:inline"
---
type Props = {
  showAlert: boolean
}

const { showAlert } = Astro.props;
---
{
  showAlert && <script is:inline>alert("Some very important code!!")</script>
}
```

<ReadMore>Äá»c thÃªm vá» [sá»­ dá»¥ng tháº» `script` trong Astro](/vi/guides/client-side-scripts/#using-script-in-astro).</ReadMore>

## Thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch

CÃ¡c thay Ä‘á»•i sau Ä‘Ã¢y Ä‘Æ°á»£c coi lÃ  thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch trong Astro v5.0. Thay Ä‘á»•i phÃ¡ vá»¡ tÆ°Æ¡ng thÃ­ch cÃ³ thá»ƒ hoáº·c khÃ´ng cung cáº¥p tÆ°Æ¡ng thÃ­ch ngÆ°á»£c táº¡m thá»i. Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng nhá»¯ng tÃ­nh nÄƒng nÃ y, báº¡n cÃ³ thá»ƒ pháº£i cáº­p nháº­t code nhÆ° Ä‘Æ°á»£c khuyáº¿n nghá»‹ trong má»—i má»¥c.

### Äá»•i tÃªn: Component `<ViewTransitions />`

<SourcePR number="11980" title="Rename the ViewTransitions component to ClientRouter"/>

Trong Astro 4.x, View Transitions API cá»§a Astro bao gá»“m má»™t component router `<ViewTransitions />` Ä‘á»ƒ kÃ­ch hoáº¡t client-side routing, page transitions, vÃ  nhiá»u hÆ¡n ná»¯a.

Astro 5.0 Ä‘á»•i tÃªn component nÃ y thÃ nh `<ClientRouter />` Ä‘á»ƒ lÃ m rÃµ vai trÃ² cá»§a component trong API. Äiá»u nÃ y lÃ m cho rÃµ rÃ ng hÆ¡n ráº±ng cÃ¡c tÃ­nh nÄƒng báº¡n nháº­n Ä‘Æ°á»£c tá»« component routing `<ClientRouter />` cá»§a Astro hÆ¡i khÃ¡c so vá»›i native CSS-based MPA router.

KhÃ´ng cÃ³ chá»©c nÄƒng nÃ o thay Ä‘á»•i. Component nÃ y chá»‰ thay Ä‘á»•i tÃªn.

#### TÃ´i nÃªn lÃ m gÃ¬?

Thay tháº¿ táº¥t cáº£ cÃ¡c láº§n xuáº¥t hiá»‡n cá»§a import vÃ  component `ViewTransitions` báº±ng `ClientRouter`:

```astro title="src/layouts/MyLayout.astro" del={1,7} ins={2,8}
import { ViewTransitions } from 'astro:transitions';
import { ClientRouter } from 'astro:transitions';

<html>
  <head>
    ...
   <ViewTransitions />
   <ClientRouter />
  </head>
</html>
```

<ReadMore>Äá»c thÃªm vá» [view transitions vÃ  client-side routing trong Astro](/vi/guides/view-transitions/).</ReadMore>

### Thay Ä‘á»•i: Cáº¥u hÃ¬nh TypeScript

<SourcePR number="11859" title="better tsconfig"/>

Trong Astro v4.x, Astro dá»±a vÃ o file `src/env.d.ts` cho type inferencing vÃ  Ä‘á»‹nh nghÄ©a modules cho cÃ¡c tÃ­nh nÄƒng dá»±a vÃ o generated types.

Astro 5.0 thay vÃ o Ä‘Ã³ sá»­ dá»¥ng file `.astro/types.d.ts` cho type inferencing, vÃ  giá» Ä‘Ã¢y khuyáº¿n nghá»‹ thiáº¿t láº­p `include` vÃ  `exclude` trong `tsconfig.json` Ä‘á»ƒ hÆ°á»Ÿng lá»£i tá»« cÃ¡c types Astro vÃ  trÃ¡nh kiá»ƒm tra cÃ¡c file Ä‘Ã£ build.

Cháº¡y `astro sync` khÃ´ng cÃ²n táº¡o, cÅ©ng khÃ´ng cáº­p nháº­t, `src/env.d.ts` vÃ¬ nÃ³ khÃ´ng Ä‘Æ°á»£c yÃªu cáº§u Ä‘á»ƒ type-checking cÃ¡c dá»± Ã¡n Astro tiÃªu chuáº©n.

#### TÃ´i nÃªn lÃ m gÃ¬?

Äá»ƒ cáº­p nháº­t dá»± Ã¡n cá»§a báº¡n lÃªn cÃ i Ä‘áº·t TypeScript Ä‘Æ°á»£c khuyáº¿n nghá»‹ cá»§a Astro, hÃ£y thÃªm cÃ¡c thuá»™c tÃ­nh `include` vÃ  `exclude` sau vÃ o `tsconfig.json` hiá»‡n cÃ³ cá»§a báº¡n:

```ts ins={3,4} title="tsconfig.json"
{
  "extends": "astro/tsconfigs/base",
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist"]
}
```

LÆ°u Ã½ ráº±ng `src/env.d.ts` chá»‰ cáº§n thiáº¿t náº¿u báº¡n Ä‘Ã£ thÃªm cáº¥u hÃ¬nh tÃ¹y chá»‰nh, hoáº·c náº¿u báº¡n khÃ´ng sá»­ dá»¥ng file `tsconfig.json`.

<ReadMore>Äá»c thÃªm vá» [cáº¥u hÃ¬nh TypeScript trong Astro](/vi/guides/typescript/#setup).</ReadMore>

### Thay Ä‘á»•i: Actions Ä‘Æ°á»£c submit bá»Ÿi HTML forms khÃ´ng cÃ²n sá»­ dá»¥ng cookie redirects

<SourcePR number="12373" title="Actions middleware"/>

Trong Astro 4.x, actions Ä‘Æ°á»£c gá»i tá»« HTML form sáº½ kÃ­ch hoáº¡t redirect vá»›i káº¿t quáº£ Ä‘Æ°á»£c chuyá»ƒn tiáº¿p báº±ng cookies. Äiá»u nÃ y gÃ¢y ra váº¥n Ä‘á» cho cÃ¡c form errors lá»›n vÃ  return values vÆ°á»£t quÃ¡ giá»›i háº¡n 4 KB cá»§a cookie-based storage.

Astro 5.0 giá» Ä‘Ã¢y render káº¿t quáº£ cá»§a action nhÆ° má»™t káº¿t quáº£ POST mÃ  khÃ´ng cÃ³ báº¥t ká»³ forwarding nÃ o. Äiá»u nÃ y sáº½ giá»›i thiá»‡u há»™p thoáº¡i "confirm form resubmission?" khi ngÆ°á»i dÃ¹ng cá»‘ gáº¯ng refresh trang, máº·c dÃ¹ nÃ³ khÃ´ng cÃ²n Ã¡p Ä‘áº·t giá»›i háº¡n 4 KB trÃªn action return value.

#### TÃ´i nÃªn lÃ m gÃ¬?

Báº¡n nÃªn cáº­p nháº­t xá»­ lÃ½ cho káº¿t quáº£ action dá»±a vÃ o redirects, vÃ  tÃ¹y chá»n giáº£i quyáº¿t há»™p thoáº¡i "confirm form resubmission?" vá»›i middleware.

##### Äá»ƒ redirect Ä‘áº¿n route trÆ°á»›c Ä‘Ã³ khi cÃ³ lá»—i

Náº¿u HTML form action cá»§a báº¡n Ä‘Æ°á»£c hÆ°á»›ng Ä‘áº¿n má»™t route khÃ¡c (tá»©c lÃ  `action={"/success-page" + actions.name}`), Astro sáº½ khÃ´ng cÃ²n redirect Ä‘áº¿n route trÆ°á»›c Ä‘Ã³ khi cÃ³ lá»—i. Báº¡n cÃ³ thá»ƒ triá»ƒn khai hÃ nh vi nÃ y thá»§ cÃ´ng báº±ng cÃ¡ch sá»­ dá»¥ng redirects tá»« component Astro cá»§a báº¡n. VÃ­ dá»¥ nÃ y thay vÃ o Ä‘Ã³ redirect Ä‘áº¿n má»™t route má»›i khi thÃ nh cÃ´ng, vÃ  xá»­ lÃ½ errors trÃªn trang hiá»‡n táº¡i náº¿u khÃ´ng:

```astro title="src/pages/newsletter.astro" ins={4-9} del="'/confirmation' + "
---
import { actions } from 'astro:actions';

const result = Astro.getActionResult(actions.newsletter);
if (!result?.error) {
  // NhÃºng dá»¯ liá»‡u káº¿t quáº£ liÃªn quan vÃ o URL náº¿u cáº§n
  // vÃ­ dá»¥: redirect(`/confirmation?email=${result.data.email}`);
  return redirect('/confirmation');
}
---

<form method="POST" action={'/confirmation' + actions.newsletter}>
  <label>E-mail <input required type="email" name="email" /></label>
  <button>Sign up</button>
</form>
```

##### (TÃ¹y chá»n) Äá»ƒ xÃ³a confirm dialog khi refresh

Äá»ƒ giáº£i quyáº¿t há»™p thoáº¡i "confirm form resubmission?" khi refresh, hoáº·c Ä‘á»ƒ báº£o tá»“n káº¿t quáº£ action qua cÃ¡c sessions, bÃ¢y giá» báº¡n cÃ³ thá»ƒ [tÃ¹y chá»‰nh xá»­ lÃ½ káº¿t quáº£ action tá»« middleware](/vi/guides/actions/#advanced-persist-action-results-with-a-session).

ChÃºng tÃ´i khuyáº¿n nghá»‹ sá»­ dá»¥ng session storage provider [nhÆ° Ä‘Æ°á»£c mÃ´ táº£ trong vÃ­ dá»¥ Netlify Blob cá»§a chÃºng tÃ´i](/vi/guides/actions/#advanced-persist-action-results-with-a-session). Tuy nhiÃªn, náº¿u báº¡n thÃ­ch hÃ nh vi cookie forwarding tá»« 4.X vÃ  cháº¥p nháº­n giá»›i háº¡n kÃ­ch thÆ°á»›c 4 KB, báº¡n cÃ³ thá»ƒ triá»ƒn khai pattern nhÆ° Ä‘Æ°á»£c hiá»ƒn thá»‹ trong Ä‘oáº¡n mÃ£ máº«u nÃ y:

```ts title="src/middleware.ts"
import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';

export const onRequest = defineMiddleware(async (context, next) => {
  // Bá» qua requests cho cÃ¡c trang prerendered
  if (context.isPrerendered) return next();

	const { action, setActionResult, serializeActionResult } = getActionContext(context);

	// Náº¿u káº¿t quáº£ action Ä‘Æ°á»£c chuyá»ƒn tiáº¿p nhÆ° má»™t cookie, thiáº¿t láº­p káº¿t quáº£
	// Ä‘á»ƒ cÃ³ thá»ƒ truy cáº­p tá»« `Astro.getActionResult()`
	const payload = context.cookies.get('ACTION_PAYLOAD');
	if (payload) {
		const { actionName, actionResult } = payload.json();
		setActionResult(actionName, actionResult);
		context.cookies.delete('ACTION_PAYLOAD');
		return next();
	}

	// Náº¿u action Ä‘Æ°á»£c gá»i tá»« HTML form action,
	// gá»i action handler vÃ  redirect vá»›i káº¿t quáº£ nhÆ° má»™t cookie.
	if (action?.calledFrom === 'form') {
		const actionResult = await action.handler();

		context.cookies.set('ACTION_PAYLOAD', {
			actionName: action.name,
			actionResult: serializeActionResult(actionResult),
		});

		if (actionResult.error) {
		// Redirect vá» trang trÆ°á»›c Ä‘Ã³ khi cÃ³ lá»—i
			const referer = context.request.headers.get('Referer');
			if (!referer) {
				throw new Error('Internal: Referer unexpectedly missing from Action POST request.');
			}
			return context.redirect(referer);
		}
		// Redirect Ä‘áº¿n trang Ä‘Ã­ch khi thÃ nh cÃ´ng
		return context.redirect(context.originPathname);
	}

	return next();
})
```

### Thay Ä‘á»•i: `compiledContent()` giá» Ä‘Ã¢y lÃ  má»™t async function

<SourcePR number="11782" title="Remove TLA by making compiledContent async"/>

Trong Astro 4.x, top level await Ä‘Æ°á»£c bao gá»“m trong cÃ¡c Markdown modules. Äiá»u nÃ y gÃ¢y ra má»™t sá»‘ váº¥n Ä‘á» vá»›i custom image services vÃ  images bÃªn trong Markdown, khiáº¿n Node Ä‘á»™t ngá»™t thoÃ¡t mÃ  khÃ´ng cÃ³ thÃ´ng bÃ¡o lá»—i.

Astro 5.0 lÃ m cho thuá»™c tÃ­nh `compiledContent()` trÃªn Markdown import trá»Ÿ thÃ nh má»™t async function, yÃªu cáº§u má»™t `await` Ä‘á»ƒ resolve ná»™i dung.

#### TÃ´i nÃªn lÃ m gÃ¬?

Cáº­p nháº­t code cá»§a báº¡n Ä‘á»ƒ sá»­ dá»¥ng `await` khi gá»i `compiledContent()`.

```astro title="src/pages/post.astro" del={4} ins={5}
---
import * as myPost from "../blog/post.md";

const content = myPost.compiledContent();
const content = await myPost.compiledContent();
---

<Fragment set:html={content} />
```

<ReadMore>Äá»c thÃªm vá» [function `compiledContent()`](/vi/guides/markdown-content/#importing-markdown) Ä‘á»ƒ tráº£ vá» compiled Markdown.</ReadMore>

### Thay Ä‘á»•i: `astro:content` khÃ´ng thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng trÃªn client ná»¯a

<SourcePR number="11827" title="Prevent usage of `astro:content` in the client "/>

Trong Astro 4.x, cÃ³ thá»ƒ truy cáº­p module `astro:content` trÃªn client.

Astro 5.0 xÃ³a quyá»n truy cáº­p nÃ y vÃ¬ nÃ³ khÃ´ng bao giá» Ä‘Æ°á»£c cá»‘ Ã½ expose Ä‘á»ƒ sá»­ dá»¥ng client. Sá»­ dá»¥ng `astro:content` theo cÃ¡ch nÃ y cÃ³ háº¡n cháº¿ vÃ  lÃ m phÃ¬nh to client bundles.

#### TÃ´i nÃªn lÃ m gÃ¬?

Náº¿u báº¡n hiá»‡n Ä‘ang sá»­ dá»¥ng `astro:content` trong client, hÃ£y truyá»n dá»¯ liá»‡u báº¡n cáº§n thÃ´ng qua props cho client components cá»§a báº¡n thay vÃ o Ä‘Ã³:

```astro title="src/pages/blog.astro"
---
import { getCollection } from 'astro:content';
import ClientComponent from '../components/ClientComponent';

const posts = await getCollection('blog');
const postsData = posts.map(post => post.data);
---

<ClientComponent posts={postsData} />
```

<ReadMore>Äá»c thÃªm vá» [API `astro:content`](/vi/reference/modules/astro-content/).</ReadMore>

### Äá»•i tÃªn: TÃªn token mÃ u theme Shiki `css-variables`

<SourcePR number="11661" title="Update to new shiki token names"/>

Trong Astro v4.x, theme Shiki `css-variables` sá»­ dá»¥ng cÃ¡c tokens `--astro-code-color-text` vÃ  `--astro-code-color-background` Ä‘á»ƒ styling foreground vÃ  background colors cá»§a code blocks tÆ°Æ¡ng á»©ng.

Astro v5.0 Ä‘á»•i tÃªn chÃºng thÃ nh `--astro-code-foreground` vÃ  `--astro-code-background` tÆ°Æ¡ng á»©ng Ä‘á»ƒ cÄƒn chá»‰nh tá»‘t hÆ¡n vá»›i cÃ¡c máº·c Ä‘á»‹nh Shiki v1.

#### TÃ´i nÃªn lÃ m gÃ¬?

Báº¡n cÃ³ thá»ƒ thá»±c hiá»‡n tÃ¬m vÃ  thay tháº¿ toÃ n cá»¥c trong dá»± Ã¡n cá»§a mÃ¬nh Ä‘á»ƒ di chuyá»ƒn sang tÃªn token má»›i.

```css title="src/styles/global.css" del={2,3} ins={4,5}
:root {
  --astro-code-color-text: #000;
  --astro-code-color-background: #fff;
  --astro-code-foreground: #000;
  --astro-code-background: #fff;
}
```

<ReadMore>Äá»c thÃªm vá» [syntax highlighting trong Astro](/vi/guides/syntax-highlighting/).</ReadMore>

### Thay Ä‘á»•i: plugin rehype Shiki ná»™i bá»™ Ä‘á»ƒ highlighting code blocks

<SourcePR number="11825" title="Refactor createShikiHighlighter"/>

Trong Astro 4.x, plugin rehype Shiki ná»™i bá»™ cá»§a Astro highlighted code blocks nhÆ° HTML.

Astro 5.0 cáº­p nháº­t plugin nÃ y Ä‘á»ƒ highlight code blocks nhÆ° hast. Äiá»u nÃ y cho phÃ©p xá»­ lÃ½ Markdown vÃ  MDX trá»±c tiáº¿p hÆ¡n vÃ  cáº£i thiá»‡n hiá»‡u suáº¥t khi building dá»± Ã¡n. Tuy nhiÃªn, Ä‘iá»u nÃ y cÃ³ thá»ƒ gÃ¢y ra váº¥n Ä‘á» vá»›i cÃ¡c Shiki transformers hiá»‡n cÃ³.

## CÃ¡c Issues Ä‘Ã£ biáº¿t

Vui lÃ²ng kiá»ƒm tra [CÃ¡c váº¥n Ä‘á» cá»§a Astro trÃªn GitHub](https://github.com/withastro/astro/issues/) cÃ¡c váº¥n Ä‘á» Ä‘Ã£ Ä‘Æ°á»£c bÃ¡o cÃ¡o, hoáº·c báº¡n cÅ©ng cÃ³ thá»ƒ tá»± gá»­i.
