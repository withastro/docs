---
title: 'Astro DB'
description: TÃ¬m hiá»ƒu cÃ¡ch sá»­ dá»¥ng Astro DB, má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u SQL Ä‘Æ°á»£c quáº£n lÃ½ hoÃ n toÃ n Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»™c quyá»n cho Astro.
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/db/'
i18nReady: true
---
import { FileTree } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { Steps } from '@astrojs/starlight/components';

Astro DB lÃ  má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u SQL Ä‘Æ°á»£c quáº£n lÃ½ hoÃ n toÃ n Ä‘Æ°á»£c thiáº¿t káº¿ cho há»‡ sinh thÃ¡i Astro. PhÃ¡t triá»ƒn cá»¥c bá»™ trong Astro vÃ  triá»ƒn khai Ä‘áº¿n báº¥t ká»³ cÆ¡ sá»Ÿ dá»¯ liá»‡u tÆ°Æ¡ng thÃ­ch libSQL nÃ o.

Astro DB lÃ  má»™t giáº£i phÃ¡p hoÃ n chá»‰nh Ä‘á»ƒ cáº¥u hÃ¬nh, phÃ¡t triá»ƒn vÃ  truy váº¥n dá»¯ liá»‡u cá»§a báº¡n. Má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»¥c bá»™ Ä‘Æ°á»£c táº¡o trong `.astro/content.db` báº¥t cá»© khi nÃ o báº¡n cháº¡y `astro dev` Ä‘á»ƒ quáº£n lÃ½ dá»¯ liá»‡u cá»§a báº¡n mÃ  khÃ´ng cáº§n Docker hoáº·c káº¿t ná»‘i máº¡ng.

## CÃ i Ä‘áº·t

CÃ i Ä‘áº·t tÃ­ch há»£p [`@astrojs/db`](/vi/guides/integrations-guide/db/) báº±ng lá»‡nh `astro add` tÃ­ch há»£p sáºµn:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add db
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add db
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add db
  ```
  </Fragment>
</PackageManagerTabs>

## Äá»‹nh nghÄ©a cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n

CÃ i Ä‘áº·t `@astrojs/db` vá»›i lá»‡nh `astro add` sáº½ tá»± Ä‘á»™ng táº¡o má»™t tá»‡p `db/config.ts` trong dá»± Ã¡n cá»§a báº¡n nÆ¡i báº¡n sáº½ Ä‘á»‹nh nghÄ©a cÃ¡c báº£ng cÆ¡ sá»Ÿ dá»¯ liá»‡u:

```ts title="db/config.ts"
import { defineDb } from 'astro:db';

export default defineDb({
  tables: { },
})
```

### Báº£ng

Dá»¯ liá»‡u trong Astro DB Ä‘Æ°á»£c lÆ°u trá»¯ báº±ng cÃ¡c báº£ng SQL. Báº£ng cáº¥u trÃºc dá»¯ liá»‡u cá»§a báº¡n thÃ nh cÃ¡c hÃ ng vÃ  cá»™t, trong Ä‘Ã³ cÃ¡c cá»™t thá»±c thi kiá»ƒu cá»§a má»—i giÃ¡ trá»‹ hÃ ng.

Äá»‹nh nghÄ©a cÃ¡c báº£ng cá»§a báº¡n trong tá»‡p `db/config.ts` báº±ng cÃ¡ch cung cáº¥p cáº¥u trÃºc cá»§a dá»¯ liá»‡u trong cÆ¡ sá»Ÿ dá»¯ liá»‡u libSQL hiá»‡n cÃ³ cá»§a báº¡n, hoáº·c dá»¯ liá»‡u báº¡n sáº½ thu tháº­p trong cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i. Äiá»u nÃ y sáº½ cho phÃ©p Astro táº¡o má»™t giao diá»‡n TypeScript Ä‘á»ƒ truy váº¥n báº£ng Ä‘Ã³ tá»« dá»± Ã¡n cá»§a báº¡n. Káº¿t quáº£ lÃ  há»— trá»£ TypeScript Ä‘áº§y Ä‘á»§ khi báº¡n truy cáº­p dá»¯ liá»‡u vá»›i tá»± Ä‘á»™ng hoÃ n thÃ nh thuá»™c tÃ­nh vÃ  kiá»ƒm tra kiá»ƒu.

Äá»ƒ cáº¥u hÃ¬nh má»™t báº£ng cÆ¡ sá»Ÿ dá»¯ liá»‡u, import vÃ  sá»­ dá»¥ng cÃ¡c tiá»‡n Ã­ch `defineTable()` vÃ  `column` tá»« `astro:db`. Sau Ä‘Ã³, Ä‘á»‹nh nghÄ©a má»™t tÃªn (phÃ¢n biá»‡t chá»¯ hoa chá»¯ thÆ°á»ng) cho báº£ng cá»§a báº¡n vÃ  kiá»ƒu dá»¯ liá»‡u trong má»—i cá»™t.

VÃ­ dá»¥ nÃ y cáº¥u hÃ¬nh má»™t báº£ng `Comment` vá»›i cÃ¡c cá»™t vÄƒn báº£n báº¯t buá»™c cho `author` vÃ  `body`. Sau Ä‘Ã³, lÃ m cho nÃ³ cÃ³ sáºµn cho dá»± Ã¡n cá»§a báº¡n thÃ´ng qua export `defineDb()`.

```ts title="db/config.ts" "Comment"
import { defineDb, defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
})

export default defineDb({
  tables: { Comment },
})
```

<ReadMore>Xem [tham chiáº¿u cáº¥u hÃ¬nh báº£ng](/vi/guides/integrations-guide/db/#table-configuration-reference) Ä‘á»ƒ cÃ³ tham chiáº¿u Ä‘áº§y Ä‘á»§ vá» cÃ¡c tÃ¹y chá»n báº£ng.</ReadMore>

### Cá»™t

Astro DB há»— trá»£ cÃ¡c kiá»ƒu cá»™t sau:

```ts title="db/config.ts" "column.text()" "column.number()" "column.boolean()" "column.date()" "column.json()"
import { defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    // Má»™t chuá»—i vÄƒn báº£n.
    author: column.text(),
    // Má»™t giÃ¡ trá»‹ sá»‘ nguyÃªn.
    likes: column.number(),
    // Má»™t giÃ¡ trá»‹ true hoáº·c false.
    flagged: column.boolean(),
    // GiÃ¡ trá»‹ ngÃ y/giá» Ä‘Æ°á»£c truy váº¥n dÆ°á»›i dáº¡ng Ä‘á»‘i tÆ°á»£ng Date JavaScript.
    published: column.date(),
    // Má»™t Ä‘á»‘i tÆ°á»£ng JSON khÃ´ng cÃ³ kiá»ƒu.
    metadata: column.json(),
  }
});
```

<ReadMore>Xem [tham chiáº¿u cá»™t báº£ng](/vi/guides/integrations-guide/db/#table-configuration-reference) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.</ReadMore>

### Tham chiáº¿u báº£ng

Má»‘i quan há»‡ giá»¯a cÃ¡c báº£ng lÃ  má»™t máº«u phá»• biáº¿n trong thiáº¿t káº¿ cÆ¡ sá»Ÿ dá»¯ liá»‡u. VÃ­ dá»¥, má»™t báº£ng `Blog` cÃ³ thá»ƒ cÃ³ liÃªn quan cháº·t cháº½ vá»›i cÃ¡c báº£ng khÃ¡c cá»§a `Comment`, `Author`, vÃ  `Category`.

Báº¡n cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c má»‘i quan há»‡ nÃ y giá»¯a cÃ¡c báº£ng vÃ  lÆ°u chÃºng vÃ o lÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n báº±ng **cá»™t tham chiáº¿u**. Äá»ƒ thiáº¿t láº­p má»™t má»‘i quan há»‡, báº¡n sáº½ cáº§n:

- Má»™t **cá»™t Ä‘á»‹nh danh** trÃªn báº£ng Ä‘Æ°á»£c tham chiáº¿u. ÄÃ¢y thÆ°á»ng lÃ  má»™t cá»™t `id` vá»›i thuá»™c tÃ­nh `primaryKey`.
- Má»™t cá»™t trÃªn báº£ng cÆ¡ sá»Ÿ Ä‘á»ƒ **lÆ°u trá»¯ `id` Ä‘Æ°á»£c tham chiáº¿u**. Äiá»u nÃ y sá»­ dá»¥ng thuá»™c tÃ­nh `references` Ä‘á»ƒ thiáº¿t láº­p má»™t má»‘i quan há»‡.

VÃ­ dá»¥ nÃ y cho tháº¥y cá»™t `authorId` cá»§a báº£ng `Comment` tham chiáº¿u Ä‘áº¿n cá»™t `id` cá»§a báº£ng `Author`.

```ts title="db/config.ts" {3, 10}
const Author = defineTable({
  columns: {
    id: column.number({ primaryKey: true }),
    name: column.text(),
  }
});

const Comment = defineTable({
  columns: {
    authorId: column.number({ references: () => Author.columns.id }),
    body: column.text(),
  }
});
```

## Seed cÆ¡ sá»Ÿ dá»¯ liá»‡u cho phÃ¡t triá»ƒn

Trong phÃ¡t triá»ƒn, Astro sáº½ sá»­ dá»¥ng cáº¥u hÃ¬nh DB cá»§a báº¡n Ä‘á»ƒ táº¡o cÃ¡c kiá»ƒu cá»¥c bá»™ theo lÆ°á»£c Ä‘á»“ cá»§a báº¡n. ChÃºng sáº½ Ä‘Æ°á»£c táº¡o má»›i tá»« tá»‡p seed cá»§a báº¡n má»—i khi mÃ¡y chá»§ dev Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng, vÃ  sáº½ cho phÃ©p báº¡n truy váº¥n vÃ  lÃ m viá»‡c vá»›i hÃ¬nh dáº¡ng dá»¯ liá»‡u cá»§a báº¡n vá»›i an toÃ n kiá»ƒu vÃ  tá»± Ä‘á»™ng hoÃ n thÃ nh.

Báº¡n sáº½ khÃ´ng cÃ³ quyá»n truy cáº­p vÃ o dá»¯ liá»‡u sáº£n xuáº¥t trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn trá»« khi báº¡n [káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa](#connecting-to-remote-databases) trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn. Äiá»u nÃ y báº£o vá»‡ dá»¯ liá»‡u cá»§a báº¡n trong khi cho phÃ©p báº¡n kiá»ƒm tra vÃ  phÃ¡t triá»ƒn vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u hoáº¡t Ä‘á»™ng vá»›i an toÃ n kiá»ƒu.

Äá»ƒ seed dá»¯ liá»‡u phÃ¡t triá»ƒn cho viá»‡c kiá»ƒm tra vÃ  gá»¡ lá»—i vÃ o dá»± Ã¡n Astro cá»§a báº¡n, hÃ£y táº¡o má»™t tá»‡p `db/seed.ts`. Import cáº£ Ä‘á»‘i tÆ°á»£ng `db` vÃ  cÃ¡c báº£ng Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trong `astro:db`. `insert` má»™t sá»‘ dá»¯ liá»‡u ban Ä‘áº§u vÃ o má»—i báº£ng. Dá»¯ liá»‡u phÃ¡t triá»ƒn nÃ y pháº£i khá»›p vá»›i cáº£ lÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  dá»¯ liá»‡u sáº£n xuáº¥t.

VÃ­ dá»¥ sau Ä‘á»‹nh nghÄ©a hai hÃ ng dá»¯ liá»‡u phÃ¡t triá»ƒn cho báº£ng `Comment` vÃ  báº£ng `Author`:

```ts title="db/seed.ts"
import { db, Comment, Author } from 'astro:db';

export default async function() {
  await db.insert(Author).values([
    { id: 1, name: "Kasim" },
    { id: 2, name: "Mina" },
  ]);

  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!'},
  ])
}
```

MÃ¡y chá»§ phÃ¡t triá»ƒn cá»§a báº¡n sáº½ tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng láº¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u báº¥t cá»© khi nÃ o tá»‡p nÃ y thay Ä‘á»•i, tÃ¡i táº¡o cÃ¡c kiá»ƒu cá»§a báº¡n vÃ  seeding dá»¯ liá»‡u phÃ¡t triá»ƒn nÃ y tá»« `seed.ts` má»›i má»—i láº§n.

## Káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u libSQL cho sáº£n xuáº¥t

Astro DB cÃ³ thá»ƒ káº¿t ná»‘i vá»›i báº¥t ká»³ cÆ¡ sá»Ÿ dá»¯ liá»‡u libSQL cá»¥c bá»™ nÃ o hoáº·c vá»›i báº¥t ká»³ mÃ¡y chá»§ nÃ o hiá»ƒn thá»‹ giao thá»©c tá»« xa libSQL, dÃ¹ Ä‘Æ°á»£c quáº£n lÃ½ hay tá»± lÆ°u trá»¯.

Äá»ƒ káº¿t ná»‘i Astro DB vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u libSQL, Ä‘áº·t cÃ¡c biáº¿n mÃ´i trÆ°á»ng sau Ä‘Æ°á»£c láº¥y tá»« nhÃ  cung cáº¥p cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n:

- `ASTRO_DB_REMOTE_URL`: URL káº¿t ná»‘i Ä‘áº¿n vá»‹ trÃ­ cá»§a libSQL DB cá»¥c bá»™ hoáº·c tá»« xa cá»§a báº¡n. Äiá»u nÃ y cÃ³ thá»ƒ bao gá»“m [tÃ¹y chá»n cáº¥u hÃ¬nh URL](#remote-url-configuration-options) nhÆ° Ä‘á»“ng bá»™ hÃ³a vÃ  mÃ£ hÃ³a dÆ°á»›i dáº¡ng tham sá»‘.
- `ASTRO_DB_APP_TOKEN`: token xÃ¡c thá»±c cho mÃ¡y chá»§ libSQL cá»§a báº¡n. Äiá»u nÃ y Ä‘Æ°á»£c yÃªu cáº§u cho cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa, vÃ  khÃ´ng cáº§n thiáº¿t cho [DB cá»¥c bá»™ nhÆ° tá»‡p hoáº·c trong bá»™ nhá»›](#url-scheme-and-host).

TÃ¹y thuá»™c vÃ o dá»‹ch vá»¥ cá»§a báº¡n, báº¡n cÃ³ thá»ƒ cÃ³ quyá»n truy cáº­p vÃ o CLI hoáº·c giao diá»‡n web Ä‘á»ƒ láº¥y cÃ¡c giÃ¡ trá»‹ nÃ y. Pháº§n sau sáº½ trÃ¬nh bÃ y viá»‡c káº¿t ná»‘i vá»›i Turso vÃ  Ä‘áº·t cÃ¡c giÃ¡ trá»‹ nÃ y lÃ m vÃ­ dá»¥, nhÆ°ng báº¡n cÃ³ thá»ƒ tá»± do sá»­ dá»¥ng báº¥t ká»³ nhÃ  cung cáº¥p nÃ o.

### Báº¯t Ä‘áº§u vá»›i Turso

Turso lÃ  cÃ´ng ty Ä‘áº±ng sau [libSQL](https://github.com/tursodatabase/libsql), fork mÃ£ nguá»“n má»Ÿ cá»§a SQLite cung cáº¥p nÄƒng lÆ°á»£ng cho Astro DB. Há» cung cáº¥p má»™t ná»n táº£ng cÆ¡ sá»Ÿ dá»¯ liá»‡u libSQL Ä‘Æ°á»£c quáº£n lÃ½ hoÃ n toÃ n vÃ  hoÃ n toÃ n tÆ°Æ¡ng thÃ­ch vá»›i Astro.

CÃ¡c bÆ°á»›c dÆ°á»›i Ä‘Ã¢y sáº½ hÆ°á»›ng dáº«n báº¡n qua quÃ¡ trÃ¬nh cÃ i Ä‘áº·t Turso CLI, Ä‘Äƒng nháº­p (hoáº·c Ä‘Äƒng kÃ½), táº¡o cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i, láº¥y cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t, vÃ  Ä‘áº©y lÆ°á»£c Ä‘á»“ Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa.

<Steps>

1. CÃ i Ä‘áº·t [Turso CLI](https://docs.turso.tech/cli/installation).

2. [ÄÄƒng nháº­p hoáº·c Ä‘Äƒng kÃ½](https://docs.turso.tech/cli/authentication) vÃ o Turso.

3. Táº¡o má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i. Trong vÃ­ dá»¥ nÃ y tÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  `andromeda`.

   ```sh "andromeda"
   turso db create andromeda
   ```

4. Cháº¡y lá»‡nh `show` Ä‘á»ƒ xem thÃ´ng tin vá» cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i Ä‘Æ°á»£c táº¡o:

   ```sh "andromeda"
   turso db show andromeda
   ```

   Sao chÃ©p giÃ¡ trá»‹ `URL` vÃ  Ä‘áº·t nÃ³ lÃ m giÃ¡ trá»‹ cho `ASTRO_DB_REMOTE_URL`.
   

   ```dotenv title=".env" "libsql://andromeda-houston.turso.io"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ```

5. Táº¡o má»™t token má»›i Ä‘á»ƒ xÃ¡c thá»±c cÃ¡c yÃªu cáº§u Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u:

   ```sh "andromeda"
   turso db tokens create andromeda
   ```

   Sao chÃ©p Ä‘áº§u ra cá»§a lá»‡nh vÃ  Ä‘áº·t nÃ³ lÃ m giÃ¡ trá»‹ cho `ASTRO_DB_APP_TOKEN`.

   ```dotenv title=".env" add={2} "eyJhbGciOiJF...3ahJpTkKDw"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ASTRO_DB_APP_TOKEN=eyJhbGciOiJF...3ahJpTkKDw
   ```

6. Äáº©y lÆ°á»£c Ä‘á»“ DB vÃ  metadata cá»§a báº¡n Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u Turso má»›i.

   ```sh
   astro db push --remote
   ```

7. ChÃºc má»«ng, giá» báº¡n Ä‘Ã£ cÃ³ má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°á»£c káº¿t ná»‘i! HÃ£y nghá»‰ ngÆ¡i má»™t chÃºt. ğŸ‘¾

   ```sh
   turso relax
   ```

</Steps>

Äá»ƒ khÃ¡m phÃ¡ thÃªm cÃ¡c tÃ­nh nÄƒng cá»§a Turso, hÃ£y xem [tÃ i liá»‡u Turso](https://docs.turso.tech).

### Káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa

Astro DB cho phÃ©p báº¡n káº¿t ná»‘i vá»›i cáº£ cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»¥c bá»™ vÃ  tá»« xa. Máº·c Ä‘á»‹nh, Astro sá»­ dá»¥ng má»™t tá»‡p cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»¥c bá»™ cho cÃ¡c lá»‡nh `dev` vÃ  `build`, tÃ¡i táº¡o cÃ¡c báº£ng vÃ  chÃ¨n dá»¯ liá»‡u seed phÃ¡t triá»ƒn má»—i láº§n.

Äá»ƒ káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa Ä‘Æ°á»£c lÆ°u trá»¯, sá»­ dá»¥ng flag `--remote`. Flag nÃ y cho phÃ©p cáº£ quyá»n truy cáº­p Ä‘á»c vÃ  ghi vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa cá»§a báº¡n, cho phÃ©p báº¡n [cháº¥p nháº­n vÃ  duy trÃ¬ dá»¯ liá»‡u ngÆ°á»i dÃ¹ng](#insert) trong mÃ´i trÆ°á»ng sáº£n xuáº¥t.

:::note
Trong khi káº¿t ná»‘i tá»« xa thÆ°á»ng cÃ³ thá»ƒ vá»›i báº¥t ká»³ ná»n táº£ng triá»ƒn khai nÃ o sá»­ dá»¥ng cháº¿ Ä‘á»™ káº¿t xuáº¥t tÄ©nh hoáº·c mÃ¡y chá»§, hiá»‡n táº¡i cÃ³ má»™t sá»‘ háº¡n cháº¿. CÃ¡c runtime khÃ´ng pháº£i Node nhÆ° Cloudflare vÃ  Deno hiá»‡n táº¡i khÃ´ng há»— trá»£ DB trÃªn cÃ¡c tuyáº¿n káº¿t xuáº¥t mÃ¡y chá»§ khi sá»­ dá»¥ng libSQL. Há»— trá»£ cho cÃ¡c ná»n táº£ng nÃ y Ä‘Æ°á»£c lÃªn káº¿ hoáº¡ch cho viá»‡c triá»ƒn khai trong tÆ°Æ¡ng lai.
:::

Cáº¥u hÃ¬nh lá»‡nh build cá»§a báº¡n Ä‘á»ƒ sá»­ dá»¥ng flag `--remote`:

```json title="package.json" "--remote"
{
  "scripts": {
    "build": "astro build --remote"
  }
}
```

Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng flag trá»±c tiáº¿p trong dÃ²ng lá»‡nh:

```bash
# Build vá»›i káº¿t ná»‘i tá»« xa
astro build --remote

# PhÃ¡t triá»ƒn vá»›i káº¿t ná»‘i tá»« xa
astro dev --remote
```

:::caution
HÃ£y cáº©n tháº­n khi sá»­ dá»¥ng `--remote` trong phÃ¡t triá»ƒn. Äiá»u nÃ y káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u sáº£n xuáº¥t trá»±c tiáº¿p cá»§a báº¡n, vÃ  táº¥t cáº£ cÃ¡c thay Ä‘á»•i (chÃ¨n, cáº­p nháº­t, xÃ³a) sáº½ Ä‘Æ°á»£c duy trÃ¬.
:::

Flag `--remote` sá»­ dá»¥ng káº¿t ná»‘i Ä‘áº¿n DB tá»« xa cáº£ cá»¥c bá»™ trong quÃ¡ trÃ¬nh build vÃ  trÃªn mÃ¡y chá»§. Äáº£m báº£o báº¡n Ä‘áº·t cÃ¡c biáº¿n mÃ´i trÆ°á»ng cáº§n thiáº¿t trong cáº£ mÃ´i trÆ°á»ng phÃ¡t triá»ƒn cá»¥c bá»™ vÃ  ná»n táº£ng triá»ƒn khai cá»§a báº¡n.

Khi triá»ƒn khai dá»± Ã¡n Astro DB cá»§a báº¡n, hÃ£y Ä‘áº£m báº£o lá»‡nh build cá»§a ná»n táº£ng triá»ƒn khai Ä‘Æ°á»£c Ä‘áº·t thÃ nh `npm run build` (hoáº·c tÆ°Æ¡ng Ä‘Æ°Æ¡ng cho trÃ¬nh quáº£n lÃ½ gÃ³i cá»§a báº¡n) Ä‘á»ƒ sá»­ dá»¥ng flag `--remote` Ä‘Æ°á»£c cáº¥u hÃ¬nh trong `package.json` cá»§a báº¡n.

### CÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh URL tá»« xa

Biáº¿n mÃ´i trÆ°á»ng `ASTRO_DB_REMOTE_URL` cáº¥u hÃ¬nh vá»‹ trÃ­ cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n cÅ©ng nhÆ° cÃ¡c tÃ¹y chá»n khÃ¡c nhÆ° Ä‘á»“ng bá»™ hÃ³a vÃ  mÃ£ hÃ³a.

#### LÆ°á»£c Ä‘á»“ URL vÃ  host

libSQL há»— trá»£ cáº£ HTTP vÃ  WebSockets lÃ m giao thá»©c váº­n chuyá»ƒn cho mÃ¡y chá»§ tá»« xa. NÃ³ cÅ©ng há»— trá»£ sá»­ dá»¥ng tá»‡p cá»¥c bá»™ hoáº·c DB trong bá»™ nhá»›. Nhá»¯ng Ä‘iá»u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥u hÃ¬nh báº±ng cÃ¡c lÆ°á»£c Ä‘á»“ URL sau trong URL káº¿t ná»‘i:

- `memory:` sáº½ sá»­ dá»¥ng DB trong bá»™ nhá»›. Host pháº£i trá»‘ng trong trÆ°á»ng há»£p nÃ y.
- `file:` sáº½ sá»­ dá»¥ng tá»‡p cá»¥c bá»™. Host lÃ  Ä‘Æ°á»ng dáº«n Ä‘áº¿n tá»‡p (`file:path/to/file.db`).
- `libsql:` sáº½ sá»­ dá»¥ng mÃ¡y chá»§ tá»« xa thÃ´ng qua giao thá»©c Ä‘Æ°á»£c thÆ° viá»‡n Æ°a thÃ­ch (Ä‘iá»u nÃ y cÃ³ thá»ƒ khÃ¡c nhau giá»¯a cÃ¡c phiÃªn báº£n). Host lÃ  Ä‘á»‹a chá»‰ cá»§a mÃ¡y chá»§ (`libsql://your.server.io`).
- `http:` sáº½ sá»­ dá»¥ng mÃ¡y chá»§ tá»« xa thÃ´ng qua HTTP. `https:` cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ báº­t káº¿t ná»‘i an toÃ n. Host giá»‘ng nhÆ° cho `libsql:`.
- `ws:` sáº½ sá»­ dá»¥ng mÃ¡y chá»§ tá»« xa thÃ´ng qua WebSockets. `wss:` cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ báº­t káº¿t ná»‘i an toÃ n. Host giá»‘ng nhÆ° cho `libsql:`.

Chi tiáº¿t káº¿t ná»‘i libSQL (vÃ­ dá»¥: khÃ³a mÃ£ hÃ³a, sao chÃ©p, khoáº£ng thá»i gian Ä‘á»“ng bá»™) cÃ³ thá»ƒ Ä‘Æ°á»£c cáº¥u hÃ¬nh dÆ°á»›i dáº¡ng tham sá»‘ truy váº¥n trong URL káº¿t ná»‘i tá»« xa.

VÃ­ dá»¥, Ä‘á»ƒ cÃ³ má»™t tá»‡p cá»¥c bá»™ Ä‘Æ°á»£c mÃ£ hÃ³a hoáº¡t Ä‘á»™ng nhÆ° má»™t báº£n sao nhÃºng Ä‘áº¿n mÃ¡y chá»§ libSQL, báº¡n cÃ³ thá»ƒ Ä‘áº·t cÃ¡c biáº¿n mÃ´i trÆ°á»ng sau:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file://local-copy.db?encryptionKey=your-encryption-key&syncInterval=60&syncUrl=libsql%3A%2F%2Fyour.server.io
ASTRO_DB_APP_TOKEN=token-to-your-remote-url
```

:::caution
Sá»­ dá»¥ng tá»‡p cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  má»™t tÃ­nh nÄƒng nÃ¢ng cao, vÃ  cáº§n cáº©n tháº­n khi triá»ƒn khai Ä‘á»ƒ trÃ¡nh ghi Ä‘Ã¨ cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n vÃ  máº¥t dá»¯ liá»‡u sáº£n xuáº¥t.

NgoÃ i ra, phÆ°Æ¡ng phÃ¡p nÃ y sáº½ khÃ´ng hoáº¡t Ä‘á»™ng trong cÃ¡c triá»ƒn khai serverless, vÃ¬ há»‡ thá»‘ng tá»‡p khÃ´ng Ä‘Æ°á»£c duy trÃ¬ trong cÃ¡c mÃ´i trÆ°á»ng Ä‘Ã³.
:::

#### `encryptionKey`

libSQL cÃ³ há»— trá»£ gá»‘c cho cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°á»£c mÃ£ hÃ³a. Truyá»n tham sá»‘ tÃ¬m kiáº¿m nÃ y sáº½ báº­t mÃ£ hÃ³a báº±ng khÃ³a Ä‘Ã£ cho:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file:path/to/file.db?encryptionKey=your-encryption-key
```

#### `syncUrl`

Báº£n sao nhÃºng lÃ  má»™t tÃ­nh nÄƒng cá»§a mÃ¡y khÃ¡ch libSQL táº¡o má»™t báº£n sao Ä‘Æ°á»£c Ä‘á»“ng bá»™ hoÃ n toÃ n cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n trÃªn tá»‡p cá»¥c bá»™ hoáº·c trong bá»™ nhá»› Ä‘á»ƒ Ä‘á»c cá»±c nhanh. CÃ¡c thao tÃ¡c ghi Ä‘Æ°á»£c gá»­i Ä‘áº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a trÃªn `syncUrl` vÃ  Ä‘Æ°á»£c Ä‘á»“ng bá»™ hÃ³a vá»›i báº£n sao cá»¥c bá»™.

Sá»­ dá»¥ng thuá»™c tÃ­nh nÃ y Ä‘á»ƒ truyá»n URL káº¿t ná»‘i riÃªng biá»‡t Ä‘á»ƒ biáº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u thÃ nh báº£n sao nhÃºng cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ¡c. Äiá»u nÃ y chá»‰ nÃªn Ä‘Æ°á»£c sá»­ dá»¥ng vá»›i cÃ¡c lÆ°á»£c Ä‘á»“ `file:` vÃ  `memory:`. Tham sá»‘ pháº£i Ä‘Æ°á»£c mÃ£ hÃ³a URL.

VÃ­ dá»¥, Ä‘á»ƒ cÃ³ má»™t báº£n sao nhÃºng trong bá»™ nhá»› cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u trÃªn `libsql://your.server.io`, báº¡n cÃ³ thá»ƒ Ä‘áº·t URL káº¿t ná»‘i nhÆ° sau:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io
```

#### `syncInterval`

Khoáº£ng thá»i gian giá»¯a cÃ¡c Ä‘á»“ng bá»™ hÃ³a báº£n sao nhÃºng tÃ­nh báº±ng giÃ¢y. Máº·c Ä‘á»‹nh nÃ³ chá»‰ Ä‘á»“ng bá»™ hÃ³a khi khá»Ÿi Ä‘á»™ng vÃ  sau cÃ¡c thao tÃ¡c ghi.

Thuá»™c tÃ­nh nÃ y chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng khi `syncUrl` cÅ©ng Ä‘Æ°á»£c Ä‘áº·t. VÃ­ dá»¥, Ä‘á»ƒ Ä‘áº·t báº£n sao nhÃºng trong bá»™ nhá»› Ä‘á»“ng bá»™ hÃ³a má»—i phÃºt, hÃ£y Ä‘áº·t biáº¿n mÃ´i trÆ°á»ng sau:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io&syncInterval=60
```

## Truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n

Báº¡n cÃ³ thá»ƒ truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« báº¥t ká»³ [trang Astro](/vi/basics/astro-pages/#astro-pages), [endpoint](/vi/guides/endpoints/), hoáº·c [action](/vi/guides/actions/) nÃ o trong dá»± Ã¡n cá»§a báº¡n báº±ng cÃ¡ch sá»­ dá»¥ng ORM `db` vÃ  query builder Ä‘Æ°á»£c cung cáº¥p.

### Drizzle ORM

```ts
import { db } from 'astro:db';
```

Astro DB bao gá»“m má»™t mÃ¡y khÃ¡ch [Drizzle ORM](https://orm.drizzle.team/) tÃ­ch há»£p sáºµn. KhÃ´ng cáº§n thiáº¿t láº­p hoáº·c cáº¥u hÃ¬nh thá»§ cÃ´ng Ä‘á»ƒ sá»­ dá»¥ng mÃ¡y khÃ¡ch. MÃ¡y khÃ¡ch Astro DB `db` Ä‘Æ°á»£c tá»± Ä‘á»™ng cáº¥u hÃ¬nh Ä‘á»ƒ giao tiáº¿p vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n (cá»¥c bá»™ hoáº·c tá»« xa) khi báº¡n cháº¡y Astro. NÃ³ sá»­ dá»¥ng Ä‘á»‹nh nghÄ©a lÆ°á»£c Ä‘á»“ cÆ¡ sá»Ÿ dá»¯ liá»‡u chÃ­nh xÃ¡c cá»§a báº¡n cho cÃ¡c truy váº¥n SQL an toÃ n kiá»ƒu vá»›i lá»—i TypeScript khi báº¡n tham chiáº¿u má»™t cá»™t hoáº·c báº£ng khÃ´ng tá»“n táº¡i.

### Select 

VÃ­ dá»¥ sau chá»n táº¥t cáº£ cÃ¡c hÃ ng cá»§a báº£ng `Comment`. Äiá»u nÃ y tráº£ vá» máº£ng Ä‘áº§y Ä‘á»§ cá»§a dá»¯ liá»‡u phÃ¡t triá»ƒn Ä‘Æ°á»£c seed tá»« `db/seed.ts` sau Ä‘Ã³ cÃ³ sáºµn Ä‘á»ƒ sá»­ dá»¥ng trong template trang cá»§a báº¡n:

```astro title="src/pages/index.astro"
---
import { db, Comment } from 'astro:db';

const comments = await db.select().from(Comment);
---

<h2>Comments</h2>

{
  comments.map(({ author, body }) => (
    <article>
      <p>Author: {author}</p>
      <p>{body}</p>
    </article>
  ))
}
```

<ReadMore>Xem [tham chiáº¿u API Drizzle `select()`](https://orm.drizzle.team/docs/select) Ä‘á»ƒ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan Ä‘áº§y Ä‘á»§.</ReadMore>

### Insert

Äá»ƒ cháº¥p nháº­n Ä‘áº§u vÃ o ngÆ°á»i dÃ¹ng, nhÆ° xá»­ lÃ½ yÃªu cáº§u form vÃ  chÃ¨n dá»¯ liá»‡u vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa Ä‘Æ°á»£c lÆ°u trá»¯ cá»§a báº¡n, hÃ£y cáº¥u hÃ¬nh dá»± Ã¡n Astro cá»§a báº¡n cho [káº¿t xuáº¥t theo nhu cáº§u](/vi/guides/on-demand-rendering/) vÃ  [thÃªm má»™t adapter](/vi/guides/on-demand-rendering/#add-an-adapter) cho mÃ´i trÆ°á»ng triá»ƒn khai cá»§a báº¡n.

VÃ­ dá»¥ nÃ y chÃ¨n má»™t hÃ ng vÃ o báº£ng `Comment` dá»±a trÃªn yÃªu cáº§u form POST Ä‘Æ°á»£c phÃ¢n tÃ­ch:

```astro
---
// src/pages/index.astro
import { db, Comment } from 'astro:db';

if (Astro.request.method === 'POST') {
  // PhÃ¢n tÃ­ch dá»¯ liá»‡u form
  const formData = await Astro.request.formData();
  const author = formData.get('author');
  const body = formData.get('body');
  if (typeof author === 'string' && typeof body === 'string') {
    // ChÃ¨n dá»¯ liá»‡u form vÃ o báº£ng Comment
    await db.insert(Comment).values({ author, body });
  }
}

// Káº¿t xuáº¥t danh sÃ¡ch comments má»›i trÃªn má»—i yÃªu cáº§u
const comments = await db.select().from(Comment);
---

<form method="POST" style="display: grid">
	<label for="author">Author</label>
	<input id="author" name="author" />

	<label for="body">Body</label>
	<textarea id="body" name="body"></textarea>

	<button type="submit">Submit</button>
</form>

<!-- Káº¿t xuáº¥t `comments` -->
```

Báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng [Astro actions](/vi/guides/actions/) Ä‘á»ƒ chÃ¨n dá»¯ liá»‡u vÃ o báº£ng Astro DB. VÃ­ dá»¥ sau chÃ¨n má»™t hÃ ng vÃ o báº£ng `Comment` báº±ng má»™t action:

```ts
// src/actions/index.ts
import { db, Comment } from 'astro:db';
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';

export const server = {
  addComment: defineAction({
    // Actions bao gá»“m an toÃ n kiá»ƒu vá»›i Zod, loáº¡i bá» nhu cáº§u
    // kiá»ƒm tra if typeof {value} === 'string' trong cÃ¡c trang cá»§a báº¡n
    input: z.object({
      author: z.string(),
      body: z.string(),
    }),
    handler: async (input) => {
      const updatedComments = await db
        .insert(Comment)
        .values(input)
        .returning(); // Tráº£ vá» cÃ¡c comments Ä‘Ã£ cáº­p nháº­t
      return updatedComments;
    },
  }),
};
```

<ReadMore>

Xem [tham chiáº¿u API Drizzle `insert()`](https://orm.drizzle.team/docs/insert) Ä‘á»ƒ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan Ä‘áº§y Ä‘á»§.

</ReadMore>

### Delete

Báº¡n cÅ©ng cÃ³ thá»ƒ truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« má»™t API endpoint. VÃ­ dá»¥ nÃ y xÃ³a má»™t hÃ ng tá»« báº£ng `Comment` báº±ng tham sá»‘ `id`:

```ts
// src/pages/api/comments/[id].ts
import type { APIRoute } from "astro";
import { db, Comment, eq } from 'astro:db';

export const DELETE: APIRoute = async (ctx) => {
  await db.delete(Comment).where(eq(Comment.id, ctx.params.id ));
  return new Response(null, { status: 204 });
}
```

<ReadMore>

Xem [tham chiáº¿u API Drizzle `delete()`](https://orm.drizzle.team/docs/delete) Ä‘á»ƒ cÃ³ cÃ¡i nhÃ¬n tá»•ng quan Ä‘áº§y Ä‘á»§.

</ReadMore>

### Lá»c

Äá»ƒ truy váº¥n káº¿t quáº£ báº£ng theo má»™t thuá»™c tÃ­nh cá»¥ thá»ƒ, sá»­ dá»¥ng [tÃ¹y chá»n Drizzle cho select tá»«ng pháº§n](https://orm.drizzle.team/docs/select#partial-select). VÃ­ dá»¥, thÃªm [má»™t cuá»™c gá»i `.where()`](https://orm.drizzle.team/docs/select#filtering) vÃ o truy váº¥n `select()` cá»§a báº¡n vÃ  truyá»n so sÃ¡nh báº¡n muá»‘n thá»±c hiá»‡n.

VÃ­ dá»¥ sau truy váº¥n táº¥t cáº£ cÃ¡c hÃ ng trong báº£ng `Comment` cÃ³ chá»©a cá»¥m tá»« "Astro DB." Sá»­ dá»¥ng [toÃ¡n tá»­ `like()`](https://orm.drizzle.team/docs/operators#like) Ä‘á»ƒ kiá»ƒm tra xem má»™t cá»¥m tá»« cÃ³ tá»“n táº¡i trong `body`:

```astro title="src/pages/index.astro"
---
import { db, Comment, like } from 'astro:db';

const comments = await db.select().from(Comment).where(
    like(Comment.body, '%Astro DB%')
);
---
```

### Tiá»‡n Ã­ch Drizzle

Táº¥t cáº£ cÃ¡c tiá»‡n Ã­ch Drizzle Ä‘á»ƒ xÃ¢y dá»±ng truy váº¥n Ä‘Æ°á»£c hiá»ƒn thá»‹ tá»« mÃ´-Ä‘un `astro:db`. Äiá»u nÃ y bao gá»“m:

- [ToÃ¡n tá»­ lá»c](https://orm.drizzle.team/docs/operators) nhÆ° `eq()` vÃ  `gt()`
- [Helpers tá»•ng há»£p](https://orm.drizzle.team/docs/select#aggregations-helpers) nhÆ° `count()`
- [Helper `sql`](https://orm.drizzle.team/docs/sql) Ä‘á»ƒ viáº¿t truy váº¥n SQL thÃ´

```ts
import { eq, gt, count, sql } from 'astro:db';
```

### Má»‘i quan há»‡

Báº¡n cÃ³ thá»ƒ truy váº¥n dá»¯ liá»‡u liÃªn quan tá»« nhiá»u báº£ng báº±ng cÃ¡ch sá»­ dá»¥ng SQL join. Äá»ƒ táº¡o truy váº¥n join, má»Ÿ rá»™ng cÃ¢u lá»‡nh `db.select()` cá»§a báº¡n vá»›i toÃ¡n tá»­ join. Má»—i hÃ m cháº¥p nháº­n má»™t báº£ng Ä‘á»ƒ join vÃ  má»™t Ä‘iá»u kiá»‡n Ä‘á»ƒ khá»›p cÃ¡c hÃ ng giá»¯a hai báº£ng.

VÃ­ dá»¥ nÃ y sá»­ dá»¥ng hÃ m `innerJoin()` Ä‘á»ƒ join cÃ¡c tÃ¡c giáº£ `Comment` vá»›i thÃ´ng tin `Author` liÃªn quan dá»±a trÃªn cá»™t `authorId`. Äiá»u nÃ y tráº£ vá» má»™t máº£ng cÃ¡c Ä‘á»‘i tÆ°á»£ng vá»›i má»—i hÃ ng `Author` vÃ  `Comment` lÃ m thuá»™c tÃ­nh cáº¥p cao nháº¥t:

```astro title="src/pages/index.astro"
---
import { db, eq, Comment, Author } from 'astro:db';

const comments = await db.select()
  .from(Comment)
  .innerJoin(Author, eq(Comment.authorId, Author.id));
---

<h2>Comments</h2>

{
  comments.map(({ Author, Comment }) => (
    <article>
      <p>Author: {Author.name}</p>
      <p>{Comment.body}</p>
    </article>
  ))
}
```

<ReadMore>

Xem [tham chiáº¿u join Drizzle](https://orm.drizzle.team/docs/joins#join-types) cho táº¥t cáº£ cÃ¡c toÃ¡n tá»­ join cÃ³ sáºµn vÃ  tÃ¹y chá»n cáº¥u hÃ¬nh.

</ReadMore>

### Giao dá»‹ch hÃ ng loáº¡t

Táº¥t cáº£ cÃ¡c truy váº¥n cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa Ä‘Æ°á»£c thá»±c hiá»‡n dÆ°á»›i dáº¡ng yÃªu cáº§u máº¡ng. Báº¡n cÃ³ thá»ƒ cáº§n "gá»™p" cÃ¡c truy váº¥n láº¡i vá»›i nhau thÃ nh má»™t giao dá»‹ch duy nháº¥t khi thá»±c hiá»‡n má»™t sá»‘ lÆ°á»£ng lá»›n truy váº¥n, hoáº·c Ä‘á»ƒ cÃ³ rollback tá»± Ä‘á»™ng náº¿u báº¥t ká»³ truy váº¥n nÃ o tháº¥t báº¡i.

VÃ­ dá»¥ nÃ y seeds nhiá»u hÃ ng trong má»™t yÃªu cáº§u duy nháº¥t báº±ng phÆ°Æ¡ng thá»©c `db.batch()`:

```ts
// db/seed.ts
import { db, Author, Comment } from 'astro:db';

export default async function () {
  const queries = [];
  // Seed 100 comments máº«u vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa cá»§a báº¡n
  // vá»›i má»™t yÃªu cáº§u máº¡ng duy nháº¥t.
  for (let i = 0; i < 100; i++) {
    queries.push(db.insert(Comment).values({ body: `Test comment ${i}` }));
  }
  await db.batch(queries);
}
```

<ReadMore>

Xem tÃ i liá»‡u [Drizzle `db.batch()`](https://orm.drizzle.team/docs/batch-api) Ä‘á»ƒ biáº¿t thÃªm chi tiáº¿t.

</ReadMore>

## Äáº©y thay Ä‘á»•i lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n

Báº¡n cÃ³ thá»ƒ Ä‘áº©y cÃ¡c thay Ä‘á»•i Ä‘Æ°á»£c thá»±c hiá»‡n trong quÃ¡ trÃ¬nh phÃ¡t triá»ƒn lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n.

### Äáº©y lÆ°á»£c Ä‘á»“ báº£ng

LÆ°á»£c Ä‘á»“ báº£ng cá»§a báº¡n cÃ³ thá»ƒ thay Ä‘á»•i theo thá»i gian khi dá»± Ã¡n cá»§a báº¡n phÃ¡t triá»ƒn. Báº¡n cÃ³ thá»ƒ kiá»ƒm tra an toÃ n cÃ¡c thay Ä‘á»•i cáº¥u hÃ¬nh cá»¥c bá»™ vÃ  Ä‘áº©y lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa khi báº¡n triá»ƒn khai.

Báº¡n cÃ³ thá»ƒ Ä‘áº©y cÃ¡c thay Ä‘á»•i lÆ°á»£c Ä‘á»“ cá»¥c bá»™ lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa qua CLI báº±ng lá»‡nh `astro db push --remote`:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote
  ```
  </Fragment>
</PackageManagerTabs>

Lá»‡nh nÃ y sáº½ xÃ¡c minh ráº±ng cÃ¡c thay Ä‘á»•i cá»¥c bá»™ cá»§a báº¡n cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n mÃ  khÃ´ng máº¥t dá»¯ liá»‡u vÃ , náº¿u cáº§n thiáº¿t, Ä‘á» xuáº¥t cÃ¡ch thá»±c hiá»‡n an toÃ n cÃ¡c thay Ä‘á»•i lÆ°á»£c Ä‘á»“ cá»§a báº¡n Ä‘á»ƒ giáº£i quyáº¿t xung Ä‘á»™t.

#### Äáº©y thay Ä‘á»•i lÆ°á»£c Ä‘á»“ phÃ¡ vá»¡

:::caution
__Äiá»u nÃ y sáº½ phÃ¡ há»§y cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n__. Chá»‰ thá»±c hiá»‡n lá»‡nh nÃ y náº¿u báº¡n khÃ´ng cáº§n dá»¯ liá»‡u sáº£n xuáº¥t.
:::

Náº¿u báº¡n pháº£i thay Ä‘á»•i lÆ°á»£c Ä‘á»“ báº£ng theo cÃ¡ch khÃ´ng tÆ°Æ¡ng thÃ­ch vá»›i dá»¯ liá»‡u hiá»‡n cÃ³ Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa cá»§a báº¡n, báº¡n sáº½ cáº§n reset cÆ¡ sá»Ÿ dá»¯ liá»‡u sáº£n xuáº¥t.

Äá»ƒ Ä‘áº©y cáº­p nháº­t lÆ°á»£c Ä‘á»“ báº£ng bao gá»“m thay Ä‘á»•i phÃ¡ vá»¡, thÃªm flag `--force-reset` Ä‘á»ƒ reset táº¥t cáº£ dá»¯ liá»‡u sáº£n xuáº¥t:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote --force-reset
  ```
  </Fragment>
</PackageManagerTabs>

### Äá»•i tÃªn báº£ng

CÃ³ thá»ƒ Ä‘á»•i tÃªn báº£ng sau khi Ä‘áº©y lÆ°á»£c Ä‘á»“ cá»§a báº¡n lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa.

Náº¿u báº¡n **khÃ´ng cÃ³ dá»¯ liá»‡u sáº£n xuáº¥t quan trá»ng nÃ o**, thÃ¬ báº¡n cÃ³ thá»ƒ [reset cÆ¡ sá»Ÿ dá»¯ liá»‡u](#pushing-breaking-schema-changes) báº±ng flag `--force-reset`. Flag nÃ y sáº½ drop táº¥t cáº£ cÃ¡c báº£ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  táº¡o báº£ng má»›i Ä‘á»ƒ nÃ³ khá»›p chÃ­nh xÃ¡c vá»›i lÆ°á»£c Ä‘á»“ hiá»‡n táº¡i cá»§a báº¡n.

Äá»ƒ Ä‘á»•i tÃªn báº£ng trong khi báº£o tá»“n dá»¯ liá»‡u sáº£n xuáº¥t cá»§a báº¡n, báº¡n pháº£i thá»±c hiá»‡n má»™t loáº¡t cÃ¡c thay Ä‘á»•i khÃ´ng phÃ¡ vá»¡ Ä‘á»ƒ Ä‘áº©y lÆ°á»£c Ä‘á»“ cá»¥c bá»™ lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa má»™t cÃ¡ch an toÃ n.

VÃ­ dá»¥ sau Ä‘á»•i tÃªn báº£ng tá»« `Comment` thÃ nh `Feedback`:

<Steps>

1. Trong tá»‡p cáº¥u hÃ¬nh cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n, thÃªm thuá»™c tÃ­nh `deprecated: true` vÃ o báº£ng báº¡n muá»‘n Ä‘á»•i tÃªn:

    ```ts title="db/config.ts" ins={2}
    const Comment = defineTable({
      deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
    ```

2. ThÃªm lÆ°á»£c Ä‘á»“ báº£ng má»›i (khá»›p chÃ­nh xÃ¡c vá»›i thuá»™c tÃ­nh cá»§a báº£ng hiá»‡n cÃ³) vá»›i tÃªn má»›i:

	  ```ts title="db/config.ts" ins={8-14}
    const Comment = defineTable({
        deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
	  const Feedback = defineTable({
        columns: {
          author: column.text(),
          body: column.text(),
        }
    });
    ```

3. [Äáº©y lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa](#pushing-table-schemas) vá»›i `astro db push --remote`. Äiá»u nÃ y sáº½ thÃªm báº£ng má»›i vÃ  Ä‘Ã¡nh dáº¥u báº£ng cÅ© lÃ  deprecated.
4. Cáº­p nháº­t báº¥t ká»³ mÃ£ dá»± Ã¡n cá»¥c bá»™ nÃ o Ä‘á»ƒ sá»­ dá»¥ng báº£ng má»›i thay vÃ¬ báº£ng cÅ©. Báº¡n cÃ³ thá»ƒ cáº§n di chuyá»ƒn dá»¯ liá»‡u sang báº£ng má»›i.
5. Khi báº¡n tin ráº±ng báº£ng cÅ© khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng trong dá»± Ã¡n cá»§a báº¡n, báº¡n cÃ³ thá»ƒ xÃ³a lÆ°á»£c Ä‘á»“ khá»i `config.ts`:
		```ts title="db/config.ts" del={1-7}
    const Comment = defineTable({
          deprecated: true,
    	  columns: {
    		  author: column.text(),
    		  body: column.text(),
  		  }
    });

	  const Feedback = defineTable({
          columns: {
            author: column.text(),
            body: column.text(),
          }
    });
    ```
6. Äáº©y lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa láº§n ná»¯a vá»›i `astro db push --remote`. Báº£ng cÅ© sáº½ bá»‹ drop, chá»‰ cÃ²n láº¡i báº£ng má»›i Ä‘Æ°á»£c Ä‘á»•i tÃªn.
</Steps>

### Äáº©y dá»¯ liá»‡u báº£ng 

Báº¡n cÃ³ thá»ƒ cáº§n Ä‘áº©y dá»¯ liá»‡u lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa Ä‘á»ƒ seeding hoáº·c di chuyá»ƒn dá»¯ liá»‡u. Báº¡n cÃ³ thá»ƒ táº¡o má»™t tá»‡p `.ts` vá»›i mÃ´-Ä‘un `astro:db` Ä‘á»ƒ viáº¿t cÃ¡c truy váº¥n an toÃ n kiá»ƒu. Sau Ä‘Ã³, thá»±c thi tá»‡p Ä‘á»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« xa báº±ng lá»‡nh `astro db execute <file-path> --remote`:

CÃ¡c Comments sau cÃ³ thá»ƒ Ä‘Æ°á»£c seed báº±ng lá»‡nh `astro db execute db/seed.ts --remote`:

```ts
// db/seed.ts
import { Comment } from 'astro:db';

export default async function () {
  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!' },
  ])
}
```

<ReadMore>

Xem [tham chiáº¿u CLI](/vi/guides/integrations-guide/db/#astro-db-cli-reference) Ä‘á»ƒ cÃ³ danh sÃ¡ch Ä‘áº§y Ä‘á»§ cÃ¡c lá»‡nh.

</ReadMore>

## XÃ¢y dá»±ng tÃ­ch há»£p Astro DB

[TÃ­ch há»£p Astro](/vi/reference/integrations-reference/) cÃ³ thá»ƒ má»Ÿ rá»™ng cÃ¡c dá»± Ã¡n ngÆ°á»i dÃ¹ng vá»›i cÃ¡c báº£ng Astro DB vÃ  dá»¯ liá»‡u seed bá»• sung.

Sá»­ dá»¥ng phÆ°Æ¡ng thá»©c `extendDb()` trong hook `astro:db:setup` Ä‘á»ƒ Ä‘Äƒng kÃ½ cÃ¡c tá»‡p cáº¥u hÃ¬nh vÃ  seed Astro DB bá»• sung.
Helper `defineDbIntegration()` cung cáº¥p há»— trá»£ TypeScript vÃ  tá»± Ä‘á»™ng hoÃ n thÃ nh cho hook `astro:db:setup`.

```js {8-13}
// my-integration/index.ts
import { defineDbIntegration } from '@astrojs/db/utils';

export default function MyIntegration() {
  return defineDbIntegration({
    name: 'my-astro-db-powered-integration',
    hooks: {
      'astro:db:setup': ({ extendDb }) => {
        extendDb({
          configEntrypoint: '@astronaut/my-package/config',
          seedEntrypoint: '@astronaut/my-package/seed',
        });
      },
      // CÃ¡c hook tÃ­ch há»£p khÃ¡c...
    },
  });
}
```

CÃ¡c tá»‡p [config](#define-your-database) vÃ  [seed](#seed-your-database-for-development) tÃ­ch há»£p tuÃ¢n theo cÃ¹ng Ä‘á»‹nh dáº¡ng vá»›i cÃ¡c tÆ°Æ¡ng Ä‘Æ°Æ¡ng do ngÆ°á»i dÃ¹ng Ä‘á»‹nh nghÄ©a.

### Thao tÃ¡c an toÃ n kiá»ƒu trong tÃ­ch há»£p

Trong khi lÃ m viá»‡c trÃªn tÃ­ch há»£p, báº¡n cÃ³ thá»ƒ khÃ´ng cÃ³ lá»£i tá»« cÃ¡c kiá»ƒu báº£ng Ä‘Æ°á»£c táº¡o bá»Ÿi Astro Ä‘Æ°á»£c export tá»« `astro:db`.
Äá»ƒ cÃ³ an toÃ n kiá»ƒu Ä‘áº§y Ä‘á»§, sá»­ dá»¥ng tiá»‡n Ã­ch `asDrizzleTable()` Ä‘á»ƒ táº¡o Ä‘á»‘i tÆ°á»£ng tham chiáº¿u báº£ng báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cho cÃ¡c thao tÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u.

VÃ­ dá»¥, cho má»™t tÃ­ch há»£p thiáº¿t láº­p báº£ng cÆ¡ sá»Ÿ dá»¯ liá»‡u `Pets` sau:

```js
// my-integration/config.ts
import { defineDb, defineTable, column } from 'astro:db';

export const Pets = defineTable({
  columns: {
    name: column.text(),
    species: column.text(),
  },
});

export default defineDb({ tables: { Pets } });
```

Tá»‡p seed cÃ³ thá»ƒ import `Pets` vÃ  sá»­ dá»¥ng `asDrizzleTable()` Ä‘á»ƒ chÃ¨n hÃ ng vÃ o báº£ng cá»§a báº¡n vá»›i kiá»ƒm tra kiá»ƒu:

```js {2,7} /typeSafePets(?! )/
// my-integration/seed.ts
import { asDrizzleTable } from '@astrojs/db/utils';
import { db } from 'astro:db';
import { Pets } from './config';

export default async function() {
  const typeSafePets = asDrizzleTable('Pets', Pets);

  await db.insert(typeSafePets).values([
    { name: 'Palomita', species: 'cat' },
    { name: 'Pan', species: 'dog' },
  ]);
}
```

GiÃ¡ trá»‹ Ä‘Æ°á»£c tráº£ vá» bá»Ÿi `asDrizzleTable('Pets', Pets)` tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i `import { Pets } from 'astro:db'`, nhÆ°ng cÃ³ sáºµn ngay cáº£ khi táº¡o kiá»ƒu cá»§a Astro khÃ´ng thá»ƒ cháº¡y.
Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng nÃ³ trong báº¥t ká»³ mÃ£ tÃ­ch há»£p nÃ o cáº§n truy váº¥n hoáº·c chÃ¨n vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u.

## Di chuyá»ƒn tá»« Astro Studio sang Turso

<Steps>

1. Trong [Studio dashboard](https://studio.astro.build/), Ä‘iá»u hÆ°á»›ng Ä‘áº¿n dá»± Ã¡n báº¡n muá»‘n di chuyá»ƒn. Trong tab settings, sá»­ dá»¥ng nÃºt "Export Database" Ä‘á»ƒ táº£i xuá»‘ng má»™t báº£n dump cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n.
2. LÃ m theo hÆ°á»›ng dáº«n chÃ­nh thá»©c Ä‘á»ƒ [cÃ i Ä‘áº·t Turso CLI](https://docs.turso.tech/cli/installation) vÃ  [Ä‘Äƒng kÃ½ hoáº·c Ä‘Äƒng nháº­p](https://docs.turso.tech/cli/authentication) vÃ o tÃ i khoáº£n Turso cá»§a báº¡n.
3. Táº¡o má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i trÃªn Turso báº±ng lá»‡nh `turso db create`.
   ```sh
   turso db create [database-name]
   ```
4. Láº¥y URL cÆ¡ sá»Ÿ dá»¯ liá»‡u báº±ng Turso CLI, vÃ  sá»­ dá»¥ng nÃ³ lÃ m biáº¿n mÃ´i trÆ°á»ng `ASTRO_DB_REMOTE_URL`.
   ```sh
   turso db show [database-name]
   ```
   ```dotenv
   ASTRO_DB_REMOTE_URL=[your-database-url]
   ```
5. Táº¡o má»™t token Ä‘á»ƒ truy cáº­p cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a báº¡n, vÃ  sá»­ dá»¥ng nÃ³ lÃ m biáº¿n mÃ´i trÆ°á»ng `ASTRO_DB_APP_TOKEN`.
   ```sh
   turso db tokens create [database-name]
   ```
   ```dotenv
   ASTRO_DB_APP_TOKEN=[your-app-token]
   ```
6. Äáº©y lÆ°á»£c Ä‘á»“ DB vÃ  metadata cá»§a báº¡n lÃªn cÆ¡ sá»Ÿ dá»¯ liá»‡u Turso má»›i.
   ```sh
   astro db push --remote
   ```
7. Import báº£n dump cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»« bÆ°á»›c 1 vÃ o Turso DB má»›i cá»§a báº¡n.
   ```sh
   turso db shell [database-name] < ./path/to/dump.sql
   ```
8. Khi báº¡n Ä‘Ã£ xÃ¡c nháº­n dá»± Ã¡n cá»§a báº¡n káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u má»›i, báº¡n cÃ³ thá»ƒ xÃ³a an toÃ n dá»± Ã¡n khá»i Astro Studio.

</Steps>