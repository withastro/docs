---
title: Deploy your Astro site to Codeberg Pages
description: How to deploy your Astro site to the web using Codeberg Pages.
sidebar:
  label: Codeberg Pages
type: deploy
logo: codeberg
supports: ['static']
i18nReady: true
---

import { Steps } from '@astrojs/starlight/components';

You can host your Astro site directly from a repository on Codeberg using [Codeberg Pages](https://codeberg.page/).

## How to deploy

You can use Codeberg CI to automatically build and deploy the site to Codeberg Pages. For this, your source code must be hosted on Codeberg and you need to complete the following steps:

<Steps>
  <ol>
    <li>
      Open an issue <a href="https://codeberg.org/Codeberg-e.V./requests/issues">here</a>. Select the <code>ci</code> label, choose <code>medium</code> for <code>Expected Resource Usage</code>, put <code>@your Codeberg username</code> in <code>I would also like the following users to be added</code>, fill the rest as needed, and wait for approval.
    </li>

    <li>
      In the repository root create a <code>.forgejo</code> folder and inside it create a <code>workflows</code> folder (i.e. <code>.forgejo/workflows/</code>).
    </li>

    <li>
      Add a workflow file named <code>astro.yaml</code> in <code>.forgejo/workflows</code>. Example content:
      ```yaml
      name: Deploy Astro site to Pages

      on:
        push:
          branches:
            - main    # Trigger only on pushes to the main branch
        workflow_dispatch:  # Allow manual triggering

      jobs:
        build:
          runs-on: codeberg-tiny-lazy
          container:
            image: node:20  # Use Node.js 20 as the base image
          steps:
            - name: Check public/.domains file
              run: |
                git ls-files public/.domains || echo ".domains not tracked"
                ls -la public/ || true
                ls -la public/.domains || echo ".domains not found"

            - name: Checkout code
              uses: https://code.forgejo.org/actions/checkout@v4
              with:
                submodules: recursive
                fetch-depth: 0

            - name: Install dependencies
              run: npm install

            - name: Build Astro static files
              run: npm run build  # Use Astro's build command

            - name: Upload build artifacts
              uses: https://code.forgejo.org/actions/upload-artifact@v3
              with:
                name: Generated files
                path: dist/  # Astro's default output directory
                include-hidden-files: true

        deploy:
          needs: [build]
          runs-on: codeberg-tiny-lazy
          steps:
            - name: Checkout code
              uses: https://code.forgejo.org/actions/checkout@v4
              with:
                submodules: recursive
                fetch-depth: 0

            - name: Switch to pages branch and clean
              run: |
                # Create an orphan branch if pages doesn't exist
                git checkout pages || git switch --orphan pages
                # Remove all files except .git and LICENSE (adjust if you want to keep other files)
                rm -Rfv $(ls -A | egrep -v '^(\.git|LICENSE)$' || true)

            - name: Download build artifacts
              uses: https://code.forgejo.org/actions/download-artifact@v3
              with:
                name: Generated files

            - name: Publish site
              run: |
                git config user.email "codeberg-ci@example.com"
                git config user.name "Codeberg CI"
                echo "=== Files being committed ==="
                ls -la
                git add .
                # Use the local short sha as the commit message to avoid relying on CI-specific env vars
                SHA=$(git rev-parse --short HEAD || echo "ci-build")
                git commit --allow-empty -m "Codeberg build for ${SHA}"
                git push origin pages
      ```
    </li>

    <li>
      In your project's <code>public</code> directory create a <code>.domains</code> file containing your default domain, for example:
      <pre><code>branch.repositoryname.username.codeberg.page</code></pre>
      (Example format: <code>branch.repo.username.codeberg.page</code>).
      For adding custom domains, refer to the Codeberg Pages documentation: [Click it](https://codeberg.org/Codeberg/pages-server/src/branch/main/README.md).
    </li>

    <li>
      Commit and push your changes to Codeberg. After building and uploading artifacts, the Codeberg CI will push the generated static files to the <code>pages</code> branch, and Codeberg Pages will publish your site.
    </li>
  </ol>
</Steps>

Your site should now be published! When you push changes to your Astro project's repository, the Codeberg CI pipeline will automatically deploy them.
