---
title: Astro Adapter API
sidebar:
  label: Adapter API
i18nReady: true
---
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { FileTree } from '@astrojs/starlight/components';

Astro is designed to make it easy to deploy to any cloud provider for on-demand rendering, also known as server-side rendering (SSR). This ability is provided by __adapters__, which are [integrations](/en/reference/integrations-reference/). See the [on-demand rendering guide](/en/guides/on-demand-rendering/) to learn how to use an existing adapter.

## What is an adapter?

An adapter is a special kind of [integration](/en/reference/integrations-reference/) that provides an entrypoint for server rendering at request time. An adapter has access to the full Integration API and does two things:

- Implements host-specific APIs for handling requests.
- Configures the build according to host conventions.

## Building an adapter

Create an integration and call the `setAdapter()` function in the [`astro:config:done`](/en/reference/integrations-reference/#astroconfigdone) hook. This allows you to define a server entrypoint and the features supported by your adapter.

The following example creates an adapter with a server entrypoint and stable support for Astro static output:

```js title="my-adapter.mjs" {5-14} "setAdapter"
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            staticOutput: 'stable'
          }
        });
      },
    },
  };
}
```

The `setAdapter()` function accepts an object containing the following properties:

### `name`

<p>

**Type:** `string`
</p>

Defines a unique name for your adapter. This will be used for logging.

### `entrypointResolution`

<p>

**Type:** `"explicit" | "auto"`<br />
**Default**: `"explicit"`<br />
<Since v="6.0.0" />
</p>

:::caution[Deprecated]
`entrypointResolution: "explicit"` is deprecated. `entrypointResolution: "auto"` will become the default, and only, behavior in a future major version.

See [how to migrate](/en/guides/upgrade-to/v6/#deprecated-createexports-and-start-adapter-api).
:::

Specifies the method Astro will use to resolve the server entrypoint: `"auto"` (recommended) or `"explicit"` (default, but deprecated):

- **`"auto"` (recommended):** You are responsible for providing a valid module as an entrypoint using either [`serverEntrypoint`](/en/reference/adapter-reference/#serverentrypoint) or, if you need further customization at the Vite level using [`vite.build.rollupOptions.input`](https://rollupjs.org/configuration-options/#input).
- **`"explicit"` (deprecated)**: You must provide the exports required by the host in the server entrypoint using a `createExports()` function before passing them to `setAdapter()` as an [`exports`](#exports) list. This supports adapters built using the Astro 5 version of the Adapter API. By default, all adapters will receive this value to allow backwards compatibility. **However, no new adapters should be created with this value.** Existing adapters should override this default value with `"auto"` as soon as they are able to migrate to the new v6 API.

The following example defines the `entrypointResolution` and `serverEntrypoint` to tell Astro that a custom entrypoint is provided:

```js title="my-adapter.mjs" {8-9}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/custom-entrypoint.js',
        });
      },
    },
  };
}
```

The following example defines the `entrypointResolution` and Rollup options to tell Astro that a custom entrypoint is provided:

```js title="my-adapter.mjs" {9-11,19}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:setup': ({ updateConfig }) => {
        updateConfig({
          vite: {
            build: {
              rollupOptions: {
                input: '@example/my-adapter/custom-entrypoint.js'
              }
            }
          }
        })
      },
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
        });
      },
    },
  };
}
```

<ReadMore>Learn more about how to [build a server entrypoint](#building-a-server-entrypoint).</ReadMore>

### `serverEntrypoint`

<p>

**Type:** `string | URL`
</p>

Defines the entrypoint for on-demand rendering.

### `supportedAstroFeatures`

<p>

**Type:** `AstroAdapterFeatureMap`<br />
<Since v="3.0.0" />
</p>

A map of Astro's built-in features supported by the adapter. This allows Astro to determine which features an adapter supports, so appropriate error messages can be provided.

<ReadMore>Discover the [available Astro features](#astro-features) that an adapter can configure.</ReadMore>

### `adapterFeatures`

<p>

**Type:** `AstroAdapterFeatures`<br />
<Since v="3.0.0" />
</p>

An object that specifies which [adapter features that change the build output](#adapter-features) are supported by the adapter.

### `client`

<p>

**Type:** `{ internalFetchHeaders?: Record<string, string> | () => Record<string, string>; assetQueryParams?: URLSearchParams; }`<br />
<Since v="5.15.0" />
</p>

A configuration object for Astro's client-side code.

#### `internalFetchHeaders`

<p>

**Type:** `Record<string, string> | () => Record<string, string>`
</p>

Defines the headers to inject into Astro's internal fetch calls (e.g. Actions, View Transitions, Server Islands, Prefetch). This can be an object of headers or a function that returns headers.

The following example retrieves a `DEPLOY_ID` from the environment variables and, if provided, returns an object with the header name as key and the deploy id as value:

```js title="my-adapter.mjs" {10-15}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          client: {
            internalFetchHeaders: () => {
              const deployId = process.env.DEPLOY_ID;
              return deployId ? { 'Your-Header-ID': deployId } : {};
            },
          },
        });
      },
    },
  };
}
```

#### `assetQueryParams`

<p>

**Type:** `URLSearchParams`
</p>

Defines the query parameters to append to all asset URLs (e.g. images, stylesheets, scripts). This is useful for adapters that need to track deployment versions or other metadata.

The following example retrieves a `DEPLOY_ID` from the environment variables and, if provided, returns an object with a custom search parameter name as key and the deploy id as value:

```js title="my-adapter.mjs" {10-14}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          client: {
            assetQueryParams: process.env.DEPLOY_ID
              ? new URLSearchParams({ yourParam: process.env.DEPLOY_ID })
              : undefined,
          },
        });
      },
    },
  };
}
```

### `previewEntrypoint`

<p>

**Type:** `string | URL`<br />
<Since v="1.5.0" />
</p>

Defines the path or ID of a module in the adapter's package that is responsible for starting up the built server when `astro preview` is run.

```js title="my-adapter.mjs" {10}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          previewEntrypoint: '@example/my-adapter/preview.js',
        });
      },
    },
  };
}
```

### `args`

<p>

**Type:** `any`
</p>

:::caution[Deprecated]
This property is deprecated and will be removed in a future major version. Learn how to [update your adapter with  `entrypointResolution: "auto"`](/en/guides/upgrade-to/v6/#deprecated-createexports-and-start-adapter-api).
:::

A JSON-serializable value that will be passed to the adapter's server entrypoint at runtime. This is useful to pass an object containing build-time configuration (e.g. paths, secrets) to your server runtime code.

The following example defines an `args` object with a property that identifies where assets generated by Astro are located:

```js title="my-adapter.mjs" {8-11}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'explicit',
          args: {
            assets: config.build.assets
          },
          serverEntrypoint: '@example/my-adapter/server.js'
        });
      },
    },
  };
}
```

### `exports`

<p>

**Type:** `string[]`
</p>

:::caution[Deprecated]
This property is deprecated and will be removed in a future major version. Learn how to [update your adapter with  `entrypointResolution: "auto"`](/en/guides/upgrade-to/v6/#deprecated-createexports-and-start-adapter-api).
:::

Defines an array of named exports to use in conjunction with the `createExports()` function of your server entrypoint.

The following example assumes that `createExports()` provides an export named `handler`:

```js title="my-adapter.mjs" {8-9}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'explicit',
          exports: ['handler'],
          serverEntrypoint: '@example/my-adapter/server.js'
        });
      },
    },
  };
}
```

## Custom prerenderer

<p><Since v="6.0.0" /></p>

Adapters can provide a custom prerenderer to control how pages are prerendered by using the [`setPrerenderer()`](/en/reference/integrations-reference/#setprerenderer-option) function in the `astro:build:start` hook.

The following example shows how an adapter can set a custom prerenderer:

```js title="my-adapter.mjs"
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:build:start': ({ setPrerenderer }) => {
        setPrerenderer((defaultPrerenderer) => ({
          name: 'my-prerenderer',
          async setup() {
            // Start a preview server
          },
          async getStaticPaths() {
            // Returns array of { pathname: string, route: RouteData }
            return defaultPrerenderer.getStaticPaths();
          },
          async render(request, { routeData }) {
            // request: Request, options: { routeData: RouteData }
            // Custom rendering logic, e.g. make HTTP requests to a preview server
            const response = await fetch(`http://localhost:4321${new URL(request.url).pathname}`);
            return response;
          },
          async teardown() {
            // Stop the preview server
          }
        }));
      },
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
        });
      },
    },
  };
}
```

The factory function receives the default prerenderer, allowing you to wrap or extend its behavior. This is useful when you only need to customize specific aspects of prerendering.

## Building a server entrypoint

You will need to create a file that executes during server-side requests to enable on-demand rendering with your particular host. Astro's adapter API attempts to work with any type of host and gives a flexible way to conform to the host APIs.

You can import and use [`createApp()`](/en/reference/modules/astro-app/#createapp) to access methods that allow you to work with standard [`Request`](https://developer.mozilla.org/en-US/docs/Web/API/Request) and [`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response) objects.

This file should conform to what the host expects. For example, some serverless hosts expect you to export an `handler()` function:

```js title="my-adapter/server.js"
import { createApp } from 'astro/app/entrypoint';

const app = createApp();

export async function handler(event, context) {
  // ...
}
```

<ReadMore>Learn more about the methods and utilities available in the [Adapter Server Entrypoint API Reference](/en/reference/modules/astro-app/).</ReadMore>

### Passing build-time configuration

If you need to access build-time configuration in your server entrypoint, you can pass via a virtual module. For example, your server might need to identify where assets generated by Astro are located.

First, create and register a Vite plugin to serialize the data:

```js title="my-adapter.mjs"
const VIRTUAL_MODULE_ID = 'virtual:@example/my-adapter:config';
const RESOLVED_VIRTUAL_MODULE_ID = '\0' + VIRTUAL_MODULE_ID;

function createConfigPlugin(config) {
  return {
    name: VIRTUAL_MODULE_ID,
		resolveId: {
			filter: {
				id: new RegExp(`^${VIRTUAL_MODULE_ID}$`),
			},
			handler() {
				return RESOLVED_VIRTUAL_MODULE_ID;
			},
		},
		load: {
			filter: {
				id: new RegExp(`^${RESOLVED_VIRTUAL_MODULE_ID}$`),
			},
			handler() {
				return `
          export const assets = ${JSON.stringify(config.build.assets)};
        `;
			},
		},
	};
}

export default function createIntegration() {
  let _config;
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:setup': ({ config, updateConfig }) => {
        _config = config;

        updateConfig({
          vite: {
            plugins: [createConfigPlugin(_config)]
          }
        })
      },
      'astro:config:done': ({ config, setAdapter }) => {
        _config = config;
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
        });
      },
    },
  };
}
```

You can create internal types if needed:

```ts title="virtual.d.ts"
declare module 'virtual:@example/my-adapter:config' {
  export const assets: string;
}
```

You can then import the virtual module:

```js title="my-adapter/server.js" ins={2}
import { createApp } from 'astro/app/entrypoint';
import { assets } from 'virtual:@example/my-adapter:config';

const app = createApp();

export async function handler(event, context) {
  // ...
}
```

## Astro features

Astro features are a way for an adapter to tell Astro whether they are able to support a feature, and also the adapterâ€™s level of support.

When using these properties, Astro will:
- run specific validation; 
- emit contextual information to the logs;

These operations are run based on the features supported or not supported, their level of support, the [desired amount of logging](#suppress), and the user's own configuration.

The following configuration tells Astro that this adapter has experimental support for the Sharp-powered built-in image service:

```js title="my-adapter.mjs" ins={10-12}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: 'experimental'
          } 
        });
      },
    },
  };
}
```

If the Sharp image service is used, Astro will log a warning and error to the terminal based on your adapter's support:

```
[@example/my-adapter] The feature is experimental and subject to issues or changes.

[@example/my-adapter] The currently selected adapter `@example/my-adapter` is not compatible with the service "Sharp". Your project will NOT be able to build.
```

A message can additionally be provided to give more context to the user:

```js title="my-adapter.mjs" ins={10-15}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'This adapter has limited support for Sharp. Certain features may not work as expected.'
            }
          } 
        });
      },
    },
  };
}
```

This object contains the following configurable features:

### `staticOutput`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)
</p>

Defines whether the adapter is able to serve static pages.

### `hybridOutput`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)
</p>

Defines whether the adapter is able to serve sites that include a mix of static and on-demand rendered pages.

### `serverOutput`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)
</p>

Defines whether the adapter is able to serve on-demand rendered pages.

### `i18nDomains`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)<br />
<Since v="4.3.0" />
</p>

Defines whether the adapter is able to support i18n domains.

### `envGetSecret`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)<br />
<Since v="4.10.0" />
</p>

Defines whether the adapter is able to support `getSecret()` exported from [`astro:env/server`](/en/reference/modules/astro-env/). When enabled, this feature allows your adapter to retrieve secrets configured by users in `env.schema`.

The following example enables the feature by passing [a valid `AdapterSupportsKind` value](#adaptersupportskind) to the adapter:

```js title="my-adapter.mjs" ins={10-12}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            envGetSecret: 'stable'
          } 
        });
      },
    },
  };
}
```

The `astro/env/setup` module allows you to provide an implementation for `getSecret()`. In [your server entrypoint](#building-a-server-entrypoint), call `setGetEnv()` as soon as possible:

```js ins={2,4}
import { createApp } from 'astro/app/entrypoint';
import { setGetEnv } from "astro/env/setup"

setGetEnv((key) => process.env[key])

const app = createApp();

export async function handler(event, context) {
  // ...
}
```

If the adapter supports secrets, be sure to call `setGetEnv()` before `getSecret()` when environment variables are tied to the request:

```js ins={2,8}
import { createApp } from 'astro/app/entrypoint';
import { setGetEnv } from 'astro/env/setup';

const app = createApp();

export default {
  async fetch(request: Request, env: Record<string, unknown>) {
    setGetEnv((key) => env[key]);

    return await app.render(request);
  }
}
```

### `sharpImageService`

<p>

**Type:** [`AdapterSupport`](#adaptersupport)<br />
<Since v="5.0.0" />
</p>

Defines whether the adapter supports image transformation using the built-in Sharp image service.

## Adapter features

A set of features that changes the output of the emitted files. When an adapter opts in to these features, they will get additional information inside specific hooks and must implement the proper logic to handle the different output.

### `edgeMiddleware`

<p>

**Type:** `boolean`
</p>

Defines whether any on-demand rendering middleware code will be bundled when built.

When enabled, this prevents middleware code from being bundled and imported by all pages during the build:

```js title="my-adapter.mjs" ins={10-12}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            edgeMiddleware: true
          } 
        });
      },
    },
  };
}
```

Then, consume the hook [`astro:build:ssr`](/en/reference/integrations-reference/#astrobuildssr), which will give you a `middlewareEntryPoint`, an `URL` to the physical file on the file system.

```js title="my-adapter.mjs" ins={16-21}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            edgeMiddleware: true
          } 
        });
      },

      'astro:build:ssr': ({ middlewareEntryPoint }) => {
        // remember to check if this property exits, it will be `undefined` if the adapter doesn't opt in to the feature
        if (middlewareEntryPoint) {
          createEdgeMiddleware(middlewareEntryPoint)
        }
      }  
    },
  };
}

function createEdgeMiddleware(middlewareEntryPoint) {
  // emit a new physical file using your bundler
}
```

### `buildOutput`

<p>

**Type:** `"static" | "server"`<br />
**Default:** `"server"`<br />
<Since v="5.0.0" />
</p>

Allows you to force a specific output shape for the build. This can be useful for adapters that only work with a specific output type. For example, your adapter might expect a static website so it can create host-specific files. Defaults to `server` if not specified.

```js title="my-adapter.mjs" ins={10-12}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            buildOutput: 'static'
          } 
        });
      },
    },
  };
}
```

### `staticHeaders`

<p>

**Type:** `boolean`<br />
<Since v="6.0.0" />
</p>

Whether or not the adapter provides support for setting response headers for static pages. When this feature is enabled, Astro will return a map of the `Headers` emitted by the static pages. This map is available as `routeToHeaders` in the [`astro:build:generated` hook](/en/reference/integrations-reference/#astrobuildgenerated) and can be used to generate platform-specific output that controls HTTP headers, for example, to create a `_headers` file for platforms that support it.

```js title="my-adapter.mjs" ins={10-12}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            staticHeaders: true,
          },
        });
      },
      'astro:build:generated': ({ routeToHeaders }) => {
        // use `routeToHeaders` to generate a configuration file
        // for your virtual host of choice
      },
    },
  };
}
```

The value of the headers might change based on the features enabled/used by the application. For example, if [CSP is enabled](/en/reference/configuration-reference/#securitycsp), the `<meta http-equiv="content-security-policy">` element is not added to the static page. Instead, its `content` is available in the `routeToHeaders` map. 

## Adapter types reference

### `AdapterSupport`

<p>

**Type:** <code><a href="#adaptersupport">AdapterSupportsKind</a> | <a href="#adaptersupportwithmessage">AdapterSupportWithMessage</a></code><br />
<Since v="5.0.0" />
</p>

A union of valid formats to describe the support level for a feature.

### `AdapterSupportsKind`

<p>

**Type:** `"deprecated" | "experimental" | "limited" | "stable" | "unsupported"`
</p>

Defines the level of support for a feature by your adapter:
* Use `"deprecated"` when your adapter deprecates support for a feature before removing it completely in a future version.
* Use `"experimental"` when your adapter adds support for a feature, but issues or breaking changes are expected.
* Use `"limited"` when your adapter only supports a subset of the full feature.
* Use `"stable"` when the feature is fully supported by your adapter.
* Use `"unsupported"` to warn users that they may encounter build issues in their project, as this feature is not supported by your adapter.

### `AdapterSupportWithMessage`

<p>

<Since v="5.0.0" />
</p>

An object that allows you to define a support level for a feature and a message to be logged in the user console. This object contains the following properties:

#### `support`

<p>

**Type:** <code>Exclude\<<a href="#adaptersupportskind">AdapterSupportsKind</a>, "stable"\></code>
</p>

Defines the level of support for a feature by your adapter.

#### `message`

<p>

**Type:** `string`
</p>

Defines a custom message to log regarding the support of a feature by your adapter.

#### `suppress`

<p>

**Type:** `"default" | "all"`<br />
<Since v="5.9.0" />
</p>

An option to prevent showing some or all logged messages about an adapter's support for a feature.

If Astro's default log message is redundant, or confusing to the user in combination with your [custom `message`](#message), you can use `suppress: "default"` to suppress the default message and only log your message:

```js title="my-adapter.mjs" ins={14}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'The adapter has limited support for Sharp. It will be used for images during build time, but will not work at runtime.',
              suppress: 'default' // custom message is more detailed than the default
            }
          } 
        });
      },
    },
  };
}
```

You can also use `suppress: "all"` to suppress all messages about support for the feature. This is useful when these messages are unhelpful to users in a specific context, such as when they have a configuration setting that means they are not using that feature. For example, you can choose to prevent logging any messages about Sharp support from your adapter:

```js title="my-adapter.mjs" ins={14}
export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) => {
        setAdapter({
          name: '@example/my-adapter',
          entrypointResolution: 'auto',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'This adapter has limited support for Sharp. Certain features may not work as expected.',
              suppress: 'all'
            }
          } 
        });
      },
    },
  };
}
```

## Allow installation via `astro add`

[The `astro add` command](/en/reference/cli-reference/#astro-add) allows users to easily add integrations and adapters to their project.  To allow your adapter to be installed with this command, **add `astro-adapter` to the `keywords` field in your `package.json`**:

```json
{
  "name": "example",
  "keywords": ["astro-adapter"],
}
```

Once you [publish your adapter to npm](https://docs.npmjs.com/cli/v8/commands/npm-publish), running `astro add example` will install your package with any peer dependencies specified in your `package.json` and instruct users to update their project config manually.
