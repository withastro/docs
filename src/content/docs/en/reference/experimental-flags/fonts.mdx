---
title: Experimental fonts API
sidebar:
  label: Fonts
i18nReady: true
tableOfContents:
  minHeadingLevel: 2
  maxHeadingLevel: 6
---

import Since from '~/components/Since.astro';
import { Steps, Tabs, TabItem } from '@astrojs/starlight/components';

<p>

**Type:** `FontFamily[]`<br />
<Since v="5.7.0" />
</p>

This experimental feature allows you to use fonts from your filesystem and various providers through a unified API. It automatically creates optimized fallbacks and preload links:

```js title="astro.config.mjs"
import { defineConfig, fontProviders } from "astro/config"

export default defineConfig({
    experimental: {
        fonts: [{
            provider: fontProviders.google(),
            name: "Roboto",
            cssVariable: "--font-roboto",
        }]
    }
})
```

```astro title="src/components/Head.astro"
---
import { Font } from 'astro:assets'
---

<Font family='--font-roboto' preload />

<style>
body {
    font-family: var(--font-roboto);
}
</style>
```

## Usage guide

To use the experimental fonts API you need to update your Astro configuration, call the `<Font />` component and use the CSS variable:

### Astro configuration

`experimental.fonts` accepts an array of `FontFamily`. To get started, let's setup one family:

<Steps>

1. Register an empty family to start with:

    ```js title="astro.config.mjs" ins={4-8}
    import { defineConfig } from "astro/config"

    export default defineConfig({
        experimental: {
            fonts: [{
                // We are going to add things here
            }]
        }
    })
    ```

2. Pick a provider from the [built-in remote provider](#available-remote-font-providers) or the [local provider](#local-font-families). In this example, we'll use the Google font provider:

    ```js title="astro.config.mjs" del={1} ins={2,7}
    import { defineConfig } from "astro/config"
    import { defineConfig, fontProviders } from "astro/config"

    export default defineConfig({
        experimental: {
            fonts: [{
                provider: fontProviders.google(),
            }]
        }
    })
    ```

3. Pick a font family supported by your provider (documented for each provider in the [reference](#available-remote-font-providers)). For our example, choose one on the [Google Fonts website](https://fonts.google.com/):

    ```js title="astro.config.mjs" ins={7}
    import { defineConfig, fontProviders } from "astro/config"

    export default defineConfig({
        experimental: {
            fonts: [{
                provider: fontProviders.google(),
                name: "Roboto",
            }]
        }
    })
    ```

3. Choose a CSS variable. This will allow you to reference the font family you just registered in CSS:

    ```js title="astro.config.mjs" ins={8}
    import { defineConfig, fontProviders } from "astro/config"

    export default defineConfig({
        experimental: {
            fonts: [{
                provider: fontProviders.google(),
                name: "Roboto",
                cssVariable: "--font-roboto",
            }]
        }
    })
    ```

</Steps>

More options are available and depend on your provider, refer to the [reference](#reference) to learn more.

### `<Font />` component

This component outputs style tags and preload links for a given font family:

<Steps>

1. Import the component to be used in your page `<head>`:

    ```astro title="src/components/Head.astro" ins={2}
    ---
    import { Font } from 'astro:assets'
    ---
    ```

2. Call the component and specify a `family`. It takes the value of the `cssVariable` in your Astro configuration:

    ```astro title="src/components/Head.astro" ins={5}
    ---
    import { Font } from 'astro:assets'
    ---

    <Font family="--font-roboto" preload />
    ```

    `family` is strongly typed using the values from your Astro configuration to help you.

</Steps>

### Use the CSS variable

Now that the `<Font />` component generates CSS with font declarations, you can reference the font family using the `cssVariable` you used in your Astro configuration:

```css
<style>
body {
    font-family: var(--font-roboto);
}
</style>
```

If you use Tailwind CSS, you can use the following configuration:

<Tabs>

<TabItem label="Tailwind CSS 4.0">

```css title="src/styles/global.css" ins={4}
@import 'tailwindcss';

@theme {
    --font-sans: var(--font-roboto);
}
```

</TabItem>

<TabItem label="Tailwind CSS 3.0">

```js title="tailwind.config.mjs" ins={6-8}
/** @type {import("tailwindcss").Config} */
export default {
  content: ["./src/**/*.{astro,html,js,jsx,md,mdx,svelte,ts,tsx,vue}"],
  theme: {
    extend: {},
    fontFamily: {
        sans: ["var(--font-roboto)"]
    }
  },
  plugins: [],
};
```

</TabItem>

</Tabs>

## Reference

### Astro configuration

#### Shared properties

##### name

<p>

**Type:** `string`
</p>

The font family name:

```js title="astro.config.mjs"
name: "Roboto"
```

##### cssVariable

<p>

**Type:** `string`
</p>

The CSS variable name. It must be a [valid ident](https://developer.mozilla.org/en-US/docs/Web/CSS/ident):

```js title="astro.config.mjs"
cssVariable: "--font-roboto"
```

##### fallbacks

TODO:

##### automaticFallback

TODO:

#### Remote font families

This kind of family accepts an [Astro font provider](#font-provider). Unde the hood, options are handled by [unifont](https://github.com/unjs/unifont/).

##### provider

<p>

**Type:** `AstroFontProvider`
</p>

Accepts an Astro font provider. You can use a [built-in one](#available-remote-font-providers) or [write your own](#custom-providers):

```js title="astro.config.mjs"
import { defineConfig, fontProviders } from "astro/config"

export default defineConfig({
    experimental: {
        fonts: [{
            provider: fontProviders.google(),
        }]
    }
})
```

##### weights

TODO:

##### styles

TODO:

##### subsets

TODO:

##### display

TODO:

##### unicodeRange

TODO:

##### stretch

TODO:

##### featureSettings

TODO:

##### variationSettings

TODO:

#### Available remote font providers

TODO:

##### adobe

TODO:

##### bunny

TODO:

##### fontshare

TODO:

##### fontsource

TODO:

##### google

TODO:

##### Custom providers

TODO: link to reference

#### Local font families

TODO:

##### provider

TODO:

##### Variants

TODO: represent several font face declarations

The following options are in common with remote font families:

- display
- unicodeRange
- stretch
- featureSettings
- variationSettings

###### src

TODO:

###### weight

TODO:

###### style

TODO:

### `<Font />` component

TODO:

1. Where to use
2. Options (family + preload)
3. What it does
4. Use the CSS variable
5. Page specific fonts

### Font provider

## Caching

## How it works

---

TODO: clean

## Configuring experimental fonts

To start using fonts, register a font family in `experimental.fonts.families`:

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config'

export default defineConfig({
    experimental: {
        fonts: {
            families: ['Roboto']
        }
    }
})
```

### Configuring a remote font family

A font family can be registered as a string or an object:

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config'

export default defineConfig({
    experimental: {
        fonts: {
            families: [
                'Roboto', // Shortand for { name: 'Roboto' }
                {
                    name: 'Lato'
                }
            ]
        }
    }
})
```

It accepts various options:

#### name

The required font family name:

```js title="astro.config.mjs"
{
    name: 'Roboto'
}
```

#### as

An optional alias name. This is useful to avoid conflicts, [especially as an integration](#registering-fonts-as-an-integration):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    as: 'Custom'
}
```

#### provider

An optional provider name. Defaults to `google` and accepts one of these values: `google`, `local` or any name from [other registered providers](#using-other-providers):

```js title="astro.config.mjs"
{
    providers: [custom()],
    families: [
        {
            name: 'Roboto',
            provider: 'custom'
        }
    ]
}
```

#### weights

An optional array of [font weights](https://developer.mozilla.org/en-US/docs/Web/CSS/font-weight) (strings and numbers are allowed). Defaults to `['400']`:

```js title="astro.config.mjs"
{
    name: 'Roboto',
    weights: [200, '300', 'bold']
}
```

#### styles

An optional array of [font styles](https://developer.mozilla.org/en-US/docs/Web/CSS/font-style). Defaults to `['normal', 'italic']`:

```js title="astro.config.mjs"
{
    name: 'Roboto',
    styles: ['oblique']
}
```

#### subsets

An optional array of [font subsets](https://fonts.google.com/knowledge/glossary/subsetting). Defaults to `['cyrillic-ext', 'cyrillic', 'greek-ext', 'greek', 'vietnamese', 'latin-ext', 'latin']`:

```js title="astro.config.mjs"
{
    name: 'Roboto',
    subsets: ['latin']
}
```

#### fallbacks

An optional array of font fallbacks:

```js title="astro.config.mjs"
{
    name: 'Roboto',
    fallbacks: ['Custom', 'sans-serif']
}
```

If the latest fallback if a [generic family name](https://developer.mozilla.org/en-US/docs/Web/CSS/font-family#generic-name), Astro will try to generate an [optimized fallback](https://developer.chrome.com/blog/font-fallbacks) using font metrics.

#### automaticFallback

An optional boolean flag to enable/disable the automatic fallback generation described above. Defaults to `false`:

```js title="astro.config.mjs"
{
    name: 'Roboto',
    fallbacks: ['Arial', 'sans-serif'],
    automaticFallback: false
}
```

#### display

An optional [font display](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-display):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    display: 'swap'
}
```

#### unicodeRange

An optional [unicode range](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/unicode-range):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    unicodeRange: 'U+26'
}
```

#### stretch

An optional [font stretch](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-stretch):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    stretch: 'condensed'
}
```

#### featureSettings

Optional [font feature settings](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-feature-settings):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    featureSettings: '"smcp" 2'
}
```

#### variationSettings

Optional [font variation settings](https://developer.mozilla.org/en-US/docs/Web/CSS/@font-face/font-variation-settings):

```js title="astro.config.mjs"
{
    name: 'Roboto',
    variationSettings: '"xhgt" 0.7'
}
```

### Using other providers

More providers can be used by registering them in `fonts.providers`:

```js title="astro.config.mjs"
import { defineConfig, fontProviders } from 'astro/config'

export default defineConfig({
    experimental: {
        fonts: {
            providers: [fontProviders.fontsource()],
            families: [{
                name: 'Roboto',
                provider: 'fontsource'
            }]
        }
    }
})
```

`fontProviders` supports most [unifont](https://github.com/unjs/unifont/) providers (except `google` since it's built-in):

- `adobe`
- `bunny`
- `fontshare`
- `fontsource`

### Configuring a local font

To use local fonts, set `provider: 'local'` and specify some sources:

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config'

export default defineConfig({
    experimental: {
        fonts: {
            families: [{
                name: 'Roboto',
                provider: 'local',
                src: [{
                    paths: ['./src/assets/fonts/roboto.woff2']
                }]
            }]
        }
    }
})
```

Here are the configuration differences with a remote font family:

- All options from [remote font families](#configuring-a-remote-font-family) except `weights`, `styles` and `subsets`
- There's a required `src` option

#### `src`

A required option of sources for your font. It's an array of objects with the following properties:

- All options from [remote font families](#configuring-a-remote-font-family) except `fallbacks`, `automaticFallback` and `subsets`
- `paths`: An array of paths relative to project root

## Using fonts

Once you've configured the fonts in your config, you can start using them by calling the [`<Font />` component](#font-component) and consuming the [CSS variable](#css-variable).

### Font component

`astro:assets` exports a `<Font />` component:

```astro title="src/components/Head.astro"
---
import { Font } from 'astro:assets'
---

<Font family='Roboto' />
```

It accepts various options:

#### family

A required font family name.

:::note
If you specified `as` for a given font family, it must be used instead of `name`.
:::

#### preload

An optional boolean to generate preload links. Defaults to `false`:

```astro title="src/components/Head.astro" "preload"
---
import { Font } from 'astro:assets'
---

<Font family='Roboto' preload />
```

### CSS variable

The `<Font />` component registers some styles, including CSS variables:

```astro title="src/components/Head.astro"
<style>
body {
    font-family: var(--astro-font-roboto);
}
</style>
```

Generated CSS variables follow the `--astro-font-name` pattern, where `name` is converted to [kebab case](https://developer.mozilla.org/en-US/docs/Glossary/Kebab_case).

:::note
If you specified `as` for a given font family, it is used instead of `name` to generate the CSS variable identifier.
:::

## Advanced

### Creating a custom font provider

An Astro font provider is made of 2 parts: the config object and the actual implementation.

#### Config object

You can use the `defineFontProvider()` type helper:

```ts title="provider/config.ts"
import { defineFontProvider } from 'astro/config'

interface Config {
    // ...
}

export function myProvider(config: Config) {
    return defineFontProvider({
        name: 'my-provider',
        entrypoint: new URL('./implementation.js', import.meta.url),
        config
    })
}
```

:::note

1. The `entrypoint` can be a URL, a path relative to the root or a package import
3. The `config` is optional and must be serializable

:::

#### Implementation

The file linked by the the `entrypoint` must contain a named `provider` export, which is a [unifont](https://github.com/unjs/unifont/) provider:

```ts
import { defineFontProvider } from "unifont"

export const provider = defineFontProvider("my-provider", async (options, ctx) => {
    // ...
})
```

:::note

We recommend you look at [unifont providers' source](https://github.com/unjs/unifont/blob/main/src/providers/) to learn more about how to create a unifont provider.

:::

### Registering fonts as an integration

As an integration, you may want to use fonts but you want to avoid conflicts with the user. Eg. both the user and your integration use Roboto but with different settings.

To make sure there's no conflict, use the [`as`](#as) prop and make sure to make it specific enough:

```ts title="my-integration.ts"
updateConfig({
    experimental: {
        fonts: {
            families: [
                {
                    name: 'Roboto',
                    as: 'CustomIntegration: Roboto',
                    // ...
                }
            ]
        }
    }
})
```

To get proper autocompletion when using the [`<Font />` component](#font-component), you'll need to use module augmentation:

```ts title="env.d.ts"
declare module 'astro:assets' {
    export type FontFamily = 'CustomIntegration: Roboto'
}
```

### Caching

In order to avoid downloading files if not needed, caching has been implemented.

#### Development

- If a font file is requested, it will first check if it has been downloaded locally and load it. Otherwise it will make a network request
- Font files are downloaded on demand. We only download them if they're requested by the browser
- They are not cached in the browser however, to avoid getting stale assets
- To clear the cache, remove the `.astro/fonts` directory

#### Build

- All font files are requested. For each file, it will first check if it has been downloaded locally and load it. Otherwise it will make a network request
- Font files are copied to the `_astro/fonts` output directory, so they can benefit from HTTP caching of static assets
- To clear the cache, remove the `node_modules/.astro/font` directory

## Further reading

For full details and to give feedback on this experimental API, see [the Fonts RFC](https://github.com/withastro/roadmap/blob/rfc/fonts/proposals/0052-fonts.md).