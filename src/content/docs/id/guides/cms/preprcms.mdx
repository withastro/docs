---
title: Prepr CMS & Astro
description: Tambahkan konten ke proyek Astro Anda menggunakan Prepr sebagai CMS
sidebar:
  label: Prepr CMS
type: cms
service: Prepr CMS
stub: true
i18nReady: true
---
import { Steps } from '@astrojs/starlight/components';
import { FileTree } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

[Prepr CMS](https://www.prepr.io/) adalah headless CMS dengan personalisasi bawaan.

## Mengintegrasikan dengan Astro

Prepr CMS menyediakan [GraphQL API](https://docs.prepr.io/reference/graphql/v1/overview) untuk menghubungkan data Anda ke Astro.

### Prasyarat

Untuk memulai, Anda memerlukan:

- Proyek Astro baru atau yang sudah ada yang dikonfigurasi untuk [on-demand rendering](/id/guides/on-demand-rendering/).
- [Akun Prepr gratis](https://signup.prepr.io/)
- [Lingkungan Prepr dengan posting blog yang sudah ada](https://docs.prepr.io/account/set-up-environments#create-an-envirntonment). Pos ini harus menyertakan `title` dan `content`. Field lain bersifat opsional.

### Menyiapkan kredensial

Untuk menambahkan endpoint Prepr ke proyek Astro Anda, buat `.env file` di root proyek Anda jika belum ada dan tambahkan variabel berikut:

```ini title=".env"
PREPR_ENDPOINT=YOUR_PREPR_API_URL
```

Anda akan menemukan nilai `YOUR_PREPR_API_URL` dari pengaturan akun Prepr Anda:

<Steps>
1. Buka **Settings > Access tokens** untuk melihat token akses Preview dan Production.

2. Gunakan nilai **API URL** dari token akses **GraphQL Production** untuk hanya mengambil item konten yang telah dipublikasikan untuk situs Astro Anda.
</Steps>

### Mengonfigurasi endpoint Prepr

Buat folder baru `src/lib/` dan tambahkan berkas baru bernama `prepr.js`. Di sinilah Anda akan mengonfigurasi endpoint Prepr. Tambahkan kode berikut untuk mengambil data dari Prepr CMS:

```js title="src/lib/prepr.js"

export async function Prepr(query, variables) {
    const response = await fetch(import.meta.env.PREPR_ENDPOINT, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ query, variables }),
    })
    return response
}
```

Direktori root Anda sekarang harus menyertakan berkas-berkas ini:

<FileTree title="Project Structure">
- src/
  - lib/
    - **prepr.js**
- **.env**
- astro.config.mjs
- package.json

</FileTree>

### Mengambil data

Anda akan mengambil data dari Prepr dengan menulis kueri untuk berinteraksi dengan GraphQL API-nya.

#### Buat kueri GraphQL untuk mengambil artikel blog Anda:

<Steps>
1. Buat folder baru `src/queries/` dan tambahkan berkas bernama `get-articles.js`.

2. Tambahkan kueri berikut ke berkas ini untuk mengambil semua artikel:
    ```js title="src/queries/get-articles.js"

    const GetArticles = `
    query {
        Articles {
          items {
            _id
            _slug
            title
        }
      }
    }
    `
    export default GetArticles
    ```

3. Untuk menampilkan daftar tautan posting blog di sebuah halaman, impor dan jalankan kueri Anda, termasuk endpoint Prepr yang diperlukan. Anda kemudian akan memiliki akses ke semua judul posting dan slug-nya untuk dirender ke halaman. (Pada langkah berikutnya, Anda akan [create individual blog post pages](#creating-individual-blog-post-pages).)
    ```astro title="src/pages/index.astro" ins={3-4, 6-8, 15-23}
    ---
    import Layout from '../layouts/Layout.astro';
    import { Prepr } from '../lib/prepr.js';
    import GetArticles from '../queries/get-articles.js';

    const response = await Prepr(GetArticles)
    const { data } = await response.json()
    const articles = data.Articles
    ---

    <Layout title="My blog site">
      <h1>
        My blog site
      </h1>
      <ul>
        {
          articles.items.map((post) => (
            <li>
              <a href={post._slug}>{post.title}</a>
            </li>
          ))
        }
      </ul>
    </Layout>
    ```
</Steps>

Direktori root Anda harus menyertakan berkas-berkas baru ini:

<FileTree title="Project Structure">
- src/
  - lib/
    - prepr.js
  - pages/
    - index.astro
  - **queries**/
      - **get-articles.js**
- .env
- astro.config.mjs
- package.json
</FileTree>

#### Creating individual blog post pages

Untuk membuat halaman untuk setiap posting blog, Anda akan menjalankan kueri GraphQL baru pada halaman `.astro` [dynamic routing](/id/guides/routing/#on-demand-dynamic-routes). Kueri ini akan mengambil artikel tertentu berdasarkan slug‑nya dan halaman baru akan dibuat untuk setiap posting blog individual.

<Steps>
1. Buat berkas bernama `get-article-by-slug.js` di folder `queries` dan tambahkan berikut ini untuk mengambil artikel tertentu berdasarkan slug‑nya dan mengembalikan data seperti `title` dan `content` artikel:
    ```js title="src/lib/queries/get-article-by-slug.js"
    const GetArticleBySlug = `
    query ($slug: String) {
       Article (slug: $slug) {
         _id
         title
         content {
           __typename
           ... on Text {
             body
             text
           }
           ... on Assets {
             items {
               url
             }
           }
         }
       }
    }`

    export default GetArticleBySlug
    ```

    :::tip
    Anda dapat membuat dan [menguji kueri GraphQL](https://docs.prepr.io/reference/graphql/v1/test-queries) menggunakan [Apollo explorer](https://studio.apollographql.com/sandbox/explorer) di Prepr. Buka API Explorer dari halaman item konten *Article* di Prepr.
    Konten Article disimpan dalam *Dynamic content field*. Lihat dokumentasi GraphQL untuk detail selengkapnya tentang [cara mengambil data di dalam field ini](https://docs.prepr.io/reference/graphql/v1/schema-field-types-dynamic-content-field).
    :::

2. Di dalam folder `src/pages`, buat berkas bernama `[…slug].astro`. Tambahkan kode berikut untuk mengimpor dan menjalankan kueri dari langkah sebelumnya dan menampilkan artikel yang diambil:
    ```astro title="src/pages/[...slug].astro"
    ---
    import Layout from '../layouts/Layout.astro';
    import {Prepr} from '../lib/prepr.js';
    import GetArticleBySlug from '../queries/get-article-by-slug.js';

    const { slug } = Astro.params;
    const response = await Prepr(GetArticleBySlug, {slug})
    const { data } = await response.json()
    const article = data.Article
    ---

    <Layout title={article.title}>
      <main>
        <h1>{article.title}</h1>
        {
          article.content.map((content) => (
            <div>
              {
                content.__typename === "Assets" &&
                <img src={content.items[0].url} width="300" height="250"/>
              }
              {
                content.__typename === 'Text' &&
                <div set:html={content.body}></div>
              }
            </div>
          ))
        }
      </main>
    </Layout>
    ```
</Steps>

Direktori root Anda sekarang harus menyertakan berkas-berkas baru ini:

<FileTree title="Project Structure">
- src/
  - lib/
    - prepr.js
  - pages/
    - index.astro
    - **[…slug].astro**
  - queries/
      - get-articles.js
      - **get-article-by-slug.js**
- .env
- astro.config.mjs
- package.json
</FileTree>

Sekarang, saat Anda mengeklik tautan artikel dari daftar posting blog utama, Anda akan dibawa ke halaman dengan konten individualnya.

### Menerbitkan situs Anda

Untuk menerapkan blog Prepr Anda, kunjungi [panduan deployment](/id/guides/deploy/) kami dan ikuti instruksi untuk penyedia hosting pilihan Anda.

## Sumber Daya Resmi

- Ikuti panduan [Prepr CMS Astro quickstart](https://github.com/preprio/astro-quick-start) untuk membuat blog sederhana dengan Astro dan Prepr CMS.
- Lihat [Menghubungkan Prepr CMS ke Astro](https://docs.prepr.io/connecting-front-end-apps/astro) untuk ringkasan sumber daya Astro dan Prepr CMS.