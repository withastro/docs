---
title: Payload CMS y Astro
description: Agrega contenido a tu proyecto de Astro utilizando Payload como CMS
type: cms
stub: true
service: Payload CMS
i18nReady: true
---

[PayloadCMS](https://payloadcms.com/) es un sistema de gesti칩n de contenido headless de c칩digo abierto que se puede utilizar para proporcionar contenido para tu proyecto Astro.

## Integraci칩n con Astro

### Prerequisitos


1. **Un proyecto de Astro** - Si a칰n no tienes un proyecto de Astro, nuestra [gu칤a de instalaci칩n](/es/install/auto/) te pondr치 en marcha en poco tiempo.
2. **Una base de datos de MongoDB** - PayloadCMS te pedir치 una cadena de conexi칩n de MongoDB al crear un nuevo proyecto. Puede configurar uno localmente o usar [MongoDBAtlas](https://www.mongodb.com/) para alojar una base de datos en la web de forma gratuita.
3. **Una API REST de PayloadCMS** - Crea un proyecto de [PayloadCMS](https://payloadcms.com/docs/getting-started/installation) y con칠ctalo a tu base de datos MongoDB durante la configuraci칩n.

:::note[Escogiendo una plantilla]
Durante la instalaci칩n de PayloadCMS, se te preguntar치 si deseas utilizar una plantilla.

Escoger cualquiera de las plantillas disponibles en este paso (como 'blog') genera autom치ticamente colecciones adicionales para que las utilices. De lo contrario, deber치s crear manualmente tus colecciones de PayloadCMS.
:::

### Configurando Astro para tu colecci칩n de PayloadCMS

Tu proyecto de plantilla Payload contendr치 un archivo llamado Posts.ts en `src/collections/`. Si no escogiste una plantilla durante la instalaci칩n que creara una colecci칩n de contenido para ti, puedes crear una nueva colecci칩n de PayloadCMS agregando este archivo de configuraci칩n manualmente. El siguiente ejemplo muestra este archivo para una colecci칩n llamada `posts` que requiere los campos `title`, `content` y `slug`:


```astro title="src/collections/Posts.ts"
import { CollectionConfig } from "payload/types";

const Posts: CollectionConfig = {
  slug: "posts",
  admin: {
    useAsTitle: "title",
  },
  access: {
    read: () => true,
  },

  fields: [
    {
      name: "title",
      type: "text",
      required: true,
    },
    {
      name: "content",
      type: "text",
      required: true,
    },
    {
      name: "slug",
      type: "text",
      required: true,
    },
  ],
};

export default Posts;
```

1. Importa y agrega tanto `Users` (disponible en todos los proyectos de PayloadCMS) como cualquier otra colecci칩n (por ejemplo, `Posts`) a las colecciones disponibles en el archivo `payload.config.ts`.

    ```astro title="src/payload.config.ts" ins={4, 5, 12}
    import { buildConfig } from "payload/config";
    import path from "path";
    import Users from "./collections/Users";
    import Posts from "./collections/Posts";
    export default buildConfig({
      serverURL: "http://localhost:4321",
      admin: {
        user: Users.slug,
      },
      collections: [Users, Posts],
      typescript: {
        outputFile: path.resolve(__dirname, "payload-types.ts"),
      },
      graphQL: {
        schemaOutputFile: path.resolve(__dirname, "generated-schema.graphql"),
      },
    });
    ```

    Esto har치 que aparezca una nueva colecci칩n llamada "Posts" en tu panel de control de PayloadCMS junto a la colecci칩n "Users".

2. Ingresa a la colecci칩n "Posts" y crea una nueva publicaci칩n. Despu칠s de guardarla, notar치s que la URL de la API aparece en la esquina inferior derecha.

3. Con el servidor de desarrollo en ejecuci칩n, abre `http://localhost:4321/api/posts` en tu navegador. Deber칤as ver un archivo JSON que contiene la publicaci칩n que has creado como un objeto.

    ```json
    {
      "docs":[
          {
            "id":"64098b16483b0f06a7e20ed4",
            "title":"Astro & PayloadCMS Title 游",
            "content":"Astro & PayloadCMS Content",
            "slug":"astro-payloadcms-slug",
            "createdAt":"2023-03-09T07:30:30.837Z",
            "updatedAt":"2023-03-09T07:30:30.837Z"
          }
      ],
      "totalDocs":1,
      "limit":10,
      "totalPages":1,
      "page":1,
      "pagingCounter":1,
      "hasPrevPage":false,
      "hasNextPage":false,
      "prevPage":null,
      "nextPage":null
    }
    ```

:::tip
Por defecto, tanto Astro como PayloadCMS utilizar치n el puerto 4321. Es posible que desees cambiar el puerto de PayloadCMS en el archivo `src/server.ts`. No olvides actualizar el `serverURL` en `src/payload.config.ts` tambi칠n.
:::

### Obteniendo los datos

Obt칠n los datos de PayloadCMS a trav칠s de la URL 칰nica de la API REST de tu sitio y la ruta de tu contenido. (Por defecto, PayloadCMS montar치 todas las rutas a trav칠s de `/api`.) Luego, puedes renderizar las propiedades de tus datos utilizando la directiva `set:html=""` de Astro.

Juntos con tu publicaci칩n, PayloadCMS devolver치 algunos metadatos de nivel superior. Los documentos reales est치n anidados dentro del arreglo `docs`.

Por ejemplo, para mostrar una lista de t칤tulos de publicaciones y su contenido:

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("http://localhost:5000/api/posts") // http://localhost:4321/api/posts by default
const posts = await res.json()
---

<HomeLayout title='Astro Blog'>
	{
    posts.docs.map((post) => (
        <h2 set:html={post.title} />
        <p set:html={post.content} />
    ))
	}
</HomeLayout>
```

## Construyendo un blog con PayloadCMS y Astro

Crea una p치gina 칤ndice de blog `src/pages/index.astro` para listar cada una de tus publicaciones con un enlace a su propia p치gina.

La b칰squeda a trav칠s de la API devuelve un arreglo de objetos (publicaciones) que incluyen, entre otros, las siguientes propiedades:

- `title`
- `content`
- `slug`

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("http://localhost:5000/api/posts") // http://localhost:4321/api/posts by default
const posts = await res.json()
---

<HomeLayout title='Astro Blog'>
	<h1>Astro + PayloadCMS 游</h1>
	<h2>Blog posts list:</h2>
	<ul>
		{
			posts.docs.map((post) =>(
				<li>
					<a href={`posts/${post.slug}`} set:html={post.title} />
				</li>
			))
		}
	</ul>
</HomeLayout>
```

### Usando la API de PayloadCMS para generar p치ginas

Crea una p치gina `src/pages/posts/[slug].astro` para [generar din치micamente una p치gina](/es/core-concepts/routing/#rutas-din치micas) para cada publicaci칩n.

```astro title="src/pages/posts/[slug].astro"
---
import PostLayout from "../../layouts/PostLayout.astro"

const {title, content} = Astro.props

// La funci칩n getStaticPaths() es necesaria para sitios est치ticos de Astro.
// Si est치s usando SSR, no necesitar치s esta funci칩n.
export async function getStaticPaths() {
    let data = await fetch("http://localhost:5000/api/posts")
    let posts = await data.json()

    return posts.docs.map((post) => {
        return {
            params: {slug: post.slug},
            props: {title: post.title, content: post.content},
        };
    });
} 
---
<PostLayout title={title}>
    <article>
        <h1 set:html={title} />
        <p set:html={content} />
    </article>
</PostLayout>
```

### Publicando tu sitio

Para desplegar tu sitio visita nuestra [gu칤a de despliegue](/es/guides/deploy/) y sigue las instrucciones para tu proveedor de alojamiento preferido.


## Recursos de la comunidad

- Prueba esta [Plantilla de Payload CMS y Astro](https://github.com/Lambdo-Labs/payloadcms-astro-template).
- Echa un vistazo a [Astroad](https://github.com/mooxl/astroad) para un f치cil desarrollo y despliegue en VPS con Docker.

