---
type: integration
title: '@astrojs/cloudflare'
description: Aprende c칩mo usar el adaptador @astrojs/cloudflare para desplegar tu proyecto Astro.
sidebar:
  label: Cloudflare
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/cloudflare/'
category: adapter
i18nReady: true
---

import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { Tabs, TabItem, Steps } from '@astrojs/starlight/components';


Este adaptador permite a Astro desplegar tus [rutas y caracter칤sticas renderizadas bajo demanda](/es/guides/on-demand-rendering/) en [Cloudflare](https://www.cloudflare.com/), incluyendo [islas de servidor](/es/guides/server-islands/), [acciones](/es/guides/actions/), y [sesiones](/es/guides/sessions/).

Si est치s usando Astro como generador de sitios est치ticos, no necesitas un adaptador.

Aprende c칩mo desplegar tu sitio Astro en nuestra [gu칤a de despliegue en Cloudflare](/es/guides/deploy/cloudflare/).

## Por qu칠 Astro Cloudflare

La [Plataforma de Desarrolladores](https://developers.cloudflare.com/) de Cloudflare te permite desarrollar aplicaciones full-stack con acceso a recursos como almacenamiento e IA, todo desplegado en una red global edge. Este adaptador construye tu proyecto Astro para el despliegue a trav칠s de Cloudflare.


## Instalaci칩n

Astro incluye un comando `astro add` para automatizar la configuraci칩n de integraciones oficiales. Si prefieres, puedes [instalar integraciones manualmente](#instalaci칩n-manual) en su lugar.

Agrega el adaptador de Cloudflare para habilitar la renderizaci칩n del servidor en tu proyecto Astro con el comando `astro add`. Esto instalar치 `@astrojs/cloudflare` y har치 los cambios apropiados a tu archivo `astro.config.mjs` en un paso.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add cloudflare
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add cloudflare
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add cloudflare
  ```
  </Fragment>
</PackageManagerTabs>

Ahora, puedes habilitar [la renderizaci칩n bajo demanda por p치gina](/es/guides/on-demand-rendering/#habilitar-el-renderizado-bajo-demanda), o configurar tu configuraci칩n de salida de construcci칩n a `output: 'server'` para [renderizar en el servidor todas tus p치ginas por defecto](/es/guides/on-demand-rendering/#modo-server).

### Instalaci칩n Manual

Primero, agrega el adaptador `@astrojs/cloudflare` a las dependencias de tu proyecto usando tu gestor de paquetes preferido.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/cloudflare
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/cloudflare
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/cloudflare
  ```
  </Fragment>
</PackageManagerTabs>

Luego, agrega el adaptador a tu archivo `astro.config.mjs`:

```js title="astro.config.mjs" ins={2,5}
import { defineConfig } from 'astro/config';
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  adapter: cloudflare(),
});
```

## Opciones

El adaptador de Cloudflare acepta las siguientes opciones:

### `cloudflareModules`

<p>
**Tipo:** `boolean`<br />
**Por defecto:** `true`
</p>

Habilita [importaciones de m칩dulos `.wasm`, `.bin`, y `.txt`](#importaciones-de-m칩dulos-de-cloudflare).

Esta funcionalidad est치 habilitada por defecto. Si deseas deshabilitarla, establece `cloudflareModules` en `false`.

### `imageService`

<p>
**Tipo:** `'passthrough' | 'cloudflare' | 'compile' | 'custom'`<br />
**Por defecto:** `'compile'`
</p>

Determina qu칠 servicio de im치genes es usado por el adaptador. El adaptador utilizar치 por defecto el modo `compile` cuando se configure un servicio de im치genes incompatible. De lo contrario, usar치 el servicio de im치genes configurado globalmente:

* **`cloudflare`:** Usa el servicio [Cloudflare Image Resizing](https://developers.cloudflare.com/images/image-resizing/).
* **`passthrough`:** Usa el servicio [`noop`](/es/guides/images/#configura-el-servicio-no-op-de-paso) existente.
* **`compile`:** Usa el servicio por defecto de Astro (sharp), pero solo en rutas pre-renderizadas en tiempo de construcci칩n. Para p치ginas renderizadas bajo demanda, todas las caracter칤sticas de `astro:assets` est치n deshabilitadas.
* **`custom`:** Siempre usa el servicio de im치genes configurado en [Opciones de Imagen](/es/reference/configuration-reference/#opciones-de-imagen). **Esta opci칩n no verificar치 si el servicio de im치genes configurado funciona en el runtime `workerd` de Cloudflare.**

```js title="astro.config.mjs" ins={6}
import { defineConfig } from "astro/config";
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  adapter: cloudflare({
     imageService: 'cloudflare'
  }),
})
```

### `platformProxy`

Determina si y c칩mo se a침ade el runtime de Cloudflare a `astro dev`. Contiene proxies a enlaces `workerd` locales y emulaciones de valores espec칤ficos de Cloudflare, permitiendo la emulaci칩n del runtime en el proceso de desarrollo de Node.js. Lee m치s sobre el [Runtime de Cloudflare](#runtime-de-cloudflare).

:::note
Los proxies proporcionados por esto son una emulaci칩n de mejor esfuerzo de la producci칩n real. Aunque est치n dise침ados para ser lo m치s cercanos posible a lo real, puede haber ligeras diferencias e inconsistencias entre los dos.
:::

#### `platformProxy.enabled`
<p>
**Tipo:** `boolean`<br />
**Por defecto:** `true`
</p>

Determina si habilitar el runtime de Cloudflare en modo de desarrollo.

#### `platformProxy.configPath`
<p>
**Tipo:** `string`<br />
**Por defecto:** `undefined`
</p>

Define la ruta al archivo de configuraci칩n de Wrangler. Si no se establece un valor, rastrea `wrangler.toml`, `wrangler.json`, y `wrangler.jsonc` en la ra칤z del proyecto.

#### `platformProxy.environment`
<p>
**Tipo:** `string`<br />
**Por defecto:** `undefined`
</p>

Establece el [entorno de Cloudflare](https://developers.cloudflare.com/workers/wrangler/environments/) a usar. Debes seleccionar un entorno definido en el archivo de configuraci칩n de Wrangler, de lo contrario ocurrir치 un error.

#### `platformProxy.persist`
<p>
**Tipo:** `boolean | { path: string }`<br />
**Por defecto:** `true`
</p>

Establece si y d칩nde guardar los datos de enlace localmente en el sistema de archivos.

- Si se establece en `true`, los datos de enlace se almacenan en `.wrangler/state/v3/`. Es el mismo que la configuraci칩n por defecto para wrangler.
- Si se establece en `false`, los datos de enlace no se almacenan en el sistema de archivos.
- Si se establece en `{ path: string }`, los datos de enlace se almacenan en la ruta especificada.

:::note
La opci칩n `--persist-to` de `wrangler` a침ade un subdirectorio llamado `v3` internamente mientras que la propiedad `persist` de `@astrojs/cloudflare` no lo hace. Por ejemplo, para reutilizar la misma ubicaci칩n que ejecutar `wrangler dev --persist-to ./my-directory`, debes especificar: `persist: { path: "./my-directory/v3" }`.
:::

La siguiente configuraci칩n muestra un ejemplo de habilitar el runtime de Cloudflare al ejecutar el servidor de desarrollo, as칤 como usar un archivo de configuraci칩n `wrangler.json`. Tambi칠n especifica una ubicaci칩n personalizada para persistir datos en el sistema de archivos:


```js
import cloudflare from '@astrojs/cloudflare';
import { defineConfig } from 'astro/config';

export default defineConfig({
	adapter: cloudflare({
		platformProxy: {
			enabled: true,
			configPath: 'wrangler.json',
			persist: {
				path: './.cache/wrangler/v3'
			},
		},
	}),
});
```
### `routes.extend`

En Cloudflare Workers, esta opci칩n no es aplicable. Consulta [Enrutamiento en Cloudflare Workers](#enrutamiento-en-cloudflare-workers) para m치s informaci칩n.

En Cloudflare Pages, esta opci칩n te permite agregar o excluir patrones personalizados (ej. `/fonts/*`) al archivo `_routes.json` generado que determina qu칠 rutas se generan bajo demanda. Esto puede ser 칰til si necesitas agregar patrones de ruta que no pueden ser generados autom치ticamente, o excluir rutas pre-renderizadas.

M치s informaci칩n sobre los patrones de ruta personalizados se puede encontrar en [la documentaci칩n de enrutamiento de Cloudflare](https://developers.cloudflare.com/pages/functions/routing/#functions-invocation-routes). Cualquier ruta especificada no se deduplica autom치ticamente y se a침adir치 a las rutas existentes tal como est치.

#### `routes.extend.include`

<p>
**Tipo:** `{ pattern: string }[]`<br />
**Por defecto:** `undefined`
</p>

Configura rutas adicionales para ser generadas bajo demanda por el adaptador de Cloudflare en el array `routes.extend.include`.

#### `routes.extend.exclude`

<p>
**Tipo:** `{ pattern: string }[]`<br />
**Por defecto:** `undefined`
</p>

Configura rutas para ser excluidas de la renderizaci칩n bajo demanda en el array `routes.extend.exclude`. Estas rutas ser치n pre-renderizadas y servidas est치ticamente en su lugar, y no invocar치n la funci칩n del servidor. Adicionalmente puedes usar esta opci칩n para servir cualquier archivo de activo est치tico (ej. im치genes, fuentes, css, js, html, txt, json, etc.) directamente sin enrutar la solicitud a trav칠s de la funci칩n del servidor.

```js title="astro.config.mjs"
export default defineConfig({
  adapter: cloudflare({
    routes: {
      extend: {
        include: [{ pattern: '/static' }], // Route a prerended page to the server function for on-demand rendering
        exclude: [{ pattern: '/pagefind/*' }], // Use Starlight's pagefind search, which is generated statically at build time
      }
    },
  }),
});
```

### `sessionKVBindingName`
<p>
**Tipo:** `string`<br />
**Por defecto:** `SESSION`
<Since v="5.6.0" />
</p>

La opci칩n `sessionKVBindingName` te permite especificar el nombre del enlace KV usado para el almacenamiento de sesiones. Por defecto, esto est치 establecido en `SESSION`, pero puedes cambiarlo para que coincida con tu propio nombre de enlace KV. Consulta [Sesiones](#sesiones) para m치s informaci칩n.

```js title="astro.config.mjs" "MY_SESSION_BINDING"
export default defineConfig({
  adapter: cloudflare({
    sessionKVBindingName: 'MY_SESSION_BINDING',
  }),
});
```

### `workerEntryPoint`
<p>

**Tipo:** `{ path: string | URL, namedExports: string[] }`<br />
**Por defecto:** `{ path: '@astrojs/cloudflare/entrypoints/server.js', namedExports: [] }`<br />
<Since v="12.6.0" pkg="@astrojs/cloudflare"/>
</p>


Un objeto de configuraci칩n para especificar el [workerEntryPoint](https://developers.cloudflare.com/workers/runtime-apis/bindings/service-bindings/rpc/) para tu Cloudflare Worker cuando usas el comando `astro build`.

Te permite especificar opcionalmente tanto una `ruta` de archivo personalizada como `namedExports`:

```js title="astro.config.mjs"
import cloudflare from '@astrojs/cloudflare';
import { defineConfig } from 'astro/config';

export default defineConfig({
	adapter: cloudflare({
		workerEntryPoint: {
			path: 'src/worker.ts',
			namedExports: ['MyDurableObject']
		}
	}),
});
```

#### `workerEntryPoint.path`

<p>

**Tipo:** `string`<br />
**Por defecto:** `@astrojs/cloudflare/entrypoints/server.js`
<Since v="12.6.0" pkg="@astrojs/cloudflare" />
</p>

La ruta al archivo de entrada. Esta debe ser una ruta relativa desde la ra칤z de tu proyecto Astro.

Por defecto, el adaptador usa un archivo de entrada gen칠rico, que solo soporta el manejador `fetch`.

Para soportar otros [manejadores de invocaci칩n de Cloudflare](https://developers.cloudflare.com/workers/observability/logs/workers-logs/#invocation-logs), puedes crear un archivo personalizado para usar como punto de entrada. Esto es 칰til si quieres usar caracter칤sticas que requieren otros manejadores (ej. Durable Objects, Cloudflare Queues, Invocaciones Programadas).

#### `workerEntryPoint.namedExports` 

<p>

**Tipo:** `[]`<br />
**Por defecto:** `['default']`
<Since v="12.6.0" pkg="@astrojs/cloudflare" />
</p>

Un array de exportaciones nombradas para usar en el archivo de entrada.

Proporciona cualquier exportaci칩n nombrada adicional definida de tu [archivo de entrada personalizado](#creando-un-archivo-de-entrada-personalizado-de-cloudflare-worker) (ej. `DurableObject`). Si no se proporciona, solo se incluir치n las exportaciones por defecto.

#### Creando un archivo de entrada personalizado de Cloudflare Worker

El archivo de entrada personalizado debe exportar la funci칩n `createExports()` con una exportaci칩n `default` incluyendo todos los manejadores que necesites.

El siguiente archivo de entrada de ejemplo registra un Durable Object y un manejador de cola:

```ts title="src/worker.ts"
import type { SSRManifest } from 'astro';
import { App } from 'astro/app';
import { handle } from '@astrojs/cloudflare/handler'
import { DurableObject } from 'cloudflare:workers';

class MyDurableObject extends DurableObject<Env> {
  constructor(ctx: DurableObjectState, env: Env) {
    super(ctx, env)
  }
}

export function createExports(manifest: SSRManifest) {
	const app = new App(manifest);
	return {
		default: {
			async fetch(request, env, ctx) {
				await env.MY_QUEUE.send("log");
				return handle(manifest, app, request, env, ctx);
			},
			async queue(batch, _env) {
				let messages = JSON.stringify(batch.messages);
				console.log(`consumed from our queue: ${messages}`);
			}
		} satisfies ExportedHandler<Env>,
		MyDurableObject: MyDurableObject,
	}
}
```

## Runtime de Cloudflare

### Uso

El runtime de Cloudflare te da acceso a variables de entorno y enlaces a recursos de Cloudflare.
El runtime de Cloudflare usa enlaces encontrados en el archivo de configuraci칩n `wrangler.toml`/`wrangler.json`. 

Puedes acceder a los enlaces desde `Astro.locals.runtime`:

```astro title="src/pages/index.astro"
---
const { env } = Astro.locals.runtime;
---
```
Puedes acceder al runtime desde endpoints de API a trav칠s de `context.locals`:

```js title="src/pages/api/someFile.js"
export function GET(context) {
  const runtime = context.locals.runtime;

  return new Response('Some body');
}
```

Consulta la [lista de todos los enlaces soportados](https://developers.cloudflare.com/workers/wrangler/api/#supported-bindings) en la documentaci칩n de Cloudflare.


### Variables de entorno y secretos

El runtime de Cloudflare trata las variables de entorno como un tipo de enlace.

Por ejemplo, puedes definir una [variable de entorno](https://developers.cloudflare.com/workers/configuration/environment-variables/#add-environment-variables-via-wrangler) en `wrangler.json` de la siguiente manera:

```json title="wrangler.json"
{
  "vars" : {
    "MY_VARIABLE": "test"
  }
}
```

Los secretos son un tipo especial de variable de entorno que te permite adjuntar valores de texto encriptados a tu Worker. Necesitan ser definidos de manera diferente para asegurar que no sean visibles despu칠s de que los configures.

Para definir `secrets`, a침치delos a trav칠s del [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/) en lugar de en tu archivo de configuraci칩n de Wrangler. 

```bash
npx wrangler secret put <KEY>
```

Para configurar secretos para desarrollo local, tambi칠n necesitas agregar un archivo `.dev.vars` a la ra칤z del proyecto Astro:

```ini title=".dev.vars"
DB_PASSWORD=myPassword
```

Entonces puedes acceder a variables de entorno, incluyendo secretos, desde el objeto `env` disponible desde `Astro.locals.runtime`:  

```astro title="src/pages/index.astro"
---
const { env } = Astro.locals.runtime;
const myVariable = env.MY_VARIABLE;
const secret = env.DB_PASSWORD;
---
```

{/*TODO: add link to /en/guides/environment-variables/#type-safe-environment-variables*/}
Las variables de entorno y secretos de Cloudflare son compatibles con la API `astro:env`).

### Tipado

`wrangler` proporciona un comando `types` para generar tipos de TypeScript para los enlaces. Esto te permite tipar locals sin la necesidad de tiparlos manualmente. Consulta la [documentaci칩n de Cloudflare](https://developers.cloudflare.com/workers/wrangler/commands/#types) para m치s informaci칩n.

Cada vez que cambies tus archivos de configuraci칩n (ej. `wrangler.toml`, `.dev.vars`) necesitas ejecutar `wrangler types`.

:::note
Puedes crear un script de pnpm para ejecutar `wrangler types` autom치ticamente antes de otros comandos.

```json title="package.json"
{
  "scripts": {
    "dev": "wrangler types && astro dev",
    "start": "wrangler types && astro dev",
    "build": "wrangler types && astro check && astro build",
    "preview": "wrangler types && astro preview",
    "astro": "astro"
  }
}
```
:::

Puedes tipar el objeto `runtime` usando `Runtime`:

```ts title="src/env.d.ts"
type Runtime = import('@astrojs/cloudflare').Runtime<Env>;

declare namespace App {
  interface Locals extends Runtime {
    otherLocals: {
      test: string;
    };
  }
}
```

## Plataforma Cloudflare

### Headers

Puedes adjuntar [headers personalizados](https://developers.cloudflare.com/pages/platform/headers/) a tus respuestas agregando un archivo `_headers` en la carpeta `public/` de tu proyecto Astro. Este archivo ser치 copiado al directorio de salida de construcci칩n.

Esto est치 disponible en Cloudflare Workers y Pages.

### Assets
Los assets construidos por Astro tienen nombres con un hash y por lo tanto se les pueden otorgar headers de cach칠 largos. Por defecto, Astro en Cloudflare agregar치 tal header para estos archivos.

### Redirecciones

Puedes declarar [redirecciones personalizadas](https://developers.cloudflare.com/pages/platform/redirects/) para redireccionar solicitudes a una URL diferente. Para hacer esto, agrega un archivo `_redirects` en la carpeta `public/` de tu proyecto Astro. Este archivo ser치 copiado al directorio de salida de construcci칩n.

Esto est치 disponible en Cloudflare Workers y Pages.

### Rutas
#### Enrutamiento en Cloudflare Workers

El enrutamiento para assets est치ticos se basa en la estructura de archivos en el directorio de construcci칩n (ej. `./dist`). Si no se encuentra una coincidencia, esto se delegar치 al Worker para renderizaci칩n bajo demanda. Lee m치s sobre [enrutamiento de assets est치ticos con Cloudflare Workers](https://developers.cloudflare.com/workers/static-assets/routing/).

A diferencia de [Cloudflare Pages](#enrutamiento-en-cloudflare-pages), con Workers, no necesitas un archivo `_routes.json`.

Actualmente, el adaptador de Cloudflare siempre genera este archivo. Para evitar esto, crea un archivo `.assetsignore` en tu carpeta `public/`, y agrega las siguientes l칤neas:
  ```txt title="public/.assetsignore"
  _worker.js
  _routes.json
  ```

#### Enrutamiento en Cloudflare Pages

Para Cloudflare Pages, [el enrutamiento](https://developers.cloudflare.com/pages/platform/functions/routing/#functions-invocation-routes) usa un archivo `_routes.json` para determinar qu칠 solicitudes se enrutan a la funci칩n del servidor y cu치les se sirven como assets est치ticos. Por defecto, un archivo `_routes.json` ser치 generado autom치ticamente para tu proyecto basado en sus archivos y configuraci칩n.

Puedes [especificar patrones de enrutamiento adicionales a seguir](#routesextend) en tu configuraci칩n del adaptador, o crear tu propio archivo `_routes.json` personalizado para anular completamente la generaci칩n autom치tica.


Crear un `public/_routes.json` personalizado anular치 la generaci칩n autom치tica. Consulta [la documentaci칩n de Cloudflare sobre crear un `_routes.json` personalizado](https://developers.cloudflare.com/pages/platform/functions/routing/#create-a-_routesjson-file) para m치s detalles.

## Sesiones

La [API de Sesiones](/es/guides/sessions/) de Astro te permite almacenar f치cilmente datos de usuario entre solicitudes. Esto puede ser usado para cosas como datos de usuario y preferencias, carritos de compras, y credenciales de autenticaci칩n. A diferencia del almacenamiento en cookies, no hay l칤mites de tama침o en los datos, y puede ser restaurado en diferentes dispositivos.

Astro configura autom치ticamente [Workers KV](https://developers.cloudflare.com/kv/) para el almacenamiento de sesiones cuando usa el adaptador de Cloudflare. Antes de usar sesiones, necesitas crear un namespace KV para almacenar los datos y configurar un enlace KV en tu archivo de configuraci칩n de Wrangler. Por defecto, Astro espera que el enlace KV se llame `SESSION`, pero puedes elegir un nombre diferente si prefieres estableciendo la opci칩n [`sessionKVBindingName`](#sessionkvbindingname) en la configuraci칩n del adaptador.

<Steps>

1. Crea un namespace KV usando el CLI de Wrangler y toma nota del ID del nuevo namespace:

   ```sh
   npx wrangler kv namespace create "SESSION"
   ```

2. Declara el namespace KV en tu configuraci칩n de Wrangler, estableciendo el ID del namespace al devuelto por el comando anterior:

    <Tabs>
      <TabItem label="wrangler.json">
        ```json title="wrangler.json" "<KV_NAMESPACE_ID>"
        {
          "kv_namespaces": [
            {
              "binding": "SESSION",
              "id": "<KV_NAMESPACE_ID>"
            }
          ]
        }
        ```
      </TabItem>
      <TabItem label="wrangler.toml">
        ```toml title="wrangler.toml" "<KV_NAMESPACE_ID>"
        kv_namespaces = [
          { binding = "SESSION", id = "<KV_NAMESPACE_ID>" }
        ]
        ```
      </TabItem>
    </Tabs>

3. Entonces puedes usar sesiones en tu c칩digo del servidor:

    ```astro title="src/components/CartButton.astro" "Astro.session?.get('cart')"
    ---
    export const prerender = false;
    const cart = await Astro.session?.get('cart');
    ---

    <a href="/checkout">游 {cart?.length ?? 0} items</a>
    ```

</Steps>

:::note
Las escrituras a Cloudflare KV son [eventualmente consistentes](https://developers.cloudflare.com/kv/concepts/how-kv-works/#consistency) entre regiones. Esto significa que los cambios est치n disponibles inmediatamente dentro de la misma regi칩n pero pueden tomar hasta 60 segundos para propagarse globalmente. Esto no afectar치 a la mayor칤a de usuarios ya que es poco probable que cambien de regi칩n entre solicitudes, pero puede ser una consideraci칩n para algunos casos de uso, como usuarios de VPN.
:::


## Importaciones de M칩dulos de Cloudflare

El runtime `workerd` de Cloudflare soporta importaciones de algunos [tipos de m칩dulos no est치ndar](https://developers.cloudflare.com/workers/wrangler/bundling/#including-non-javascript-modules). La mayor칤a de tipos de archivos adicionales tambi칠n est치n disponibles en Astro:

- `.wasm` o `.wasm?module`: exporta un [`WebAssembly.Module`](https://developer.mozilla.org/en-US/docs/WebAssembly/JavaScript_interface/Module) que puede ser instanciado
- `.bin`: exporta un [`ArrayBuffer`](https://developer.mozilla.org/es/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer) del contenido binario crudo del archivo
- `.txt`: exporta una cadena del contenido del archivo

Todos los tipos de m칩dulos exportan un 칰nico valor por defecto. Los m칩dulos pueden ser importados tanto desde p치ginas renderizadas del lado del servidor, como desde p치ginas pre-renderizadas para generaci칩n de sitios est치ticos.

Lo siguiente es un ejemplo de importar un m칩dulo Wasm que luego responde a solicitudes sumando los par치metros num칠ricos de la solicitud.

```js title="pages/add/[a]/[b].js"
// Importando el m칩dulo WebAssembly
import mod from '../util/add.wasm';

// Instanciar primero para poder usarlo
const addModule: any = new WebAssembly.Instance(mod);

export async function GET(context) {
  const a = Number.parseInt(context.params.a);
  const b = Number.parseInt(context.params.b);
  return new Response(`${addModule.exports.add(a, b)}`);
}
```

Aunque este ejemplo es trivial, Wasm puede ser usado para acelerar operaciones computacionalmente intensivas que no involucran I/O significativo como incrustar una biblioteca de procesamiento de im치genes, o incrustar una peque침a base de datos pre-indexada para b칰squeda sobre un conjunto de datos de solo lectura.

## Compatibilidad con Node.js

Por defecto, Cloudflare no soporta las APIs del runtime de Node.js. Con algo de configuraci칩n, Cloudflare s칤 soporta un subconjunto de las APIs del runtime de Node.js. Puedes encontrar las APIs del runtime de Node.js soportadas en la [documentaci칩n](https://developers.cloudflare.com/workers/runtime-apis/nodejs) de Cloudflare.

Para usar estas APIs, tu p치gina o endpoint debe ser renderizado del lado del servidor (no pre-renderizado) y debe usar la sintaxis de importaci칩n `import {} from 'node:*'`.

```js title="pages/api/endpoint.js"
export const prerender = false;
import { Buffer } from 'node:buffer';
```

Tambi칠n necesitar치s modificar la configuraci칩n de `vite` en tu configuraci칩n de Astro para permitir la sintaxis de importaci칩n `node:*`:

```js title="astro.config.mjs" ins={6-10}
import {defineConfig} from "astro/config";
import cloudflare from '@astrojs/cloudflare';

export default defineConfig({
  adapter: cloudflare({}),
  vite: {
		ssr: {
			external: ['node:buffer'],
		},
	},
})
```

Adicionalmente, necesitar치s seguir la documentaci칩n de Cloudflare sobre c칩mo habilitar el soporte. Para una gu칤a detallada, por favor consulta la [documentaci칩n de Cloudflare sobre habilitar la compatibilidad con Node.js](https://developers.cloudflare.com/workers/runtime-apis/nodejs/).

:::note[Implicaciones de Compatibilidad de Paquetes]
Si un proyecto importa un paquete al servidor que usa las APIs del runtime de Node.js, esto puede causar problemas al desplegar en Cloudflare. Este problema surge con paquetes que no usan la sintaxis de importaci칩n `node:*`. Se recomienda que contactes a los autores del paquete para determinar si el paquete soporta la sintaxis de importaci칩n mencionada. Si el paquete no soporta esto, puede que necesites usar un paquete diferente.
:::

## Vista previa con Wrangler

Para usar [`wrangler`](https://developers.cloudflare.com/workers/wrangler/) para ejecutar tu aplicaci칩n localmente, actualiza el script de vista previa.

Para Workers:

```json title="package.json"
"preview": "wrangler dev ./dist"
```

Para Pages:

```json title="package.json"
"preview": "wrangler pages dev ./dist"
```

Desarrollar con [`wrangler`](https://developers.cloudflare.com/workers/wrangler/) te da acceso a [enlaces de Cloudflare](https://developers.cloudflare.com/pages/platform/functions/bindings), [variables de entorno](https://developers.cloudflare.com/pages/platform/functions/bindings/#environment-variables), y el [objeto cf](https://developers.cloudflare.com/workers/runtime-apis/request/#incomingrequestcfproperties). Hacer que la recarga en caliente del servidor de desarrollo de Astro funcione con Wrangler podr칤a requerir una configuraci칩n personalizada. Consulta [ejemplos de la comunidad](https://github.com/withastro/roadmap/discussions/590).

### Mensajes de error significativos

Actualmente, los errores durante la ejecuci칩n de tu aplicaci칩n en Wrangler no son muy 칰tiles, debido a la minificaci칩n de tu c칩digo. Para una mejor depuraci칩n, puedes agregar la configuraci칩n `vite.build.minify = false` a tu `astro.config.mjs`.

```js title="astro.config.mjs" ins={3-7}
export default defineConfig({
  adapter: cloudflare(),
  vite: {
    build: {
      minify: false,
    },
  },
});
```

[astro-integration]: /es/guides/integrations-guide/
