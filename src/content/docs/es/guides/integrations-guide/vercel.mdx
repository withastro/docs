---
type: integration
title: '@astrojs/vercel'
description: Aprende como usar el adaptador SSR @astrojs/vercel para desplegar tu proyecto de Astro.
githubURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/vercel/'
hasREADME: true
category: adapter
i18nReady: true
---

import Video from '~/components/Video.astro';

Este adaptador permite que Astro despliegue tu proyecto usando redenrizado en el servidor (SSR) en [Vercel](https://www.vercel.com/).

Aprende como desplegar tu proyecto de Astro consultando nuestra [gu칤a de despliegue en Vercel](/es/guides/deploy/vercel/).

## 쯇or qu칠 Astro Vercel?

Si est치s usando Astro como un generador de sitios est치ticos no necesitas un adaptador.

Si deseas [usar renderizado del lado del servidor (SSR)](/es/guides/server-side-rendering/), Astro requiere un adaptador que coincida con el runtime de tu despliegue.

[Vercel](https://www.vercel.com/) es una plataforma de despliegue que te permite alojar tu proyecto conect치ndote directamente a tu repositorio de GitHub. Este adaptador ajusta el proceso de compilaci칩n de Astro para preparar tu proyecto para el despliegue a trav칠s de Vercel.

## Instalaci칩n

Agrega el adaptador Vercel para habilitar SSR en tu proyecto de Astro con el comando `astro add`. Esto instalar치 el adaptador y realizar치 los cambios apropiados en tu archivo `astro.config.mjs` en un solo paso.

```sh
# Usando NPM
npx astro add vercel
# Usando Yarn
yarn astro add vercel
# Usando PNPM
pnpm astro add vercel
```

### A침adir dependencias manualmente

Si prefieres instalar el adaptador manualmente, completa los siguientes dos pasos:

1. Instala el adaptador Vercel en las dependencias de tu proyecto usando tu administrador de paquetes preferido. Si est치s usando npm o no est치s seguro, ejecuta esto en la terminal:

    ```bash
      npm install @astrojs/vercel
    ```

2.  Agrega dos nuevas l칤neas a tu archivo de configuraci칩n de proyecto `astro.config.mjs`.

    ```js ins={3, 6-7}
    // astro.config.mjs
    import { defineConfig } from 'astro/config';
    import vercel from '@astrojs/vercel/serverless';

    export default defineConfig({
      output: 'server',
      adapter: vercel(),
    });
    ```

### Objetivos

Puedes desplegar en diferentes objetivos:

*   `serverless`: SSR dentro de una [funci칩n Node.js](https://vercel.com/docs/concepts/functions/serverless-functions).
*   `static`: genera un sitio est치tico siguiendo los formatos de salida, redirecciones, etc. de Vercel.

Puedes cambiar el destino modificando la importaci칩n:


```js
import vercel from '@astrojs/vercel/serverless';
import vercel from '@astrojs/vercel/static';
```

## Uso

游닄 **[Lee la gu칤a completa para despliegue aqu칤.](/es/guides/deploy/vercel/)**

Puedes desplegar por CLI (`vercel deploy`) o conectando tu nuevo repositorio en el [Panel de Vercel](https://vercel.com/). Alternativamente, puedes crear un build de producci칩n localmente:

```sh
astro build
vercel deploy --prebuilt
```

## Configuraci칩n

Para configurar este adaptador, pasa un objeto a la invocaci칩n de funci칩n `vercel()` en `astro.config.mjs`:

### analytics

**Tipo:** `boolean`<br/>
**Disponible para:** Serverless y Static<br/>
**Agregado en:** `@astrojs/vercel@3.1.0`

Puedes habilitar [Vercel Analytics](https://vercel.com/analytics) (incluyendo Web Vitals y Audiences) configurando `analytics: true`. Esto inyectar치 los scripts de seguimiento de Vercel en todas tus p치ginas.

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  output: 'server',
  adapter: vercel({
    analytics: true,
  }),
});
```

### imagesConfig

**Tipo:** `VercelImageConfig`<br/>
**Disponible para:** Serverless, Static
**Agregado en:** `@astrojs/vercel@3.3.0`

Opciones de configuraci칩n para la [API de Optimizaci칩n de Im치genes de Vercel](https://vercel.com/docs/concepts/image-optimization). Consulta la [documentaci칩n de configuraci칩n de im치genes de Vercel](https://vercel.com/docs/build-output-api/v3/configuration#images) para obtener una lista completa de los par치metros admitidos.

Las propiedades `domains` y `remotePatterns` se llenar치n autom치ticamente utilizando [la configuraci칩n correspondiente de `image` en Astro](/es/reference/configuration-reference/#opciones-de-imagen).

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/static';
export default defineConfig({
  output: 'server',
  adapter: vercel({
    imagesConfig: {
      sizes: [320, 640, 1280],
    },
  }),
});
```

### imageService

**Tipo:** `boolean`<br/>
**Disponible para:** Serverless y Static
**Agregado en:** `@astrojs/vercel@3.3.0`

Cuando est치 habilitado, se configurar치 y utilizar치 autom치ticamente un [Servicio de Im치genes](/es/reference/image-service-reference/) impulsado por la API de Optimizaci칩n de Im치genes de Vercel en producci칩n. En desarrollo, se utilizar치 en su lugar un servicio incorporado basado en Squoosh.

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/static';
export default defineConfig({
  output: 'server',
  adapter: vercel({
    imageService: true,
  }),
});
```

```astro
---
import { Image } from 'astro:assets';
import astroLogo from ''../assets/logo.png';
---
<!-- Este componente -->
<Image src={astroLogo} alt="My super logo!" />
<!-- se convertir치 en el siguiente elemento de HTML -->
<img
  src="/_vercel/image?url=_astro/logo.hash.png&w=...&q=..."
  alt="Mi super logo!"
  loading="lazy"
  decoding="async"
  width="..."
  height="..."
/>
```

### includeFiles

**Tipo:** `string[]`<br/>
**Disponible para:** Serverless

Usa esta propiedad para forzar a que los archivos se incluyan en el empaquetado de tu funci칩n. Esto es 칰til cuando notas que faltan archivos.

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  output: 'server',
  adapter: vercel({
    includeFiles: ['./my-data.json'],
  }),
});
```

### excludeFiles

**Tipo:** `string[]`<br/>
**Disponible para:** Serverless

Utiliza esta propiedad para excluir cualquier archivo del proceso de empaquetado que de otra manera se incluir칤a.

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  output: 'server',
  adapter: vercel({
    excludeFiles: ['./src/some_big_file.jpg'],
  }),
});
```

### Configuraci칩n de agrupaci칩n de funciones

El adaptador de Vercel divide las compilaciones en una funci칩n separada por ruta de forma predeterminada. Esto ayuda a reducir el tama침o de cada funci칩n, ya que solo agrupa el c칩digo utilizado en esa p치gina.

Puedes desactivar esto y compilar en una 칰nica funci칩n configurando la opci칩n de configuraci칩n `functionPerRoute` en `false`:

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel/serverless';

export default defineConfig({
  output: 'server',
  adapter: vercel({
    functionPerRoute: false,
  }),
});
```

### Middleware de Vercel Edge

Puedes usar el middleware de Vercel Edge para interceptar una solicitud y redirigirla antes de enviar una respuesta. El middleware de Vercel puede ejecutarse en implementaciones de Edge, SSR y est치ticas. Es posible que no necesites instalar este paquete para tu middleware. `@vercel/edge` es solo necesario para usar algunas usar algunas caracter칤sticas de middleware como la geolocalizaci칩n. Para obtener m치s informaci칩n, consulta la [documentaci칩n de middleware de Vercel](https://vercel.com/docs/concepts/functions/edge-middleware).

1.  Agrega un archivo `middleware.js` en la ra칤z de tu proyecto:

    ```js
    // middleware.js
    export const config = {
      // Solo ejecuta el middleware en la ruta admin
      matcher: '/admin',
    };

    export default function middleware(request) {
      const url = new URL(request.url);
      // Puedes recuperar la ubicaci칩n IP o las cookies aqu칤.
      if (url.pathname === '/admin') {
        url.pathname = '/'
      }
      return Response.redirect(url);
    }
    ```

2.  Mientras desarrollas localmente, puedes ejecutar `vercel dev` para ejecutar el middleware. En producci칩n, Vercel lo manejar치 por ti.

:::caution
**쯀ntentando reescribir?** Actualmente, reescribir una solicitud con middleware solo funciona para archivos est치ticos.
:::

### Middleware de Vercel Edge con middleware de Astro

El adaptador `@astrojs/vercel/serverless` puede crear autom치ticamente el middleware de Vercel Edge a partir de un middleware de Astro en tu c칩digo base.

Esto es una caracter칤stica opcional, y la opci칩n `edgeMiddleware` debe establecerse en `true`:

```js
// astro.config.mjs
import { defineConfig } from 'astro/config';
import vercel from '@astrojs/vercel';
export default defineConfig({
  output: 'server',
  adapter: vercel({
    edgeMiddleware: true,
  }),
});
```

Opcionalmente, puedes crear un archivo reconocido por el adaptador llamado `vercel-edge-middleware.(js|ts)` en la carpeta [`srcDir`](/es/reference/configuration-reference/#srcdir) para crear [`Astro.locals`](/es/reference/api-reference/#astrolocals).

Escribir requiere el paquete [`@vercel/edge`](https://www.npmjs.com/package/@vercel/edge)

```js
// src/vercel-edge-middleware.js
/**
 *
 * @param options.request {Request}
 * @param options.context {import("@vercel/edge").RequestContext}
 * @returns {object}
 */
export default function ({ request, context }) {
  // haz algo con la solicitud y el contexto
  return {
    title: "Blog de Spiderman",
  };
}
```

Si usas TypeScript, puedes escribir la funci칩n de la siguiente manera:

```ts
// src/vercel-edge-middleware.ts
import type { RequestContext } from '@vercel/edge';

export default function ({ request, context }: { request: Request; context: RequestContext }) {
  // haz algo con la solicitud y el contexto
  return {
    title: "Blog de Spiderman",
  };
}
```

La informaci칩n devuelta por esta funci칩n se pasar치 al middleware de Astro.

La funci칩n:

*   debe exportar una funci칩n **predeterminada**;
*   debe **regresar** un `object`;
*   acepta un objeto con una `request` y `context` como propiedades;
*   `request` es tipada como [`Request`](https://developer.mozilla.org/es/docs/Web/API/Request);
*   `context` es tipado como [`RequestContext`](https://vercel.com/docs/concepts/functions/edge-functions/vercel-edge-package#requestcontext);

#### Limitaciones y restricciones

Cuando optes por esta caracter칤stica, hay algunas restricciones a tener en cuenta:

*   El middleware de Vercel Edge ser치 siempre la **primera** funci칩n en recibir la `Request` y la 칰ltima funci칩n en recibir la `Response`. Esta es una restricci칩n arquitect칩nica que sigue los [l칤mites establecidos por Vercel](https://vercel.com/docs/concepts/functions/edge-middleware).
*   Solo `request` y `context` se pueden usar para producir un objeto `Astro.locals`. Las operaciones como redireccionamientos, etc. deben delegarse al middleware de Astro.
*   `Astro.locals` **debe ser serializable**. Si no lo haces, se producir치 un **error de runtime**. Esto significa que **no puedes** almacenar tipos complejos como `Map`, `function`, `Set`, etc.

## Soluci칩n de problemas

**Un par de paquetes conocidos por ser complejos (por ejemplo: [puppeteer](https://github.com/puppeteer/puppeteer)) no admiten el empaquetado y, por lo tanto, no funcionar치n correctamente con este adaptador.** Por defecto, Vercel no incluye los archivos y paquetes instalados de npm de la carpeta `./node_modules` de tu proyecto. Para solucionar esto, el adaptador `@astrojs/vercel` empaqueta autom치ticamente la salida final de la compilaci칩n usando `esbuild`.

Para obtener ayuda, consulta el canal `#support` en [Discord](https://astro.build/chat). 춰Nuestros amables miembros del equipo de soporte est치n aqu칤 para ayudarte!

## Contribuyendo

Este paquete es mantenido por el equipo de Astro. 춰Est치s invitado a enviar un problema o PR!

## Changelog

Consulta el [CHANGELOG.md](https://github.com/withastro/astro/tree/main/packages/integrations/vercel/CHANGELOG.md) para ver el historial de cambios en esta integraci칩n.

[astro-integration]: /es/guides/integrations-guide/
