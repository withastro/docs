---
title: 'Astro DB'
description: Aprende a usar Astro DB, una base de datos SQL completamente gestionada dise帽ada exclusivamente para Astro.
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/db/'
i18nReady: true
---
import { FileTree } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { Steps } from '@astrojs/starlight/components';

Astro DB es una base de datos SQL completamente gestionada dise帽ada para el ecosistema de Astro. Desarrolla localmente en Astro y despliega en cualquier base de datos compatible con libSQL.

Astro DB es una soluci贸n completa para configurar, desarrollar y consultar tus datos. Una base de datos local se crea en `.astro/content.db` cada vez que ejecutas `astro dev` para gestionar tus datos sin necesidad de Docker o una conexi贸n de red.

## Instalaci贸n

Instala la integraci贸n [`@astrojs/db`](/es/guides/integrations-guide/db/) usando el comando incorporado `astro add`:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add db
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add db
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add db
  ```
  </Fragment>
</PackageManagerTabs>

## Define tu base de datos

Instalar `@astrojs/db` con el comando `astro add` crear谩 autom谩ticamente un archivo `db/config.ts` en tu proyecto donde definir谩s las tablas de tu base de datos:

```ts title="db/config.ts"
import { defineDb } from 'astro:db';

export default defineDb({
  tables: { },
})
```

### Tablas

Los datos en Astro DB se almacenan usando tablas SQL. Las tablas estructuran tus datos en filas y columnas, donde las columnas hacen cumplir el tipo de cada valor de fila.

Define tus tablas en tu archivo `db/config.ts` proporcionando la estructura de los datos en tu base de datos libSQL existente, o los datos que recopilar谩s en una nueva base de datos. Esto permitir谩 a Astro generar una interfaz de TypeScript para consultar esa tabla desde tu proyecto. El resultado es soporte completo de TypeScript cuando accedes a tus datos con autocompletado de propiedades y verificaci贸n de tipos.

Para configurar una tabla de base de datos, importa y usa las utilidades `defineTable()` y `column` desde `astro:db`. Luego, define un nombre (sensible a may煤sculas) para tu tabla y el tipo de datos en cada columna.

Este ejemplo configura una tabla `Comment` con columnas de texto obligatorias para `author` y `body`. Luego, la hace disponible para tu proyecto a trav茅s de la exportaci贸n `defineDb()`.

```ts title="db/config.ts" "Comment"
import { defineDb, defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
})

export default defineDb({
  tables: { Comment },
})
```

<ReadMore>Consulta la [referencia de configuraci贸n de tablas](/es/guides/integrations-guide/db/#table-configuration-reference) para una referencia completa de las opciones de tabla.</ReadMore>

### Columnas

Astro DB admite los siguientes tipos de columna:

```ts title="db/config.ts" "column.text()" "column.number()" "column.boolean()" "column.date()" "column.json()"
import { defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    // Una cadena de texto.
    author: column.text(),
    // Un valor entero completo.
    likes: column.number(),
    // Un valor verdadero o falso.
    flagged: column.boolean(),
    // Valores de fecha/hora consultados como objetos Date de JavaScript.
    published: column.date(),
    // Un objeto JSON sin tipo.
    metadata: column.json(),
  }
});
```

<ReadMore>Consulta la [referencia de columnas de tabla](/es/guides/integrations-guide/db/#table-configuration-reference) para m谩s detalles.</ReadMore>

### Referencias de Tabla

Las relaciones entre tablas son un patr贸n com煤n en el dise帽o de bases de datos. Por ejemplo, una tabla `Blog` puede estar estrechamente relacionada con otras tablas de `Comment`, `Author` y `Category`.

Puedes definir estas relaciones entre tablas y guardarlas en tu esquema de base de datos usando **columnas de referencia**. Para establecer una relaci贸n, necesitar谩s:

- Una **columna identificadora** en la tabla referenciada. Suele ser una columna `id` con la propiedad `primaryKey`.
- Una columna en la tabla base para **almacenar el `id` referenciado**. Esto usa la propiedad `references` para establecer una relaci贸n.

Este ejemplo muestra una columna `authorId` de la tabla `Comment` que referencia una columna `id` de la tabla `Author`.

```ts title="db/config.ts" {3, 10}
const Author = defineTable({
  columns: {
    id: column.number({ primaryKey: true }),
    name: column.text(),
  }
});

const Comment = defineTable({
  columns: {
    authorId: column.number({ references: () => Author.columns.id }),
    body: column.text(),
  }
});
```

## Sembrar tu base de datos para desarrollo

En desarrollo, Astro usar谩 tu configuraci贸n de DB para generar tipos locales seg煤n tus esquemas. Estos se generar谩n de nuevo desde tu archivo de semilla cada vez que se inicie el servidor de desarrollo, y te permitir谩n consultar y trabajar con la forma de tus datos con seguridad de tipos y autocompletado.

No tendr谩s acceso a datos de producci贸n durante el desarrollo a menos que [te conectes a una base de datos remota](#conectando-a-bases-de-datos-remotas) durante el desarrollo. Esto protege tus datos mientras te permite probar y desarrollar con una base de datos funcional con seguridad de tipos.

Para sembrar datos de desarrollo para pruebas y depuraci贸n en tu proyecto de Astro, crea un archivo `db/seed.ts`. Importa tanto el objeto `db` como tus tablas definidas en `astro:db`. `inserta` algunos datos iniciales en cada tabla. Estos datos de desarrollo deben coincidir con la forma de tu esquema de base de datos y de los datos de producci贸n.

El siguiente ejemplo define dos filas de datos de desarrollo para una tabla `Comment` y una tabla `Author`:

```ts title="db/seed.ts"
import { db, Comment, Author } from 'astro:db';

export default async function() {
  await db.insert(Author).values([
    { id: 1, name: "Kasim" },
    { id: 2, name: "Mina" },
  ]);

  await db.insert(Comment).values([
    { authorId: 1, body: '隆Espero que te guste Astro DB!' },
    { authorId: 2, body: '隆Disfr煤talo!'},
  ])
}
```

Tu servidor de desarrollo reiniciar谩 autom谩ticamente tu base de datos cada vez que este archivo cambie, regenerando tus tipos y sembrando estos datos de desarrollo desde `seed.ts` de nuevo cada vez.

## Conecta una base de datos libSQL para producci贸n

Astro DB puede conectarse a cualquier base de datos libSQL local o a cualquier servidor que exponga el protocolo remoto de libSQL, ya sea gestionado o autoalojado.

Para conectar Astro DB a una base de datos libSQL, establece las siguientes variables de entorno obtenidas de tu proveedor de base de datos:

- `ASTRO_DB_REMOTE_URL`: la URL de conexi贸n a la ubicaci贸n de tu base de datos libSQL local o remota. Esto puede incluir [opciones de configuraci贸n de URL](#opciones-de-configuraci贸n-de-url-remota) como sincronizaci贸n y cifrado como par谩metros.
- `ASTRO_DB_APP_TOKEN`: el token de autenticaci贸n para tu servidor libSQL. Esto es obligatorio para bases de datos remotas, y no es necesario para [bases de datos locales como archivos o en memoria](#esquema-de-url-y-host)

Dependiendo de tu servicio, puedes tener acceso a una CLI o interfaz web para recuperar estos valores. La siguiente secci贸n demostrar谩 conectarse a Turso y establecer estos valores como ejemplo, pero eres libre de usar cualquier proveedor.

### Comenzando con Turso

Turso es la empresa detr谩s de [libSQL](https://github.com/tursodatabase/libsql), el fork de c贸digo abierto de SQLite que impulsa Astro DB. Proporcionan una plataforma de base de datos libSQL completamente gestionada y son totalmente compatibles con Astro.

Los pasos a continuaci贸n te guiar谩n a trav茅s del proceso de instalar la CLI de Turso, iniciar sesi贸n (o registrarte), crear una nueva base de datos, obtener las variables de entorno requeridas y empujar el esquema a la base de datos remota.

<Steps>

1. Instala la [CLI de Turso](https://docs.turso.tech/cli/installation).

2. [Inicia sesi贸n o reg铆strate](https://docs.turso.tech/cli/authentication) en Turso.

3. Crea una nueva base de datos. En este ejemplo el nombre de la base de datos es `andromeda`.

   ```sh "andromeda"
   turso db create andromeda
   ```

4. Ejecuta el comando `show` para ver informaci贸n sobre la base de datos reci茅n creada:

   ```sh "andromeda"
   turso db show andromeda
   ```

   Copia el valor `URL` y establ茅celo como el valor para `ASTRO_DB_REMOTE_URL`.
   

   ```dotenv title=".env" "libsql://andromeda-houston.turso.io"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ```

5. Crea un nuevo token para autenticar las solicitudes a la base de datos:

   ```sh "andromeda"
   turso db tokens create andromeda
   ```

   Copia la salida del comando y establ茅celo como el valor para `ASTRO_DB_APP_TOKEN`.

   ```dotenv title=".env" add={2} "eyJhbGciOiJF...3ahJpTkKDw"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ASTRO_DB_APP_TOKEN=eyJhbGciOiJF...3ahJpTkKDw
   ```

6. Empuja tu esquema de DB y metadatos a la nueva base de datos de Turso.

   ```sh
   astro db push --remote
   ```

7. 隆Felicidades, ahora tienes una base de datos conectada! Date un descanso. 

   ```sh
   turso relax
   ```

</Steps>

Para explorar m谩s caracter铆sticas de Turso, consulta la [documentaci贸n de Turso](https://docs.turso.tech).

### Conectando a bases de datos remotas

Astro DB te permite conectarte tanto a bases de datos locales como remotas. Por defecto, Astro usa un archivo de base de datos local para los comandos `dev` y `build`, recreando tablas e insertando datos de semilla de desarrollo cada vez.

Para conectarte a una base de datos remota alojada, usa la bandera `--remote`. Esta bandera habilita tanto acceso de lectura como escritura a tu base de datos remota, permiti茅ndote [aceptar y persistir datos de usuarios](#insertar) en entornos de producci贸n.

Configura tu comando de construcci贸n para usar la bandera `--remote`:

```json title="package.json" "--remote"
{
  "scripts": {
    "build": "astro build --remote"
  }
}
```

Tambi茅n puedes usar la bandera directamente en la l铆nea de comandos:

```bash
# Construir con una conexi贸n remota
astro build --remote

# Desarrollar con una conexi贸n remota
astro dev --remote
```

:::caution
Ten cuidado al usar `--remote` en desarrollo. Esto se conecta a tu base de datos de producci贸n en vivo, y todos los cambios (inserciones, actualizaciones, eliminaciones) persistir谩n.
:::

La bandera `--remote` usa la conexi贸n a la base de datos remota tanto localmente durante la construcci贸n como en el servidor. Aseg煤rate de establecer las variables de entorno necesarias tanto en tu entorno de desarrollo local como en tu plataforma de despliegue. Adem谩s, es posible que necesites [configurar el modo web](/es/guides/integrations-guide/db/#mode) para entornos de ejecuci贸n que no sean Node.js, como Cloudflare Workers o Deno.

Al desplegar tu proyecto de Astro DB, aseg煤rate de que el comando de construcci贸n de tu plataforma de despliegue est茅 configurado como `npm run build` (o el equivalente para tu gestor de paquetes) para utilizar la bandera `--remote` configurada en tu `package.json`.

### Opciones de configuraci贸n de URL remota

La variable de entorno `ASTRO_DB_REMOTE_URL` configura la ubicaci贸n de tu base de datos, as铆 como otras opciones como sincronizaci贸n y cifrado.

#### Esquema de URL y host

libSQL admite tanto HTTP como WebSockets como protocolo de transporte para un servidor remoto. Tambi茅n admite usar un archivo local o una base de datos en memoria. Estos se pueden configurar usando los siguientes esquemas de URL en la URL de conexi贸n:

- `memory:` usar谩 una base de datos en memoria. El host debe estar vac铆o en este caso.
- `file:` usar谩 un archivo local. El host es la ruta al archivo (`file:path/to/file.db`).
- `libsql:` usar谩 un servidor remoto a trav茅s del protocolo preferido por la biblioteca (esto puede variar entre versiones). El host es la direcci贸n del servidor (`libsql://your.server.io`).
- `http:` usar谩 un servidor remoto a trav茅s de HTTP. Se puede usar `https:` para habilitar una conexi贸n segura. El host es el mismo que para `libsql:`.
- `ws:` usar谩 un servidor remoto a trav茅s de WebSockets. Se puede usar `wss:` para habilitar una conexi贸n segura. El host es el mismo que para `libsql:`.

Los detalles de la conexi贸n libSQL (por ejemplo, clave de cifrado, replicaci贸n, intervalo de sincronizaci贸n) se pueden configurar como par谩metros de consulta en la URL de conexi贸n remota.

Por ejemplo, para tener un archivo local cifrado que funcione como una r茅plica embebida de un servidor libSQL, puedes establecer las siguientes variables de entorno:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file://local-copy.db?encryptionKey=your-encryption-key&syncInterval=60&syncUrl=libsql%3A%2F%2Fyour.server.io
ASTRO_DB_APP_TOKEN=token-to-your-remote-url
```

:::caution
Usar un archivo de base de datos es una caracter铆stica avanzada, y se debe tener cuidado al desplegar para evitar sobrescribir tu base de datos y perder tus datos de producci贸n.

Adem谩s, este m茅todo no funcionar谩 en despliegues sin servidor (serverless), ya que el sistema de archivos no persiste en esos entornos.
:::

#### `encryptionKey`

libSQL tiene soporte nativo para bases de datos cifradas. Pasar este par谩metro de b煤squeda habilitar谩 el cifrado usando la clave dada:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file:path/to/file.db?encryptionKey=your-encryption-key
```

#### `syncUrl`

Las r茅plicas embebidas son una caracter铆stica de los clientes libSQL que crea una copia completamente sincronizada de tu base de datos en un archivo local o en memoria para lecturas ultrarr谩pidas. Las escrituras se env铆an a una base de datos remota definida en `syncUrl` y se sincronizan con la copia local.

Usa esta propiedad para pasar una URL de conexi贸n separada para convertir la base de datos en una r茅plica embebida de otra base de datos. Esto solo debe usarse con los esquemas `file:` y `memory:`. El par谩metro debe estar codificado en URL.

Por ejemplo, para tener una r茅plica embebida en memoria de una base de datos en `libsql://your.server.io`, puedes establecer la URL de conexi贸n as铆:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io
```

#### `syncInterval`

Intervalo entre sincronizaciones de r茅plicas embebidas en segundos. Por defecto solo se sincroniza al inicio y despu茅s de escrituras.

Esta propiedad solo se usa cuando `syncUrl` tambi茅n est谩 establecida. Por ejemplo, para establecer una r茅plica embebida en memoria que se sincronice cada minuto, establece la siguiente variable de entorno:

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io&syncInterval=60
```

## Consulta tu base de datos

Puedes consultar tu base de datos desde cualquier [p谩gina de Astro](/es/basics/astro-pages/#p谩ginas-de-astro), [endpoint](/es/guides/endpoints/), o [acci贸n](/es/guides/actions/) en tu proyecto usando el ORM `db` y el constructor de consultas proporcionados.

### Drizzle ORM

```ts
import { db } from 'astro:db';
```

Astro DB incluye un cliente [Drizzle ORM](https://orm.drizzle.team/) incorporado. No se requiere configuraci贸n o configuraci贸n manual para usar el cliente. El cliente `db` de Astro DB se configura autom谩ticamente para comunicarse con tu base de datos (local o remota) cuando ejecutas Astro. Usa tu definici贸n exacta de esquema de base de datos para consultas SQL con seguridad de tipos con errores de TypeScript cuando haces referencia a una columna o tabla que no existe.

### Seleccionar 

El siguiente ejemplo selecciona todas las filas de una tabla `Comment`. Esto devuelve el arreglo completo de datos de desarrollo sembrados desde `db/seed.ts` que luego est谩 disponible para usar en tu plantilla de p谩gina:

```astro title="src/pages/index.astro"
---
import { db, Comment } from 'astro:db';

const comments = await db.select().from(Comment);
---

<h2>Comentarios</h2>

{
  comments.map(({ author, body }) => (
    <article>
      <p>Autor: {author}</p>
      <p>{body}</p>
    </article>
  ))
}
```

<ReadMore>Consulta la [referencia de la API `select()` de Drizzle](https://orm.drizzle.team/docs/select) para una descripci贸n completa.</ReadMore>

### Insertar

Para aceptar entrada de usuario, como manejar solicitudes de formularios e insertar datos en tu base de datos remota alojada, configura tu proyecto de Astro para [renderizado bajo demanda](/es/guides/on-demand-rendering/) y [agrega un adaptador](/es/guides/on-demand-rendering/#agrega-un-adaptador) para tu entorno de despliegue.

Este ejemplo inserta una fila en una tabla `Comment` basada en una solicitud POST de formulario analizada:

```astro
---
// src/pages/index.astro
import { db, Comment } from 'astro:db';

if (Astro.request.method === 'POST') {
  // Analiza los datos del formulario
  const formData = await Astro.request.formData();
  const author = formData.get('author');
  const body = formData.get('body');
  if (typeof author === 'string' && typeof body === 'string') {
    // Inserta los datos del formulario en la tabla Comment
    await db.insert(Comment).values({ author, body });
  }
}

// Renderiza la nueva lista de comentarios en cada solicitud
const comments = await db.select().from(Comment);
---

<form method="POST" style="display: grid">
	<label for="author">Autor</label>
	<input id="author" name="author" />

	<label for="body">Cuerpo</label>
	<textarea id="body" name="body"></textarea>

	<button type="submit">Enviar</button>
</form>

<!-- Renderiza `comments` -->
```

Tambi茅n puedes usar [acciones de Astro](/es/guides/actions/) para insertar datos en una tabla de Astro DB. El siguiente ejemplo inserta una fila en una tabla `Comment` usando una acci贸n:

```ts
// src/actions/index.ts
import { db, Comment } from 'astro:db';
import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';

export const server = {
  addComment: defineAction({
    // Las acciones incluyen seguridad de tipos con Zod, eliminando la necesidad
    // de verificar si typeof {valor} === 'string' en tus p谩ginas
    input: z.object({
      author: z.string(),
      body: z.string(),
    }),
    handler: async (input) => {
      const updatedComments = await db
        .insert(Comment)
        .values(input)
        .returning(); // Devuelve los comentarios actualizados
      return updatedComments;
    },
  }),
};
```

<ReadMore>

Consulta la [referencia de la API `insert()` de Drizzle](https://orm.drizzle.team/docs/insert) para una descripci贸n completa.

</ReadMore>

### Eliminar

Tambi茅n puedes consultar tu base de datos desde un endpoint de API. Este ejemplo elimina una fila de una tabla `Comment` por el par谩metro `id`:

```ts
// src/pages/api/comments/[id].ts
import type { APIRoute } from "astro";
import { db, Comment, eq } from 'astro:db';

export const DELETE: APIRoute = async (ctx) => {
  await db.delete(Comment).where(eq(Comment.id, ctx.params.id ));
  return new Response(null, { status: 204 });
}
```

<ReadMore>

Consulta la [referencia de la API `delete()` de Drizzle](https://orm.drizzle.team/docs/delete) para una descripci贸n completa.

</ReadMore>

### Filtrado

Para consultar resultados de tabla por una propiedad espec铆fica, usa [opciones de Drizzle para selecciones parciales](https://orm.drizzle.team/docs/select#partial-select). Por ejemplo, agrega [una llamada `.where()`](https://orm.drizzle.team/docs/select#filtering) a tu consulta `select()` y pasa la comparaci贸n que quieres hacer.

El siguiente ejemplo consulta todas las filas en una tabla `Comment` que contengan la frase "Astro DB". Usa [el operador `like()`](https://orm.drizzle.team/docs/operators#like) para verificar si una frase est谩 presente dentro del `body`:


```astro title="src/pages/index.astro"
---
import { db, Comment, like } from 'astro:db';

const comments = await db.select().from(Comment).where(
    like(Comment.body, '%Astro DB%')
);
---
```

### Utilidades de Drizzle

Todas las utilidades de Drizzle para construir consultas est谩n expuestas desde el m贸dulo `astro:db`. Esto incluye:

- [Operadores de filtro](https://orm.drizzle.team/docs/operators) como `eq()` y `gt()`
- [Ayudantes de agregaci贸n](https://orm.drizzle.team/docs/select#aggregations-helpers) como `count()`
- [El ayudante `sql`](https://orm.drizzle.team/docs/sql) para escribir consultas SQL crudas

```ts
import { eq, gt, count, sql } from 'astro:db';
```

### Relaciones

Puedes consultar datos relacionados desde m煤ltiples tablas usando un join de SQL. Para crear una consulta de join, extiende tu sentencia `db.select()` con un operador de join. Cada funci贸n acepta una tabla con la que unir y una condici贸n para emparejar filas entre las dos tablas.

Este ejemplo usa una funci贸n `innerJoin()` para unir autores de `Comment` con su informaci贸n de `Author` relacionada basada en la columna `authorId`. Esto devuelve un arreglo de objetos con cada fila de `Author` y `Comment` como propiedades de primer nivel:

```astro title="src/pages/index.astro"
---
import { db, eq, Comment, Author } from 'astro:db';

const comments = await db.select()
  .from(Comment)
  .innerJoin(Author, eq(Comment.authorId, Author.id));
---

<h2>Comentarios</h2>

{
  comments.map(({ Author, Comment }) => (
    <article>
      <p>Autor: {Author.name}</p>
      <p>{Comment.body}</p>
    </article>
  ))
}
```

<ReadMore>

Consulta la [referencia de join de Drizzle](https://orm.drizzle.team/docs/joins#join-types) para todos los operadores de join y opciones de configuraci贸n disponibles.

</ReadMore>

### Transacciones por Lotes

Todas las consultas a bases de datos remotas se realizan como una solicitud de red. Es posible que necesites "agrupar" consultas juntas en una sola transacci贸n cuando hagas un gran n煤mero de consultas, o para tener reversiones autom谩ticas si falla alguna consulta.

Este ejemplo siembra m煤ltiples filas en una sola solicitud usando el m茅todo `db.batch()`:

```ts
// db/seed.ts
import { db, Author, Comment } from 'astro:db';

export default async function () {
  const queries = [];
  // Siembra 100 comentarios de ejemplo en tu base de datos remota
  // con una sola solicitud de red.
  for (let i = 0; i < 100; i++) {
    queries.push(db.insert(Comment).values({ body: `Comentario de prueba ${i}` }));
  }
  await db.batch(queries);
}
```

<ReadMore>

Consulta la documentaci贸n de [`db.batch()` de Drizzle](https://orm.drizzle.team/docs/batch-api) para m谩s detalles.

</ReadMore>

## Empujando cambios a tu base de datos

Puedes empujar cambios realizados durante el desarrollo a tu base de datos.

### Empujando esquemas de tabla

Tu esquema de tabla puede cambiar con el tiempo a medida que tu proyecto crece. Puedes probar de manera segura cambios de configuraci贸n localmente y empujar a tu base de datos remota cuando despliegues.

Puedes empujar tus cambios de esquema local a tu base de datos remota a trav茅s de la CLI usando el comando `astro db push --remote`:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote
  ```
  </Fragment>
</PackageManagerTabs>

Este comando verificar谩 que tus cambios locales se pueden realizar sin p茅rdida de datos y, si es necesario, sugerir谩 c贸mo hacer cambios en tu esquema de manera segura para resolver conflictos.

#### Empujando cambios de esquema que rompen compatibilidad

:::danger
__Esto destruir谩 tu base de datos__. Solo realiza este comando si no necesitas tus datos de producci贸n.
:::

Si debes cambiar tu esquema de tabla de una manera que es incompatible con tus datos existentes alojados en tu base de datos remota, necesitar谩s resetear tu base de datos de producci贸n.

Para empujar una actualizaci贸n de esquema de tabla que incluya un cambio que rompe compatibilidad, agrega la bandera `--force-reset` para resetear todos los datos de producci贸n:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote --force-reset
  ```
  </Fragment>
</PackageManagerTabs>

### Renombrando tablas

Es posible renombrar una tabla despu茅s de haber empujado tu esquema a tu base de datos remota.

Si **no tienes datos de producci贸n importantes**, entonces puedes [resetear tu base de datos](#empujando-cambios-de-esquema-que-rompen-compatibilidad) usando la bandera `--force-reset`. Esta bandera eliminar谩 todas las tablas de la base de datos y crear谩 nuevas para que coincida exactamente con tu esquema actual.

Para renombrar una tabla mientras preservas tus datos de producci贸n, debes realizar una serie de cambios no destructivos para empujar tu esquema local a tu base de datos remota de manera segura.

El siguiente ejemplo renombra una tabla de `Comment` a `Feedback`:

<Steps>

1. En tu archivo de configuraci贸n de base de datos, agrega la propiedad `deprecated: true` a la tabla que quieres renombrar:

    ```ts title="db/config.ts" ins={2}
    const Comment = defineTable({
      deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
    ```

2. Agrega un nuevo esquema de tabla (coincidiendo exactamente con las propiedades de la tabla existente) con el nuevo nombre:

	  ```ts title="db/config.ts" ins={8-14}
    const Comment = defineTable({
        deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
	  const Feedback = defineTable({
        columns: {
          author: column.text(),
          body: column.text(),
        }
    });
    ```

3. [Empuja a tu base de datos remota](#empujando-esquemas-de-tabla) con `astro db push --remote`. Esto agregar谩 la nueva tabla y marcar谩 la antigua como obsoleta.
4. Actualiza cualquier c贸digo de tu proyecto local para usar la nueva tabla en lugar de la antigua. Es posible que tambi茅n necesites migrar datos a la nueva tabla.
5. Una vez que est茅s seguro de que la tabla antigua ya no se usa en tu proyecto, puedes eliminar el esquema de tu `config.ts`:
		```ts title="db/config.ts" del={1-7}
    const Comment = defineTable({
          deprecated: true,
    	  columns: {
    		  author: column.text(),
    		  body: column.text(),
  		  }
    });

	  const Feedback = defineTable({
          columns: {
            author: column.text(),
            body: column.text(),
          }
    });
    ```
6. Empuja a tu base de datos remota nuevamente con `astro db push --remote`. La tabla antigua ser谩 eliminada, dejando solo la nueva tabla renombrada.
</Steps>

### Empujando datos de tabla 

Es posible que necesites empujar datos a tu base de datos remota para sembrar o migraciones de datos. Puedes crear un archivo `.ts` con el m贸dulo `astro:db` para escribir consultas con seguridad de tipos. Luego, ejecuta el archivo contra tu base de datos remota usando el comando `astro db execute <ruta-del-archivo> --remote`:

Los siguientes Comentarios se pueden sembrar usando el comando `astro db execute db/seed.ts --remote`:

```ts
// db/seed.ts
import { Comment } from 'astro:db';

export default async function () {
  await db.insert(Comment).values([
    { authorId: 1, body: '隆Espero que te guste Astro DB!' },
    { authorId: 2, body: '隆Disfr煤talo!' },
  ])
}
```

<ReadMore>

Consulta la [referencia de la CLI](/es/guides/integrations-guide/db/#astro-db-cli-reference) para una lista completa de comandos.

</ReadMore>

## Construyendo integraciones de Astro DB

Las [integraciones de Astro](/es/reference/integrations-reference/) pueden extender proyectos de usuario con tablas adicionales de Astro DB y datos de semilla.

Usa el m茅todo `extendDb()` en el hook `astro:db:setup` para registrar configuraciones adicionales de Astro DB y archivos de semilla.
El ayudante `defineDbIntegration()` proporciona soporte de TypeScript y autocompletado para el hook `astro:db:setup`.

```js {8-13}
// my-integration/index.ts
import { defineDbIntegration } from '@astrojs/db/utils';

export default function MyIntegration() {
  return defineDbIntegration({
    name: 'mi-integracion-impulsada-por-astro-db',
    hooks: {
      'astro:db:setup': ({ extendDb }) => {
        extendDb({
          configEntrypoint: '@astronaut/my-package/config',
          seedEntrypoint: '@astronaut/my-package/seed',
        });
      },
      // Otros hooks de integraci贸n...
    },
  });
}
```

Los archivos de [configuraci贸n](#define-tu-base-de-datos) y [semilla](#sembrar-tu-base-de-datos-para-desarrollo) de integraci贸n siguen el mismo formato que sus equivalentes definidos por el usuario.

### Operaciones con seguridad de tipos en integraciones

Mientras trabajas en integraciones, es posible que no puedas beneficiarte de los tipos de tabla generados por Astro exportados desde `astro:db`.
Para seguridad de tipos completa, usa la utilidad `asDrizzleTable()` para crear un objeto de referencia de tabla que puedas usar para operaciones de base de datos.

Por ejemplo, dada una integraci贸n configurando la siguiente tabla de base de datos `Pets`:

```js
// my-integration/config.ts
import { defineDb, defineTable, column } from 'astro:db';

export const Pets = defineTable({
  columns: {
    name: column.text(),
    species: column.text(),
  },
});

export default defineDb({ tables: { Pets } });
```

El archivo de semilla puede importar `Pets` y usar `asDrizzleTable()` para insertar filas en tu tabla con verificaci贸n de tipos:

```js {2,7} /typeSafePets(?! )/
// my-integration/seed.ts
import { asDrizzleTable } from '@astrojs/db/utils';
import { db } from 'astro:db';
import { Pets } from './config';

export default async function() {
  const typeSafePets = asDrizzleTable('Pets', Pets);

  await db.insert(typeSafePets).values([
    { name: 'Palomita', species: 'cat' },
    { name: 'Pan', species: 'dog' },
  ]);
}
```

El valor devuelto por `asDrizzleTable('Pets', Pets)` es equivalente a `import { Pets } from 'astro:db'`, pero est谩 disponible incluso cuando la generaci贸n de tipos de Astro no puede ejecutarse.
Puedes usarlo en cualquier c贸digo de integraci贸n que necesite consultar o insertar en la base de datos.

## Migrar de Astro Studio a Turso

<Steps>

1. En el [panel de control de Studio](https://studio.astro.build/), navega al proyecto que deseas migrar. En la pesta帽a de configuraci贸n, usa el bot贸n "Exportar Base de Datos" para descargar un volcado de tu base de datos.
2. Sigue las instrucciones oficiales para [instalar la CLI de Turso](https://docs.turso.tech/cli/installation) y [registrarte o iniciar sesi贸n](https://docs.turso.tech/cli/authentication) en tu cuenta de Turso.
3. Crea una nueva base de datos en Turso usando el comando `turso db create`.
   ```sh
   turso db create [nombre-de-la-base-de-datos]
   ```
4. Obt茅n la URL de la base de datos usando la CLI de Turso, y 煤sala como la variable de entorno `ASTRO_DB_REMOTE_URL`.
   ```sh
   turso db show [nombre-de-la-base-de-datos]
   ```
   ```dotenv
   ASTRO_DB_REMOTE_URL=[tu-url-de-base-de-datos]
   ```
5. Crea un token para acceder a tu base de datos, y 煤salo como la variable de entorno `ASTRO_DB_APP_TOKEN`.
   ```sh
   turso db tokens create [nombre-de-la-base-de-datos]
   ```
   ```dotenv
   ASTRO_DB_APP_TOKEN=[tu-token-de-aplicaci贸n]
   ```
6. Empuja tu esquema de DB y metadatos a la nueva base de datos de Turso.
   ```sh
   astro db push --remote
   ```
7. Importa el volcado de base de datos del paso 1 en tu nueva DB de Turso.
   ```sh
   turso db shell [nombre-de-la-base-de-datos] < ./ruta/al/volcado.sql
   ```
8. Una vez que hayas confirmado que tu proyecto se conecta a la nueva base de datos, puedes eliminar de manera segura el proyecto de Astro Studio.

</Steps>
