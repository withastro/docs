---
title: Actualizar a Astro v3
description: C칩mo actualizar tu proyecto a la 칰ltima versi칩n de Astro (v3.0).
i18nReady: true
---
import { Steps } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'

Esta gu칤a te ayudar치 a migrar de Astro v2 a Astro v3.

쯅ecesitas actualizar un proyecto m치s antiguo a la versi칩n v2? Consulta nuestra [gu칤a de migraci칩n anterior](/es/guides/upgrade-to/v2/) para obtener m치s informaci칩n.

## Actualizar Astro

Actualiza la versi칩n de Astro en tu proyecto a la 칰ltima versi칩n utilizando tu administrador de paquetes. Si est치s utilizando integraciones de Astro, por favor tambi칠n actualiza esas integraciones a la 칰ltima versi칩n.

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # Actualizar a Astro v3.x
  npm install astro@latest
  
  # Ejemplo: actualizar las integraciones de React y Tailwind
  npm install @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # Actualizar a Astro v3.x
  pnpm add astro@latest

  # Ejemplo: actualizar las integraciones de React y Tailwind
  pnpm add @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # Actualizar a Astro v3.x
  yarn add astro@latest
  
  # Ejemplo: actualizar las integraciones de React y Tailwind
  yarn add @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
</PackageManagerTabs>

:::note[쯅ecesitas continuar?]
춰Despu칠s de actualizar Astro a la 칰ltima versi칩n, es posible que no necesites realizar ning칰n cambio en tu proyecto en absoluto!

Sin embargo, si notas errores o comportamientos inesperados, por favor revisa a continuaci칩n los cambios que se han realizado y que podr칤an requerir actualizaciones en tu proyecto.
:::

## Astro v3.0: Banderas Experimentales Eliminadas

Elimina las siguientes banderas experimentales de `astro.config.mjs`:

```js del={5-8}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    assets: true,
    viewTransitions: true,
  },
})
```

Estas caracter칤sticas ahora est치n disponibles por defecto:

- View Transitions para transiciones de p치gina animadas e islas persistentes. Consulta [cambios importantes en la API de View Transitions y consejos de actualizaci칩n](#actualizar-view-transitions-a-la-versi칩n-3) si estabas utilizando esta bandera experimental.
- Una nueva API de servicios de imagen `astro:assets` para usar im치genes en Astro, incluyendo un nuevo componente `<Image />` y la funci칩n `getImage()`. Por favor, lee los detallados [consejos de actualizaci칩n de im치genes](#actualizaci칩n-de-im치genes-a-la-versi칩n-3) **sin importar si estabas usando esta bandera experimental** para ver c칩mo esto podr칤a afectar tu proyecto.

춰Lee m치s sobre estas dos emocionantes caracter칤sticas y m치s en la publicaci칩n del blog sobre la versi칩n 3.0!

## Cambios importantes en Astro v3.0

Astro v3.0 incluye algunos cambios importantes, as칤 como la eliminaci칩n de algunas caracter칤sticas previamente deprecadas. Si tu proyecto no funciona como se esperaba despu칠s de actualizar a v3.0, consulta esta gu칤a para obtener una visi칩n general de todos los cambios importantes e instrucciones sobre c칩mo actualizar tu c칩digo base.

Mira el [historial de cambios](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) para ver las notas completas de la versi칩n.

### Eliminado: Soporte para Node 16

Node 16 tiene programado alcanzar su Fin de Vida en septiembre de 2023.

Astro v3.0 elimina por completo el soporte para Node 16 para que todos los usuarios de Astro puedan aprovechar las caracter칤sticas m치s modernas de Node.

#### 쯈u칠 debo hacer?

 Aseg칰rate de que tanto tu entorno de desarrollo como tu entorno de implementaci칩n est칠n utilizando **Node `18.14.1` o una versi칩n superior**.

1. Verifica tu versi칩n local de Node utilizando:

    ```sh
    node -v
    ```

2. Revisa la documentaci칩n de tu [entorno de despliegue](/es/guides/deploy/) para verificar que admita Node 18.

    Puedes especificar Node `18.14.1` para tu proyecto de Astro ya sea en una configuraci칩n en el panel de control o en un archivo `.nvmrc`.

    ```bash title=".nvmrc"
    18.14.1
    ```

### Eliminado: Soporte para TypeScript 4

En Astro v2.x, los ajustes preestablecidos de `tsconfig.json` incluyen soporte tanto para TypeScript 4.x como para 5.x.

Astro v3.0 actualiza los ajustes preestablecidos de `tsconfig.json` para solo admitir TypeScript 5.x. Ahora Astro asume que est치s utilizando TypeScript 5.0 (marzo de 2023) o que tu editor lo incluye (p. ej. VS Code 1.77).

#### 쯈u칠 debo hacer?

Si has instalado TypeScript localmente, actualiza al menos a la versi칩n v5.0.

```bash
npm install typescript@latest --save-dev
```

### Eliminado: `@astrojs/image`

En Astro v2.x, Astro ofrec칤a una integraci칩n oficial de im치genes que inclu칤a los componentes `<Image />` y `<Picture />`.

Astro v3.0 elimina por completo esta integraci칩n del c칩digo base. La nueva soluci칩n de Astro para im치genes es una API de servicios de im치genes integrada: `astro:assets`.

#### 쯈u칠 debo hacer?

Elimina la integraci칩n `@astrojs/image` de tu proyecto. Deber치s no solo desinstalar la integraci칩n, sino tambi칠n actualizar o eliminar cualquier declaraci칩n de importaci칩n y los componentes existentes `<Image />` y `<Picture />`. Es posible que tambi칠n necesites configurar un servicio de procesamiento de im치genes preferido por defecto.

Encontrar치s [instrucciones completas y paso a paso para eliminar la antigua integraci칩n de im치genes](/es/guides/images/#elimina-astrojsimage) en nuestra gu칤a de Im치genes.

Migrar a `astro:assets` tambi칠n traer치 algunas nuevas opciones y caracter칤sticas de im치genes que es posible que desees utilizar. 춰Por favor, consulta el [Consejo de Actualizaci칩n de Im치genes v3.0](/es/guides/images/#actualizar-a-v30-desde-v2x) completo para obtener todos los detalles!

```js del={3,7}
// astro.config.mjs
import { defineConfig } from 'astro/config';
import image from '@astrojs/image';

export default defineConfig({
  integrations: [
    image(),
  ]
})
```

### Eliminado: Componente `<Markdown />`

En Astro v1.x, Astro marc칩 como obsoleto el componente `<Markdown />` y lo movi칩 a un paquete externo.

Astro v3.0 elimina por completo el paquete `@astrojs/markdown-component`. El componente `<Markdown />` de Astro ya no funcionar치 en tu proyecto.

#### 쯈u칠 debo hacer?

Elimina todas las instancias de `@astrojs/markdown-component`.

```astro del={2} title="src/components/MyAstroComponent.astro"
---
import Markdown from '@astrojs/markdown-component';
---
```

Para seguir utilizando un componente similar a `<Markdown />` en tu c칩digo, considera usar [integraciones de la comunidad](https://astro.build/integrations/) como [`astro-remote`](https://github.com/natemoo-re/astro-remote). Aseg칰rate de actualizar las importaciones y atributos de tu componente `<Markdown />` seg칰n sea necesario, de acuerdo con la documentaci칩n propia de la integraci칩n.

De lo contrario, elimina todas las referencias a la importaci칩n del componente `<Markdown />` de Astro y el propio componente en tus archivos `.astro`. Tendr치s que reescribir tu contenido directamente como HTML o [importar Markdown](/es/guides/markdown-content/#importando-markdown) desde un archivo `.md`.

### Eliminado: APIs obsoletas de la versi칩n 1.x

En Astro v1.x, Astro marc칩 como obsoletas las opciones de configuraci칩n, as칤 como los tipos de atributos `global` y `hoist` para script/estilos. Estos se mantuvieron para compatibilidad con versiones anteriores.

Astro v3.0 elimina por completo estas API obsoletas. Ya no se pueden utilizar en tu proyecto de Astro.

#### 쯈u칠 debo hacer?

Si contin칰as utilizando las APIs de la versi칩n v1.x, utiliza en su lugar las nuevas API para cada funcionalidad:

- Opciones de configuraci칩n obsoletas: Consulta [la gu칤a de migraci칩n 0.26](/es/guides/upgrade-to/v1/#new-configuration-api)
- Tipos de atributos script/estilo obsoletos: Consulta [la gu칤a de migraci칩n 0.26](/es/guides/upgrade-to/v1/#new-default-script-behavior)

### Eliminado: Shims parciales para Web APIs en c칩digo de servidor

En Astro v2.x, Astro proporcionaba shims parciales para las Web APIs como `document` o `localStorage` en el c칩digo de servidor. Estos shims a menudo eran incompletos y poco confiables.

Astro v3.0 elimina por completo estos shims parciales. Las Web APIs ya no est치n disponibles en el c칩digo renderizado en el servidor.

#### 쯈u칠 debo hacer?

Si est치s utilizando Web APIs en componentes renderizados en el servidor, deber치s hacer que el uso de esas APIs sea condicional o utilizar [la directiva `client:only`](/es/reference/directives-reference/#clientonly).

### Eliminado: `image` de `astro:content` en el esquema de colecciones de contenido

En Astro v2.x, la API de colecciones de contenido marc칩 como obsoleta la exportaci칩n de `image` desde `astro:content` para su uso en los esquemas de colecciones de contenido.

Astro v3.0 elimina por completo esta exportaci칩n.

#### 쯈u칠 debo hacer?

Si est치s utilizando el `image()` obsoleto de `astro:content`, elim칤nalo ya que ya no existe. Valida las im치genes a trav칠s del [ayudante `image` del `esquema`](/es/guides/images/#actualiza-los-esquemas-de-colecciones-de-contenido) en su lugar:

 ```ts title="src/content/config.ts" del={1} ins={2} "({ image })"
import { defineCollection, z, image } from "astro:content";
import { defineCollection, z } from "astro:content";
 
 defineCollection({
   schema: ({ image }) =>
     z.object({
       image: image(),
    }),
});
```

### Eliminado: Nombres de temas de Shiki pre-0.14

En Astro v2.x, algunos nombres de temas de Shiki fueron cambiados, pero se mantuvieron los nombres originales para mantener la compatibilidad hacia atr치s.

Astro v3.0 elimina los nombres originales a favor de los nombres de temas renombrados.

#### 쯈u칠 debo hacer?

Si tu proyecto utiliza alguno de los temas a continuaci칩n, ren칩mbralos con su nombre actualizado:

- `material-darker` -> `material-theme-darker`
- `material-default` -> `material-theme`
- `material-lighter` -> `material-theme-lighter`
- `material-ocean` -> `material-theme-ocean`
- `material-palenight` -> `material-theme-palenight`

### Eliminado: Caracter칤sticas `class:list`

En Astro v2.x, la directiva [`class:list`](/es/reference/directives-reference/#classlist) utilizaba una implementaci칩n personalizada inspirada en [`clsx`](https://github.com/lukeed/clsx), con algunas caracter칤sticas adicionales como la eliminaci칩n de duplicados y el soporte para `Set`.

Astro v3.0 ahora utiliza `clsx` directamente para `class:list`, lo cual no admite la eliminaci칩n de duplicados ni valores de tipo `Set`.

#### 쯈u칠 debo hacer?

Reemplaza cualquier elemento de tipo `Set` pasado a la directiva `class:list` con un simple `Array`.

```astro title="src/components/MyAstroComponent.astro" del={4} ins={5}
<Component class:list={[
  'a',
  'b',
  new Set(['c', 'd'])
  ['c', 'd']
]} />
```

### Eliminado: pasando `class:list` como una propiedad

En Astro v2.x, los [valores de `class:list`](/es/reference/directives-reference/#classlist) se enviaban a los componentes a trav칠s de [`Astro.props['class:list']`](/es/reference/api-reference/#astroprops).

En Astro v3.0, los valores de `class:list` se normalizan a un string antes de ser enviados a los componentes a trav칠s de `Astro.props['class']`.

#### 쯈u칠 debo hacer?

Elimina cualquier c칩digo que espere recibir la propiedad `class:list`.

```astro title="src/components/MyAstroComponent.astro" del={2,3,7} ins={4,8} "classList" "'class:list': classList"
---
import { clsx } from 'clsx';
const { class: className, 'class:list': classList } = Astro.props;
const { class: className } = Astro.props;
---
<div
  class:list={[className, classList]}
  class:list={[className]}
/>
```

### Eliminado: Transformaci칩n de kebab-case para variables CSS en camelCase

En Astro v2.x, las [variables CSS](/es/guides/styling/#variables-de-css) en formato camelCase pasadas al atributo `style` eran representadas tanto en camelCase (como se escrib칤an originalmente) como en kebab-case (mantenidas para compatibilidad hacia atr치s).

Astro v3.0 elimina la transformaci칩n a kebab-case para estos nombres de variables CSS en formato camelCase, y solo se representa la variable CSS camelCase original.

```astro "my-value"
---
// src/components/MyAstroComponent.astro
const myValue = "red"
---
<!-- entrada -->
<div style={{ "--myValue": myValue }}></div>

<!-- salida (Astro 2.x) -->
<div style="--my-value:var(--myValue);--myValue:red"></div>
<!-- salida (Astro 3.0) -->
<div style="--myValue:red"></div>
```

#### 쯈u칠 debo hacer?

Si estabas confiando en Astro para transformar kebab-case en tus estilos, actualiza tus estilos existentes a camelCase para evitar estilos faltantes. Por ejemplo:

```astro del={3} ins={4} title="src/components/MyAstroComponent.astro"
<style>
  div {
   color: var(--my-value);
   color: var(--myValue);
  }
</style>
```

### Eliminado: Aplanamiento autom치tico del valor de retorno de `getStaticPaths()`

En Astro v2.x, el valor de retorno de [`getStaticPaths()`](/es/reference/api-reference/#getstaticpaths) se aplanaba autom치ticamente para permitirte devolver un arreglo de arreglos sin errores.

Astro v3.0 elimina el aplanamiento autom치tico del resultado de `getStaticPaths()`.

#### 쯈u칠 debo hacer?

Si est치s devolviendo un arreglo de arreglos en lugar de un arreglo de _objetos_ (como se espera), ahora debes usar `.flatMap` y `.flat` para asegurarte de que est치s devolviendo un array plano.

Se proporcionar치 un [mensaje de error indicando que el valor de retorno de `getStaticPath()` debe ser un arreglo de objetos](/es/reference/errors/invalid-get-static-paths-entry/#qu칠-sali칩-mal) si necesitas actualizar tu c칩digo.

### Movido: `astro check` ahora requiere un paquete externo

En Astro v2.x, [`astro check`](/es/reference/cli-reference/#astro-check) estaba incluido en Astro por defecto, y sus dependencias estaban empaquetadas en Astro. Esto resultaba en un paquete m치s grande, independientemente de si usabas o no `astro check`. Tambi칠n evitaba que tuvieras control sobre la versi칩n de TypeScript y el Servidor de Lenguaje de Astro que se utilizaba.

Astro v3.0 mueve el comando `astro check` fuera del n칰cleo de Astro y ahora requiere un paquete externo `@astrojs/check`. Adem치s, debes instalar `typescript` en tu proyecto para poder usar el comando `astro check`.

#### 쯈u칠 debo hacer?

Ejecuta el comando `astro check` despu칠s de actualizar a Astro v3.0 y sigue las indicaciones para instalar las dependencias requeridas, o bien, instala manualmente `@astrojs/check` y `typescript` en tu proyecto.

### Obsoleto: `build.excludeMiddleware` y `build.split`

En Astro v2.x, `build.excludeMiddleware` y `build.split` se utilizaban para cambiar la forma en que se emit칤an archivos espec칤ficos al usar un adaptador en modo SSR.

Astro v3.0 reemplaza estas opciones de configuraci칩n de compilaci칩n con nuevas opciones de configuraci칩n [para adaptadores SSR](/es/guides/integrations-guide/#integraciones-oficiales) para realizar las mismas tareas: `edgeMiddleware` y `functionPerRoute`.

#### 쯈u칠 debo hacer?

Actualiza el archivo de configuraci칩n de Astro para usar las nuevas opciones **en la configuraci칩n del adaptador** directamente.

```js title="astro.config.mjs" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import vercel from "@astrojs/vercel/serverless";

export default defineConfig({
    build: {
      excludeMiddleware: true
    },
    adapter: vercel({
      edgeMiddleware: true
    }),
});
```

```js title="astro.config.mjs" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import netlify from "@astrojs/netlify/functions";

export default defineConfig({
     build: {
        split: true
     },
     adapter: netlify({
        functionPerRoute: true
     }),
});
```

### Obsoleto: `markdown.drafts`

En Astro v2.x, la configuraci칩n `markdown.drafts` permit칤a tener p치ginas en borrador disponibles cuando se ejecutaba el servidor de desarrollo, pero que no se constru칤an en producci칩n.

Astro v3.0 desaconseja esta caracter칤stica a favor del m칠todo de colecciones de contenido para manejar las p치ginas en borrador mediante filtrado manual, lo que proporciona un mayor control sobre la funcionalidad.

#### 쯈u칠 debo hacer?

Para seguir marcando algunas p치ginas en tu proyecto como borradores, [migra a las colecciones de contenido](/es/guides/content-collections/#migrando-desde-el-enrutamiento-basado-en-archivos) y [filtra manualmente las p치ginas](/es/guides/content-collections/#filtrando-consultas-de-colecci칩n) con la propiedad `draft: true` en el frontmatter en lugar de usar la configuraci칩n `markdown.drafts`.

### Obsoleto: Retornando un objeto simple en los endpoints

En Astro v2.x, los endpoints pod칤an devolver un objeto simple, que se convertir칤a en una respuesta JSON.

Astro v3.0 desecha este comportamiento en favor de devolver directamente un objeto `Response`.

#### 쯈u칠 debo hacer?

Actualiza tus endpoints para devolver directamente un objeto `Response`.

```ts title="endpoint.json.ts" del={2} ins={3}
export async function GET() {
  return { body: { "title": "Blog de Bob" }};
  return new Response(JSON.stringify({ "title": "Blog de Bob" }));
}
```

Si realmente necesitas mantener el formato anterior, puedes usar el objeto `ResponseWithEncoding`, pero ser치 obsoleto en el futuro.

```ts title="endpoint.json.ts" del={2} ins={3}
export async function GET() {
  return { body: { "title": "Blog de Bob" } };
  return new ResponseWithEncoding({ body: { "title": "Blog de Bob" }});
}
```

### Cambiado por defecto: `verbatimModuleSyntax` en los ajustes preestablecidos de tsconfig.json

En Astro v2.x, la configuraci칩n [`verbatimModuleSyntax`](https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax) estaba desactivada de forma predeterminada, con su equivalente de TypeScript 4.x `importsNotUsedAsValues` habilitado en el ajuste preestablecido `strict`.

En Astro v3.0, `verbatimModuleSyntax` est치 habilitado en todos los ajustes preestablecidos.

#### 쯈u칠 debo hacer?

Esta opci칩n requiere que los tipos se importen utilizando la sintaxis `import type`.

```astro title="src/components/MyAstroComponent.astro" "type"
---
import { type CollectionEntry, getEntry } from "astro:content";
---
```

Si bien recomendamos mantenerlo activado y hacer correctamente tus importaciones de tipo con `type` (como se muestra arriba), puedes desactivarlo estableciendo `verbatimModuleSyntax: false` en tu archivo `tsconfig.json` si causa alg칰n problema.

```json title="tsconfig.json" "false"
{
  "compilerOptions": {
    "verbatimModuleSyntax": false
  }
}
```

### Cambiado por defecto: Puerto `3000`

En Astro v2.x, Astro se ejecutaba en el puerto `3000` por defecto.

Astro v3.0 cambia el [puerto por defecto](/es/reference/cli-reference/#--port-number) a `4321`. 游

#### 쯈u칠 debo hacer?

Actualiza cualquier referencia existente a `localhost:3000`, por ejemplo en tests o en tu `README`, para reflejar el nuevo puerto `localhost:4321`.

### Cambiado por defecto: import.meta.env.BASE_URL `trailingSlash`

En Astro v2.x, `import.meta.env.BASE_URL` agregaba por defecto tu configuraci칩n [`base`](/es/reference/configuration-reference/#base) con una barra diagonal al final, llamada [trailingSlash](/es/reference/configuration-reference/#trailingslash). `trailingSlash: "ignore"` tambi칠n agregaba una barra diagonal al final.

En Astro v3.0, ya no se agrega una barra diagonal al final a `import.meta.env.BASE_URL` de forma predeterminada, ni cuando se establece `trailingSlash: "ignore"`. (El comportamiento existente de `base` en combinaci칩n con `trailingSlash: "always"` o `trailingSlash: "never"` no ha cambiado).

#### 쯈u칠 debo hacer?

Si tu configuraci칩n `base` ya tiene una barra diagonal al final, no es necesario realizar ning칰n cambio.

Si tu configuraci칩n `base` no tiene una barra diagonal al final, agrega una si deseas preservar el comportamiento anterior por defecto (o `trailingSlash: "ignore"`):

```js title="astro.config.mjs" del={4} ins={5}
import { defineConfig } from "astro/config";

export default defineConfig({
  base: 'mi-base',
  base: 'mi-base/',
});
```

### Cambiado por defecto: `compressHTML`

En Astro v2.x, Astro solamente comprim칤a tu HTML emitido cuando [`compressHTML`](/es/reference/configuration-reference/#compresshtml) se establec칤a expl칤citamente como `true`. El valor predeterminado era `false`.

Astro v3.0 ahora comprime autom치ticamente el HTML emitido por defecto.

#### 쯈u칠 debo hacer?

Ahora puedes eliminar `compressHTML: true` de tu configuraci칩n, ya que este es el nuevo comportamiento predeterminado.

```js title="astro.config.mjs" del={4}
import { defineConfig } from "astro/config";

export default defineConfig({
  compressHTML: true
})
```

Ahora debes establecer `compressHTML: false` para desactivar la compresi칩n de HTML.

### Cambiado por defecto: `scopedStyleStrategy`

En Astro v2.x, el valor predeterminado de [`scopedStyleStrategy`](/es/reference/configuration-reference/#scopedstylestrategy) era `"where"`.

Astro v3.0 introduce un nuevo valor por defecto: `"attribute"`. De manera predeterminada, los estilos ahora se aplican utilizando atributos `data-*`.

#### 쯈u칠 debo hacer?

Para mantener el [치mbito de estilo](/es/guides/styling/#estilos-locales) actual de tu proyecto, actualiza el archivo de configuraci칩n al valor predeterminado anterior:

```js title="astro.config.mjs" ins={4}
import { defineConfig } from "astro/config";

export default defineConfig({
  scopedStyleStrategy: "where"
})
```

### Cambiado por defecto: `inlineStyleSheets`

En Astro v2.x, todas las hojas de estilo del proyecto se enviaban por defecto como etiquetas de enlace. Pod칤as elegir insertarlas siempre en etiquetas `<style>` con la opci칩n `"always"`, o insertar en l칤nea solo las hojas de estilo por debajo de un cierto tama침o con `"auto"`, configurando la propiedad [`build.inlineStylesheets`](/es/reference/configuration-reference/#buildinlinestylesheets). La configuraci칩n predeterminada era `"never"`.

Astro v3.0 cambia el valor predeterminado de `inlineStylesheets` a `"auto"`. Las hojas de estilo con un tama침o menor que `ViteConfig.build.assetsInlineLimit` (predeterminado: 4 KB) se incluyen en l칤nea de manera predeterminada. De lo contrario, los estilos del proyecto se env칤an en hojas de estilo externas.

#### 쯈u칠 debo hacer?

Si deseas mantener el comportamiento actual de tu proyecto, establece `build.inlineStylesheets` en el valor predeterminado anterior, que es `"never"`:

```js title="astro.config.mjs" ins={4-6}
import { defineConfig } from "astro/config";

export default defineConfig({
	 build: {
    inlineStylesheets: "never"
  }
})
```

### Cambiado por defecto: Servicio image

En Astro v2.x, Squoosh era el [servicio de procesamiento de im치genes predeterminado](/es/guides/images/#servicio-de-im치genes-por-defecto).

Ahora Astro v3.0 incluye Sharp como el servicio de procesamiento de im치genes predeterminado y en su lugar se proporciona una opci칩n de configuraci칩n para usar Squoosh.

#### 쯈u칠 debo hacer?

:::note
Cuando uses un [administrador de paquetes estricto](https://pnpm.io/pnpm-vs-npm#npms-flat-tree) como `pnpm`, es posible que necesites instalar manualmente Sharp en tu proyecto, aunque sea una dependencia de Astro:

```bash
pnpm add sharp
```
:::

Si prefieres seguir utilizando Squoosh para transformar tus im치genes, actualiza tu configuraci칩n con lo siguiente:

```ts title="astro.config.mjs" ins={4-6}
import { defineConfig, squooshImageService } from "astro/config";

export default defineConfig({
  image: {
    service: squooshImageService(),
  }
})
```

### Cambiado: May칰sculas en los m칠todos de solicitud HTTP

En Astro v2.x, los [m칠todos de solicitud HTTP](/es/guides/endpoints/#m칠todos-http) se escrib칤an utilizando nombres de funciones en min칰sculas: `get`, `post`, `put`, `all` y `del`.

Astro v3.0 utiliza nombres de funciones en may칰sculas, incluyendo `DELETE` en lugar de `del`.

#### 쯈u칠 debo hacer?

Cambia el nombre de todas las funciones a su equivalente en may칰sculas:

- `get` a `GET`
- `post` a `POST`
- `put` a `PUT`
- `all` a `ALL`
- `del` a `DELETE`

```js title="endpoint.ts" del={1} ins={2}
export function get() {
export function GET() {
    return new Response(JSON.stringify({ "title": "Blog de Bob" }));
}
```

### Cambiado: Configuraci칩n de m칰ltiples frameworks JSX

En Astro v2.x, pod칤as utilizar [varias integraciones de frameworks JSX](/es/guides/integrations-guide/#integraciones-oficiales) (React, Solid, Preact) en el mismo proyecto sin necesidad de identificar a qu칠 framework pertenec칤an los archivos.

Ahora en Astro v3.0, es necesario especificar qu칠 framework utilizar para tus archivos mediante las nuevas opciones de configuraci칩n de integraci칩n `include` y `exclude` cuando tienes instaladas m칰ltiples integraciones de framework JSX. Esto permite que Astro admita de manera m치s eficiente el uso de un solo framework, as칤 como caracter칤sticas avanzadas como React Fast Refresh.

#### 쯈u칠 debo hacer?

Si est치s utilizando m칰ltiples frameworks JSX en el mismo proyecto, establece `include` (y opcionalmente `exclude`) en un arreglo de archivos y/o carpetas. Puedes utilizar comodines para incluir m칰ltiples rutas de archivo.

Recomendamos colocar los componentes comunes del framework en la misma carpeta (por ejemplo, `/components/react/` y `/components/solid/`) para facilitar la especificaci칩n de tus inclusiones, pero esto no es obligatorio:

```js ins={13,16,19}
import { defineConfig } from 'astro/config';
import preact from '@astrojs/preact';
import react from '@astrojs/react';
import svelte from '@astrojs/svelte';
import vue from '@astrojs/vue';
import solid from '@astrojs/solid-js';

export default defineConfig({
  // Habilita varios frameworks para admitir todo tipo de componentes diferentes.
  // 춰No se necesita `include` si solo est치s utilizando un solo framework!
  integrations: [
    preact({
      include: ['**/preact/*']
    }),
    react({
      include: ['**/react/*']
    }),
    solid({
      include: ['**/solid/*'],
    }),
  ]
});
```

### Cambiado: `Astro.cookies.get(key)` puede retornar `undefined`

En Astro v2.x, [`Astro.cookies.get(key)`](/es/reference/api-reference/#astrocookies) siempre devolver칤a un objeto [`AstroCookie`](/es/reference/api-reference/#astrocookie), incluso si la cookie no existiera. Para verificar su existencia, necesitabas usar `Astro.cookies.has(key)`.

En Astro v3.0, `Astro.cookies.get(key)` devuelve `undefined` si la cookie no existe.

#### 쯈u칠 debo hacer?

Este cambio no romper치 ning칰n c칩digo que verifique la existencia del objeto `Astro.cookie` antes de usar `Astro.cookies.get(key)`, pero ya no es necesario hacerlo.

Puedes eliminar de manera segura cualquier c칩digo que utilice `has()` para verificar si el valor de `Astro.cookies` es `undefined`:

```js del={1-3} ins={5-7}
if (Astro.cookies.has(id)) {
  const id = Astro.cookies.get(id)!;
}

const id = Astro.cookies.get(id);
if (id) {
}
```

### Cambiado: Ejecutando la CLI de Astro de manera program치tica.

En Astro v2.x, el punto de entrada del paquete `"astro"` exportaba y ejecutaba directamente la CLI de Astro. No se recomienda ejecutar Astro de esta manera en la pr치ctica.

Astro v3.0 elimina la CLI del punto de entrada y exporta un nuevo conjunto de APIs experimentales en JavaScript, que incluyen `dev()`, `build()`, `preview()` y `sync()`.

#### 쯈u칠 debo hacer?

Para [ejecutar la CLI de Astro de manera program치tica](/es/reference/cli-reference/#apis-avanzadas-experimental), utiliza las nuevas APIs experimentales en JavaScript:

```js
import { dev, build } from "astro";

// Inicia el servidor de desarrollo de Astro
const devServer = await dev();
await devServer.stop();

// Construye tu proyecto de Astro
await build();
```

### Cambiado: Rutas de exportaci칩n de puntos de entrada de la API interna de Astro

En Astro v2.x, pod칤as importar las APIs internas de Astro desde `astro/internal/*` y `astro/runtime/server/*`.

Astro v3.0 elimina los dos puntos de entrada a favor del punto de entrada existente `astro/runtime/*`. Adem치s, se ha agregado una nueva exportaci칩n `astro/compiler-runtime` para el c칩digo de runtime espec칤fico del compilador.

#### 쯈u칠 debo hacer?

Estos son puntos de entrada para la API interna de Astro y no deber칤an afectar tu proyecto. Pero si utilizas estos puntos de entrada, actualiza como se muestra a continuaci칩n:

```js del={1,4,10} ins={2,5,11}
import 'astro/internal/index.js';
import 'astro/runtime/server/index.js';

import 'astro/server/index.js';
import 'astro/runtime/server/index.js';
```

```js ins={5} del={4}
import { transform } from '@astrojs/compiler';

const result = await transform(source, {
  internalURL: 'astro/runtime/server/index.js',
  internalURL: 'astro/compiler-runtime',
  // ...
});
```

## Mejoras de funcionalidades

### Actualizaci칩n de im치genes a la versi칩n 3

`astro:assets` ya no est치 detr치s de una bandera experimental en Astro v3.0.

`<Image />` ahora es un componente incorporado y la integraci칩n anterior `@astrojs/image` ha sido eliminada.

Estos y otros cambios relacionados con el uso de im치genes en Astro pueden provocar cambios incompatibles al actualizar tu proyecto Astro desde una versi칩n anterior.

Por favor, sigue las instrucciones a continuaci칩n seg칰n corresponda para actualizar un proyecto Astro v2.x a la versi칩n 3.0.

#### Actualizaci칩n desde `experimental.assets`

Si previamente hab칤as activado la bandera experimental para `astro:assets`, deber치s actualizar tu proyecto para Astro v3.0, que ahora incluye las funcionalidades de assets de forma predeterminada.

##### Eliminar la bandera `experimental.assets`

Elimina la bandera experimental:

```js title="astro.config.mjs" del={4-6}
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    assets: true
  }
});
```

Si es necesario, actualiza tambi칠n tu archivo `src/env.d.ts` para reemplazar la referencia a `astro/client-image` por `astro/client`:

```ts title="src/env.d.ts" del={1} ins={2}
/// <reference types="astro/client-image" />
/// <reference types="astro/client" />
```

Este alias de importaci칩n ya no se incluye por defecto con `astro:assets`. Si estabas usando este alias con los assets experimentales, debes convertirlos a rutas de archivo relativas o [crear tus propios alias de importaci칩n](/es/guides/imports/#alias).

```astro title="src/pages/posts/post-1.astro" del={2} ins={3}
---
import rocket from '~/assets/rocket.png';
import rocket from '../../assets/rocket.png';
---
```
---

##### A침adir soporte b치sico de assets para Cloudflare, Deno, Vercel Edge y Netlify Edge

Astro v3.0 permite que `astro:assets` funcione sin errores en Cloudflare, Deno, Vercel Edge y Netlify Edge, los cuales no son compatibles con la optimizaci칩n de im치genes integrada de Astro mediante Squoosh y Sharp. Ten en cuenta que Astro **no realiza ninguna transformaci칩n ni procesamiento de im치genes** en estos entornos. Sin embargo, a칰n puedes disfrutar de otros beneficios al usar `astro:assets`, incluyendo la ausencia de desplazamiento acumulativo de dise침o (CLS), el atributo `alt` obligatorio y una experiencia de creaci칩n consistente.

Si anteriormente evitaste usar `astro:assets` debido a estas limitaciones, ahora puedes utilizarlos sin problemas. Puedes configurar el servicio de im치genes sin operaciones (no-op image service) para activar este comportamiento expl칤citamente:

```js title="astro.config.mjs" ins={4-8}
import { defineConfig } from 'astro/config';

export default defineConfig({
  image: {
    service: {
      entrypoint: 'astro/assets/services/noop'
    }
  }
});
```

#### Decide d칩nde almacenar tus im치genes

Consulta la gu칤a de Im치genes para ayudarte a [decidir d칩nde almacenar tus im치genes](/es/guides/images/#d칩nde-guardar-las-im치genes). Tal vez quieras aprovechar las nuevas opciones para almacenar tus im치genes gracias a la flexibilidad adicional que ofrece `astro:assets`. Por ejemplo, ahora se pueden referenciar im치genes relativas desde el directorio `src/` de tu proyecto en Markdown, MDX y Markdoc usando la sintaxis est치ndar de Markdown: `![alt](src)`.

#### Actualiza las etiquetas `<img>` existentes

Anteriormente, importar una imagen devolv칤a simplemente una `string` con la ruta de la imagen. Ahora, los assets de imagen importados tienen la siguiente firma:

```ts
interface ImageMetadata {
  src: string;
  width: number;
  height: number;
  format: string;
}
```

Debes actualizar el atributo `src` de cualquier etiqueta `<img>` existente** (incluyendo [im치genes en componentes de frameworks de interfaz de usuario](/es/guides/images/#im치genes-en-componentes-de-frameworks-ui)), y tambi칠n puedes actualizar otros atributos que ahora est치n disponibles a partir de la imagen importada.

```astro title="src/components/MyComponent.astro" ".src" ".width" ".height" del={4} ins={6}
---
import rocket from '../images/rocket.svg';
---
<img src={rocket} width="250" height="250" alt="A rocketship in space." />

<img src={rocket.src} width={rocket.width} height={rocket.height} alt="A rocketship in space." />
```

#### Actualiza tus archivos Markdown, MDX y Markdoc

Ahora se pueden referenciar im치genes relativas desde el directorio `src/` de tu proyecto en archivos Markdown, MDX y Markdoc utilizando la sintaxis est치ndar de Markdown: `![alt](src)`.

Esto te permite mover tus im치genes del directorio `public/` al directorio `src/` de tu proyecto, donde ahora ser치n procesadas y optimizadas. Las im치genes que ya tengas en `public/`, as칤 como las im치genes remotas, siguen siendo v치lidas, pero **no ser치n optimizadas** por el proceso de compilaci칩n de Astro.

```md title="src/pages/posts/post-1.md" "/_astro" ".hash" "../../assets/"
# My Markdown Page

<!-- Local images now possible! -->
![A starry night sky.](../../images/stars.png)

<!-- Keep your images next to your content! -->
![A starry night sky.](./stars.png)
```

Si necesitas m치s control sobre los atributos de tus im치genes, te recomendamos usar el formato de archivo `.mdx`, que te permite incluir el componente `<Image />` de Astro o una etiqueta `<img />` en JSX, adem치s de la sintaxis est치ndar de Markdown. Utiliza la [integraci칩n de MDX](/es/guides/integrations-guide/mdx/) para a침adir soporte para MDX en Astro.

#### Elimina `@astrojs/image`

Si estabas utilizando la integraci칩n de im치genes en Astro v2.x, completa los siguientes pasos:

<Steps>
1. Elimina la integraci칩n `@astrojs/image`.
  
    Debes [eliminar la integraci칩n](/es/guides/integrations-guide/#eliminando-una-integraci칩n) desinstal치ndola y luego elimin치ndola de tu archivo `astro.config.mjs`.

    ```js del={3,7}
    // astro.config.mjs
    import { defineConfig } from 'astro/config';
    import image from '@astrojs/image';

    export default defineConfig({
      integrations: [
        image(),
      ]
    })
    ```
2. Actualiza los tipos (si es necesario).

    Si hab칤as configurado tipos especiales para `@astrojs/image` en `src/env.d.ts`, es posible que necesites volver a los tipos predeterminados de Astro si tu actualizaci칩n a la versi칩n 3 no complet칩 este paso autom치ticamente.

    ```ts title="src/env.d.ts" del={1} ins={2}
		 /// <reference types="@astrojs/image/client" />
		 /// <reference types="astro/client" />
		```
    De manera similar, actualiza el archivo `tsconfig.json` si es necesario:

    ```json title="tsconfig.json" del={3} ins={4}
		{
			"compilerOptions": {
			  "types": ["@astrojs/image/client"]
			  "types": ["astro/client"]
			}
		}
		```

3. Migra cualquier componente `<Imagen />` existente.

    Cambia todas las declaraciones de `import` de `@astrojs/image/components` a `astro:assets` para poder usar el nuevo componente integrado `<Image />`.

    Elimina cualquier atributo del componente que no sean [propiedades de assets de imagen actualmente admitidas](/es/guides/images/#propiedades).

    Por ejemplo, `aspectRatio` ya no es compatible, ya que ahora se infiere autom치ticamente a partir de los atributos `width` y `height`.

      ```astro title="src/components/MyComponent.astro" del= {2,11} ins={3}
      ---
      import { Image } from '@astrojs/image/components';
      import { Image } from 'astro:assets';
      import localImage from '../assets/logo.png';
      const localAlt = 'El logo de Astro';
      ---

      <Image
        src={localImage}
        width={300}
        aspectRatio="16:9"
        alt={localAlt}
      />
      ```
      
4. Elige un servicio de im치genes predeterminado.

   [Sharp](https://github.com/lovell/sharp) es ahora el servicio de im치genes predeterminado utilizado para `astro:assets`. Si deseas utilizar Sharp, no se requiere ninguna configuraci칩n.

    Si prefieres utilizar [Squoosh](https://github.com/GoogleChromeLabs/squoosh) para transformar tus im치genes, actualiza tu configuraci칩n con la siguiente opci칩n `image.service`:

    ```js title="astro.config.mjs" ins={4-6}
    import { defineConfig, squooshImageService } from 'astro/config';

    export default defineConfig({
      image: {
        service: squooshImageService(),
      },
    });
    ```
</Steps>

#### Actualiza los esquemas de *Content Collections* (colecciones de contenido).

Ahora puedes declarar una imagen asociada a una entrada de *content collections*, como la imagen de portada de una publicaci칩n de blog, en el *frontmatter* utilizando su ruta relativa a la carpeta actual.

El nuevo asistente `image` para *content collections* te permite validar los metadatos de la imagen usando Zod. Aprende m치s sobre [c칩mo usar im치genes en content collections](/es/guides/images/#im치genes-en-colecciones-de-contenido).

#### C칩mo manejar las importaciones de im치genes en Astro v3.0

En Astro v3.0, si necesitas conservar el comportamiento anterior de las importaciones de im치genes y requieres una representaci칩n en forma de cadena (string) de la URL de la imagen, agrega `?url` al final de la ruta de la imagen al importarla. Por ejemplo:

```astro title="src/pages/blog/MyImages.astro"
---
import Sprite from '../assets/logo.svg?url';
---

<svg>
  <use xlink:href={Sprite + '#cart'} />
</svg>
```

Este enfoque garantiza que obtendr치s la URL como una cadena de texto. Ten en cuenta que, durante el desarrollo, Astro utiliza una ruta relativa desde `src/`, pero al compilar el proyecto, genera rutas con hash como `/_astro/cat.a6737dd3.png`.

Si prefieres trabajar directamente con el objeto de la imagen, puedes acceder a la propiedad `.src`. Este m칠todo es ideal para tareas como gestionar las dimensiones de la imagen para m칠tricas de Core Web Vitals y evitar el desplazamiento acumulativo del dise침o (CLS).

Si est치s haciendo la transici칩n al nuevo comportamiento de importaci칩n, combinar los m칠todos `?url` y `.src` podr칤a ser la mejor manera de manejar las im치genes sin inconvenientes.

### Actualizar view transitions a la versi칩n 3

Las transiciones de vista ya no est치n detr치s de una bandera experimental en Astro v3.0.

Si **no** hab칤as activado esta bandera experimental en Astro 2.x, esto no causar치 ning칰n cambio incompatible en tu proyecto. La nueva API de transiciones de vista no afecta tu c칩digo existente.

Si usabas previamente las transiciones de vista experimentales, puede haber algunos cambios incompatibles al actualizar tu proyecto Astro desde una versi칩n anterior.

Sigue las instrucciones a continuaci칩n, seg칰n corresponda, para actualizar **un proyecto Astro v2.x configurado con `experimental.viewTransitions: true`** a la versi칩n 3.0.

#### Actualizaci칩n desde `experimental.viewTransitions`

Si hab칤as activado anteriormente la bandera experimental para las transiciones de vista, deber치s actualizar tu proyecto para Astro v3.0, que ahora permite las transiciones de vista de forma predeterminada.

##### Eliminar la bandera `experimental.viewTransitions`

Elimina la bandera experimental:

```js title="astro.config.mjs" del={4-6}
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
   viewTransitions: true
  }
});
```

##### Actualiza la fuente de importaci칩n

El componente `<ViewTransitions />` se ha movido de `astro:components` a `astro:transitions`. Actualiza la fuente de importaci칩n en todas las apariciones dentro de tu proyecto.

```astro title="src/layouts/BaseLayout.astro" del="astro:components" ins="astro:transitions"
---
import { ViewTransitions } from "astro:components astro:transitions"
---
<html lang="en">
  <head>
    <title>My Homepage</title>
    <ViewTransitions />
  </head>
  <body>
    <h1>Welcome to my website!</h1>
  </body>
</html>
```

#### Actualizar directivas `transition:animate`

**Cambiado:** El valor `morph` de la directiva `transition:animate` ha sido renombrado a `initial`. Adem치s, esta ya no es la animaci칩n por defecto. Si no se especifica ninguna directiva `transition:animate`, tus animaciones ahora ser치n por defecto `fade`.

1. Renombra cualquier animaci칩n `morph` a `initial`.
    ```astro title="src/components/MyComponent.astro" del="morph" ins="initial"
    <div transition:name="name" transition:animate="morph initial" />
    ```
2. Para mantener cualquier animaci칩n que previamente usara `morph` por defecto, a침ade expl칤citamente `transition:animate="initial"` a esas animaciones.

    ```astro title="src/components/MyComponent.astro" ins='transition:animate="initial"'
    <div transition:name="name" transition:animate="initial" />
    ```
3. Puedes eliminar de manera segura cualquier animaci칩n configurada expl칤citamente como `fade`. Esto es ahora el comportamiento por defecto:

    ```astro title="src/components/MyComponent.astro" del="transition:animate=\"fade\""
    <div transition:name="name" transition:animate="fade" />
    ```

**A침adido:** Astro tambi칠n admite un nuevo valor para `transition:animate`, llamado `none`. Este valor puede ser utilizado en el elemento `<html>` de una p치gina para desactivar las transiciones animadas de p치gina completa en toda la p치gina. Esto solo anular치 el **comportamiento de animaci칩n predeterminado** en elementos de la p치gina que no tengan una directiva de animaci칩n. A칰n puedes establecer animaciones en elementos individuales y estas animaciones espec칤ficas ocurrir치n.

4. Ahora puedes desactivar todas las transiciones predeterminadas en una p치gina individual, animando solamente los elementos que utilicen expl칤citamente una directiva `transition:animate`:

    ```astro ins="transition:animate=\"none\""
    <html transition:animate="none">
      <head></head>
      <body>
        <h1>춰Hola Mundo!</h1>
      </body>
    </html>
    ```

#### Actualizar nombres de eventos

El evento `astro:load` ha sido renombrado a `astro:page-load`. Renombra todas las instancias en tu proyecto.

```astro title="src/components/MyComponent.astro" del="astro:load" ins="astro:page-load"
<script>
document.addEventListener('astro:load astro:page-load', runSetupLogic);
</script>
```

El evento `astro:beforeload` ha sido renombrado como `astro:after-swap`. Renombra todas las instancias en tu proyecto.

```astro title="src/components/MyComponent.astro" del="astro:beforeload" ins="astro:after-swap"
<script>
document.addEventListener('astro:beforeload astro:after-swap', setDarkMode);
</script>
```

## Recursos de la comunidad

쮺onoces un buen recurso para Astro v3.0? 춰[Edita esta p치gina](https://github.com/withastro/docs/edit/main/src/content/docs/es/guides/upgrade-to/v3.mdx) y agrega un enlace a continuaci칩n!

## Problemas conocidos

Actualmente no hay problemas conocidos.
