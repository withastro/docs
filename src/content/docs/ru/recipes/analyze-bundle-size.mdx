---
title: Анализ размера сборки
description: Узнайте, как анализировать размер файлов, генерируемых Astro, с помощью `rollup-plugin-visualizer`.
i18nReady: true
type: recipe
---

import { Steps } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';

Понимание того, что входит в итоговую сборку Astro, важно для оптимизации производительности сайта. Визуализация бандла поможет найти модули, которые занимают слишком много места, и принять меры по их оптимизации.

## Инструкция

Библиотека [`rollup-plugin-visualizer`](https://github.com/btd/rollup-plugin-visualizer) позволяет анализировать сборку Rollup и видеть, какие модули вносят наибольший вклад в её размер.

<Steps>
1. Установите `rollup-plugin-visualizer`:

    <PackageManagerTabs>
        <Fragment slot="npm">
        ```shell
        npm install rollup-plugin-visualizer --save-dev
        ```
        </Fragment>
        <Fragment slot="pnpm">
        ```shell
        pnpm add rollup-plugin-visualizer --save-dev
        ```
        </Fragment>
        <Fragment slot="yarn">
        ```shell
        yarn add rollup-plugin-visualizer --save-dev
        ```
        </Fragment>
    </PackageManagerTabs>

2. Добавьте плагин в файл `astro.config.mjs`:

    ```js
    // @ts-check
    import { defineConfig } from 'astro/config';
    import { visualizer } from "rollup-plugin-visualizer";

    export default defineConfig({
    vite: {
        plugins: [visualizer({
            emitFile: true,
            filename: "stats.html",
        })]
    }
    });
    ```

3. Запустите команду сборки:

    <PackageManagerTabs>
        <Fragment slot="npm">
        ```shell
        npm run build
        ```
        </Fragment>
        <Fragment slot="pnpm">
        ```shell
        pnpm build
        ```
        </Fragment>
        <Fragment slot="yarn">
        ```shell
        yarn build
        ```
        </Fragment>
    </PackageManagerTabs>

4. Найдите файл(ы) `stats.html` в вашем проекте.

    В полностью статических сайтах файл появится в корне директории `dist/`. Откройте его в браузере, чтобы увидеть интерактивную карту вашего бандла.

    Если вы используете рендеринг по запросу (SSR), вы получите два файла: один для клиента (в `dist/client/`) и один для сервера (в `dist/server/`).
</Steps>

:::note
Из-за особенностей гидратации в Astro состав бандла, который получает клиент, может отличаться от того, что вы видите в общей статистике сборки. Визуализатор показывает все зависимости, используемые на сайте, но не дает детальной разбивки размера для каждой отдельной страницы.
:::
