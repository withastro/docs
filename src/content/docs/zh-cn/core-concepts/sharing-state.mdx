---
title: çŠ¶æ€å…±äº«
description: å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Nano Stores åœ¨æ¡†æ¶ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€
i18nReady: true
type: recipe
---

import UIFrameworkTabs from '~/components/tabs/UIFrameworkTabs.astro'
import LoopingVideo from '~/components/LoopingVideo.astro'
import JavascriptFlavorTabs from '~/components/tabs/JavascriptFlavorTabs.astro'
import RecipeLinks from "~/components/RecipeLinks.astro"

å½“ä½¿ç”¨[ç¾¤å²›ç»“æ„ / éƒ¨åˆ†æ¿€æ´»](/zh-cn/concepts/islands/)æ„å»ºä¸€ä¸ª Astro ç½‘ç«™æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„é—®é¢˜ï¼š**æˆ‘æƒ³åœ¨æˆ‘çš„ç»„ä»¶ä¹‹é—´å…±äº«çŠ¶æ€ã€‚**

åƒ React æˆ–è€… Vue è¿™æ ·çš„ UI æ¡†æ¶å¯èƒ½é¼“åŠ±ä½¿ç”¨ ["context"](https://react.dev/learn/passing-data-deeply-with-context) æ¥ä¸ºå…¶ä»–ç»„ä»¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä½†æ˜¯åœ¨ Astro æˆ–è€… Markdown ä¸­çš„ [éƒ¨åˆ†æ¿€æ´»ç»„ä»¶ (partially hydrating components)](/zh-cn/core-concepts/framework-components/#æ¿€æ´»ç»„ä»¶) ä¸èƒ½ä½¿ç”¨ä¸Šä¸‹æ–‡å°è£…ã€‚

Astro æ¨èäº†ä¸€ä¸ªä¸åŒçš„å®¢æˆ·ç«¯å…±äº«å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆï¼š [**Nano Stores**](https://github.com/nanostores/nanostores)ã€‚

<RecipeLinks slugs={["zh-cn/recipes/sharing-state"]} />

## ä¸ºä»€ä¹ˆä½¿ç”¨ Nano Stores?

[Nano Stores](https://github.com/nanostores/nanostores) åº“å…è®¸ä½ ç¼–å†™ä»»ä½•ç»„ä»¶éƒ½èƒ½ä¸ä¹‹äº’åŠ¨çš„çŠ¶æ€åº“ã€‚æˆ‘ä»¬æ¨è Nano Storesï¼Œå› ä¸ºï¼š
- **å®ƒæ˜¯è½»é‡çº§çš„ã€‚** Nano Stores æä¾›äº†ä½ æ‰€éœ€è¦çš„æœ€ä½é™åº¦çš„ JSï¼ˆä¸åˆ° 1KBï¼‰ï¼Œå¹¶ä¸”é›¶ä¾èµ–ã€‚
- **å®ƒæ˜¯æ¡†æ¶æ— å…³çš„ã€‚** è¿™æ„å‘³ç€åœ¨æ¡†æ¶ä¹‹é—´å…±äº«çŠ¶æ€å°†æ˜¯æ— ç¼çš„ï¼Astro æ˜¯å»ºç«‹åœ¨çµæ´»æ€§ä¹‹ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å–œæ¬¢é‚£äº›æ— è®ºä½ çš„åå¥½å¦‚ä½•éƒ½èƒ½æä¾›ç±»ä¼¼å¼€å‘è€…ä½“éªŒçš„è§£å†³æ–¹æ¡ˆã€‚

å°½ç®¡å¦‚æ­¤ï¼Œä½ ä»ç„¶å¯ä»¥æ¢ç´¢ä¸€äº›æ›¿ä»£æ–¹æ¡ˆã€‚è¿™äº›æ–¹æ³•åŒ…æ‹¬ï¼š
- [Svelte's built-in stores](https://svelte.dev/tutorial/writable-stores)
- [Solid signals](https://www.solidjs.com/docs/latest) ç»„ä»¶ä¹‹å¤–çš„ä¸Šä¸‹æ–‡
- [Vue çš„å“åº”å¼ API](https://vuejs.org/guide/scaling-up/state-management.html#simple-state-management-with-reactivity-api)
- [å‘é€è‡ªå®šä¹‰æµè§ˆå™¨äº‹ä»¶](https://developer.mozilla.org/en-US/docs/Web/Events/Creating_and_triggering_events) åœ¨ç»„ä»¶ä¹‹é—´ 

:::note[FAQ]

<details>
<summary>**ğŸ™‹ æˆ‘å¯ä»¥åœ¨ `.astro` æ–‡ä»¶ä¸­æˆ–è€…å…¶ä»–æœåŠ¡ç«¯ç»„ä»¶ä½¿ç”¨ Nano Stores å—ï¼Ÿ**</summary>

Nano Stores èƒ½è¢«æœåŠ¡ç«¯ç»„ä»¶å¯¼å…¥ã€å†™å…¥å’Œè¯»å–ä¿¡æ¯ï¼Œ**ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸æ¨èè¿™æ ·åšï¼** è¿™æ˜¯ç”±äºä¸€äº›é™åˆ¶ï¼š
- ä»ä¸€ä¸ª `.astro` æ–‡ä»¶æˆ–è€… [éæ¿€æ´»ç»„ä»¶](/zh-cn/core-concepts/framework-components/#æ¿€æ´»ç»„ä»¶) å†™å…¥çŠ¶æ€åº“å°†ä¸ä¼šå½±å“ [å®¢æˆ·ç«¯ç»„ä»¶](/zh-cn/reference/directives-reference/#å®¢æˆ·ç«¯æŒ‡ä»¤) å€¼çš„è·å–ã€‚
- ä½ ä¸èƒ½å°† Nano Store ä½œä¸ºä¸€ä¸ª "prop" ä¼ é€’ç»™å®¢æˆ·ç«¯ç»„ä»¶ã€‚
- ä½ ä¸èƒ½ä»ä¸€ä¸ª `.astro` æ–‡ä»¶ä¸­è®¢é˜…çŠ¶æ€åº“å˜åŒ–ï¼Œå› ä¸º Astro ç»„ä»¶ä¸ä¼šé‡æ–°æ¸²æŸ“ã€‚

å¦‚æœä½ ç†è§£äº†è¿™äº›é™åˆ¶ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹ Nano Stores! è¯·è®°ä½ï¼ŒNano Stores æ˜¯ä¸ºäº†å“åº”**å®¢æˆ·ç«¯**çš„å˜åŒ–è€Œæ„å»ºçš„ã€‚

</details>

<details>
<summary>**ğŸ™‹  Svelte stores å’Œ Nano Stores ç›¸æ¯”å¦‚ä½•ï¼Ÿ**</summary>

**Nano Stores å’Œ [Svelte stores](https://svelte.dev/tutorial/writable-stores) ååˆ†ç›¸ä¼¼ï¼** äº‹å®ä¸Šï¼Œ [Nano Stores å…è®¸ä½ ä½¿ç”¨ä¸ Svelte Store ç›¸åŒçš„ `$` æ–¹å¼](https://github.com/nanostores/nanostores#svelte) æ¥è®¢é˜…ã€‚

å¦‚æœä½ æƒ³é¿å…ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼Œ [Svelte stores](https://svelte.dev/tutorial/writable-stores) æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„è·¨ç»„ä»¶é€šä¿¡åº“ã€‚ä¸è¿‡ï¼Œä½ å¯èƒ½å–œæ¬¢ä½¿ç”¨ Nano Stores å¦‚æœï¼š
aï¼‰ä½ å–œæ¬¢ä»–ä»¬çš„æ’ä»¶ ["objects"](https://github.com/nanostores/nanostores#maps) å’Œ [async state](https://github.com/nanostores/nanostores#lazy-stores)ã€‚
bï¼‰ä½ æƒ³è¦åœ¨ Svelte å’Œå…¶ä»– UI æ¡†æ¶å¦‚ Preact æˆ–è€… Vue ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚
</details>

<details>
<summary>**ğŸ™‹ Solid signals å’Œ Nano Stores ç›¸æ¯”å¦‚ä½•ï¼Ÿ**</summary>

å¦‚æœä½ å·²ç»ä½¿ç”¨ Solid æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä½ å¯èƒ½è¯•ç€å°† [signals](https://www.solidjs.com/docs/latest#createsignal) æˆ–è€… [stores](https://www.solidjs.com/docs/latest#createstore) ç§»å‡ºä½ çš„ç»„ä»¶ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æ–¹å¼æ¥åœ¨ Solid islands ä¹‹é—´å…±äº«çŠ¶æ€ï¼å°è¯•ä»ä¸€ä¸ªå…±äº«çš„æ–‡ä»¶ä¸­å¯¼å‡º signalsï¼š

```js
// sharedStore.js
import { createSignal } from 'solid-js';

export const sharedCount = createSignal(0);
```
æ‰€æœ‰å¯¼å…¥äº† `sharedCount` çš„ç»„ä»¶éƒ½ä¼šå…±äº«å…±åŒçš„çŠ¶æ€ã€‚è™½ç„¶è¿™å¾ˆå¥½ç”¨ï¼Œä½†æ˜¯ä½ å¯èƒ½æ›´å–œæ¬¢ Nano Stores å¦‚æœï¼š
aï¼‰ä½ å–œæ¬¢ä»–ä»¬çš„æ’ä»¶ ["objects"](https://github.com/nanostores/nanostores#maps) å’Œ [async state](https://github.com/nanostores/nanostores#lazy-stores)ã€‚
bï¼‰ä½ æƒ³è¦åœ¨ Svelte å’Œå…¶ä»– UI æ¡†æ¶å¦‚ Preact æˆ–è€… Vue ä¹‹é—´è¿›è¡Œé€šä¿¡ã€‚
</details>
:::

## å®‰è£… Nano Stores

ä¸ºä½ å–œæ¬¢çš„ UI æ¡†æ¶å®‰è£… Nano Stores å’Œä»–ä»¬çš„å¸®åŠ©åŒ…ï¼š

<UIFrameworkTabs>
  <Fragment slot="preact">
  ```shell
  npm i nanostores @nanostores/preact
  ```
  </Fragment>
  <Fragment slot="react">
  ```shell
  npm i nanostores @nanostores/react
  ```
  </Fragment>
  <Fragment slot="solid">
  ```shell
  npm i nanostores @nanostores/solid
  ```
  </Fragment>
  <Fragment slot="svelte">
  ```shell
  npm i nanostores
  ```
  :::note
  è¿™é‡Œä¸éœ€è¦å®‰è£…å¸®åŠ©åŒ…ï¼å› ä¸º Nano Stores å¯ä»¥åƒæ ‡å‡†çš„ Svelte çŠ¶æ€åº“ä¸€æ ·è¢«ä½¿ç”¨ã€‚
  :::
  </Fragment>
  <Fragment slot="vue">
  ```shell
  npm i nanostores @nanostores/vue
  ```
  </Fragment>
  <Fragment slot="lit">
  ```shell
  npm install nanostores @nanostores/lit
  ```
  </Fragment>
</UIFrameworkTabs>

ä½ å¯ä»¥è·³è½¬åˆ° [Nano Stores ä½¿ç”¨æŒ‡å—](https://github.com/nanostores/nanostores#guide) æˆ–è€…è·Ÿéšæˆ‘ä»¬ä¸‹é¢çš„ä¾‹å­ï¼

## ç”¨ä¾‹ - ç”µå•†è´­ç‰©è½¦æŠ½å±‰

å‡å¦‚æˆ‘ä»¬æ­£åœ¨æ­å»ºä¸€ä¸ªç®€å•çš„ç”µå•†é¡µé¢ï¼Œæœ‰ä¸‹é¢ä¸‰ä¸ªäº¤äº’å…ƒç´ ï¼š

- ä¸€ä¸ª "add to cart" æŒ‰é’®
- ä¸€ä¸ªè´­ç‰©è½¦æŠ½å±‰æ¥æ˜¾ç¤ºå·²æ·»åŠ çš„å•†å“
- ä¸€ä¸ªè´­ç‰©è½¦æŠ½å±‰å¼€å…³

<LoopingVideo sources={[{ src: '/videos/stores-example.mp4', type: 'video/mp4' }]} />

_[**åœ¨ä½ çš„æœºå™¨ä¸Šå°è¯•å®Œæ•´çš„ä¾‹å­**](https://github.com/withastro/astro/tree/main/examples/with-nanostores) æˆ–è€…é€šè¿‡ StackBlitz åœ¨çº¿å°è¯•!_

ä½ åŸºç¡€çš„ Astro æ–‡ä»¶çœ‹èµ·æ¥åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

```astro
---
// src/pages/index.astro
import CartFlyoutToggle from '../components/CartFlyoutToggle';
import CartFlyout from '../components/CartFlyout';
import AddToCartForm from '../components/AddToCartForm';
---

<!DOCTYPE html>
<html lang="en">
<head>...</head>
<body>
  <header>
    <nav>
      <a href="/">Astro storefront</a>
      <CartFlyoutToggle client:load />
    </nav>
  </header>
  <main>
    <AddToCartForm client:load>
    <!-- ... -->
    </AddToCartForm>
  </main>
  <CartFlyout client:load />
</body>
</html>
```

### ä½¿ç”¨ "atoms"

è®©æˆ‘ä»¬åœ¨ç‚¹å‡»è´­ç‰©è½¦æŠ½å±‰å¼€å…³ï¼ˆ`CartFlyoutToggle`ï¼‰çš„æ—¶å€™æ‰“å¼€è´­ç‰©è½¦æŠ½å±‰ï¼ˆ`CartFlyout`ï¼‰

é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ JS æˆ– TS æ–‡ä»¶æ¥å­˜æ”¾æˆ‘ä»¬çš„çŠ¶æ€åº“ã€‚æˆ‘ä»¬å°†ä¼šä½¿ç”¨ ["atom"](https://github.com/nanostores/nanostores#atoms) æ¥åšè¿™ä»¶äº‹ï¼š

```js
// src/cartStore.js
import { atom } from 'nanostores';

export const isCartOpen = atom(false);
```

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»æ„æ–‡ä»¶ä¸­å¯¼å…¥è¿™ä¸ªçŠ¶æ€åº“æ¥è¿›è¡Œè¯»å†™ã€‚æˆ‘ä»¬æ¥ä¸‹æ¥ç€æ‰‹å¼€å‘æˆ‘ä»¬çš„ `CartFlyoutToggle` ç»„ä»¶ï¼š

<UIFrameworkTabs>
<Fragment slot="preact">
```jsx
// src/components/CartFlyoutToggle.jsx
import { useStore } from '@nanostores/preact';
import { isCartOpen } from '../cartStore';

export default function CartButton() {
  // ä½¿ç”¨ `useStore` é’©å­æ¥è¯»å–çŠ¶æ€åº“
  const $isCartOpen = useStore(isCartOpen);
  // ä½¿ç”¨ `.set` æ¥å°†æ•°æ®å†™å…¥çŠ¶æ€åº“
  return (
    <button onClick={() => isCartOpen.set(!$isCartOpen)}>Cart</button>
  )
}
```
</Fragment>
<Fragment slot="react">
```jsx
// src/components/CartFlyoutToggle.jsx
import { useStore } from '@nanostores/react';
import { isCartOpen } from '../cartStore';

export default function CartButton() {
  // ä½¿ç”¨ `useStore` é’©å­æ¥è¯»å–çŠ¶æ€åº“
  const $isCartOpen = useStore(isCartOpen);
  // ä½¿ç”¨ `.set` æ¥å°†æ•°æ®å†™å…¥çŠ¶æ€åº“
  return (
    <button onClick={() => isCartOpen.set(!$isCartOpen)}>Cart</button>
  )
}
```
</Fragment>
<Fragment slot="solid">
```jsx
// src/components/CartFlyoutToggle.jsx
import { useStore } from '@nanostores/solid';
import { isCartOpen } from '../cartStore';

export default function CartButton() {
  // ä½¿ç”¨ `useStore` é’©å­æ¥è¯»å–çŠ¶æ€åº“
  const $isCartOpen = useStore(isCartOpen);
  // ä½¿ç”¨ `.set` æ¥å°†æ•°æ®å†™å…¥çŠ¶æ€åº“
  return (
    <button onClick={() => isCartOpen.set(!$isCartOpen)}>Cart</button>
  )
}
```
</Fragment>
<Fragment slot="svelte">
```svelte
<!--src/components/CartFlyoutToggle.svelte-->
<script>
  import { isCartOpen } from '../cartStore';
</script>

<!--ä½¿ç”¨ "$" æ¥è¯»å–çŠ¶æ€åº“çš„å€¼-->
<button on:click={() => isCartOpen.set(!$isCartOpen)}>Cart</button>
```
</Fragment>
<Fragment slot="vue">
```vue
<!--src/components/CartFlyoutToggle.vue-->
<template>
  <!--ä½¿ç”¨ `.set` æ¥å°†æ•°æ®å†™å…¥çŠ¶æ€åº“-->
  <button @click="isCartOpen.set(!$isCartOpen)">Cart</button>
</template>

<script setup>
  import { isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';
  
  // ä½¿ç”¨ `useStore` é’©å­æ¥è¯»å–çŠ¶æ€åº“
  const $isCartOpen = useStore(isCartOpen);
</script>
```
</Fragment>
<Fragment slot="lit">
```ts
// src/components/CartFlyoutToggle.ts
import { LitElement, html } from 'lit';
import { isCartOpen } from '../cartStore';

export class CartFlyoutToggle extends LitElement {
  handleClick() {
    isCartOpen.set(!isCartOpen.get());
  }

  render() {
    return html`
      <button @click="${this.handleClick}">Cart</button>
    `;
  }
}

customElements.define('cart-flyout-toggle', CartFlyoutToggle);
```
</Fragment>
</UIFrameworkTabs>

ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä»æˆ‘ä»¬çš„ `CartFlyout` ç»„ä»¶ä¸­è¯»å– `isCartOpen` å€¼ï¼š

<UIFrameworkTabs>
<Fragment slot="preact">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/preact';
import { isCartOpen } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);

  return $isCartOpen ? <aside>...</aside> : null;
}
```
</Fragment>
<Fragment slot="react">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/react';
import { isCartOpen } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);

  return $isCartOpen ? <aside>...</aside> : null;
}
```
</Fragment>
<Fragment slot="solid">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/solid';
import { isCartOpen } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);

  return $isCartOpen ? <aside>...</aside> : null;
}
```
</Fragment>
<Fragment slot="svelte">
```svelte
<!--src/components/CartFlyout.svelte-->
<script>
  import { isCartOpen } from '../cartStore';
</script>

{#if $isCartOpen}
<aside>...</aside>
{/if}
```
</Fragment>
<Fragment slot="vue">
```vue
<!--src/components/CartFlyout.vue-->
<template>
  <aside v-if="$isCartOpen">...</aside>
</template>

<script setup>
  import { isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';

  const $isCartOpen = useStore(isCartOpen);
</script>
```
</Fragment>
<Fragment slot="lit">
```ts
// src/components/CartFlyout.ts
import { isCartOpen } from '../cartStore';
import { LitElement, html } from 'lit';
import { StoreController } from '@nanostores/lit';

export class CartFlyout extends LitElement {
  private cartOpen = new StoreController(this, isCartOpen);

  render() {
    return this.cartOpen.value ? html`<aside>...</aside>` : null;
  }
}

customElements.define('cart-flyout', CartFlyout);

```
</Fragment>
</UIFrameworkTabs>

### ä½¿ç”¨ "maps"

:::tip
**[Maps](https://github.com/nanostores/nanostores#maps) å¯¹äºä½ ç»å¸¸å†™å…¥çš„å¯¹è±¡æ¥è¯´æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©!**  é™¤äº†`atom` æä¾›çš„æ ‡å‡†çš„ `get()` å’Œ `set()` å¸®åŠ©å™¨ä¹‹å¤–ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ `.setKey()` å‡½æ•°æ¥æœ‰æ•ˆåœ°æ›´æ–°å•ä¸ªå¯¹è±¡çš„é”®å€¼ã€‚
:::

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥è·Ÿè¸ªä½ è´­ç‰©è½¦é‡Œçš„å•†å“ã€‚ä¸ºäº†é¿å…é‡å¤å’Œè·Ÿè¸ª "æ•°é‡"ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä½ çš„è´­ç‰©è½¦å­˜å‚¨ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä»¥å•†å“çš„ ID ä¸ºé”®ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª [Map](https://github.com/nanostores/nanostores#maps) æ¥åšè¿™ä»¶äº‹ã€‚

è®©æˆ‘ä»¬åœ¨å…ˆå‰çš„ `cartStore.js` ä¸­æ·»åŠ ä¸€ä¸ª `cartItem` çŠ¶æ€åº“ã€‚å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ TypeScript æ–‡ä»¶æ¥å®šä¹‰ã€‚


<JavascriptFlavorTabs>
  <Fragment slot="js">
  ```js
  // src/cartStore.js
  import { atom, map } from 'nanostores';

  export const isCartOpen = atom(false);

  /**
  * @typedef {Object} CartItem
  * @property {string} id
  * @property {string} name
  * @property {string} imageSrc
  * @property {number} quantity
  */

  /** @type {import('nanostores').MapStore<Record<string, CartItem>>} */
  export const cartItems = map({});

  ```
  </Fragment>
  <Fragment slot="ts">
  ```ts
  // src/cartStore.ts
  import { atom, map } from 'nanostores';

  export const isCartOpen = atom(false);

  export type CartItem = {
    id: string;
    name: string;
    imageSrc: string;
    quantity: number;
  }

  export const cartItems = map<Record<string, CartItem>>({});
  ```
  </Fragment>
</JavascriptFlavorTabs>

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¯¼å‡ºä¸€ä¸ª `addCartItem` å‡½æ•°ä¾›æˆ‘ä»¬çš„ç»„ä»¶ä½¿ç”¨ã€‚
- **å¦‚æœä½ çš„è´­ç‰©è½¦ä¸­ä¸å­˜åœ¨è¯¥å•†å“**ï¼Œæ·»åŠ å•†å“å¹¶è®¾ç½®åˆå§‹æ•°é‡ 1ã€‚
- **å¦‚æœè´­ç‰©è½¦ä¸­ *å·²ç»* å­˜åœ¨è¯¥å•†å“**ï¼Œåˆ™å°†è¯¥å•†å“æ•°é‡å¢åŠ  1ã€‚

<JavascriptFlavorTabs>
  <Fragment slot="js">
  ```js
  // src/cartStore.js
  ...
  export function addCartItem({ id, name, imageSrc }) {
    const existingEntry = cartItems.get()[id];
    if (existingEntry) {
      cartItems.setKey(id, {
        ...existingEntry,
        quantity: existingEntry.quantity + 1,
      })
    } else {
      cartItems.setKey(
        id,
        { id, name, imageSrc, quantity: 1 }
      );
    }
  }
  ```
  </Fragment>
  <Fragment slot="ts">
  ```ts
  // src/cartStore.ts
  ...
  type ItemDisplayInfo = Pick<CartItem, 'id' | 'name' | 'imageSrc'>;
  export function addCartItem({ id, name, imageSrc }: ItemDisplayInfo) {
    const existingEntry = cartItems.get()[id];
    if (existingEntry) {
      cartItems.setKey(id, {
        ...existingEntry,
        quantity: existingEntry.quantity + 1,
      });
    } else {
      cartItems.setKey(
        id,
        { id, name, imageSrc, quantity: 1 }
      );
    }
  }
  ```
  </Fragment>
</JavascriptFlavorTabs>

:::note
<details>

<summary>**ğŸ™‹ ä¸ºä»€ä¹ˆè¿™é‡Œä½¿ç”¨ `.get()` è€Œä¸æ˜¯ `useStore`ï¼Ÿ**</summary>

ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä»¬è¿™é‡Œè°ƒç”¨äº† `cartItems.get()`ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨æˆ‘ä»¬ React / Preact / Solid / Vue ä¾‹å­ä¸­çš„ `useStore`ã€‚è¿™æ˜¯å› ä¸º**useStore æ˜¯ç”¨æ¥è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ã€‚** æ¢å¥è¯è¯´ï¼Œ `useStore` åº”è¯¥è¢«ç”¨æ¥å°†çŠ¶æ€åº“çš„å€¼æ¸²æŸ“åˆ° UIã€‚ç”±äºæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶è¯»å–çš„å€¼ (åœ¨è¿™ä¸ªä¾‹å­ä¸­æŒ‡`addToCart`)ï¼Œå¹¶ä¸”æˆ‘ä»¬å¹¶ä¸è¯•å›¾æ¸²æŸ“è¯¥å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦åœ¨è¿™é‡Œä½¿ç”¨ `useStore` ã€‚
</details>
:::

æœ‰äº†çŠ¶æ€åº“ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¯æ¬¡æäº¤è¡¨å•æ—¶è°ƒç”¨ `AddToCartForm`å‡½æ•°ã€‚æˆ‘ä»¬è¿˜å¯ä»¥æ‰“å¼€è´­ç‰©è½¦æŠ½å±‰ï¼Œè¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå®Œæ•´çš„è´­ç‰©è½¦æ¦‚è¦ã€‚

<UIFrameworkTabs>
<Fragment slot="preact">
```jsx
// src/components/AddToCartForm.jsx
import { addCartItem, isCartOpen } from '../cartStore';

export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }

  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }

  return (
    <form onSubmit={addToCart}>
      {children}
    </form>
  )
}
```
</Fragment>
<Fragment slot="react">
```jsx
// src/components/AddToCartForm.jsx
import { addCartItem, isCartOpen } from '../cartStore';

export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }

  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }

  return (
    <form onSubmit={addToCart}>
      {children}
    </form>
  )
}
```
</Fragment>
<Fragment slot="solid">
```jsx
// src/components/AddToCartForm.jsx
import { addCartItem, isCartOpen } from '../cartStore';

export default function AddToCartForm({ children }) {
  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }

  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }

  return (
    <form onSubmit={addToCart}>
      {children}
    </form>
  )
}
```
</Fragment>
<Fragment slot="svelte">
```svelte
<!--src/components/AddToCartForm.svelte-->
<form on:submit|preventDefault={addToCart}>
  <slot></slot>
</form>

<script>
  import { addCartItem, isCartOpen } from '../cartStore';

  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }

  function addToCart() {
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }
</script>
```
</Fragment>
<Fragment slot="vue">
```vue
<!--src/components/AddToCartForm.vue-->
<template>
  <form @submit="addToCart">
    <slot></slot>
  </form>
</template>

<script setup>
  import { addCartItem, isCartOpen } from '../cartStore';

  // we'll hardcode the item info for simplicity!
  const hardcodedItemInfo = {
    id: 'astronaut-figurine',
    name: 'Astronaut Figurine',
    imageSrc: '/images/astronaut-figurine.png',
  }

  function addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(hardcodedItemInfo);
  }
</script>
```
</Fragment>
<Fragment slot="lit">
```ts
// src/components/AddToCartForm.ts
import { LitElement, html } from 'lit';
import { isCartOpen, addCartItem } from '../cartStore';

export class AddToCartForm extends LitElement {
  static get properties() {
    return {
      item: { type: Object },
    };
  }

  constructor() {
    super();
    this.item = {};
  }

  addToCart(e) {
    e.preventDefault();
    isCartOpen.set(true);
    addCartItem(this.item);
  }

  render() {
    return html`
      <form @submit="${this.addToCart}">
        <slot></slot>
      </form>
    `;
  }
}
customElements.define('add-to-cart-form', AddToCartForm);
```
</Fragment>
</UIFrameworkTabs>

æœ€åï¼Œæˆ‘ä»¬å°†åœ¨ `CartFlyout` ç»„ä»¶ä¸­æ¸²æŸ“è´­ç‰©è½¦å•†å“ï¼š

<UIFrameworkTabs>
<Fragment slot="preact">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/preact';
import { isCartOpen, cartItems } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);

  return $isCartOpen ? (
    <aside>
      {Object.values($cartItems).length ? (
        <ul>
          {Object.values($cartItems).map(cartItem => (
            <li>
              <img src={cartItem.imageSrc} alt={cartItem.name} />
              <h3>{cartItem.name}</h3>
              <p>Quantity: {cartItem.quantity}</p>
            </li>
          ))}
        </ul>
      ) : <p>Your cart is empty!</p>}
    </aside>
  ) : null;
}
```
</Fragment>
<Fragment slot="react">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/react';
import { isCartOpen, cartItems } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);

  return $isCartOpen ? (
    <aside>
      {Object.values($cartItems).length ? (
        <ul>
          {Object.values($cartItems).map(cartItem => (
            <li>
              <img src={cartItem.imageSrc} alt={cartItem.name} />
              <h3>{cartItem.name}</h3>
              <p>Quantity: {cartItem.quantity}</p>
            </li>
          ))}
        </ul>
      ) : <p>Your cart is empty!</p>}
    </aside>
  ) : null;
}
```
</Fragment>
<Fragment slot="solid">
```jsx
// src/components/CartFlyout.jsx
import { useStore } from '@nanostores/solid';
import { isCartOpen, cartItems } from '../cartStore';

export default function CartFlyout() {
  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);

  return $isCartOpen ? (
    <aside>
      {Object.values($cartItems).length ? (
        <ul>
          {Object.values($cartItems).map(cartItem => (
            <li>
              <img src={cartItem.imageSrc} alt={cartItem.name} />
              <h3>{cartItem.name}</h3>
              <p>Quantity: {cartItem.quantity}</p>
            </li>
          ))}
        </ul>
      ) : <p>Your cart is empty!</p>}
    </aside>
  ) : null;
}
```
</Fragment>
<Fragment slot="svelte">
```svelte
<!--src/components/CartFlyout.svelte-->
<script>
  import { isCartOpen, cartItems } from '../cartStore';
</script>

{#if $isCartOpen}
  {#if Object.values($cartItems).length}
    <aside>
      {#each Object.values($cartItems) as cartItem}
      <li>
        <img src={cartItem.imageSrc} alt={cartItem.name} />
        <h3>{cartItem.name}</h3>
        <p>Quantity: {cartItem.quantity}</p>
      </li>
      {/each}
    </aside>
  {#else}
    <p>Your cart is empty!</p>
  {/if}
{/if}
```
</Fragment>
<Fragment slot="vue">
```vue
<!--src/components/CartFlyout.vue-->
<template>
  <aside v-if="$isCartOpen">
    <ul v-if="Object.values($cartItems).length">
      <li v-for="cartItem in Object.values($cartItems)" v-bind:key="cartItem.name">
        <img :src=cartItem.imageSrc :alt=cartItem.name />
        <h3>{{cartItem.name}}</h3>
        <p>Quantity: {{cartItem.quantity}}</p>
      </li>
    </ul>
    <p v-else>Your cart is empty!</p>
  </aside>
</template>

<script setup>
  import { cartItems, isCartOpen } from '../cartStore';
  import { useStore } from '@nanostores/vue';

  const $isCartOpen = useStore(isCartOpen);
  const $cartItems = useStore(cartItems);
</script>
```
</Fragment>
<Fragment slot="lit">
```ts
// src/components/CartFlyout.ts
import { LitElement, html } from 'lit';
import { isCartOpen, cartItems } from '../cartStore';
import { StoreController } from '@nanostores/lit';

export class CartFlyoutLit extends LitElement {
  private cartOpen = new StoreController(this, isCartOpen);
  private getCartItems = new StoreController(this, cartItems);

  renderCartItem(cartItem) {
    return html`
      <li>
        <img src="${cartItem.imageSrc}" alt="${cartItem.name}" />
        <h3>${cartItem.name}</h3>
        <p>Quantity: ${cartItem.quantity}</p>
      </li>
    `;
  }

  render() {
    return this.cartOpen.value
      ? html`
          <aside>
            ${
              Object.values(this.getCartItems.value).length
                ? html`
                  <ul>
                    ${Object.values(this.getCartItems.value).map((cartItem) =>
                      this.renderCartItem(cartItem)
                    )}
                  </ul>
                `
                : html`<p>Your cart is empty!</p>`
            }
          </aside>
        `
      : null;
  }
}

customElements.define('cart-flyout', CartFlyoutLit);
```
</Fragment>
</UIFrameworkTabs>

ç°åœ¨ï¼Œä½ åº”è¯¥æ‹¥æœ‰äº†ä¸€ä¸ªå®Œå…¨äº¤äº’å¼çš„ç”µå•†ç¤ºä¾‹ï¼Œå¹¶ä¸”æ˜¯å®‡å®™ä¸­æœ€å°çš„ JS åŒ… ğŸš€

[**åœ¨ä½ çš„æœºå™¨ä¸Šå°è¯•å®Œæ•´çš„ä¾‹å­**](https://github.com/withastro/astro/tree/main/examples/with-nanostores) æˆ–è€…é€šè¿‡ StackBlitz åœ¨çº¿å°è¯•ï¼
