---
title: æ•°æ®è·å–
description: å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Astro fetch API è·å–è¿œç¨‹æ•°æ®ã€‚
---

`.astro` æ–‡ä»¶å¯ä»¥åœ¨æ„å»ºæ—¶è·å–è¿œç¨‹æ•°æ®æ¥è¾…åŠ©é¡µé¢ç”Ÿæˆã€‚


## Astro ä¸­çš„ `fetch()`

æ‰€æœ‰ [Astro ç»„ä»¶](/zh-cn/core-concepts/astro-components/) éƒ½å¯ä»¥åœ¨å®ƒä»¬çš„ç»„ä»¶è„šæœ¬ä¸­é€šè¿‡[å…¨å±€ `fetch()` å‡½æ•°](https://developer.mozilla.org/zh-CN/docs/Web/API/fetch)æ¥ä½¿ç”¨å®Œæ•´çš„ URLï¼ˆä¾‹å¦‚ https://example.com/api æˆ– `Astro.url + "/api"`ï¼‰å‘èµ· API è¯·æ±‚ã€‚

fetch è°ƒç”¨å°†ä¼šåœ¨æ„å»ºæ—¶æ‰§è¡Œï¼Œå¹¶ä¸”æ•°æ®éƒ½å¯ç”¨äºç»„ä»¶æ¨¡æ¿ä¸­æ¥ç”ŸæˆåŠ¨æ€ HTMLã€‚å¦‚æœå¯ç”¨ [SSR](/zh-cn/guides/server-side-rendering/) æ¨¡å¼ï¼Œä»»ä½• fetch è°ƒç”¨éƒ½å°†åœ¨è¿è¡Œæ—¶æ‰§è¡Œã€‚

ğŸ’¡ åœ¨ Astro ç»„ä»¶ script ä¸­[ä½¿ç”¨**é¡¶å±‚ await**](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/await#top_level_await) çš„ä¼˜åŠ¿ã€‚

ğŸ’¡ å°†è·å–çš„æ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ç»™ Astro å’Œæ¡†æ¶ç»„ä»¶ã€‚

```astro /await fetch\\(.*?\\)/
---
// src/components/User.astro
import Contact from '../components/Contact.jsx';
import Location from '../components/Location.astro';

const response = await fetch('https://randomuser.me/api/');
const data = await response.json();
const randomUser = data.results[0]
---
<!-- è·å–çš„æ•°æ®å¯ä»¥åœ¨æ„å»ºæ—¶åœ¨ HTML ä¸­æ¸²æŸ“ -->
<h1>User</h1>
<h2>{randomUser.name.first} {randomUser.name.last}</h2>

<!-- è·å–çš„æ•°æ®å¯ä»¥åœ¨æ„å»ºæ—¶ä¼ é€’ç»™ç»„ä»¶ä½œä¸ºå‚æ•° -->
<Contact client:load email={randomUser.email} />
<Location city={randomUser.location.city} />
```

:::note
è¯·è®°ä½ï¼ŒAstro ç»„ä»¶ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯åœ¨æ¸²æŸ“ç»„ä»¶æ—¶è·å–çš„ã€‚

ä½ éƒ¨ç½²çš„ Astro ç«™ç‚¹å°†åœ¨**æ„å»ºæ—¶è·å–ä¸€æ¬¡æ•°æ®**ã€‚åœ¨å¼€å‘ä¸­ï¼Œä½ å°†åœ¨ç»„ä»¶åˆ·æ–°æ—¶çœ‹åˆ°æ•°æ®è·å–ã€‚å¦‚æœä½ éœ€è¦åœ¨å®¢æˆ·ç«¯å¤šæ¬¡é‡æ–°è·å–æ•°æ®ï¼Œè¯·åœ¨ Astro ç»„ä»¶ä¸­ä½¿ç”¨[æ¡†æ¶ç»„ä»¶](/zh-cn/core-concepts/framework-components/)æˆ–[å®¢æˆ·ç«¯è„šæœ¬](/zh-cn/guides/client-side-scripts/)ã€‚
:::

## åœ¨æ¡†æ¶ç»„ä»¶ä¸­ä½¿ç”¨ `fetch()`

`fetch()` å‡½æ•°ä¹Ÿå¯åœ¨ä»»ä½•[æ¡†æ¶ç»„ä»¶](/zh-cn/core-concepts/framework-components/)ä¸­å…¨å±€ä½¿ç”¨ï¼š

```tsx title="src/components/Movies.tsx" /await fetch\\(.*?\\)/
import type { FunctionalComponent } from 'preact';
import { h } from 'preact';

const data = await fetch('https://example.com/movies.json').then((response) =>
  response.json()
);

// æ„å»ºæ—¶æ¸²æŸ“çš„ç»„ä»¶ä¹Ÿä¼šè¾“å‡ºæ—¥å¿—åˆ° CLIã€‚
// å½“ç”¨ client:* æŒ‡ä»¤æ¸²æŸ“æ—¶ï¼Œå®ƒä»¬ä¹Ÿä¼šè¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°ã€‚
console.log(data);

const Movies: FunctionalComponent = () => {
// å°†ç»“æœè¾“å‡ºåˆ°é¡µé¢ä¸Š
  return <div>{JSON.stringify(data)}</div>;
};

export default Movies;
```

## GraphQL æŸ¥è¯¢

Astro ä¹Ÿå¯ä»¥ä½¿ç”¨ `fetch()` å’Œä»»ä¸€æœ‰æ•ˆçš„ GraphQL æŸ¥è¯¢æ¥æŸ¥è¯¢ GraphQL æœåŠ¡å™¨ã€‚

```astro title="src/components/Film.astro" "await fetch"
---
const response = await fetch("https://swapi-graphql.netlify.app/.netlify/functions/index",
  {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({
      query: `
        query getFilm ($id:ID!) {
          film(id: $id) {
            title
            releaseDate
          }
        }
      `,
      variables: {
        id: "ZmlsbXM6MQ==",
      },
    }),
  });

const json = await response.json();
const { film } = json.data;
---
<h1>Fetching information about Star Wars: A New Hope</h1>
<h2>Title: {film.title}</h2>
<p>Year: {film.releaseDate}</p>
```

## ä»æ— å¤´CMS ä¸­è·å–

Astro ç»„ä»¶å¯ä»¥ä»ä½ æœ€å–œæ¬¢çš„ CMS ä¸­è·å–æ•°æ®ï¼Œç„¶åå°†å…¶å‘ˆç°ä¸ºé¡µé¢å†…å®¹ã€‚ä½¿ç”¨[åŠ¨æ€è·¯ç”±](/zh-cn/core-concepts/routing/#åŠ¨æ€è·¯ç”±)ï¼Œç»„ä»¶ç”šè‡³å¯ä»¥æ ¹æ®ä½ çš„ CMS å†…å®¹ç”Ÿæˆé¡µé¢ã€‚

è¯·å‚é˜… [CMS æŒ‡å—](/zh-cn/guides/cms/)ï¼ŒæŸ¥çœ‹æœ‰å…³å°† Astro ä¸æ— å¤´ CMSï¼ˆåŒ…æ‹¬ Storyblokã€Contentful å’Œ WordPressï¼‰é›†æˆçš„å®Œæ•´è¯¦ç»†ä¿¡æ¯ã€‚
