---
title: 部署你的 Astro 站点至 Codeberg Pages
description: 如何使用 Codeberg Pages 将你的 Astro 网站部署到网络上。
sidebar:
  label: Codeberg Pages
type: deploy
---
import { Steps } from '@astrojs/starlight/components';
你可以使用[Codeberg Pages](https://codeberg.page/)直接从[Codeberg](https://codeberg.org)上的存储库托管 Astro 网站。
## 如何部署
你可以使用 Codeberg CI 来自动构建和部署站点，从而将 Astro 网站部署到 Codeberg Pages。为此，你的源代码必须托管在 Codeberg 上，并进行以下操作：
<Steps>
1. 在[这里](https://codeberg.org/Codeberg-e.V./requests/issues)提起一个 Issue，标签选择 `ci` ，`Expected Resource Usage` 选 `medium`，`I would also like the following users to be added` 填 `@自己的 Codeberg 用户名`，其他自己看着填，等待审批通过。
2. 在 `astro.config.mjs` 文件中设置 [`site`](/zh-cn/reference/configuration-reference/#site) 和 [`base`](/zh-cn/reference/configuration-reference/#base)。
```js title="astro.config.mjs" ins={4-5}
import { defineConfig } from 'astro/config';
 export default defineConfig({
   site: 'https://<username>.codeberg.page',
   base: '/<my-repo>',
   outDir: 'dist',
   publicDir: 'public',
 });
``` 
    `base`

    为了让 Astro 将你的仓库名（例如：`/my-repo`）视为网站的根目录，所以需要一个 `base` 的值。
	`base` 的值应该是诸如 `/my-blog` 这样以斜杠开头的仓库名称。这样 Astro 就能理解你网站的根目录是 `/my-repo`，而不是默认的 `/`。
    :::caution
        配置此值后，所有内部页面链接都必须以你的 `base` 值作为前缀：
      ```astro ins="/my-repo"
      <a href="/my-repo/about">关于</a>
      ```
    请参阅 [配置 `base` 的值](/zh-cn/reference/configuration-reference/#base)
    :::
3. 在仓库根目录中，新建 `.forgejo` 文件夹，在 `.forgejo` 文件夹下再新建 `workflows` 文件夹。
4. 在文件夹中添加 `astro.yml` 文件，文件代码示例如下：
```yml
name: Deploy Astro site to Pages

on:
  # Runs on pushes targeting the default branch
  push:
    branches:
      # If you want to build from a different branch, change it here.
      - main
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    # You can find the list of available runners on https://codeberg.org/actions/meta, or run one yourself.
    runs-on: codeberg-tiny-lazy
    steps:
      - name: Clone the repository
        uses: https://code.forgejo.org/actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0
      - name: check .domains files
        run: |
          git ls-files public/.domains
          ls -la public/
          ls -la public/.domains || echo ".domains not found"
      - name: Setup Node.js
        uses: https://code.forgejo.org/actions/setup-node@v4
        with:
          node-version: 22
      - name: Install dependencies
        run: npm install
      - name: Build Astro site
        run: npm run build

      - name: Upload generated files
        uses: https://code.forgejo.org/actions/upload-artifact@v3
        with:
          name: Generated files
          path: dist/
          include-hidden-files: true
      
  deploy:
    needs: [ build ]
    runs-on: codeberg-tiny-lazy
    steps:
      - name: Clone the repository
        uses: https://code.forgejo.org/actions/checkout@v4
        with:
          submodules: recursive
          fetch-depth: 0

      - name: Checkout the target branch and clean it up
        run: |
          git checkout pages || git switch --orphan pages
          rm -Rfv $(ls -A | egrep -v '^(\.git|LICENSE)$')

      - name: Download generated files
        uses: https://code.forgejo.org/actions/download-artifact@v3
        with:
          name: Generated files

      - name: Publish the website
        run: |
          git config user.email codeberg-ci
          git config user.name "Codeberg CI"
          echo "=== Files being committed ==="
          ls -la
          git add .
          git commit --allow-empty --message "Codeberg build for ${GITHUB_SHA}"
          git push origin pages

```
5. 在 `public` 目录下新建 `.domains` 文件，输入 `用户名.codeberg.pages`，在前面的域名后面加上`/你的仓库名称`，就是你的默认域名。如果要添加自定义域名，请查看[这篇文章](https://codeberg.org/Codeberg/pages-server/src/branch/main/README.md)。
6. 提交你的更改并将其推送到 Codeberg ，Codeberg 会为你自动部署 。
</Steps>
你的网站现在应该可以发布了！当你将更改推送到 Astro 项目的仓库时，Codeberg CI 流水线将自动为你部署它们。
