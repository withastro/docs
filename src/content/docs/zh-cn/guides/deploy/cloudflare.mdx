---
title: éƒ¨ç½²ä½ çš„ Astro ç«™ç‚¹è‡³ Cloudflare Pages
description: å¦‚ä½•ä½¿ç”¨ Cloudflare Pages å°†ä½ çš„ Astro ç½‘ç«™éƒ¨ç½²åˆ°ç½‘ç»œä¸Šã€‚
type: deploy
i18nReady: true
---

ä½ å¯ä»¥å°†ä½ çš„ Astro é¡¹ç›®éƒ¨ç½²åœ¨ [Cloudflare Pages](https://pages.cloudflare.com/) ä¸Šã€‚Cloudflare Pages æ˜¯ä¸€ä¸ªä¾›å‰ç«¯å¼€å‘äººå‘˜åä½œå’Œéƒ¨ç½²é™æ€ (JAMstack) æˆ– SSR ç½‘ç«™çš„å¹³å°ã€‚

æœ¬æŒ‡å—åŒ…å«ï¼š

- [å¦‚ä½•ä½¿ç”¨ Git éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹](#å¦‚ä½•ä½¿ç”¨-git-éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹)
- [å¦‚ä½•ä½¿ç”¨ Wrangler éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹](#å¦‚ä½•ä½¿ç”¨-wrangler-éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹)
- [å¦‚ä½•éƒ¨ç½² SSR ç«™ç‚¹](#å¦‚ä½•éƒ¨ç½²-ssr-ç«™ç‚¹)

## å‰ææ¡ä»¶

å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ï¼š

- ä¸€ä¸ª Cloudflare è´¦æˆ·ã€‚å¦‚æœä½ æš‚æ—¶è¿˜æ²¡æœ‰ï¼Œä½ å¯ä»¥ç°åœ¨å…è´¹å» Cloudflare å®˜ç½‘æ³¨å†Œä¸€ä¸ªã€‚
- ä½ çš„æºä»£ç å­˜å‚¨åœ¨ä¸€ä¸ª [GitHub](https://github.com/) æˆ–è€… [GitLab](https://about.gitlab.com/) ä»“åº“é‡Œã€‚

## å¦‚ä½•ä½¿ç”¨ Git éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹

1. åœ¨ Cloudflare Pages è®¾ç½®ä¸€ä¸ªæ–°é¡¹ç›®ã€‚
2. å°†ä½ çš„ä»£ç æäº¤åˆ°ä¸€ä¸ª Git ä»“åº“ä¸­ (GitHub, GitLab)ã€‚
3. ç™»é™† Cloudflare Dashboard å¹¶åœ¨ **Account Home** > **Pages** é€‰æ‹©ä½ çš„è´¦æˆ·ã€‚
4. é€‰æ‹© **Create a new Project**ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼‰å’Œ **Connect Git**ï¼ˆè¿æ¥ Gitï¼‰é€‰é¡¹ã€‚
5. é€‰æ‹©ä½ æƒ³éƒ¨ç½²çš„ Git é¡¹ç›®å¹¶ç‚¹å‡» **Begin setup**ï¼ˆåˆå§‹è®¾ç½®ï¼‰ã€‚
6. ä½¿ç”¨ä»¥ä¸‹çš„æ„å»ºè®¾ç½®ï¼š

    - **Framework presetï¼ˆæ¡†æ¶é¢„è®¾ï¼‰:** `Astro`
    - **Build commandï¼ˆæ„å»ºå‘½ä»¤ï¼‰:** `npm run build`
    - **Build output directoryï¼ˆæ„å»ºè¾“å‡ºç›®å½•ï¼‰:** `dist`

7. ç‚¹å‡» **Save and Deploy**ï¼ˆä¿å­˜å¹¶éƒ¨ç½²ï¼‰æŒ‰é’®ã€‚

## å¦‚ä½•ä½¿ç”¨ Wrangler éƒ¨ç½²ä¸€ä¸ªç«™ç‚¹

1. å®‰è£… [Wrangler CLI](https://developers.cloudflare.com/workers/wrangler/get-started/)ã€‚
2. ä½¿ç”¨ `wrangler login` åœ¨ Wrangler ç™»é™† Cloudflare è´¦æˆ·å¹¶æˆæƒã€‚
3. è¿è¡Œä½ çš„æ„å»ºå‘½ä»¤ï¼ˆæ¯”å¦‚ `npm run build`ï¼‰ã€‚
4. ä½¿ç”¨ `npx wrangler pages publish dist` è¿›è¡Œéƒ¨ç½²ã€‚

```bash
# å®‰è£… Wrangler CLIï¼ˆå‘½ä»¤è¡Œï¼‰
npm install -g wrangler
# åœ¨ CLI ä¸­ç™»é™† Cloudflare è´¦æˆ·
wrangler login
# è¿è¡Œä½ çš„æ„å»ºå‘½ä»¤
npm run build
# åˆ›å»ºæ–°çš„éƒ¨ç½²
npx wrangler pages publish dist
```

ä¸Šä¼ å®Œæ‰€æœ‰çš„æ–‡ä»¶åï¼ŒWrangler å°†ä¸ºä½ æä¾›ä¸€ä¸ªé¢„è§ˆ URL ä»¥æ£€æŸ¥ä½ çš„ç«™ç‚¹ã€‚å½“ä½ ç™»å½• Cloudflare Pages ä»ªè¡¨æ¿æ—¶ï¼Œä½ å°†çœ‹åˆ°ä½ çš„æ–°é¡¹ç›®ã€‚

### ä½¿ç”¨ Wrangler åœ¨æœ¬åœ°å¯ç”¨é¢„è§ˆ

è¦ä½¿é¢„è§ˆç‰ˆæ­£å¸¸å·¥ä½œï¼Œä½ å¿…é¡»å®‰è£… `wrangler`

```bash
pnpm install wrangler --save-dev
```

ç„¶åå°±å¯ä»¥å°†é¢„è§ˆè„šæœ¬ä» Astro çš„å†…ç½®é¢„è§ˆå‘½ä»¤æ›´æ–°ä¸º `wrangler` äº†ï¼š

```json title="package.json"
"preview": "wrangler pages dev ./dist"
```

## å¦‚ä½•éƒ¨ç½² SSR ç«™ç‚¹

ä½ å¯ä»¥ä½¿ç”¨ [`@astrojs/cloudflare` é€‚é…å™¨](/zh-cn/guides/integrations-guide/cloudflare/)å°† Astro SSR ç«™ç‚¹éƒ¨ç½²åˆ° Cloudflare Pagesã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è®¾ç½®é€‚é…å™¨ã€‚å®Œæˆåï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸Šè¿°æ–‡æ¡£ä¸­çš„ä»»ä½•æ–¹æ³•è¿›è¡Œéƒ¨ç½²ã€‚

### å¿«é€Ÿå®‰è£…

ä½¿ç”¨ä»¥ä¸‹ `astro add` å‘½ä»¤æ·»åŠ  Cloudflare é€‚é…å™¨ä»¥åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­å¯ç”¨ SSRã€‚è¿™å°†å®‰è£…é€‚é…å™¨å¹¶ä¸€æ­¥å¯¹ä½ çš„æ–‡ä»¶ `astro.config.mjs` è¿›è¡Œé€‚å½“çš„æ›´æ”¹ã€‚

```bash
npx astro add cloudflare
```

### æ‰‹åŠ¨å®‰è£…

å¦‚æœä½ æƒ³è¦æ‰‹åŠ¨å®‰è£…é€‚é…å™¨ï¼Œè¯·å®Œæˆä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š

1. ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨å°† `@astrojs/cloudflare` æ·»åŠ åˆ°é¡¹ç›®çš„ä¾èµ–é¡¹ä¸­ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ npm æˆ–ä¸ç¡®å®šæ˜¯å“ªä¸ªåŒ…ç®¡ç†å™¨ï¼Œè¯·åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š

    ```bash
    npm install @astrojs/cloudflare
    ```

2. å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°ä½ çš„ `astro.config.mjs` æ–‡ä»¶ä¸­ï¼š

    ```js title="astro.config.mjs" ins={2, 5-6}
    import { defineConfig } from 'astro/config';
    import cloudflare from '@astrojs/cloudflare';

    export default defineConfig({
      output: 'server',
      adapter: cloudflare()
    });
    ```

### æ¨¡å¼

ç°åœ¨ä½¿ç”¨ [`@astrojs/cloudflare`](https://github.com/withastro/astro/tree/main/packages/integrations/cloudflare#readme) é€‚é…å™¨éƒ¨ç½²åˆ° Pages Functions æ—¶æœ‰ä¸¤ç§æ¨¡å¼ã€‚

1. **advanced**ï¼ˆé«˜çº§ï¼‰æ¨¡å¼ï¼šåœ¨æ­¤æ¨¡å¼ä¸‹ï¼ŒAstro ä¼šåœ¨ `dist` ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª `_worker.js` æ–‡ä»¶ã€‚æˆ–è€…è‡ªåŠ¨å˜ä¸ºä¸€ä¸ª `directory`ï¼ˆç›®å½•ï¼‰æ¨¡å¼ï¼Œé¡µé¢å°†ä»é¡¹ç›®æ ¹ç›®å½•ä¸­çš„å‡½æ•°æ–‡ä»¶å¤¹ä¸­ç¼–è¯‘ä»£ç ã€‚

    > å¦‚æœæ²¡æœ‰è®¾ç½®ä»»ä½•æ¨¡å¼ï¼Œé»˜è®¤æ¨¡å¼æ˜¯ `"advanced"`ã€‚

2. **directory**ï¼ˆç›®å½•ï¼‰æ¨¡å¼ï¼šç›®å½•æ¨¡å¼æ„å‘³ç€é€‚é…å™¨å°†ä»¥ç›¸åŒçš„æ–¹å¼ç¼–è¯‘æ‚¨çš„åº”ç”¨ç¨‹åºçš„å®¢æˆ·ç«¯éƒ¨åˆ†ï¼Œä½†å®ƒå°† worker è„šæœ¬ç§»åŠ¨åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸­çš„ `functions` æ–‡ä»¶å¤¹ä¸­ã€‚é€‚é…å™¨åªä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸­ç”Ÿæˆä¸€ä¸ª `[[path]].js` æ–‡ä»¶ï¼Œä»¥å…è®¸æ‚¨æ·»åŠ å…¶ä»–æ’ä»¶å’Œä¸­é—´ä»¶ï¼Œè¿™äº›ä¸­é—´ä»¶å¯ä»¥è¢«æ£€æŸ¥åˆ°ç‰ˆæœ¬æ§åˆ¶ä¸­ã€‚

    ```ts title="astro.config.mjs" "directory"
    export default defineConfig({
      adapter: cloudflare({ mode: "directory" }),
    });
    ```
### ä½¿ç”¨ Pages Functions

[Pages Functions](https://developers.cloudflare.com/pages/platform/functions/)ä½¿ä½ èƒ½å¤Ÿè¿è¡ŒæœåŠ¡å™¨ç«¯ä»£ç ä»¥å¯ç”¨åŠ¨æ€åŠŸèƒ½ï¼Œè€Œæ— éœ€è¿è¡Œä¸“ç”¨æœåŠ¡å™¨ã€‚

é¦–å…ˆï¼Œåœ¨ä½ é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `/functions` ç›®å½•ã€‚åœ¨æ­¤ç›®å½•ä¸­ç¼–å†™çš„ Functions æ–‡ä»¶ä¼šè‡ªåŠ¨åœ¨é¢„å…ˆæŒ‡å®šçš„ç›®å½•ä¸Šç”Ÿæˆå…·æœ‰è‡ªå®šä¹‰åŠŸèƒ½çš„ Workerã€‚è¦äº†è§£æœ‰å…³ç¼–å†™å‡½æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [Pages Functions æ–‡æ¡£](https://developers.cloudflare.com/pages/platform/functions/)ã€‚

ğŸ“š é˜…è¯»æ›´å¤šå…³äº [Astro ä¸­çš„ SSRï¼ˆæœåŠ¡ç«¯æ¸²æŸ“ï¼‰](/zh-cn/guides/server-side-rendering/) çš„ä¿¡æ¯

## æ•…éšœæ’é™¤

å¦‚æœæ‚¨é‡åˆ°é”™è¯¯ï¼Œè¯·ä»”ç»†æ£€æŸ¥æ‚¨åœ¨æœ¬åœ°ä½¿ç”¨çš„ `node` ç‰ˆæœ¬ (ä½¿ç”¨å‘½ä»¤ `node -v`) æ˜¯å¦ä¸æ‚¨åœ¨ Pages ç¯å¢ƒå˜é‡ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ç›¸åŒ¹é…ã€‚

Cloudflare éœ€è¦ [node `v16.13`](https://miniflare.dev/get-started/cli#installation)ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯” Astro å¼€ç®±å³ç”¨çš„æœ€ä½ç‰ˆæœ¬æ›´æ–°çš„ç‰ˆæœ¬ï¼Œå› æ­¤è¯·ä»”ç»†æ£€æŸ¥æ‚¨æ˜¯å¦ä½¿ç”¨äº†è‡³å°‘ `v16.13`ã€‚

ç”±äº Cloudflare çš„ Auto Minifyï¼ˆè‡ªåŠ¨å‹ç¼©ï¼‰åŠŸèƒ½ï¼Œå®¢æˆ·ç«¯ Hydration å¯èƒ½ä¼šå¤±è´¥ã€‚å¦‚æœä½ åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ° `Hydration completed but contains mismatches`ï¼Œè¯·ç¡®ä¿åœ¨ Cloudflare è®¾ç½®ä¸­ç¦ç”¨ Auto Minifyã€‚
