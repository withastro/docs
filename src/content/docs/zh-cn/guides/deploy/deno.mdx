---
title: å¦‚ä½•å°†ä½ çš„ Astro ç½‘ç«™éƒ¨ç½²åˆ° Deno
description: å¦‚ä½•å°†ä½ çš„ Astro ç½‘ç«™é€šè¿‡ Deno éƒ¨ç½²ä¸Šçº¿
type: deploy
i18nReady: true
---

ä½ å¯ä»¥å°†ä¸€ä¸ªä½¿ç”¨æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„ Astro ç½‘ç«™éƒ¨ç½²åˆ° Deno Deployï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨å…¨çƒèŒƒå›´è¾¹çš„è¾¹ç¼˜æœåŠ¡ä¸Šè¿è¡Œ JavaScriptã€TypeScript å’Œ WebAssembly çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚

æœ¬æŒ‡å—æä¾›äº†é€šè¿‡ GitHub Actions æˆ– Deno Deploy CLI éƒ¨ç½²åˆ° Deno Deploy çš„ä»‹ç»ã€‚

## è¦æ±‚

æœ¬æŒ‡å—å‡è®¾ä½ å·²ç»å®‰è£…äº† [Deno](https://deno.land/)ã€‚

## é¡¹ç›®é…ç½®

ä½ çš„ Astro é¡¹ç›®å¯ä»¥ä½œä¸ºæœåŠ¡å™¨ç«¯æ¸²æŸ“ç«™ç‚¹ï¼ˆSSRï¼‰éƒ¨ç½²åˆ° Deno Deployã€‚æ³¨æ„ï¼ŒDeno Deploy ä¸æ”¯æŒé™æ€ç«™ç‚¹ã€‚

### SSR é€‚é…å™¨

è¦åœ¨ Astro é¡¹ç›®ä¸­å¯ç”¨ SSR å¹¶åœ¨ Deno Deploy ä¸Šè¿›è¡Œéƒ¨ç½²ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹ `astro add` å‘½ä»¤æ·»åŠ  [Deno é€‚é…å™¨][Deno adapter]ã€‚è¿™å°†ä¸€æ­¥å®‰è£…é€‚é…å™¨å¹¶å¯¹ä½ çš„ `astro.config.mjs` æ–‡ä»¶è¿›è¡Œé€‚å½“æ›´æ”¹ã€‚

```bash
npx astro add deno
```

å¦‚æœä½ æ›´å–œæ¬¢æ‰‹åŠ¨å®‰è£…é€‚é…å™¨ï¼Œåˆ™éœ€è¦å®Œæˆä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š

1. ä½¿ç”¨ä½ å–œæ¬¢çš„åŒ…ç®¡ç†å™¨å°† [`@astrojs/deno` é€‚é…å™¨][Deno adapter] å®‰è£…åˆ°ä½ çš„é¡¹ç›®ä¾èµ–ä¸­ã€‚å¦‚æœä½ ä¸ç¡®å®šæ˜¯å¦ä½¿ç”¨ npm çš„è¯ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

    ```bash
      npm install @astrojs/deno
    ```

2. ä½¿ç”¨ä¸‹é¢çš„ä¿®æ”¹æ¥æ›´æ–°ä½ çš„ `astro.config.mjs` é¡¹ç›®é…ç½®æ–‡ä»¶ã€‚

    ```js ins={3,6-7}
    // astro.config.mjs
    import { defineConfig } from 'astro/config';
    import deno from '@astrojs/deno';

    export default defineConfig({
      output: 'server',
      adapter: deno(),
    });
    ```

    æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹ä¿®æ”¹æ¥æ›´æ–° `package.json` ä¸­çš„ `preview` è„šæœ¬ã€‚

    ```json del={8} ins={9}
    // package.json
    {
      // ...
      "scripts": {
        "dev": "astro dev",
        "start": "astro dev",
        "build": "astro build",
        "preview": "astro preview"
        "preview": "deno run --allow-net --allow-read --allow-env ./dist/server/entry.mjs"
      }
    }
    ```
    
    ä½ ç°åœ¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤é€šè¿‡ Deno åœ¨æœ¬åœ°é¢„è§ˆä½ ç”Ÿäº§ç¯å¢ƒçš„ Astro ç«™ç‚¹ã€‚

    ```bash
    npm run preview
    ```

## å¦‚ä½•éƒ¨ç½²

ä½ å¯ä»¥é€šè¿‡ GitHub Actions æˆ–ä½¿ç”¨ Deno Deploy çš„å‘½ä»¤è¡Œç•Œé¢ï¼ˆCLIï¼‰å°†é¡¹ç›®éƒ¨ç½²åˆ° Deno Deployã€‚

### ä½¿ç”¨ GitHub Actions è¿›è¡Œéƒ¨ç½²

å¦‚æœä½ çš„é¡¹ç›®å­˜å‚¨åœ¨ GitHub ä¸Šï¼Œ[Deno Deploy ç½‘ç«™](https://dash.deno.com/) å°†æŒ‡å¯¼ä½ è®¾ç½® GitHub Actions æ¥éƒ¨ç½²ä½ çš„ Astro ç«™ç‚¹ã€‚

1. å°†ä½ çš„ä»£ç æ¨é€åˆ°å…¬å¼€æˆ–ç§æœ‰çš„ GitHub å­˜å‚¨ä»“åº“ã€‚

2. ä½¿ç”¨ä½ çš„ GitHub è´¦æˆ·ç™»å½• [Deno Deploy](https://dash.deno.com/)ï¼Œç„¶åå•å‡» [New Project](https://dash.deno.com)ã€‚

3. é€‰æ‹©ä½ çš„å­˜å‚¨ä»“åº“å’Œè¦éƒ¨ç½²çš„åˆ†æ”¯ï¼Œå¹¶é€‰æ‹© **GitHub Action** æ¨¡å¼ã€‚ï¼ˆä½ çš„ Astro ç«™ç‚¹éœ€è¦ä¸€ä¸ªæ„å»ºæ­¥éª¤ï¼Œä¸èƒ½ä½¿ç”¨ Automatic æ¨¡å¼ã€‚ï¼‰

4. åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `.github/workflows/deploy.yml` çš„æ–°æ–‡ä»¶ï¼Œå¹¶ç²˜è´´ä¸‹é¢çš„ YAML å†…å®¹ã€‚è¿™ç±»ä¼¼äº Deno Deploy æä¾›çš„ YAMLï¼Œä½†è¿˜åŒ…æ‹¬ä½ çš„ Astro ç«™ç‚¹æ‰€éœ€çš„å…¶ä»–æ­¥éª¤ã€‚

    ```yaml
    name: Deploy
    on: [push]

    jobs:
      deploy:
        name: Deploy
        runs-on: ubuntu-latest
        permissions:
          id-token: write # ç”¨äº Deno Deploy èº«ä»½è®¤è¯
          contents: read # ç”¨äºå…‹éš†ä»“åº“

        steps:
          - name: Clone repository
            uses: actions/checkout@v3

          # æ²¡æœ‰ä½¿ç”¨ npmï¼Ÿè¯·å°† `npm ci` ä¿®æ”¹ä¸º `yarn install` æˆ– `pnpm i`
          - name: Install dependencies
            run: npm ci

          # æ²¡æœ‰ä½¿ç”¨ npmï¼Ÿè¯·å°† `npm run build` ä¿®æ”¹ä¸º `yarn build` æˆ– `pnpm run build`
          - name: Build Astro
            run: npm run build

          - name: Upload to Deno Deploy
            uses: denoland/deployctl@v1
            with:
              project: my-deno-project # TODO: æ›¿æ¢ä¸º Deno Deploy é¡¹ç›®çš„åç§°
              entrypoint: server/entry.mjs
              root: dist
    ```

5. æäº¤æ­¤ YAML æ–‡ä»¶ï¼Œç„¶åæ¨é€åˆ°ä½ é…ç½®çš„éƒ¨ç½²åˆ†æ”¯åï¼Œå°†ä¼šè‡ªåŠ¨å¼€å§‹éƒ¨ç½²ï¼

   ä½ å¯ä»¥åœ¨ GitHub å­˜å‚¨åº“é¡µé¢ä¸Šçš„ "Actions" é€‰é¡¹å¡ä¸Šï¼Œæˆ–åœ¨ [Deno Deploy](https://dash.deno.com) ä¸Šè·ŸæŸ¥çœ‹éƒ¨ç½²è¿›åº¦ã€‚

### ä½¿ç”¨ CLI è¿›è¡Œéƒ¨ç½²

1. å®‰è£… [Deno Deploy CLI](https://deno.com/deploy/docs/deployctl)ã€‚

    ```bash
    deno install --allow-read --allow-write --allow-env --allow-net --allow-run --no-check -r -f https://deno.land/x/deploy/deployctl.ts
    ```

2. è¿è¡Œ Astro çš„æ„å»ºæ­¥éª¤ã€‚

    ```bash
    npm run build
    ```

3. è¿è¡Œ `deployctl` è¿›è¡Œéƒ¨ç½²ï¼

   åœ¨ä¸‹é¢çš„å‘½ä»¤ä¸­ï¼Œå°† `<ACCESS-TOKEN>` æ›¿æ¢ä¸ºä½ çš„ [ä¸ªäººè®¿é—®ä»¤ç‰Œ](https://dash.deno.com/user/access-tokens)ï¼Œå°† `<MY-DENO-PROJECT>` æ›¿æ¢ä¸ºä½ çš„ Deno Deploy é¡¹ç›®åç§°ã€‚

    ```bash
    DENO_DEPLOY_TOKEN=<ACCESS-TOKEN> deployctl deploy --project=<MY-DENO-PROJECT> --no-static --include=./dist ./dist/server/entry.mjs
    ```

    ä½ å¯ä»¥åœ¨ [Deno Deploy](https://dash.deno.com) ä¸Šè·Ÿè¸ªæ‰€æœ‰éƒ¨ç½²ã€‚

4. (å¯é€‰) ä¸ºäº†å°†æ„å»ºå’Œéƒ¨ç½²ç®€åŒ–ä¸ºä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥åœ¨ `package.json` ä¸­æ·»åŠ ä¸€ä¸ª `deploy-deno` è„šæœ¬ã€‚

    ```json ins={9}
    // package.json
    {
      // ...
      "scripts": {
        "dev": "astro dev",
        "start": "astro dev",
        "build": "astro build",
        "preview": "deno run --allow-net --allow-read --allow-env ./dist/server/entry.mjs",
        "deno-deploy": "npm run build && deployctl deploy --project=<MY-DENO-PROJECT> --no-static --include=./dist ./dist/server/entry.mjs"
      }
    }
    ```

    ç„¶åä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸€æ­¥æ„å»ºå’Œéƒ¨ç½²ä½ çš„ Astro ç«™ç‚¹ã€‚

    ```bash
    DENO_DEPLOY_TOKEN=<ACCESS-TOKEN> npm run deno-deploy
    ```

ğŸ“š äº†è§£æ›´å¤šå…³äº [Astro ä¸­çš„ SSR](/zh-cn/guides/server-side-rendering/) çš„å†…å®¹ã€‚

[Deno adapter]: https://github.com/denoland/deno-astro-adapter
