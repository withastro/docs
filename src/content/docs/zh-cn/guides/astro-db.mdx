---
title: 'Astro DB'
description: äº†è§£å¦‚ä½•ä½¿ç”¨ Astro DBâ€”â€”ä¸€ä¸ªä¸“é—¨ä¸º Astro è®¾è®¡çš„å…¨æ‰˜ç®¡ SQL æ•°æ®åº“ã€‚
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/db/'
i18nReady: true
---
import { FileTree } from '@astrojs/starlight/components';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro';
import ReadMore from '~/components/ReadMore.astro';
import Since from '~/components/Since.astro';
import { Steps } from '@astrojs/starlight/components';

Astro DB æ˜¯ä¸€æ¬¾ä¸“ä¸º Astro è®¾è®¡çš„å…¨æ‰˜ç®¡ SQL æ•°æ®åº“ã€‚åœ¨ Astro ä¸­è¿›è¡Œæœ¬åœ°å¼€å‘å¹¶éƒ¨ç½²åˆ°ä»»ä½•ä¸ libSQL å…¼å®¹çš„æ•°æ®åº“ã€‚

Astro DB æ˜¯ä¸€ç§é…ç½®ã€å¼€å‘å’ŒæŸ¥è¯¢æ•°æ®çš„å®Œæ•´è§£å†³æ–¹æ¡ˆã€‚æ¯å½“ä½ è¿è¡Œ`astro dev`æ—¶ï¼Œéƒ½ä¼šåœ¨`.astro/content.db`ä¸­åˆ›å»ºä¸€ä¸ªæœ¬åœ°æ•°æ®åº“æ¥ç®¡ç†æ•°æ®ï¼Œè€Œæ— éœ€ Docker æˆ–ç½‘ç»œè¿æ¥ã€‚

## å®‰è£…

ä½¿ç”¨å†…ç½®çš„ `astro add` å‘½ä»¤å®‰è£… [`@astrojs/db` é›†æˆ](/zh-cn/guides/integrations-guide/db/)ï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add db
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add db
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add db
  ```
  </Fragment>
</PackageManagerTabs>

## å®šä¹‰ä½ çš„æ•°æ®åº“

ä½¿ç”¨ `astro add` å‘½ä»¤å®‰è£… `@astrojs/db` å°†è‡ªåŠ¨åœ¨ä½ çš„é¡¹ç›®ä¸­åˆ›å»ºä¸€ä¸ª `db/config.ts` æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰ä½ çš„æ•°æ®åº“è¡¨ï¼š

```ts title="db/config.ts"
import { defineDb } from 'astro:db';

export default defineDb({
  tables: { },
})
```

### è¡¨

Astro DB ä¸­çš„æ•°æ®æ˜¯é€šè¿‡ SQL è¡¨å­˜å‚¨çš„ã€‚è¡¨å°†ä½ çš„æ•°æ®ç»“æ„åŒ–ä¸ºè¡Œå’Œåˆ—ï¼Œå…¶ä¸­åˆ—å¼ºåˆ¶æ¯è¡Œå€¼çš„ç±»å‹ã€‚

é€šè¿‡æä¾›ç°æœ‰ libSQL æ•°æ®åº“ä¸­çš„æ•°æ®ç»“æ„æˆ–å°†åœ¨æ–°æ•°æ®åº“ä¸­æ”¶é›†çš„æ•°æ®ï¼Œåœ¨ `db/config.ts` æ–‡ä»¶ä¸­å®šä¹‰è¡¨ã€‚è¿™å°†å…è®¸ Astro ä¸ºä½ çš„é¡¹ç›®ç”Ÿæˆä¸€ä¸ª TypeScript æ¥å£æ¥æŸ¥è¯¢è¯¥è¡¨ã€‚è¿™æ„å‘³ç€å½“ä½ è®¿é—®æ•°æ®æ—¶ï¼Œå°†è·å¾—å®Œæ•´çš„ TypeScript æ”¯æŒï¼ŒåŒ…æ‹¬å±æ€§è‡ªåŠ¨å®Œæˆå’Œç±»å‹æ£€æŸ¥ã€‚

è¦é…ç½®æ•°æ®åº“è¡¨ï¼Œåº”ä» `astro:db` å¯¼å…¥å¹¶ä½¿ç”¨ `defineTable()` å’Œ `column` å·¥å…·ã€‚ç„¶åï¼Œä¸ºè¡¨å®šä¹‰ä¸€ä¸ªåç§°ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ä»¥åŠæ¯åˆ—çš„æ•°æ®ç±»å‹ã€‚

è¿™ä¸ªä¾‹å­é…ç½®äº†ä¸€ä¸ª `Comment` è¡¨ï¼Œå®ƒæœ‰ `author` å’Œ `body` çš„å¿…éœ€æ–‡æœ¬åˆ—ã€‚ç„¶åï¼Œé€šè¿‡ `defineDb()` å¯¼å‡ºä½¿å…¶åœ¨ä½ çš„é¡¹ç›®ä¸­å¯ç”¨ã€‚

```ts title="db/config.ts" "Comment"
import { defineDb, defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
})

export default defineDb({
  tables: { Comment },
})
```

<ReadMore>æŸ¥çœ‹ [è¡¨é…ç½®å‚è€ƒ](/zh-cn/guides/integrations-guide/db/#è¡¨é…ç½®å‚è€ƒ) ä»¥è·å–å®Œæ•´çš„è¡¨é€‰é¡¹å‚è€ƒã€‚</ReadMore>

### åˆ—

Astro DB æ”¯æŒä»¥ä¸‹åˆ—ç±»å‹ï¼š

```ts title="db/config.ts" "column.text()" "column.number()" "column.boolean()" "column.date()" "column.json()"
import { defineTable, column } from 'astro:db';

const Comment = defineTable({
  columns: {
    // æ–‡æœ¬å­—ç¬¦ä¸²ã€‚
    author: column.text(),
    // æ•´æ•°å€¼ã€‚
    likes: column.number(),
    // å¸ƒå°”å€¼ã€‚
    flagged: column.boolean(),
    // ä½œä¸º JavaScript Date å¯¹è±¡æŸ¥è¯¢çš„æ—¥æœŸ/æ—¶é—´å€¼ã€‚
    published: column.date(),
    // æœªç»ç±»å‹åŒ–çš„ JSON å¯¹è±¡ã€‚
    metadata: column.json(),
  }
});
```

<ReadMore>æŸ¥çœ‹[è¡¨çš„åˆ—å‚è€ƒ](/zh-cn/guides/integrations-guide/db/#è¡¨é…ç½®å‚è€ƒ)ä»¥è·å–æ›´å¤šç»†èŠ‚ã€‚</ReadMore>

### è¡¨å¼•ç”¨

è¡¨ä¹‹é—´çš„å…³ç³»æ˜¯æ•°æ®åº“è®¾è®¡ä¸­çš„å¸¸è§æ¶æ„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª `Blog` è¡¨å¯èƒ½ä¸ `Comment`ã€`Author` å’Œ `Category` ç­‰å…¶ä»–å‡ ä¸ªè¡¨å¯†åˆ‡ç›¸å…³ã€‚

ä½ å¯ä»¥ä½¿ç”¨**å¼•ç”¨åˆ—**å®šä¹‰æ¥è¿™äº›è¡¨ä¹‹é—´çš„å…³ç³»å¹¶å°†å®ƒä»¬ä¿å­˜åˆ°ä½ çš„æ•°æ®åº“ä¸­ã€‚è¦å»ºç«‹å…³ç³»ï¼Œä½ éœ€è¦ï¼š

- åœ¨è¢«å¼•ç”¨çš„è¡¨ä¸Šæœ‰ä¸€ä¸ª**æ ‡è¯†ç¬¦åˆ—**ã€‚è¿™é€šå¸¸æ˜¯å¸¦æœ‰ `primaryKey` å±æ€§çš„ `id` åˆ—ã€‚
- åœ¨åŸºç¡€è¡¨ä¸Šæœ‰ä¸€ä¸ªç”¨äº**å­˜å‚¨è¢«å¼•ç”¨ `id`** çš„åˆ—ã€‚è¿™å°†ä½¿ç”¨ `references` å±æ€§æ¥å»ºç«‹å…³ç³»ã€‚

è¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ª `Comment` è¡¨çš„ `authorId` åˆ—å¼•ç”¨äº† `Author` è¡¨çš„ `id` åˆ—ã€‚

```ts title="db/config.ts" {3, 10}
const Author = defineTable({
  columns: {
    id: column.number({ primaryKey: true }),
    name: column.text(),
  }
});

const Comment = defineTable({
  columns: {
    authorId: column.number({ references: () => Author.columns.id }),
    body: column.text(),
  }
});
```

## ä¸ºä½ çš„å¼€å‘æ•°æ®åº“å¡«å……æ•°æ®

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒAstro å°†ä½¿ç”¨ä½ çš„ DB é…ç½®å¹¶æ ¹æ®ä½ çš„æ¶æ„ç”Ÿæˆæœ¬åœ°ç±»å‹ã€‚è¿™äº›å†…å®¹å°†åœ¨æ¯æ¬¡å¯åŠ¨å¼€å‘æœåŠ¡å™¨æ—¶ä»ä½ çš„ seed æ–‡ä»¶é‡æ–°ç”Ÿæˆï¼Œå¹¶å…è®¸ä½ ä½¿ç”¨ç±»å‹å®‰å…¨å’Œè‡ªåŠ¨è¡¥å…¨æ¥æŸ¥è¯¢å’Œå¤„ç†ä½ çš„æ•°æ®æ ·ä¾‹ã€‚

ä½ å°†æ— æ³•åœ¨å¼€å‘è¿‡ç¨‹ä¸­è®¿é—®ç”Ÿäº§æ•°æ®ï¼Œé™¤éä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­ [è¿æ¥åˆ°è¿œç¨‹æ•°æ®åº“](#è¿æ¥åˆ°è¿œç¨‹æ•°æ®åº“)ã€‚è¿™æ ·å¯ä»¥ä¿æŠ¤ä½ çš„æ•°æ®ï¼ŒåŒæ—¶å…è®¸ä½ ä½¿ç”¨ç±»å‹å®‰å…¨çš„å·¥ä½œæ•°æ®åº“è¿›è¡Œæµ‹è¯•å’Œå¼€å‘ã€‚

è¦ä¸ºä½ çš„ Astro é¡¹ç›®å¡«å……å¼€å‘æ•°æ®è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ª `db/seed.ts` æ–‡ä»¶ã€‚å¯¼å…¥ `db` å¯¹è±¡å’Œ `astro:db` ä¸­å®šä¹‰çš„è¡¨ã€‚`insert`ä¸€äº›åˆå§‹æ•°æ®åˆ°æ¯ä¸€ä¸ªè¡¨ä¸­ã€‚è¿™äº›å¼€å‘æ•°æ®åº”è¯¥ä¸æ•°æ®åº“æ¨¡å¼å’Œç”Ÿäº§æ•°æ®çš„ç»“æ„ç›¸åŒ¹é…ã€‚

ä»¥ä¸‹ä¾‹å­ä¸º `Comment` è¡¨å’Œ `Author` è¡¨å®šä¹‰äº†ä¸¤è¡Œå¼€å‘æ•°æ®ï¼š

```ts title="db/seed.ts"
import { db, Comment, Author } from 'astro:db';

export default async function() {
  await db.insert(Author).values([
    { id: 1, name: "Kasim" },
    { id: 2, name: "Mina" },
  ]);

  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!'},
  ])
}
```

ä½ çš„å¼€å‘æœåŠ¡å™¨å°†åœ¨æ­¤æ–‡ä»¶æ›´æ”¹æ—¶è‡ªåŠ¨é‡å¯ä½ çš„æ•°æ®åº“ï¼Œå¹¶æ¯æ¬¡é‡æ–°ç”Ÿæˆç±»å‹å¹¶ä» `seed.ts` å¡«å……æ–°çš„å¼€å‘æ•°æ®ã€‚

## è¿æ¥ä¸€ä¸ª libSQL æ•°æ®åº“ç”¨äºç”Ÿäº§

Astro DB å¯ä»¥è¿æ¥åˆ°ä»»ä½•æœ¬åœ° libSQL æ•°æ®åº“æˆ–ä»»ä½•æš´éœ² libSQL è¿œç¨‹åè®®çš„æ‰˜ç®¡æˆ–è‡ªæ‰˜ç®¡æœåŠ¡å™¨ã€‚

è¦è¿æ¥ Astro DB åˆ° libSQL æ•°æ®åº“ï¼Œè®¾ç½®ä»¥ä¸‹ä»ä½ çš„æ•°æ®åº“æä¾›å•†è·å–çš„ç¯å¢ƒå˜é‡ï¼š

- `ASTRO_DB_REMOTE_URL`ï¼šè¿æ¥åˆ°æœ¬åœ°æˆ–è¿œç¨‹ libSQL DB çš„ä½ç½®çš„è¿æ¥ URLã€‚è¿™å¯èƒ½åŒ…æ‹¬ [URL é…ç½®é€‰é¡¹](#è¿œç¨‹-url-é…ç½®é€‰é¡¹) å¦‚ sync å’Œ encryption ä½œä¸ºå‚æ•°ã€‚
- `ASTRO_DB_APP_TOKEN`ï¼šä½ çš„ libSQL æœåŠ¡å™¨çš„è®¤è¯ tokenã€‚è¿™å¯¹è¿œç¨‹æ•°æ®åº“æ˜¯å¿…é¡»çš„ï¼Œå¯¹ [æœ¬åœ° DB å¦‚ æ–‡ä»¶æˆ–å†…å­˜](#url-scheme-å’Œ-host) æ•°æ®åº“ä¸æ˜¯å¿…é¡»çš„ã€‚

æ ¹æ®ä½ çš„æœåŠ¡ï¼Œä½ å¯èƒ½ä¼šè®¿é—®åˆ°ä¸€ä¸ª CLI æˆ– web UI æ¥è·å–è¿™äº›å€¼ã€‚ä»¥ä¸‹éƒ¨åˆ†å°†æ¼”ç¤ºè¿æ¥åˆ° Turso å¹¶è®¾ç½®è¿™äº›å€¼ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•æä¾›å•†ã€‚

### å¼€å§‹ä½¿ç”¨ Turso

Turso æ˜¯ [libSQL](https://github.com/tursodatabase/libsql) èƒŒåçš„å…¬å¸ï¼ŒlibSQL æ˜¯ Astro DB çš„åº•å±‚æ•°æ®åº“ã€‚ä»–ä»¬æä¾›äº†ä¸€ä¸ªå®Œå…¨æ‰˜ç®¡çš„ libSQL æ•°æ®åº“å¹³å°ï¼Œå¹¶ä¸ Astro å®Œå…¨å…¼å®¹ã€‚

ä»¥ä¸‹æ­¥éª¤å°†å¼•å¯¼ä½ å®Œæˆå®‰è£… Turso CLIã€ç™»å½•ï¼ˆæˆ–æ³¨å†Œï¼‰ã€åˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“ã€è·å–æ‰€éœ€çš„è®¤è¯ç¯å¢ƒå˜é‡ï¼Œå¹¶å°†æ¨¡å¼æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“çš„è¿‡ç¨‹ã€‚

<Steps>

1. å®‰è£… [Turso CLI](https://docs.turso.tech/cli/installation)ã€‚

2. [ç™»å½•æˆ–æ³¨å†Œ](https://docs.turso.tech/cli/authentication) Tursoã€‚

3. åˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ•°æ®åº“åç§°ä¸º `andromeda`ã€‚

   ```sh "andromeda"
   turso db create andromeda
   ```

4. è¿è¡Œ `show` å‘½ä»¤æŸ¥çœ‹æ–°åˆ›å»ºæ•°æ®åº“çš„ä¿¡æ¯ï¼š

   ```sh "andromeda"
   turso db show andromeda
   ```

   å¤åˆ¶ `URL` å€¼å¹¶å°†å…¶è®¾ç½®ä¸º `ASTRO_DB_REMOTE_URL` çš„å€¼ã€‚
   

   ```dotenv title=".env" "libsql://andromeda-houston.turso.io"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ```

5. åˆ›å»ºä¸€ä¸ªæ–° token è®¤è¯è¯·æ±‚åˆ°æ•°æ®åº“ï¼š

   ```sh "andromeda"
   turso db tokens create andromeda
   ```

   å¤åˆ¶å‘½ä»¤çš„è¾“å‡ºå¹¶å°†å…¶è®¾ç½®ä¸º `ASTRO_DB_APP_TOKEN` çš„å€¼ã€‚

   ```dotenv title=".env" add={2} "eyJhbGciOiJF...3ahJpTkKDw"
   ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
   ASTRO_DB_APP_TOKEN=eyJhbGciOiJF...3ahJpTkKDw
   ```

6. å°†ä½ çš„ DB schema å’Œ metadata æ¨é€åˆ°æ–°çš„ Turso æ•°æ®åº“ã€‚

   ```sh
   astro db push --remote
   ```

7. æ­å–œï¼Œç°åœ¨ä½ å·²ç»è¿æ¥äº†ä¸€ä¸ªæ•°æ®åº“ï¼ç»™è‡ªå·±ä¸€ä¸ªå¥–åŠ±ã€‚ ğŸ‘¾

   ```sh
   turso relax
   ```

</Steps>

è¦æ¢ç´¢æ›´å¤š Turso çš„åŠŸèƒ½ï¼Œè¯·æŸ¥çœ‹ [Turso æ–‡æ¡£](https://docs.turso.tech)ã€‚

### è¿æ¥åˆ°è¿œç¨‹æ•°æ®åº“

Astro DB å…è®¸ä½ è¿æ¥åˆ°æœ¬åœ°å’Œè¿œç¨‹æ•°æ®åº“ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒAstro ä½¿ç”¨ä¸€ä¸ªæœ¬åœ°æ•°æ®åº“æ–‡ä»¶ç”¨äº `dev` å’Œ `build` å‘½ä»¤ï¼Œæ¯æ¬¡é‡æ–°åˆ›å»ºè¡¨å¹¶æ’å…¥å¼€å‘ seed æ•°æ®ã€‚

è¦è¿æ¥åˆ°ä¸€ä¸ªæ‰˜ç®¡çš„è¿œç¨‹æ•°æ®åº“ï¼Œä½¿ç”¨ `--remote` æ ‡å¿—ã€‚è¿™ä¸ªæ ‡å¿—å…è®¸ä½ è®¿é—®è¿œç¨‹æ•°æ®åº“ï¼Œå…è®¸ä½  [æ¥å—å’ŒæŒä¹…åŒ–ç”¨æˆ·æ•°æ®](#æ’å…¥) åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

:::note
è™½ç„¶è¿œç¨‹è¿æ¥åœ¨ä»»ä½•ä½¿ç”¨é™æ€æˆ–æœåŠ¡å™¨æ¸²æŸ“æ¨¡å¼çš„éƒ¨ç½²å¹³å°ä¸Šéƒ½æ˜¯å¯èƒ½çš„ï¼Œä½†ç›®å‰å­˜åœ¨ä¸€äº›é™åˆ¶ã€‚é Node è¿è¡Œæ—¶ï¼ˆå¦‚ Cloudflare å’Œ Denoï¼‰ä¸æ”¯æŒåœ¨ libSQL ä¸Šä½¿ç”¨æœåŠ¡å™¨æ¸²æŸ“è·¯ç”±æ—¶ä½¿ç”¨ DBã€‚å¯¹äºè¿™äº›å¹³å°çš„æ”¯æŒï¼Œè®¡åˆ’å°†åœ¨æœªæ¥ä¸­å®ç°ã€‚
:::

é…ç½®ä½ çš„ build å‘½ä»¤ä½¿ç”¨ `--remote` æ ‡å¿—ï¼š

```json title="package.json" "--remote"
{
  "scripts": {
    "build": "astro build --remote"
  }
}
```

ä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨è¯¥æ ‡å¿—ï¼š

```bash
# ä½¿ç”¨è¿œç¨‹è¿æ¥æ„å»º
astro build --remote

# ä½¿ç”¨è¿œç¨‹è¿æ¥å¼€å‘
astro dev --remote
```

:::caution
åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ `--remote` æ—¶è¯·å°å¿ƒã€‚è¿™ä¼šè¿æ¥åˆ°ä½ çš„ç”Ÿäº§æ•°æ®åº“ï¼Œæ‰€æœ‰æ›´æ”¹ï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰éƒ½ä¼šè¢«æŒä¹…åŒ–ã€‚
:::

`--remote` æ ‡å¿—åœ¨æœ¬åœ°æ„å»ºæœŸé—´å’ŒæœåŠ¡å™¨ä¸Šéƒ½ä½¿ç”¨è¿œç¨‹æ•°æ®åº“è¿æ¥ã€‚ç¡®ä¿åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒå’Œéƒ¨ç½²å¹³å°ä¸­éƒ½è®¾ç½®äº†å¿…è¦çš„ç¯å¢ƒå˜é‡ã€‚

å½“ä½ éƒ¨ç½²ä½ çš„ Astro DB é¡¹ç›®æ—¶ï¼Œç¡®ä¿ä½ çš„éƒ¨ç½²å¹³å°çš„ build å‘½ä»¤è®¾ç½®ä¸º `npm run build`ï¼ˆæˆ–ä½ åŒ…ç®¡ç†å™¨çš„ç­‰æ•ˆå‘½ä»¤ï¼‰ä»¥ä½¿ç”¨åœ¨ `package.json` ä¸­é…ç½®çš„ `--remote` æ ‡å¿—ã€‚

### è¿œç¨‹ URL é…ç½®é€‰é¡¹

`ASTRO_DB_REMOTE_URL` ç¯å¢ƒå˜é‡é…ç½®äº†æ•°æ®åº“çš„ä½ç½®ä»¥åŠåŒæ­¥å’ŒåŠ å¯†ç­‰å…¶ä»–é€‰é¡¹ã€‚

#### URL scheme å’Œ host

libSQL æ”¯æŒ HTTP å’Œ WebSockets ä½œä¸ºè¿œç¨‹æœåŠ¡å™¨çš„ä¼ è¾“åè®®ã€‚å®ƒè¿˜æ”¯æŒä½¿ç”¨æœ¬åœ°æ–‡ä»¶æˆ–å†…å­˜æ•°æ®åº“ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ URL æ–¹æ¡ˆåœ¨è¿æ¥ URL ä¸­è¿›è¡Œé…ç½®ï¼š

- `memory:` å°†ä½¿ç”¨å†…å­˜æ•°æ®åº“ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»æœºå¿…é¡»ä¸ºç©ºã€‚
- `file:` å°†ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ã€‚ä¸»æœºæ˜¯æ–‡ä»¶çš„è·¯å¾„ (`file:path/to/file.db`).
- `libsql:` å°†é€šè¿‡ libSQL åº“é¦–é€‰çš„åè®®ä½¿ç”¨è¿œç¨‹æœåŠ¡å™¨ï¼ˆè¿™å¯èƒ½å› ç‰ˆæœ¬è€Œå¼‚ï¼‰ã€‚ä¸»æœºæ˜¯æœåŠ¡å™¨çš„åœ°å€ (`libsql://your.server.io`).
- `http:` é€šè¿‡ HTTP ä½¿ç”¨è¿œç¨‹æœåŠ¡å™¨ã€‚`https:` å¯ä»¥ç”¨æ¥å¯ç”¨å®‰å…¨è¿æ¥ã€‚ä¸»æœºä¸ `libsql:` ç›¸åŒã€‚
- `ws:` é€šè¿‡ WebSockets ä½¿ç”¨è¿œç¨‹æœåŠ¡å™¨ã€‚`wss:` å¯ä»¥ç”¨æ¥å¯ç”¨å®‰å…¨è¿æ¥ã€‚ä¸»æœºä¸ `libsql:` ç›¸åŒã€‚

libSQL è¿æ¥çš„è¯¦ç»†ä¿¡æ¯ï¼ˆä¾‹å¦‚åŠ å¯†å¯†é’¥ã€å¤åˆ¶ã€åŒæ­¥é—´éš”ï¼‰å¯ä»¥åœ¨è¿œç¨‹è¿æ¥ URL ä¸­ä½œä¸ºæŸ¥è¯¢å‚æ•°è¿›è¡Œé…ç½®ã€‚

ä¾‹å¦‚ï¼Œè¦å°†ä¸€ä¸ªåŠ å¯†çš„æœ¬åœ°æ–‡ä»¶è®¾ç½®ä¸º libSQL æœåŠ¡å™¨çš„åµŒå…¥å¼å‰¯æœ¬ï¼Œå¯ä»¥è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file://local-copy.db?encryptionKey=your-encryption-key&syncInterval=60&syncUrl=libsql%3A%2F%2Fyour.server.io
ASTRO_DB_APP_TOKEN=token-to-your-remote-url
```

:::caution
ä½¿ç”¨æ•°æ®åº“æ–‡ä»¶æ˜¯ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œåœ¨éƒ¨ç½²æ—¶åº”è¯¥å°å¿ƒï¼Œä»¥é˜²æ­¢è¦†ç›–ä½ çš„æ•°æ®åº“å¹¶ä¸¢å¤±ä½ çš„ç”Ÿäº§æ•°æ®ã€‚

æ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•åœ¨æ— æœåŠ¡å™¨éƒ¨ç½²ä¸­å°†æ— æ³•å·¥ä½œï¼Œå› ä¸ºè¿™äº›ç¯å¢ƒä¸­æ²¡æœ‰æŒä¹…åŒ–çš„æ–‡ä»¶ç³»ç»Ÿã€‚
:::

#### `encryptionKey`

libSQL å¯¹åŠ å¯†æ•°æ®åº“æœ‰åŸç”Ÿæ”¯æŒã€‚ä¼ é€’è¿™ä¸ªæœç´¢å‚æ•°å°†ä½¿ç”¨ç»™å®šçš„å¯†é’¥å¯ç”¨åŠ å¯†ï¼š

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=file:path/to/file.db?encryptionKey=your-encryption-key
```

#### `syncUrl`

åµŒå…¥å¼å‰¯æœ¬æ˜¯ libSQL å®¢æˆ·ç«¯çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒä¼šåœ¨æœ¬åœ°æ–‡ä»¶æˆ–å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªå®Œæ•´åŒæ­¥çš„å‰¯æœ¬ï¼Œä»¥å®ç°è¶…å¿«çš„è¯»å–ã€‚å†™å…¥å‘é€åˆ°åœ¨ `syncUrl` ä¸Šå®šä¹‰çš„è¿œç¨‹æ•°æ®åº“ï¼Œå¹¶ä¸æœ¬åœ°å‰¯æœ¬åŒæ­¥ã€‚

ä½¿ç”¨æ­¤å±æ€§ä¼ é€’ä¸€ä¸ªå•ç‹¬çš„è¿æ¥ URL å°†æ•°æ®åº“è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ•°æ®åº“çš„åµŒå…¥å¼å‰¯æœ¬ã€‚è¿™åº”è¯¥ä»…ä¸ `file:` å’Œ `memory:` æ–¹æ¡ˆä¸€èµ·ä½¿ç”¨ã€‚è¯¥å‚æ•°å¿…é¡»è¿›è¡Œ URL ç¼–ç ã€‚

ä¾‹å¦‚ï¼Œè¦å°†ä¸€ä¸ªæ•°æ®åº“è®¾ç½®ä¸º `libsql://your.server.io` çš„å†…å­˜åµŒå…¥å¼å‰¯æœ¬ï¼Œå¯ä»¥è®¾ç½®è¿æ¥ URL å¦‚ä¸‹ï¼š

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io
```

#### `syncInterval`

åµŒå…¥å¼å‰¯æœ¬ä¹‹é—´åŒæ­¥çš„é—´éš”æ—¶é—´ï¼Œå•ä½ä¸ºç§’ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»…åœ¨å¯åŠ¨æ—¶å’Œå†™å…¥ååŒæ­¥ã€‚

æ­¤å±æ€§ä»…åœ¨è®¾ç½® `syncUrl` æ—¶ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè¦å°†å†…å­˜åµŒå…¥å¼å‰¯æœ¬è®¾ç½®ä¸ºæ¯åˆ†é’ŸåŒæ­¥ï¼Œè¯·è®¾ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

```dotenv title=".env"
ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io&syncInterval=60
```

## æŸ¥è¯¢ä½ çš„æ•°æ®åº“

ä½ å¯ä»¥ä»é¡¹ç›®ä¸­çš„ä»»ä½• [Astro é¡µé¢](/zh-cn/basics/astro-pages/#astro-é¡µé¢)ï¼Œ[ç«¯ç‚¹](/zh-cn/guides/endpoints/) æˆ– [action](/zh-cn/guides/actions/) ä½¿ç”¨æä¾›çš„ `db` ORM å’ŒæŸ¥è¯¢æ„å»ºå™¨æ¥æŸ¥è¯¢ä½ çš„æ•°æ®åº“ã€‚

### Drizzle ORM

```ts
import { db } from 'astro:db';
```

Astro DB åŒ…å«ä¸€ä¸ªå†…ç½®çš„ [Drizzle ORM](https://orm.drizzle.team/) å®¢æˆ·ç«¯ã€‚ä½¿ç”¨è¯¥å®¢æˆ·ç«¯æ— éœ€è®¾ç½®æˆ–æ‰‹åŠ¨é…ç½®ã€‚å½“ä½ è¿è¡Œ Astro æ—¶ï¼ŒAstro DB çš„ `db` å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨é…ç½®ä»¥ä¸ä½ çš„æ•°æ®åº“ï¼ˆæœ¬åœ°æˆ–è¿œç¨‹ï¼‰è¿›è¡Œé€šä¿¡ã€‚å®ƒä½¿ç”¨ä½ æ˜ç¡®çš„æ•°æ®åº“æ¶æ„å®šä¹‰è¿›è¡Œç±»å‹å®‰å…¨çš„ SQL æŸ¥è¯¢ï¼Œå½“ä½ å¼•ç”¨ä¸å­˜åœ¨çš„åˆ—æˆ–è¡¨æ—¶ï¼Œä¼šå‡ºç° TypeScript é”™è¯¯ã€‚

### æŸ¥è¯¢

ä»¥ä¸‹ä¾‹å­é€‰æ‹©äº† `Comment` è¡¨çš„æ‰€æœ‰è¡Œã€‚è¿™å°†è¿”å›æ¥è‡ª `db/seed.ts` å…¨é‡çš„å¡«å……çš„å¼€å‘æ•°æ®æ•°ç»„ï¼Œç„¶åå¯ä»¥åœ¨ä½ çš„é¡µé¢æ¨¡æ¿ä¸­ä½¿ç”¨å®ƒä»¬ï¼š

```astro title="src/pages/index.astro"
---
import { db, Comment } from 'astro:db';

const comments = await db.select().from(Comment);
---

<h2>Comments</h2>

{
  comments.map(({ author, body }) => (
    <article>
      <p>Author: {author}</p>
      <p>{body}</p>
    </article>
  ))
}
```

<ReadMore>æŸ¥çœ‹ [Drizzle `select()` API å‚è€ƒ](https://orm.drizzle.team/docs/select) ä»¥è·å–å®Œæ•´æ¦‚è¿°ã€‚</ReadMore>

### æ’å…¥

è¦æ¥å—ç”¨æˆ·è¾“å…¥ï¼Œå¦‚å¤„ç†è¡¨å•è¯·æ±‚å¹¶å°†æ•°æ®æ’å…¥åˆ°ä½ çš„è¿œç¨‹æ‰˜ç®¡æ•°æ®åº“ï¼Œéœ€è¦ä¸ºä½ çš„ Astro é¡¹ç›®é…ç½® [æŒ‰éœ€æ¸²æŸ“](/zh-cn/guides/on-demand-rendering/) å¹¶ä¸ºä½ çš„éƒ¨ç½²ç¯å¢ƒ [æ·»åŠ ä¸€ä¸ªé€‚é…å™¨](/zh-cn/guides/on-demand-rendering/#æ·»åŠ é€‚é…å™¨)ã€‚

è¿™ä¸ªä¾‹å­åŸºäºè§£æåè¡¨å•çš„ POST è¯·æ±‚å‘ `Comment` è¡¨æ’å…¥ä¸€è¡Œï¼š

```astro
---
// src/pages/index.astro
import { db, Comment } from 'astro:db';

if (Astro.request.method === 'POST') {
  // è§£æè¡¨å•æ•°æ®
  const formData = await Astro.request.formData();
  const author = formData.get('author');
  const body = formData.get('body');
  if (typeof author === 'string' && typeof body === 'string') {
    // å°†è¡¨å•æ•°æ®æ’å…¥åˆ° Comment è¡¨ä¸­
    await db.insert(Comment).values({ author, body });
  }
}

// åœ¨æ¯æ¬¡è¯·æ±‚ä¸Šæ¸²æŸ“æ–°çš„è¯„è®ºåˆ—è¡¨
const comments = await db.select().from(Comment);
---

<form method="POST" style="display: grid">
	<label for="author">Author</label>
	<input id="author" name="author" />

	<label for="body">Content</label>
	<textarea id="body" name="body"></textarea>

	<button type="submit">Submit</button>
</form>

<!--æ¸²æŸ“ `comments`-->
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ [Astro actions](/zh-cn/guides/actions/) å‘ Astro DB è¡¨ä¸­æ’å…¥æ•°æ®ã€‚ä»¥ä¸‹ä¾‹å­ä½¿ç”¨ä¸€ä¸ª action å‘ `Comment` è¡¨ä¸­æ’å…¥ä¸€è¡Œï¼š

```ts
// src/actions/index.ts
import { db, Comment } from 'astro:db';
import { defineAction } from 'astro:actions';
import { z } from 'astro:schema';
export const server = {
  addComment: defineAction({
    // Actions ç”¨ Zod ä¿è¯ç±»å‹å®‰å…¨ï¼Œä¸éœ€è¦å†
    // åœ¨é¡µé¢ä¸­æ£€æŸ¥ typeof {value} === 'string'
    input: z.object({
      author: z.string(),
      body: z.string(),
    }),
    handler: async (input) => {
      const updatedComments = await db
        .insert(Comment)
        .values(input)
        .returning(); // è¿”å›æ›´æ–°åçš„è¯„è®º
      return updatedComments;
    },
  }),
};
```

<ReadMore>

æŸ¥çœ‹ [Drizzle `insert()` API å‚è€ƒ](https://orm.drizzle.team/docs/insert) ä»¥è·å–å®Œæ•´æ¦‚è¿°ã€‚

</ReadMore>

### åˆ é™¤

ä½ ä¹Ÿå¯ä»¥ä» API ç«¯ç‚¹æŸ¥è¯¢ä½ çš„æ•°æ®åº“ã€‚è¿™ä¸ªä¾‹å­é€šè¿‡ `id` å‚æ•°åˆ é™¤ `Comment` è¡¨ä¸­çš„ä¸€è¡Œï¼š

```ts
// src/pages/api/comments/[id].ts
import type { APIRoute } from "astro";
import { db, Comment, eq } from 'astro:db';
export const DELETE: APIRoute = async (ctx) => {
  await db.delete(Comment).where(eq(Comment.id, ctx.params.id ));
  return new Response(null, { status: 204 });
}
```

<ReadMore>
æŸ¥çœ‹ [Drizzle `delete()` API å‚è€ƒ](https://orm.drizzle.team/docs/delete) ä»¥è·å–å®Œæ•´æ¦‚è¿°ã€‚
</ReadMore>

### è¿‡æ»¤

è¦é€šè¿‡ç‰¹å®šå±æ€§æŸ¥è¯¢è¡¨ç»“æœï¼Œè¯·ä½¿ç”¨ [Drizzle çš„éƒ¨åˆ†æŸ¥è¯¢é€‰é¡¹](https://orm.drizzle.team/docs/select#partial-select)ã€‚ä¾‹å¦‚ï¼Œå‘ä½ çš„ `select()` æŸ¥è¯¢æ·»åŠ  [ä¸€ä¸ª `.where()` è°ƒç”¨](https://orm.drizzle.team/docs/select#filtering)ï¼Œå¹¶ä¼ é€’ä½ æƒ³åšçš„æ¯”è¾ƒæ“ä½œã€‚

ä»¥ä¸‹ä¾‹å­æŸ¥è¯¢äº† `Comment` è¡¨ä¸­åŒ…å« "Astro DB" çŸ­è¯­çš„æ‰€æœ‰è¡Œã€‚ä½¿ç”¨ [`like()` æ“ä½œç¬¦](https://orm.drizzle.team/docs/operators#like) æ£€æŸ¥ `body` ä¸­æ˜¯å¦å­˜åœ¨çŸ­è¯­ï¼š

```astro title="src/pages/index.astro"
---
import { db, Comment, like } from 'astro:db';

const comments = await db.select().from(Comment).where(
    like(Comment.body, '%Astro DB%')
);
---
```

### Drizzle è¾…åŠ©å·¥å…·

æ‰€æœ‰ç”¨äºæ„å»ºæŸ¥è¯¢çš„ Drizzle è¾…åŠ©å·¥å…·éƒ½ä» `astro:db` æ¨¡å—ä¸­æš´éœ²å‡ºæ¥ã€‚è¿™åŒ…æ‹¬ï¼š

- [è¿‡æ»¤æ“ä½œç¬¦](https://orm.drizzle.team/docs/operators) å¦‚ `eq()` å’Œ `gt()`
- [èšåˆè¾…åŠ©å·¥å…·](https://orm.drizzle.team/docs/select#aggregations-helpers) å¦‚ `count()`
- ç”¨äºç¼–å†™åŸå§‹ SQL æŸ¥è¯¢è¯­å¥çš„ [`sql` è¾…åŠ©å·¥å…·](https://orm.drizzle.team/docs/sql)

```ts
import { eq, gt, count, sql } from 'astro:db';
```

### å…³ç³»

ä½ å¯ä»¥ä½¿ç”¨ SQL è¿æ¥ä»å¤šä¸ªè¡¨æŸ¥è¯¢å…³è”çš„æ•°æ®ã€‚è¦åˆ›å»ºä¸€ä¸ªè¿æ¥æŸ¥è¯¢ï¼Œè¯·ä½¿ç”¨è¿æ¥æ“ä½œç¬¦æ‰©å±•ä½ çš„ `db.select()` è¯­å¥ã€‚æ¯ä¸ªå‡½æ•°éƒ½æ¥å—ä¸€ä¸ªè¦è¿æ¥çš„è¡¨å’Œä¸€ä¸ªæ¡ä»¶æ¥åŒ¹é…ä¸¤ä¸ªè¡¨ä¹‹é—´çš„è¡Œã€‚

è¿™ä¸ªä¾‹å­ä½¿ç”¨äº† `innerJoin()` å‡½æ•°å°† `Comment` çš„ä½œè€…ä¸ä»–ä»¬ç›¸å…³çš„ `Author` ä¿¡æ¯è¿æ¥èµ·æ¥ï¼ŒåŸºäº `authorId` åˆ—ã€‚è¿™å°†è¿”å›ä¸€ä¸ªå¯¹è±¡æ•°ç»„ï¼Œæ¯ä¸ª `Author` å’Œ `Comment` è¡Œä½œä¸ºé¡¶çº§å±æ€§ï¼š

```astro title="src/pages/index.astro"
---
import { db, eq, Comment, Author } from 'astro:db';

const comments = await db.select()
  .from(Comment)
  .innerJoin(Author, eq(Comment.authorId, Author.id));
---

<h2>Comments</h2>

{
  comments.map(({ Author, Comment }) => (
    <article>
      <p>Author: {Author.name}</p>
      <p>{Comment.body}</p>
    </article>
  ))
}
```

<ReadMore>

æŸ¥çœ‹ [Drizzle è¿æ¥å‚è€ƒ](https://orm.drizzle.team/docs/joins#join-types) ä»¥è·å–æ‰€æœ‰å¯ç”¨çš„è¿æ¥æ“ä½œç¬¦å’Œé…ç½®é€‰é¡¹ã€‚

</ReadMore>

### æ‰¹å¤„ç†äº‹åŠ¡

æ‰€æœ‰è¿œç¨‹æ•°æ®åº“æŸ¥è¯¢éƒ½ä½œä¸ºç½‘ç»œè¯·æ±‚è¿›è¡Œã€‚å½“è¿›è¡Œå¤§é‡æŸ¥è¯¢ï¼Œæˆ–è€…å¦‚æœä»»ä½•æŸ¥è¯¢å¤±è´¥éœ€è¦è‡ªåŠ¨å›æ»šæ—¶ï¼Œä½ å¯èƒ½éœ€è¦å°†æŸ¥è¯¢æ‰¹é‡å¤„ç†ä¸ºå•ä¸ªäº‹åŠ¡ã€‚

è¿™ä¸ªä¾‹å­ä½¿ç”¨ `db.batch()` æ–¹æ³•åœ¨å•ä¸ªè¯·æ±‚ä¸­å¡«å……å¤šè¡Œï¼š

```ts
// db/seed.ts
import { db, Author, Comment } from 'astro:db';

export default async function () {
  const queries = [];
  // ä½¿ç”¨å•ä¸ªç½‘ç»œè¯·æ±‚å°† 100 ä¸ªæ ·æœ¬æ•°æ®å¡«å……åˆ°ä½ çš„è¿œç¨‹æ•°æ®åº“ä¸­ã€‚
  for (let i = 0; i < 100; i++) {
    queries.push(db.insert(Comment).values({ body: `Test comment ${i}` }));
  }
  await db.batch(queries);
}
```

<ReadMore>

æŸ¥çœ‹ [Drizzle `db.batch()`](https://orm.drizzle.team/docs/batch-api) æ–‡æ¡£ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

</ReadMore>

## å°†æ›´æ”¹æ¨é€åˆ°ä½ çš„æ•°æ®åº“

ä½ å¯ä»¥å°†å¼€å‘æœŸé—´æ‰€åšçš„æ›´æ”¹æ¨é€åˆ°ä½ çš„æ•°æ®åº“ã€‚

### æ¨é€è¡¨æ¶æ„

ä½ çš„è¡¨æ¶æ„å¯èƒ½ä¼šéšç€é¡¹ç›®çš„å¢é•¿è€Œå˜åŒ–ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°å®‰å…¨åœ°æµ‹è¯•é…ç½®æ›´æ”¹ï¼Œå¹¶åœ¨éƒ¨ç½²æ—¶æ¨é€åˆ°ä½ çš„è¿œç¨‹æ•°æ®åº“ã€‚

ä½ å¯ä»¥é€šè¿‡ CLI ä½¿ç”¨ `astro db push --remote` å‘½ä»¤å°†æœ¬åœ°æ¶æ„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“ï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote
  ```
  </Fragment>
</PackageManagerTabs>

æ­¤å‘½ä»¤å°†éªŒè¯ä½ çš„æœ¬åœ°æ›´æ”¹æ˜¯å¦å¯ä»¥åœ¨ä¸ä¸¢å¤±æ•°æ®çš„æƒ…å†µä¸‹è¿›è¡Œï¼Œå¹¶åœ¨å¿…è¦æ—¶ï¼Œå»ºè®®å¦‚ä½•å®‰å…¨åœ°ä¿®æ”¹ä½ çš„æ¶æ„ä»¥è§£å†³å†²çªã€‚

#### æ¨é€ç ´åæ€§æ¶æ„æ›´æ”¹

:::caution
__è¿™å°†é”€æ¯ä½ çš„æ•°æ®åº“__ã€‚ä»…åœ¨ä½ ä¸éœ€è¦ç”Ÿäº§æ•°æ®æ—¶æ‰§è¡Œæ­¤å‘½ä»¤ã€‚
:::

å¦‚æœå¿…é¡»ä»¥ä¸ç°æœ‰æ•°æ®ä¸å…¼å®¹çš„æ–¹å¼æ›´æ”¹è¡¨æ¶æ„ï¼Œåˆ™éœ€è¦é‡ç½®ç”Ÿäº§æ•°æ®åº“ã€‚

è¦æ¨é€åŒ…å«ç ´åæ€§æ›´æ”¹çš„è¡¨æ¶æ„æ›´æ–°ï¼Œè¯·æ·»åŠ  `--force-reset` æ ‡å¿—ä»¥é‡ç½®æ‰€æœ‰ç”Ÿäº§æ•°æ®ï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm run astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro db push --remote --force-reset
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro db push --remote --force-reset
  ```
  </Fragment>
</PackageManagerTabs>

### é‡å‘½åè¡¨

åœ¨å°†æ¶æ„æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“åï¼Œå¯ä»¥é‡å‘½åè¡¨ã€‚

å¦‚æœ **æ²¡æœ‰é‡è¦çš„ç”Ÿäº§æ•°æ®**ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ `--force-reset` æ ‡å¿— [é‡ç½®ä½ çš„æ•°æ®åº“](#æ¨é€ç ´åæ€§æ¶æ„æ›´æ”¹)ã€‚æ­¤æ ‡å¿—å°†åˆ é™¤æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨å¹¶åˆ›å»ºæ–°çš„è¡¨ï¼Œä»¥åŒ¹é…å½“å‰çš„æ¶æ„ã€‚

ä¸ºäº†åœ¨ä¿ç•™ä½ çš„ç”Ÿäº§æ•°æ®çš„åŒæ—¶é‡å‘½åä¸€ä¸ªè¡¨ï¼Œä½ å¿…é¡»æ‰§è¡Œä¸€ç³»åˆ—éç ´åæ€§æ›´æ”¹ï¼Œä»¥å®‰å…¨åœ°å°†æœ¬åœ°æ¶æ„æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“ã€‚

ä»¥ä¸‹ç¤ºä¾‹å°†è¡¨ä» `Comment` é‡å‘½åä¸º `Feedback`ï¼š

<Steps>

1. åœ¨ä½ çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸ºä½ æƒ³è¦é‡å‘½åçš„è¡¨æ·»åŠ  `deprecated: true` å±æ€§ï¼š

    ```ts title="db/config.ts" ins={2}
    const Comment = defineTable({
      deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
    ```

2. æ·»åŠ ä¸€ä¸ªæ–°çš„è¡¨æ¶æ„ï¼ˆå®Œå…¨åŒ¹é…ç°æœ‰è¡¨çš„å±æ€§ï¼‰å¹¶ä½¿ç”¨æ–°åç§°ï¼š

	  ```ts title="db/config.ts" ins={8-14}
    const Comment = defineTable({
        deprecated: true,
    	columns: {
    		author: column.text(),
    		body: column.text(),
  		}
    });
	  const Feedback = defineTable({
        columns: {
          author: column.text(),
          body: column.text(),
        }
    });
    ```

3. ä½¿ç”¨ `astro db push --remote`[å°†æ¶æ„æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“](#æ¨é€è¡¨æ¶æ„) ã€‚è¿™å°†æ·»åŠ æ–°è¡¨å¹¶å°†æ—§è¡¨æ ‡è®°ä¸ºå·²å¼ƒç”¨ã€‚
4. æ›´æ–°ä½ çš„æœ¬åœ°é¡¹ç›®ä»£ç ä»¥ä½¿ç”¨æ–°è¡¨è€Œä¸æ˜¯æ—§è¡¨ã€‚ä½ å¯èƒ½è¿˜éœ€è¦å°†æ•°æ®è¿ç§»åˆ°æ–°è¡¨ã€‚
5. ä¸€æ—¦ä½ ç¡®ä¿¡æ—§è¡¨åœ¨ä½ çš„é¡¹ç›®ä¸­ä¸å†ä½¿ç”¨ï¼Œä½ å¯ä»¥ä» `config.ts` ä¸­åˆ é™¤æ—§è¡¨çš„æ¶æ„ï¼š
		```ts title="db/config.ts" del={1-7}
    const Comment = defineTable({
          deprecated: true,
    	  columns: {
    		  author: column.text(),
    		  body: column.text(),
  		  }
    });

	  const Feedback = defineTable({
          columns: {
            author: column.text(),
            body: column.text(),
          }
    });
    ```
6. å†æ¬¡ä½¿ç”¨ `astro db push --remote`æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“ã€‚æ—§è¡¨å°†è¢«åˆ é™¤ï¼Œåªç•™ä¸‹æ–°çš„ã€é‡å‘½åçš„è¡¨ã€‚
</Steps>

### æ¨é€è¡¨æ•°æ®

ä½ å¯èƒ½éœ€è¦å°†æ•°æ®æ¨é€åˆ°è¿œç¨‹æ•°æ®åº“ä»¥è¿›è¡Œå¡«å……æˆ–æ•°æ®è¿ç§»ã€‚ä½ å¯ä»¥ç¼–å†™ä¸€ä¸ª `.ts` æ–‡ä»¶å¹¶ä½¿ç”¨ `astro:db` æ¨¡å—æ¥ç¼–å†™ç±»å‹å®‰å…¨çš„æŸ¥è¯¢ã€‚ç„¶åï¼Œä½¿ç”¨å‘½ä»¤ `astro db execute <file-path> --remote` å¯¹è¿œç¨‹æ•°æ®åº“æ‰§è¡Œè¯¥æ–‡ä»¶ï¼š

ä»¥ä¸‹è¯„è®ºå¯ä»¥ä½¿ç”¨å‘½ä»¤ `astro db execute db/seed.ts --remote` è¿›è¡Œå¡«å……ï¼š

```ts
// db/seed.ts
import { Comment } from 'astro:db';

export default async function () {
  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!' },
  ])
}
```

<ReadMore>

æŸ¥çœ‹ [CLI å‚è€ƒ](/zh-cn/guides/integrations-guide/db/#astro-db-cli-å‚è€ƒ) ä»¥è·å–å®Œæ•´çš„å‘½ä»¤åˆ—è¡¨ã€‚

</ReadMore>

## æ„å»º Astro DB é›†æˆ

[Astro é›†æˆ](/zh-cn/reference/integrations-reference/) å¯ä»¥é€šè¿‡é¢å¤–çš„ Astro DB è¡¨å’Œå¡«å……æ•°æ®æ¥æ‰©å±•ç”¨æˆ·é¡¹ç›®ã€‚

åœ¨ `astro:db:setup` é’©å­ä¸­ä½¿ç”¨ `extendDb()` æ–¹æ³•æ³¨å†Œé¢å¤–çš„ Astro DB é…ç½®å’Œå¡«å……æ–‡ä»¶ã€‚
`defineDbIntegration()` è¾…åŠ©å‡½æ•°ä¸º `astro:db:setup` é’©å­æä¾› TypeScript æ”¯æŒå’Œè‡ªåŠ¨è¡¥å…¨ã€‚

```js {8-13}
// my-integration/index.ts
import { defineDbIntegration } from '@astrojs/db/utils';

export default function MyIntegration() {
  return defineDbIntegration({
    name: 'my-astro-db-powered-integration',
    hooks: {
      'astro:db:setup': ({ extendDb }) => {
        extendDb({
          configEntrypoint: '@astronaut/my-package/config',
          seedEntrypoint: '@astronaut/my-package/seed',
        });
      },
      // å…¶ä»–é›†æˆé’©å­...
    },
  });
}
```

é›†æˆçš„ [é…ç½®](#å®šä¹‰ä½ çš„æ•°æ®åº“) å’Œ [å¡«å……](#ä¸ºä½ çš„å¼€å‘æ•°æ®åº“å¡«å……æ•°æ®) æ–‡ä»¶éµå¾ªä¸å…¶ç”¨æˆ·å®šä¹‰çš„ç­‰æ•ˆé¡¹ç›¸åŒçš„æ ¼å¼ã€‚

### åœ¨é›†æˆä¸­è¿›è¡Œç±»å‹å®‰å…¨æ“ä½œ

åœ¨è¿›è¡Œé›†æˆå·¥ä½œæ—¶ï¼Œä½ å¯èƒ½æ— æ³•ä» `astro:db` å¯¼å‡ºçš„ Astro ç”Ÿæˆçš„è¡¨ç±»å‹ä¸­è·ç›Šã€‚
ä¸ºäº†å®Œå…¨çš„ç±»å‹å®‰å…¨ï¼Œä½¿ç”¨ `asDrizzleTable()` è¾…åŠ©å·¥å…·åˆ›å»ºä¸€ä¸ªå¯ä»¥ç”¨äºæ•°æ®åº“æ“ä½œçš„è¡¨å¼•ç”¨å¯¹è±¡ã€‚

ä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªé›†æˆè®¾ç½®ä»¥ä¸‹ `Pets` æ•°æ®åº“è¡¨ï¼š

```js
// my-integration/config.ts
import { defineDb, defineTable, column } from 'astro:db';

export const Pets = defineTable({
  columns: {
    name: column.text(),
    species: column.text(),
  },
});

export default defineDb({ tables: { Pets } });
```

å¡«å……æ–‡ä»¶å¯ä»¥å¯¼å…¥ `Pets` å¹¶ä½¿ç”¨ `asDrizzleTable()` å‘ä½ çš„è¡¨æ’å…¥å…·æœ‰ç±»å‹æ£€æŸ¥çš„è¡Œï¼š

```js {2,7} /typeSafePets(?! )/
// my-integration/seed.ts
import { asDrizzleTable } from '@astrojs/db/utils';
import { db } from 'astro:db';
import { Pets } from './config';

export default async function() {
  const typeSafePets = asDrizzleTable('Pets', Pets);

  await db.insert(typeSafePets).values([
    { name: 'Palomita', species: 'cat' },
    { name: 'Pan', species: 'dog' },
  ]);
}
```

`asDrizzleTable('Pets', Pets)` è¿”å›çš„å€¼ç­‰åŒäº `import { Pets } from 'astro:db'`ï¼Œä½†å³ä½¿ Astro çš„ç±»å‹ç”Ÿæˆæ— æ³•è¿è¡Œæ—¶ä¹Ÿå¯ç”¨ã€‚
ä½ å¯ä»¥åœ¨ä»»ä½•éœ€è¦æŸ¥è¯¢æˆ–æ’å…¥æ•°æ®åº“çš„é›†æˆä»£ç ä¸­ä½¿ç”¨å®ƒã€‚


## ä» Astro Studio è¿ç§»åˆ° Turso

<Steps>

1. åœ¨ [Studio ä»ªè¡¨æ¿](https://studio.astro.build/) ä¸­ï¼Œå¯¼èˆªåˆ°ä½ è¦è¿ç§»çš„é¡¹ç›®ã€‚åœ¨è®¾ç½®é€‰é¡¹å¡ä¸­ï¼Œä½¿ç”¨ â€œExport Databaseï¼ˆå¯¼å‡ºæ•°æ®åº“ï¼‰â€ æŒ‰é’®ä¸‹è½½æ•°æ®åº“çš„è½¬å‚¨ã€‚
2. æŒ‰ç…§å®˜æ–¹è¯´æ˜ [å®‰è£… Turso CLI](https://docs.turso.tech/cli/installation) å¹¶ [æ³¨å†Œæˆ–ç™»å½•](https://docs.turso.tech/cli/authentication) ä½ çš„ Turso å¸æˆ·ã€‚
3. ä½¿ç”¨ `turso db create` å‘½ä»¤åœ¨ Turso ä¸Šåˆ›å»ºä¸€ä¸ªæ–°æ•°æ®åº“ã€‚
   ```sh
   turso db create [database-name]
   ```
4. ä½¿ç”¨ Turso CLI è·å–æ•°æ®åº“ URLï¼Œå¹¶å°†å…¶é…ç½®ä¸ºç¯å¢ƒå˜é‡ `ASTRO_DB_REMOTE_URL`ã€‚
   ```sh
   turso db show [database-name]
   ```
   ```dotenv
   ASTRO_DB_REMOTE_URL=[your-database-url]
   ```
5. åˆ›å»ºä¸€ä¸ªä»¤ç‰Œæ¥è®¿é—®ä½ çš„æ•°æ®åº“ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºç¯å¢ƒå˜é‡ `ASTRO_DB_APP_TOKEN`ã€‚
   ```sh
   turso db tokens create [database-name]
   ```
   ```dotenv
   ASTRO_DB_APP_TOKEN=[your-app-token]
   ```
6. å°†ä½ çš„ DB æ¶æ„å’Œå…ƒæ•°æ®æ¨é€åˆ°æ–°çš„ Turso æ•°æ®åº“ã€‚
   ```sh
   astro db push --remote
   ```
7. å°†æ­¥éª¤ 1 ä¸­çš„æ•°æ®åº“è½¬å‚¨å¯¼å…¥åˆ°æ–°çš„ Turso DB ä¸­ã€‚
   ```sh
   turso db shell [database-name] < ./path/to/dump.sql
   ```
8. ç¡®è®¤ä½ çš„é¡¹ç›®è¿æ¥åˆ°æ–°æ•°æ®åº“åï¼Œä½ å°±å¯ä»¥å®‰å…¨åœ°ä» Astro Studio ä¸­åˆ é™¤è¯¥é¡¹ç›®äº†ã€‚

</Steps>
