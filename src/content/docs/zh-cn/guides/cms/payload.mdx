---
title: Payload CMS ä¸ Astro
description: ä½¿ç”¨ Payload CMS ä½œä¸º CMS å°†å…§å®¹æ·»åŠ åˆ°ä½ çš„ Astro é¡¹ç›®
type: cms
stub: true
service: Payload CMS
i18nReady: true
---

[PayloadCMS](https://payloadcms.com/) æ˜¯ä¸€ä¸ªå¼€æºçš„ headless CMSï¼ˆContent Management Systemï¼Œå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰ï¼Œå¯ä»¥ç”¨æ¥ä¸ºä½ çš„ Astro é¡¹ç›®æä¾›å†…å®¹ã€‚

## ä¸ Astro é›†æˆ

### å‰ç½®å‡†å¤‡

åœ¨å¼€å§‹ä½¿ç”¨ä¹‹å‰ï¼Œä½ éœ€è¦ï¼š

1. **ä¸€ä¸ª Astro é¡¹ç›®** - å¦‚æœè¿˜æ²¡æœ‰ Astro é¡¹ç›®, æˆ‘ä»¬çš„ [å®‰è£…æŒ‡å—](/zh-cn/install/auto/) å°†åœ¨çŸ­æ—¶é—´å†…å¸®åŠ©ä½ å¯åŠ¨å¹¶è¿è¡Œã€‚
2. **ä¸€ä¸ª MongoDB æ•°æ®åº“** - åœ¨åˆ›å»ºæ–°é¡¹ç›®æ—¶ï¼ŒPayloadCMS ä¼šè¦æ±‚ä½ æä¾›ä¸€ä¸ª MongoDB è¿æ¥å­—ç¬¦ä¸²ã€‚ä½ å¯ä»¥åœ¨æœ¬åœ°éƒ¨ç½²ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ [MongoDBAtlas](https://www.mongodb.com/zh-cn/atlas/database) åœ¨ Web ä¸Šå…è´¹æ‰˜ç®¡æ•°æ®åº“ã€‚
3. **ä¸€ä¸ª PayloadCMS REST API** - åˆ›å»ºä¸€ä¸ª [PayloadCMS](https://payloadcms.com/docs/getting-started/installation) é¡¹ç›®ï¼Œå¹¶åœ¨å®‰è£…è¿‡ç¨‹ä¸­å°†å…¶è¿æ¥åˆ°ä½ çš„ MongoDB æ•°æ®åº“ã€‚

:::note[é€‰æ‹©æ¨¡ç‰ˆ]
åœ¨ PayloadCMS å®‰è£…è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šè¯¢é—®ä½ æ˜¯å¦è¦ä½¿ç”¨æ¨¡æ¿ã€‚

åœ¨æ­¤æ­¥éª¤ä¸­é€‰æ‹©ä»»ä½•å¯ç”¨çš„æ¨¡æ¿ï¼ˆå¦‚ 'blog'ï¼‰éƒ½ä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆé™„åŠ çš„é›†åˆï¼ˆcollectionsï¼‰ä¾›ä½ ä½¿ç”¨ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ‰‹åŠ¨åˆ›å»º PayloadCMS é›†åˆã€‚
:::

### ä¸ºä½ çš„ PayloadCMS é›†åˆé…ç½® Astro

ä½ çš„ Payload é¡¹ç›®æ¨¡æ¿çš„ `src/collections/` è·¯å¾„ä¸‹å°†åŒ…å«ä¸€ä¸ªåä¸º `Posts.ts` çš„æ–‡ä»¶ã€‚å¦‚æœä½ åœ¨å®‰è£…è¿‡ç¨‹ä¸­æ²¡æœ‰é€‰æ‹©åˆ›å»ºå†…å®¹é›†åˆçš„æ¨¡æ¿ï¼Œä½ å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ·»åŠ æ­¤é…ç½®æ–‡ä»¶æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Payload CMS é›†åˆã€‚ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä¸€ä¸ªåä¸º `posts` çš„å†…å®¹é›†åˆï¼Œå…¶ä¸­åŒ…å« `title`ã€`content` å’Œ `slug` å­—æ®µï¼š


```astro title="src/collections/Posts.ts"
import { CollectionConfig } from "payload/types";

const Posts: CollectionConfig = {
  slug: "posts",
  admin: {
    useAsTitle: "title",
  },
  access: {
    read: () => true,
  },

  fields: [
    {
      name: "title",
      type: "text",
      required: true,
    },
    {
      name: "content",
      type: "text",
      required: true,
    },
    {
      name: "slug",
      type: "text",
      required: true,
    },
  ],
};

export default Posts;
```

1. å°† `Users`ï¼ˆæ‰€æœ‰ PayloadCMS é¡¹ç›®ä¸­éƒ½å¯ç”¨ï¼‰å’Œä»»ä½•å…¶ä»–é›†åˆï¼ˆä¾‹å¦‚ `Posts`ï¼‰å¯¼å…¥å¹¶æ·»åŠ åˆ° `payload.config.ts` æ–‡ä»¶ä¸­çš„å¯ç”¨é›†åˆï¼ˆcollectionsï¼‰ä¸­ã€‚

```astro title="src/payload.config.ts" ins={4, 5, 12}
import { buildConfig } from "payload/config";
import path from "path";

import Users from "./collections/Users";
import Posts from "./collections/Posts";

export default buildConfig({
  serverURL: "http://localhost:3000",
  admin: {
    user: Users.slug,
  },
  collections: [Users, Posts],
  typescript: {
    outputFile: path.resolve(__dirname, "payload-types.ts"),
  },
  graphQL: {
    schemaOutputFile: path.resolve(__dirname, "generated-schema.graphql"),
  },
});
```

è¿™å°†ä½¿ä¸€ä¸ªåä¸º â€œPostsâ€ çš„æ–°é›†åˆå‡ºç°åœ¨ä½ çš„ PayloadCMS ä»ªè¡¨æ¿ä¸­ â€œUsersâ€ é›†åˆçš„æ—è¾¹ã€‚


2. è¿›å…¥ â€œPostsâ€ é›†åˆå¹¶åˆ›å»ºä¸€ç¯‡æ–°æ–‡ç« ã€‚åœ¨ä¿å­˜åï¼Œä½ ä¼šæ³¨æ„åˆ° API URL å‡ºç°åœ¨å³ä¸‹è§’ã€‚

3. åœ¨æœ¬åœ° PayloadCMS æœåŠ¡è¿è¡Œçš„æƒ…å†µä¸‹ï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:3000/api/posts` ã€‚ä½ åº”è¯¥çœ‹åˆ°ä¸€ä¸ªåŒ…å«ä½ åˆ›å»ºçš„æ–‡ç« ä½œä¸ºå¯¹è±¡çš„ JSON æ–‡ä»¶ã€‚

```json
{
   "docs":[
      {
         "id":"64098b16483b0f06a7e20ed4",
         "title":"Astro & PayloadCMS Title ğŸš€",
         "content":"Astro & PayloadCMS Content",
         "slug":"astro-payloadcms-slug",
         "createdAt":"2023-03-09T07:30:30.837Z",
         "updatedAt":"2023-03-09T07:30:30.837Z"
      }
   ],
   "totalDocs":1,
   "limit":10,
   "totalPages":1,
   "page":1,
   "pagingCounter":1,
   "hasPrevPage":false,
   "hasNextPage":false,
   "prevPage":null,
   "nextPage":null
}
```

:::tip[æç¤º]
é»˜è®¤æƒ…å†µä¸‹ï¼ŒAstro å’Œ PayloadCMS éƒ½ä¼šä½¿ç”¨ 3000 ç«¯å£ã€‚ä½ å¯èƒ½æƒ³è¦åœ¨ `src/server.ts` æ–‡ä»¶ä¸­æ›´æ”¹ PayloadCMS çš„ç«¯å£ï¼Œåˆ«å¿˜äº†ä¹ŸåŒæ—¶æ›´æ–° `src/payload.config.ts` ä¸­çš„ `serverURL` ã€‚
:::

### è·å–æ•°æ®

é€šè¿‡ä½ ç½‘ç«™çš„å”¯ä¸€ REST API URL å’Œå†…å®¹çš„è·¯ç”±æ¥è·å–ä½ çš„ PayloadCMS æ•°æ®ã€‚ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒPayloadCMS å°†é€šè¿‡ `/api` æŒ‚è½½æ‰€æœ‰è·¯ç”±ã€‚ï¼‰ç„¶åï¼Œä½ å¯ä»¥ä½¿ç”¨ Astro çš„ `set:html=""` æŒ‡ä»¤æ¥æ¸²æŸ“ä½ çš„æ•°æ®å±æ€§ã€‚

ä¸ä½ çš„å¸–å­ä¸€èµ·ï¼ŒPayloadCMS å°†è¿”å›ä¸€äº›é¡¶çº§å…ƒæ•°æ®ã€‚å®é™…çš„æ–‡ç« æ•°æ®åµŒå¥—åœ¨ `docs` æ•°ç»„ä¸­ã€‚

ä¾‹å¦‚ï¼Œæ˜¾ç¤ºæ–‡ç« æ ‡é¢˜å’Œå†…å®¹åˆ—è¡¨ï¼š

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("https://localhost:5000/api/posts") // https://localhost:3000/api/posts é»˜è®¤ç«¯å£
const posts = await res.json()
---

<HomeLayout title='Astro Blog'>
	{
    posts.docs.map((post) => (
        <h2 set:html={post.title} />
        <p set:html={post.content} />
    ))
	}
</HomeLayout>
```

## ä½¿ç”¨ PayloadCMS å’Œ Astro åˆ›å»ºåšå®¢

åˆ›å»ºä¸€ä¸ªåšå®¢ç´¢å¼•é¡µé¢ `src/pages/index.astro`ï¼Œåˆ—å‡ºæ¯ç¯‡æ–‡ç« å¹¶é“¾æ¥åˆ°å…¶å•ç‹¬çš„é¡µé¢ã€‚

é€šè¿‡ API è·å–çš„è¿”å›ç»“æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆpostsï¼‰çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹å±æ€§ï¼š

- `title` - æ–‡ç« çš„æ ‡é¢˜
- `content` - æ–‡ç« çš„å†…å®¹
- `slug` - æ–‡ç« çš„slug

```astro title="src/pages/index.astro"
---
import HomeLayout from "../layouts/HomeLayout.astro";

const res = await fetch("http://localhost:5000/api/posts") // https://localhost:3000/api/posts é»˜è®¤ç«¯å£
const posts = await res.json()
---

<HomeLayout title='Astro Blog'>
	<h1>Astro + PayloadCMS ğŸš€</h1>
	<h2>åšå®¢æ–‡ç« åˆ—è¡¨ï¼š</h2>
	<ul>
		{
			posts.docs.map((post) =>(
				<li>
					<a href={`posts/${post.slug}`} set:html={post.title} />
				</li>
			))
		}
	</ul>
</HomeLayout>
```

### ä½¿ç”¨ PayloadCMS API ç”Ÿæˆé¡µé¢

åˆ›å»ºä¸€ä¸ªé¡µé¢ `src/pages/post/[slug].astro` ä¸ºæ¯ä¸€ç¯‡æ–‡ç« [åŠ¨æ€ç”Ÿæˆä¸€ä¸ªé¡µé¢](/zh-cn/core-concepts/routing/#åŠ¨æ€è·¯ç”±)ã€‚

```astro title="src/pages/posts/[slug].astro"
---
import PostLayout from "../../layouts/PostLayout.astro"

const {title, content} = Astro.props

// å¯¹äºé™æ€ Astro ç«™ç‚¹ï¼Œéœ€è¦ getStaticPaths()ã€‚
// å¦‚æœä½¿ç”¨ SSRï¼Œä½ å°†ä¸éœ€è¦æ­¤å‡½æ•°ã€‚
export async function getStaticPaths() {
    let data = await fetch("http://localhost:5000/api/posts")
    let posts = await data.json()

    return posts.docs.map((post) => {
        return {
            params: {slug: post.slug},
            props: {title: post.title, content: post.content},
        };
    });
} 
---
<PostLayout title={title}>
    <article>
        <h1 set:html={title} />
        <p set:html={content} />
    </article>
</PostLayout>
```

### å‘å¸ƒä½ çš„ç½‘ç«™

è¦éƒ¨ç½²ä½ çš„ç½‘ç«™ï¼Œè¯·è®¿é—®æˆ‘ä»¬çš„[éƒ¨ç½²æŒ‡å—](/zh-cn/guides/deploy/)ï¼Œå¹¶æŒ‰ç…§ä½ æ›´å–œæ¬¢çš„æ‰˜ç®¡æœåŠ¡æä¾›å•†çš„éƒ¨ç½²è¯´æ˜è¿›è¡Œæ“ä½œã€‚


## ç¤¾åŒºèµ„æº

- å°è¯•è¿™ä¸ª [Payload CMS & Astro æ¨¡ç‰ˆ](https://github.com/Lambdo-Labs/payloadcms-astro-template)ã€‚
- æŸ¥çœ‹ [Astroad](https://github.com/mooxl/astroad) ï¼Œä½¿ç”¨ Docker è¿›è¡Œ Payload CMS & Astro å¼€å‘å’Œ VPS éƒ¨ç½²ã€‚

