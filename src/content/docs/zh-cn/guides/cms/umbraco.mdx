---
title: Umbraco ä¸ Astro
description: ä½¿ç”¨ Umbraco ä½œä¸º CMS å‘ä½ çš„ Astro é¡¹ç›®æ·»åŠ å†…å®¹
sidebar:
  label: Umbraco
type: cms
stub: false
service: Umbraco
i18nReady: true
---
import { FileTree, Steps } from '@astrojs/starlight/components';
import ReadMore from '~/components/ReadMore.astro'; 

[Umbraco CMS](https://umbraco.com/) æ˜¯ä¸€ä¸ªå¼€æºçš„ ASP.NET Core CMSã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒUmbraco ä½¿ç”¨ Razor é¡µé¢ä½œä¸ºå…¶å‰ç«¯ï¼Œä½†ä¹Ÿå¯ä»¥ä½œä¸ºæ— å¤´ CMS ä½¿ç”¨ã€‚

## ä¸ Astro é›†æˆ

åœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†ä½¿ç”¨ Umbraco çš„åŸç”Ÿ [Content Delivery API](https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api) ä¸ºä½ çš„ Astro é¡¹ç›®æä¾›å†…å®¹ã€‚

### å‰ææ¡ä»¶

è¦å¼€å§‹ï¼Œä½ éœ€è¦å…·å¤‡ä»¥ä¸‹æ¡ä»¶ï¼š

1. **ä¸€ä¸ª Astro é¡¹ç›®** - å¦‚æœä½ è¿˜æ²¡æœ‰ Astro é¡¹ç›®ï¼Œæˆ‘ä»¬çš„ [å®‰è£…æŒ‡å—](/zh-cn/install-and-setup/) å°†å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œã€‚
2. **ä¸€ä¸ª Umbracoï¼ˆv12+ï¼‰é¡¹ç›®** - å¦‚æœä½ è¿˜æ²¡æœ‰ Umbraco é¡¹ç›®ï¼Œè¯·å‚é˜…è¿™ä¸ª [å®‰è£…æŒ‡å—](https://docs.umbraco.com/umbraco-cms/fundamentals/setup/install/)ã€‚

### è®¾ç½® Content Delivery API

è¦å¯ç”¨ Content Delivery APIï¼Œè¯·æ›´æ–°ä½ çš„ Umbraco é¡¹ç›®çš„ `appsettings.json` æ–‡ä»¶ï¼š

```json title="appsettings.json"
{
  "Umbraco": {
    "CMS": {
      "DeliveryApi": {
        "Enabled": true,
        "PublicAccess": true
      }
    }
  }
}
```

ä½ å¯ä»¥æ ¹æ®éœ€è¦é…ç½®é¢å¤–çš„é€‰é¡¹ï¼Œå¦‚å…¬å…±è®¿é—®ã€API å¯†é’¥ã€å…è®¸çš„å†…å®¹ç±»å‹ã€ä¼šå‘˜æˆæƒç­‰ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ [Umbraco Content Delivery API æ–‡æ¡£](https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api)ã€‚

### è·å–æ•°æ®

ä½¿ç”¨ `fetch()` è°ƒç”¨ Content Delivery API æ¥è®¿é—®ä½ çš„å†…å®¹ï¼Œå¹¶ä½¿å…¶å¯ç”¨äºä½ çš„ Astro ç»„ä»¶ã€‚

ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†è·å–çš„æ–‡ç« åˆ—è¡¨ï¼ŒåŒ…æ‹¬æ–‡ç« æ—¥æœŸå’Œå†…å®¹ç­‰å±æ€§ã€‚

```astro title="src/pages/index.astro"
---
const res = await fetch('http://localhost/umbraco/delivery/api/v2/content?filter=contentType:article');
const articles = await res.json();
---
<h1>Astro + Umbraco ğŸš€</h1>
{
  articles.items.map((article) => (
      <h1>{article.name}</h1>
      <p>{article.properties.articleDate}</p>
      <div set:html={article.properties.content?.markup}></div>
  ))
}
```


<ReadMore>äº†è§£æ›´å¤šå…³äº [åœ¨ Astro ä¸­è·å–æ•°æ®](/zh-cn/guides/data-fetching/) çš„ä¿¡æ¯ã€‚</ReadMore>

## ä½¿ç”¨ Umbraco å’Œ Astro æ„å»ºåšå®¢

### å‰ææ¡ä»¶

- **ä¸€ä¸ª Astro é¡¹ç›®** - å¦‚æœä½ è¿˜æ²¡æœ‰ Astro é¡¹ç›®ï¼Œæˆ‘ä»¬çš„ [å®‰è£…æŒ‡å—](/zh-cn/install-and-setup/) å°†å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œã€‚

- **ä¸€ä¸ªå¯ç”¨äº† Content Delivery API çš„ Umbraco é¡¹ç›®ï¼ˆv12+ï¼‰** - éµå¾ªè¿™ä¸ª [å®‰è£…æŒ‡å—](https://docs.umbraco.com/umbraco-cms/fundamentals/setup/install/) æ¥åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚

### åœ¨ Umbraco ä¸­åˆ›å»ºåšå®¢æ–‡ç« 

ä» [Umbraco åå°](https://docs.umbraco.com/umbraco-cms/fundamentals/backoffice) åˆ›å»ºä¸€ä¸ªç®€å•åšå®¢æ–‡ç« çš„æ–‡æ¡£ç±»å‹ï¼Œå‘½åä¸º 'Article'ã€‚

<Steps>
1. ä¸ºä½ çš„ 'Article' æ–‡æ¡£ç±»å‹é…ç½®ä»¥ä¸‹å±æ€§ï¼š

		- Title (DataType: Textstring)
		- Article Date (DataType: Date Picker)
		- Content (DataType: Richtext Editor)

2. å°† 'Article' æ–‡æ¡£ç±»å‹çš„ "Allow as root" é€‰é¡¹è®¾ç½®ä¸º `true`ã€‚

3. åœ¨ Umbraco åå°çš„ "Content" éƒ¨åˆ†ï¼Œ[åˆ›å»ºå¹¶å‘å¸ƒä½ çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« ](https://docs.umbraco.com/umbraco-cms/fundamentals/data/defining-content)ã€‚ä½ å¯ä»¥é‡å¤è¿™ä¸ªè¿‡ç¨‹å¤šæ¬¡ã€‚

</Steps>

æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·è§‚çœ‹[åˆ›å»ºæ–‡æ¡£ç±»å‹çš„è§†é¢‘æŒ‡å—](https://www.youtube.com/watch?v=otRuIkN80qM)ã€‚

### åœ¨ Astro ä¸­å±•ç¤ºåšå®¢æ–‡ç« åˆ—è¡¨

åˆ›å»ºä¸€ä¸ª `src/layouts/` æ–‡ä»¶å¤¹ï¼Œç„¶åæ·»åŠ ä¸€ä¸ªæ–°æ–‡ä»¶ `Layout.astro`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```astro title="src/layouts/Layout.astro"
---
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>My Blog with Astro and Umbraco</title>
</head>
<body>
    <main>
        <slot />
    </main>
</body>
</html>
```

ä½ çš„é¡¹ç›®ç°åœ¨åº”è¯¥åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

<FileTree>
- src/
  - **layouts/**
    - **Layout.astro**
  - pages/
    - index.astro
</FileTree>

è¦åˆ›å»ºåšå®¢æ–‡ç« åˆ—è¡¨ï¼Œé¦–å…ˆä½¿ç”¨ `fetch` è°ƒç”¨ Content Delivery API çš„ `content` ç«¯ç‚¹ï¼Œå¹¶æŒ‰ 'article' çš„ contentType è¿›è¡Œç­›é€‰ã€‚æ–‡ç« å¯¹è±¡å°†åŒ…æ‹¬åœ¨ CMS ä¸­è®¾ç½®çš„å±æ€§å’Œå†…å®¹ã€‚ç„¶åï¼Œä½ å¯ä»¥éå†è¿™äº›æ–‡ç« ï¼Œå¹¶æ˜¾ç¤ºæ¯ä¸ªæ ‡é¢˜åŠå…¶æ–‡ç« çš„é“¾æ¥ã€‚

å°† `index.astro` çš„é»˜è®¤å†…å®¹æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

```astro title="src/pages/index.astro"
---
import Layout from '../layouts/Layout.astro';
const res = await fetch('http://localhost/umbraco/delivery/api/v2/content?filter=contentType:article');
const articles = await res.json();
---
<Layout>
	<h2>Blog Articles</h2>
	{
        articles.items.map((article: any) => (
            <div>
                <h3>{article.properties.title}</h3>
                <p>{article.properties.articleDate}</p>
                <a href={article.route.path}>Read more</a>
            </div>
        ))
    }
</Layout>
```

### ç”Ÿæˆå•ä¸ªåšå®¢æ–‡ç« 

åœ¨ `/pages/` ç›®å½•çš„æ ¹éƒ¨åˆ›å»ºæ–‡ä»¶ `[...slug].astro`ã€‚æ­¤æ–‡ä»¶å°†ç”¨äº[åŠ¨æ€ç”Ÿæˆå•ä¸ªåšå®¢é¡µé¢](/zh-cn/guides/routing/#åŠ¨æ€è·¯ç”±)ã€‚

è¯·æ³¨æ„ï¼Œç”Ÿæˆé¡µé¢ url è·¯å¾„çš„ `params` å±æ€§åŒ…å«æ¥è‡ª API è·å–çš„ `article.route.path`ã€‚åŒæ ·ï¼Œ`props` å±æ€§å¿…é¡»åŒ…å«æ•´ä¸ª `article`ï¼Œä»¥ä¾¿ä½ å¯ä»¥è®¿é—® CMS æ¡ç›®ä¸­çš„æ‰€æœ‰ä¿¡æ¯ã€‚

æ·»åŠ ä»¥ä¸‹ä»£ç åˆ° `[...slug].astro`ï¼Œå®ƒå°†åˆ›å»ºä½ çš„å•ä¸ªåšå®¢æ–‡ç« é¡µé¢ï¼š

```astro title="[...slug].astro"
---
import Layout from '../layouts/Layout.astro';

export async function getStaticPaths() {
    let data = await fetch("http://localhost/umbraco/delivery/api/v2/content?filter=contentType:article");
    let articles = await data.json();
    
    return articles.items.map((article: any) => ({
        params: { slug: article.route.path },
        props: { article: article },
    }));
}

const { article } = Astro.props;
---

<Layout>
  <h1>{article.properties.title}</h1>
  <p>{article.properties.articleDate}</p>
  <div set:html={article.properties.content?.markup}></div>
</Layout>
```

ä½ çš„é¡¹ç›®ç°åœ¨åº”è¯¥åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

<FileTree>
- src/
  - layouts/
    - Layout.astro
  - pages/
    - index.astro
    - **[...slug].astro**
</FileTree>

åœ¨å¼€å‘æœåŠ¡å™¨è¿è¡Œæ—¶ï¼Œä½ ç°åœ¨åº”è¯¥èƒ½å¤Ÿåœ¨ä½ çš„ Astro é¡¹ç›®çš„æµè§ˆå™¨é¢„è§ˆä¸­æŸ¥çœ‹ç”± Umbraco åˆ›å»ºçš„å†…å®¹ã€‚æ­å–œä½ ï¼ğŸš€

## å‘å¸ƒä½ çš„ç½‘ç«™

è¦éƒ¨ç½²ä½ çš„ç½‘ç«™ï¼Œè¯·è®¿é—®æˆ‘ä»¬çš„[éƒ¨ç½²æŒ‡å—](/zh-cn/guides/deploy/)å¹¶æŒ‰ç…§ä½ é€‰æ‹©çš„æ‰˜ç®¡æä¾›å•†çš„æŒ‡ç¤ºè¿›è¡Œæ“ä½œã€‚

## æœ¬åœ°å¼€å‘ã€HTTPS å’Œè‡ªç­¾å SSL è¯ä¹¦

å¦‚æœä½ åœ¨æœ¬åœ°ä½¿ç”¨ Umbraco çš„ HTTPS ç«¯ç‚¹ï¼Œä»»ä½• `fetch` æŸ¥è¯¢éƒ½ä¼šå› ä¸ºä»£ç  `DEPTH_ZERO_SELF_SIGNED_CERT` è€Œå¯¼è‡´ `fetch failed`ã€‚è¿™æ˜¯å› ä¸º Nodeï¼ˆAstro çš„åŸºç¡€ï¼‰é»˜è®¤ä¸æ¥å—è‡ªç­¾åè¯ä¹¦ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·åœ¨æœ¬åœ°å¼€å‘ä¸­ä½¿ç”¨ Umbraco çš„ HTTP ç«¯ç‚¹ã€‚

æˆ–è€…ï¼Œä½ å¯ä»¥åœ¨ `env.development` æ–‡ä»¶ä¸­è®¾ç½® `NODE_TLS_REJECT_UNAUTHORIZED=0` å¹¶æŒ‰å¦‚ä¸‹æ–¹å¼æ›´æ–° `astro.config.js`ï¼š

```sh title=".env.development"
NODE_TLS_REJECT_UNAUTHORIZED=0
```

```astro title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import { loadEnv } from "vite";

const { NODE_TLS_REJECT_UNAUTHORIZED } = loadEnv(process.env.NODE_ENV, process.cwd(), "");
process.env.NODE_TLS_REJECT_UNAUTHORIZED = NODE_TLS_REJECT_UNAUTHORIZED;
// https://astro.build/config
export default defineConfig({});
```

æ­¤æ–¹æ³•åœ¨è¿™ç¯‡[åšå®¢æ–‡ç« ](https://kjac.dev/posts/jamstack-for-free-with-azure-and-cloudflare/)ä¸­æœ‰æ›´è¯¦ç»†çš„æè¿°ï¼Œå±•ç¤ºäº†å¦‚ä½•ä¸ºè‡ªç­¾åè¯ä¹¦é…ç½®ä½ çš„é¡¹ç›®ï¼Œé™„å¸¦ä¸€ä¸ª[ç›¸å…³çš„ä»“åº“](https://github.com/kjac/UmbracoAzureCloudflare)ã€‚

## å®˜æ–¹æ–‡æ¡£
- [Content Delivery API - Umbraco æ–‡æ¡£](https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api)

## ç¤¾åŒºèµ„æº

- [ä½¿ç”¨ Content Delivery API æ„å»ºæ€§èƒ½å“è¶Šçš„ Astro ç½‘ç«™ - Louis Richardson](https://24days.in/umbraco-cms/2023/sustainable-performant/astronomically-performant/)
- [ä» Umbraco çš„ Content Delivery API ç”Ÿæˆ TypeScript OpenAPI å®¢æˆ·ç«¯ - Rick Butterfield](https://rickbutterfield.dev/blog/typescript-openapi-umbraco-content-delivery/)
- [ä½¿ç”¨ Azure å’Œ CloudFlare å…è´¹æ„å»º Jamstack - Kenn Jacobsen](https://kjac.dev/posts/jamstack-for-free-with-azure-and-cloudflare/)
- [ä½¿ç”¨ Astro å’Œ Umbraco å¿«é€Ÿæ­å»ºåšå®¢ - Kenn Jacobsen](https://kjac.dev/posts/quick-n-dirty-blog-with-astro-and-umbraco/)
- [æ¼”è®²ï¼šçƒ˜ç„™ï¼Œä½†ä¸æ²¹ç‚¸ - Astro ä¸ Content Delivery API - Adam Prendergast](https://www.youtube.com/watch?v=zNxqI25dtx4)
