---
title: å‡çº§åˆ° Astro v3
description: å¦‚ä½•å°†ä½ çš„é¡¹ç›®å‡çº§åˆ° Astro çš„æœ€æ–°ç‰ˆæœ¬ (v3.0)ã€‚
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import FileTree from '~/components/FileTree.astro'


æœ¬æŒ‡å—å°†å¸®åŠ©ä½ ä» Astro v2 è¿ç§»åˆ° Astro v3ã€‚

éœ€è¦å°†æ—§é¡¹ç›®å‡çº§åˆ° v2 å—ï¼Ÿè¯·å‚é˜…æˆ‘ä»¬çš„ [æ—§ç‰ˆæœ¬è¿ç§»æŒ‡å—](/zh-cn/guides/upgrade-to/v2/)ã€‚

## å‡çº§ Astro

ä½¿ç”¨ä½ çš„åŒ…ç®¡ç†å™¨å°†é¡¹ç›®çš„ Astro ç‰ˆæœ¬æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Astro é›†æˆï¼Œè¯·åŒæ—¶å°†å…¶æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  # å‡çº§åˆ° Astro v3.x
  npm install astro@latest
  
  # ç¤ºä¾‹ï¼šå‡çº§ React å’Œ Tailwind é›†æˆ
  npm install @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  # å‡çº§åˆ° Astro v3.x
  pnpm install astro@latest

  # ç¤ºä¾‹ï¼šå‡çº§ React å’Œ Tailwind é›†æˆ
  pnpm install @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  # å‡çº§åˆ° Astro v3.x
  yarn add astro@latest
  
  # ç¤ºä¾‹ï¼šå‡çº§ React å’Œ Tailwind é›†æˆ
  yarn add @astrojs/react@latest @astrojs/tailwind@latest
  ```
  </Fragment>
</PackageManagerTabs>

:::note[éœ€è¦ç»§ç»­å—ï¼Ÿ]
å‡çº§ Astro åˆ°æœ€æ–°ç‰ˆæœ¬åï¼Œä½ å¯èƒ½ä¸éœ€è¦å¯¹ä½ çš„é¡¹ç›®åšä»»ä½•æ›´æ”¹ï¼

ä½†æ˜¯ï¼Œå¦‚æœä½ æ³¨æ„åˆ°é”™è¯¯æˆ–æ„å¤–çš„è¡Œä¸ºï¼Œè¯·æ£€æŸ¥ä¸‹é¢çš„å†…å®¹ï¼Œçœ‹çœ‹æœ‰ä»€ä¹ˆå˜åŒ–å¯èƒ½éœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸­æ›´æ–°ã€‚
:::

## Astro v3.0 å®éªŒæ€§æ ‡å¿—å·²ç§»é™¤

ä» `astro.config.mjs` ä¸­ç§»é™¤ä»¥ä¸‹å®éªŒæ€§æ ‡å¿—ï¼š

```js del={5-8}
// astro.config.mjs
import { defineConfig } from 'astro/config';

export default defineConfig({
  experimental: {
    assets: true,
    viewTransitions: true,
  },
})
```

è¿™äº›ç‰¹æ€§ç°åœ¨é»˜è®¤å¯ç”¨ï¼š

- è§†å›¾è¿‡æ¸¡åŠ¨ç”»ç”¨äºåŠ¨ç”»é¡µé¢è¿‡æ¸¡å’ŒæŒä¹…åŒ–ç»„ä»¶ã€‚å¦‚æœä½ ä½¿ç”¨æ­¤å®éªŒæ€§æ ‡å¿—ï¼Œè¯·æŸ¥çœ‹ [è§†å›¾è¿‡æ¸¡åŠ¨ç”» API é‡å¤§æ›´æ”¹åŠå‡çº§å»ºè®®](/zh-cn/guides/view-transitions/#ä»-v2x-å‡çº§åˆ°-v30)ã€‚
- æ–°çš„å›¾åƒæœåŠ¡ API `astro:assets` ç”¨äºåœ¨ Astro ä¸­ä½¿ç”¨å›¾åƒï¼ŒåŒ…æ‹¬æ–°çš„ `<Image />` ç»„ä»¶å’Œ `getImage()` å‡½æ•°ã€‚**æ— è®ºä½ æ˜¯å¦ä½¿ç”¨æ­¤å®éªŒæ€§æ ‡å¿—**ï¼Œè¯·é˜…è¯»è¯¦ç»†çš„ [å›¾åƒå‡çº§å»ºè®®](/zh-cn/guides/images/#ä»-v2x-å‡çº§åˆ°-v30) ï¼Œä»¥äº†è§£è¿™å¯èƒ½å¦‚ä½•å½±å“ä½ çš„é¡¹ç›®ã€‚

åœ¨ [3.0 åšå®¢æ–‡ç« ](https://astro.build/blog/astro-3/) é˜…è¯»æ›´å¤šå…³äºè¿™ä¸¤ä¸ªä»¤äººå…´å¥‹çš„åŠŸèƒ½å’Œæ›´å¤šå…¶ä»–å†…å®¹ï¼

## Astro v3.0 ç ´åæ€§æ›´æ”¹

Astro v3.0 åŒ…å«äº†ä¸€äº›ç ´åæ€§æ›´æ”¹ï¼Œä»¥åŠä¸€äº›ä¹‹å‰å·²ç»å¼ƒç”¨çš„åŠŸèƒ½çš„ç§»é™¤ã€‚å¦‚æœä½ çš„é¡¹ç›®åœ¨å‡çº§åˆ° v3.0 åæ— æ³•æ­£å¸¸å·¥ä½œï¼Œè¯·æŸ¥çœ‹æœ¬æŒ‡å—ï¼Œäº†è§£æ‰€æœ‰ç ´åæ€§æ›´æ”¹çš„æ¦‚è¿°ä»¥åŠå¦‚ä½•æ›´æ–°ä½ çš„ä»£ç åº“çš„è¯´æ˜ã€‚

è¯·æŸ¥çœ‹ [æ›´æ–°æ—¥å¿—](https://github.com/withastro/astro/blob/main/packages/astro/CHANGELOG.md) ä»¥è·å–å®Œæ•´çš„å‘å¸ƒè¯´æ˜ã€‚

### ç§»é™¤ï¼šå¯¹ Node 16 çš„æ”¯æŒ

Node 16 è®¡åˆ’åœ¨ 2023 å¹´ 9 æœˆè¾¾åˆ°å…¶ç”Ÿå‘½å‘¨æœŸç»ˆç‚¹ã€‚

Astro v3.0 å®Œå…¨æ”¾å¼ƒå¯¹ Node 16 çš„æ”¯æŒï¼Œä»¥ä¾¿æ‰€æœ‰ Astro ç”¨æˆ·éƒ½èƒ½åˆ©ç”¨ Node çš„æ›´ç°ä»£åŒ–çš„åŠŸèƒ½ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

 æ£€æŸ¥ä½ çš„å¼€å‘ç¯å¢ƒå’Œéƒ¨ç½²ç¯å¢ƒæ˜¯å¦éƒ½ä½¿ç”¨**Node `18.14.1` æˆ–æ›´é«˜ç‰ˆæœ¬**ã€‚

1. ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ Node æœ¬åœ°ç‰ˆæœ¬ï¼š

    ```sh
    node -v
    ```

2. æŸ¥çœ‹ä½ çš„ [éƒ¨ç½²ç¯å¢ƒ](/zh-cn/guides/deploy/) çš„æ–‡æ¡£ï¼Œä»¥ç¡®è®¤å®ƒä»¬æ˜¯å¦æ”¯æŒ Node 18ã€‚

    ä½ å¯ä»¥åœ¨ä»ªè¡¨æ¿é…ç½®è®¾ç½®æˆ– `.nvmrc` æ–‡ä»¶ä¸­ä¸ºä½ çš„ Astro é¡¹ç›®æŒ‡å®š `Node 18.14.1`ã€‚

```bash title=".nvmrc"
18.14.1
```
### ç§»é™¤ï¼šå¯¹ TypeScript 4 çš„æ”¯æŒ

åœ¨ Astro v2.x ä¸­ï¼Œ`tsconfig.json` é¢„è®¾åŒ…å«å¯¹ TypeScript 4.x å’Œ 5.x çš„æ”¯æŒã€‚

Astro v3.0 æ›´æ–°äº† `tsconfig.json` é¢„è®¾ï¼Œåªæ”¯æŒ TypeScript 5.xã€‚Astro ç°åœ¨å‡è®¾ä½ ä½¿ç”¨ TypeScript 5.0ï¼ˆ2023 å¹´ 3 æœˆï¼‰ï¼Œæˆ–è€…ä½ çš„ç¼–è¾‘å™¨åŒ…å«å®ƒï¼ˆä¾‹å¦‚ VS Code 1.77ï¼‰ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ æœ¬åœ°å®‰è£…äº† TypeScriptï¼Œè¯·æ›´æ–°åˆ°è‡³å°‘ v5.0ã€‚

```bash
npm install typescript@latest --save-dev
```

### ç§»é™¤ï¼š`@astrojs/image`

åœ¨ Astro v2.x ä¸­ï¼ŒAstro æä¾›äº†ä¸€ä¸ªå®˜æ–¹çš„å›¾åƒé›†æˆï¼Œå…¶ä¸­åŒ…æ‹¬ Astro `<Image />` å’Œ `<Picture />` ç»„ä»¶ã€‚

Astro v3.0 å®Œå…¨ä»ä»£ç åº“ä¸­åˆ é™¤äº†è¿™ä¸ªé›†æˆã€‚Astro å›¾åƒçš„æ–°è§£å†³æ–¹æ¡ˆæ˜¯å†…ç½®çš„å›¾åƒæœåŠ¡ APIï¼š`astro:assets`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ç§»é™¤ `@astrojs/image` é›†æˆã€‚ä½ ä¸ä»…éœ€è¦å¸è½½é›†æˆï¼Œè¿˜éœ€è¦æ›´æ–°æˆ–åˆ é™¤ä»»ä½•å¯¼å…¥è¯­å¥å’Œç°æœ‰çš„ `<Image />` å’Œ `<Picture />` ç»„ä»¶ã€‚ä½ å¯èƒ½è¿˜éœ€è¦é…ç½®ä¸€ä¸ªé¦–é€‰çš„é»˜è®¤å›¾åƒå¤„ç†æœåŠ¡ã€‚

ä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„ [å›¾åƒæŒ‡å—](/zh-cn/guides/images/#ç§»é™¤-astrojsimage) ä¸­æ‰¾åˆ°å®Œæ•´çš„ã€é€æ­¥çš„åˆ é™¤æ—§å›¾åƒé›†æˆçš„è¯´æ˜ã€‚

è¿ç§» `astro:assets` è¿˜å°†å¸¦æ¥ä¸€äº›ä½ ç°åœ¨å¯èƒ½å¸Œæœ›ä½¿ç”¨çš„æ–°çš„å›¾åƒé€‰é¡¹å’ŒåŠŸèƒ½ã€‚è¯·å‚é˜…å®Œæ•´çš„ [v3.0 å›¾åƒå‡çº§å»ºè®®](/zh-cn/guides/images/#ä»-v2x-å‡çº§åˆ°-v30) äº†è§£å®Œæ•´çš„è¯¦æƒ…ï¼

```js del={3,7}
// astro.config.mjs
import { defineConfig } from 'astro/config';
import image from '@astrojs/image';

export default defineConfig({
  integrations: [
    image(),
  ]
})
```

### ç§»é™¤ï¼š`<Markdown />` ç»„ä»¶

åœ¨ Astro v1.x ä¸­ï¼ŒAstro åºŸå¼ƒäº† `<Markdown />` ç»„ä»¶ï¼Œå¹¶å°†å…¶ç§»åŠ¨åˆ°äº†ä¸€ä¸ªå¤–éƒ¨åŒ…ä¸­ã€‚

Astro v3.0 å®Œå…¨åˆ é™¤äº† `@astrojs/markdown-component` åŒ…ã€‚Astro çš„ `<Markdown />` ç»„ä»¶å°†ä¸å†åœ¨ä½ çš„é¡¹ç›®ä¸­å·¥ä½œã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ç§»é™¤æ‰€æœ‰çš„ `@astrojs/markdown-component` å®ä¾‹ã€‚

```astro del={2} title="src/components/MyAstroComponent.astro"
---
import Markdown from '@astrojs/markdown-component';
---
```

è¦ç»§ç»­åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨ç±»ä¼¼çš„ `<Markdown />` ç»„ä»¶ï¼Œè¯·è€ƒè™‘ä½¿ç”¨ [ç¤¾åŒºé›†æˆ](https://astro.build/integrations/)ï¼Œä¾‹å¦‚ [`astro-remote`](https://github.com/natemoo-re/astro-remote)ã€‚è¯·æ ¹æ®é›†æˆçš„æ–‡æ¡£æ›´æ–°ä½ çš„ `<Markdown />` ç»„ä»¶å¯¼å…¥å’Œå±æ€§ã€‚

å¦åˆ™ï¼Œè¯·åˆ é™¤æ‰€æœ‰å¯¹å¯¼å…¥ Astro çš„ `<Markdown />` ç»„ä»¶åŠå…¶æœ¬èº«çš„å¼•ç”¨ã€‚ä½ éœ€è¦ç›´æ¥å°†ä½ çš„å†…å®¹é‡å†™ä¸º HTMLï¼Œæˆ–è€…ä» `.md` æ–‡ä»¶ä¸­[å¯¼å…¥ Markdown](/zh-cn/guides/markdown-content/#å¯¼å…¥-markdown)ã€‚

### ç§»é™¤ï¼šå·²åºŸå¼ƒçš„ 1.x API

åœ¨ Astro v1.x ä¸­ï¼ŒAstro åºŸå¼ƒäº†å¯¹æœ€åˆçš„é…ç½®é€‰é¡¹ä»¥åŠ `<style global>` å’Œ `<script hoist>` çš„æ”¯æŒã€‚ä½†ä¸ºäº†å‘åå…¼å®¹ï¼Œå®ƒä»¬ä¾æ—§å¯ç”¨ã€‚

Astro v3.0 å®Œå…¨åˆ é™¤äº†è¿™äº›å·²å¼ƒç”¨çš„ APIã€‚ä½ åº”è¯¥ä½¿ç”¨æ­£å¼è¢«æ”¯æŒçš„[é…ç½®é€‰é¡¹](/zh-cn/reference/configuration-reference/)ä»¥åŠç°ä»£çš„ `<style is:global>` å’Œ `<script>`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ æ­£åœ¨ç»§ç»­ä½¿ç”¨ v1.x APIï¼Œè¯·æ”¹ç”¨æ¯ä¸ªåŠŸèƒ½çš„æ–° APIï¼š

- åºŸå¼ƒçš„é…ç½®é€‰é¡¹ï¼šè¯·å‚é˜… [0.26 è¿ç§»æŒ‡å—](/zh-cn/guides/upgrade-to/v1/#new-configuration-api)
- åºŸå¼ƒçš„è„šæœ¬/æ ·å¼ç±»å‹ï¼šè¯·å‚é˜… [0.26 è¿ç§»æŒ‡å—](/zh-cn/guides/upgrade-to/v1/#new-default-script-behavior)

### ç§»é™¤ï¼šæœåŠ¡å™¨ä»£ç ä¸­ Web API çš„ä¸å®Œæ•´å«ç‰‡ï¼ˆshimï¼‰

åœ¨ Astro v2.x ä¸­ï¼ŒAstro åœ¨æœåŠ¡å™¨æ¸²æŸ“ä»£ç ä¸­æä¾›äº†ä¾‹å¦‚åƒ `document` æˆ– `localStorage` è¿™æ ·çš„ Web APIs çš„ä¸å®Œæ•´å«ç‰‡ï¼ˆshimï¼Œç±»ä¼¼ polyfillï¼‰ã€‚è¿™äº›å«ç‰‡ç»å¸¸å®ç°ä¸å®Œæ•´å¹¶ä¸”ä¸å¯é ã€‚

Astro v3.0 å®Œå…¨ç§»é™¤äº†è¿™äº›ä¸å®Œæ•´çš„å«ç‰‡ã€‚Web APIs ä¸å†åœ¨æœåŠ¡å™¨æ¸²æŸ“ä»£ç ä¸­å¯ç”¨ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ åœ¨æœåŠ¡å™¨æ¸²æŸ“çš„ç»„ä»¶ä¸­ä½¿ç”¨ Web APIï¼Œä½ éœ€è¦æŠŠä½¿ç”¨äº†çš„åœ°æ–¹æ”¹æˆæ ¹æ®è¿è¡Œå¹³å°é€‰æ‹©æ€§è°ƒç”¨æˆ–ä½¿ç”¨ [`client:only` å®¢æˆ·ç«¯æŒ‡ä»¤](/zh-cn/reference/directives-reference/#clientonly).

### ç§»é™¤ï¼šå†…å®¹é›†åˆ schema ä¸­æ¥è‡ª `astro:content` çš„ `image`

åœ¨ Astro v2.x ä¸­ï¼Œå†…å®¹é›†åˆ API åºŸå¼ƒäº†æ¥è‡ª `astro:content` çš„ `image` å¯¼å‡ºï¼Œç”¨äºåœ¨ä½ çš„å†…å®¹é›†åˆ schema ä¸­ä½¿ç”¨ã€‚

Astro v3.0 å®Œå…¨åˆ é™¤äº†è¿™ä¸ªå¯¼å‡ºã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ `astro:content` ä¸­åºŸå¼ƒçš„ `image()`ï¼Œè¯·åˆ é™¤å®ƒï¼Œå› ä¸ºå®ƒå·²ç»ä¸å­˜åœ¨äº†ã€‚è¯·é€šè¿‡ [æ¥è‡ª `schema` çš„ `image` å¸®åŠ©ç¨‹åº](/zh-cn/guides/images/#æ›´æ–°å†…å®¹é›†åˆç»“æ„) æ¥éªŒè¯å›¾åƒã€‚

 ```ts title="astro.config.mjs" del={1} ins={2} "({ image })"
import { defineCollection, z, image } from "astro:content";
import { defineCollection, z } from "astro:content";
 
 defineCollection({
   schema: ({ image }) =>
     z.object({
       image: image(),
    }),
});
```

### ç§»é™¤ï¼špre-0.14 Shiki ä¸»é¢˜åç§°

åœ¨ Astro v2.x ä¸­ï¼Œä¸€äº› Shiki ä¸»é¢˜åç§°å·²è¢«é‡å‘½åï¼Œä½†åŸå§‹åç§°ä»ä¿ç•™äº†å‘åå…¼å®¹æ€§ã€‚

Astro v3.0 åˆ é™¤äº†åŸå§‹åç§°ï¼Œè€Œé‡‡ç”¨äº†é‡å‘½åçš„ä¸»é¢˜åç§°ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ çš„ Astro é¡¹ç›®ä½¿ç”¨äº†ä»¥ä¸‹ä»»ä½•ä¸»é¢˜ï¼Œè¯·å°†å®ƒä»¬é‡å‘½åä¸ºæ›´æ–°åçš„åç§°ï¼š

- `material-darker` -> `material-theme-darker`
- `material-default` -> `material-theme`
- `material-lighter` -> `material-theme-lighter`
- `material-ocean` -> `material-theme-ocean`
- `material-palenight` -> `material-theme-palenight`

### ç§»é™¤ï¼š`class:list` åŠŸèƒ½

åœ¨ Astro v2.x ä¸­ï¼Œ[`class:list` æŒ‡ä»¤](/zh-cn/reference/directives-reference/#classlist) ä½¿ç”¨äº†ä¸€ä¸ªå— [`clsx`](https://github.com/lukeed/clsx) å¯å‘çš„è‡ªå®šä¹‰å®ç°ï¼Œå…¶ä¸­åŒ…å«ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚å»é‡å’Œ `Set` æ”¯æŒã€‚

Astro v3.0 ç°åœ¨ç›´æ¥ä½¿ç”¨ `clsx` æ¥å¤„ç† `class:list`ï¼Œå®ƒä¸æ”¯æŒå»é‡å’Œ `Set` å€¼ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å°†ä¼ é€’ç»™ `class:list` æŒ‡ä»¤çš„ä»»ä½• `Set` å…ƒç´ æ›¿æ¢ä¸ºæ™®é€šæ•°ç»„ã€‚
```astro title="src/components/MyAstroComponent.astro" del={4} ins={5}
<Component class:list={[
  'a',
  'b',
  new Set(['c', 'd'])
  ['c', 'd'] 
]} />
```

### ç§»é™¤ï¼šå°† `class:list` ä½œä¸º prop ä¼ é€’

åœ¨ Astro v2.x ä¸­ï¼Œ[`class:list` çš„å€¼](/zh-cn/reference/directives-reference/#classlist) é€šè¿‡ [`Astro.props['class:list']`](/zh-cn/reference/api-reference/#astroprops) ä¼ é€’ç»™ç»„ä»¶ã€‚

Astro v3.0 å°† `class:list` çš„å€¼æ ‡å‡†åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åé€šè¿‡ `Astro.props['class']` å‘é€ç»™ç»„ä»¶ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ç§»é™¤ä»»ä½•æœŸæœ›æ¥æ”¶ `class:list` prop çš„ä»£ç ã€‚

```astro title="src/components/MyAstroComponent.astro" del={2,3,7} ins={4,8} "classList" "'class:list': classList"
---
import { clsx } from 'clsx';
const { class: className, 'class:list': classList } = Astro.props;
const { class: className } = Astro.props;
---
<div
  class:list={[className, classList]}
  class:list={[className]}
/>
```

### ç§»é™¤ï¼šå¯¹äº camelCase CSS å˜é‡çš„ kebab-case è½¬æ¢

åœ¨ Astro v2.x ä¸­ï¼Œä¼ é€’ç»™ `style` å±æ€§çš„ camelCase [CSS å˜é‡](/zh-cn/guides/styling/#css-å˜é‡) ä¼šè¢«æ¸²æŸ“ä¸º camelCaseï¼ˆå¦‚å†™å…¥çš„é‚£æ ·ï¼‰å’Œ kebab-caseï¼ˆä¿ç•™å‘åå…¼å®¹æ€§ï¼‰ã€‚

Astro v3.0 ç§»é™¤äº†è¿™äº› camelCase CSS å˜é‡åç§°çš„ kebab-case è½¬æ¢ï¼Œåªæœ‰åŸå§‹çš„ camelCase CSS å˜é‡è¢«æ¸²æŸ“ã€‚

```astro "my-value"
---
// src/components/MyAstroComponent.astro
const myValue = "red"
---
<!-- è¾“å…¥ -->
<div style={{ "--myValue": myValue }}></div>

<!-- è¾“å‡º (Astro 2.x) -->
<div style="--my-value:var(--myValue);--myValue:red"></div>
<!-- è¾“å‡º (Astro 3.0) -->
<div style="--myValue:red"></div>
```

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ ä¾é  Astro æ¥è½¬æ¢ä½ çš„æ ·å¼ä¸­çš„ kebab-caseï¼Œè¯·æ›´æ–°ä½ ç°æœ‰çš„æ ·å¼ä¸º camelCaseï¼Œä»¥é˜²æ­¢ä¸¢å¤±æ ·å¼ã€‚ä¾‹å¦‚ï¼š

```astro del={3} ins={4} title="src/components/MyAstroComponent.astro"
<style>
  div {
   color: var(--my-value);
   color: var(--myValue);
  }
</style>
```

### ç§»é™¤ï¼šè‡ªåŠ¨å±•å¹³ `getStaticPaths()` çš„è¿”å›å€¼

åœ¨ Astro v2.x ä¸­ï¼Œ`getStaticPaths()` çš„è¿”å›å€¼ä¼šè‡ªåŠ¨å±•å¹³ï¼Œä»¥å…è®¸è¿”å›ä¸€ä¸ªäºŒç»´æ•°ç»„è€Œä¸ä¼šå‡ºé”™ã€‚

Astro v3.0 ç§»é™¤äº†å¯¹ `getStaticPaths()` è¿”å›å€¼çš„è‡ªåŠ¨å±•å¹³ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ è¿”å›çš„æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„è€Œä¸æ˜¯ä¸€ä¸ªï¼ˆé¢„æœŸçš„ï¼‰_ä¸€ç»´å¯¹è±¡æ•°ç»„_ï¼Œåˆ™åº”è¯¥ä½¿ç”¨ `.flatMap` å’Œ `.flat` æ¥ç¡®ä¿ä½ è¿”å›çš„æ˜¯å±•å¹³çš„ä¸€ç»´æ•°ç»„ã€‚

å¦‚æœä½ éœ€è¦æ›´æ–°ä»£ç ï¼ŒAstro å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ï¼ŒæŒ‡å‡º `getStaticPath()` çš„è¿”å›å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹è±¡æ•°ç»„ã€‚

### ç§»åŠ¨ï¼š`astro check` ç°åœ¨éœ€è¦ä¸€ä¸ªå¤–éƒ¨åŒ…

åœ¨ Astro v2.x ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹åŒ…å«äº† [`astro check`](/zh-cn/reference/cli-reference/#astro-check)ï¼Œå¹¶ä¸”å®ƒçš„ä¾èµ–é¡¹è¢«æ‰“åŒ…åœ¨ Astro ä¸­ã€‚è¿™æ„å‘³ç€æ— è®ºä½ æ˜¯å¦ä½¿ç”¨ `astro check`ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªæ›´å¤§çš„åŒ…ã€‚è¿™ä¹Ÿé˜»æ­¢ä½ å¯¹ TypeScript å’Œ Astro è¯­è¨€æœåŠ¡å™¨çš„ç‰ˆæœ¬è¿›è¡Œæ§åˆ¶ã€‚

Astro v3.0 å°† `astro check` å‘½ä»¤ä» Astro æ ¸å¿ƒä¸­ç§»å‡ºï¼Œå¹¶ä¸”ç°åœ¨éœ€è¦ä¸€ä¸ªå¤–éƒ¨åŒ… `@astrojs/check`ã€‚æ­¤å¤–ï¼Œä½ å¿…é¡»åœ¨ä½ çš„é¡¹ç›®ä¸­å®‰è£… `typescript` æ¥ä½¿ç”¨ `astro check` å‘½ä»¤ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

åœ¨å‡çº§ Astro v3.0 åè¿è¡Œ `astro check` å‘½ä»¤ï¼Œå¹¶æŒ‰ç…§æç¤ºå®‰è£…æ‰€éœ€çš„ä¾èµ–é¡¹ï¼Œæˆ–è€…æ‰‹åŠ¨å°† `@astrojs/check` å’Œ `typescript` å®‰è£…åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚

### åºŸå¼ƒï¼š`build.excludeMiddleware` å’Œ `build.split`

åœ¨ Astro v2.x ä¸­ï¼Œ`build.excludeMiddleware` å’Œ `build.split` ç”¨äºåœ¨ SSR æ¨¡å¼ä¸‹ä½¿ç”¨é€‚é…å™¨æ—¶æ›´æ”¹ç‰¹å®šæ–‡ä»¶çš„äº§å‡ºæ–¹å¼ã€‚

Astro v3.0 ç”¨æ–°çš„ [SSR é€‚é…å™¨é…ç½®é€‰é¡¹](/zh-cn/guides/integrations-guide/#å®˜æ–¹é›†æˆ) æ›¿æ¢äº†è¿™äº›æ„å»ºé…ç½®é€‰é¡¹ï¼Œä»¥æ‰§è¡Œç›¸åŒçš„ä»»åŠ¡ï¼š`edgeMiddleware` å’Œ `functionPerRoute`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

æ›´æ–° Astro é…ç½®æ–‡ä»¶ï¼Œç›´æ¥åœ¨é€‚é…å™¨é…ç½®ä¸­ä½¿ç”¨æ–°çš„é€‰é¡¹ã€‚

```js title="astro.config.mjs" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import vercel from "@astrojs/vercel/serverless";

export default defineConfig({
    build: {
      excludeMiddleware: true
    },
    adapter: vercel({
      edgeMiddleware: true
    }),
});
```

```js title="astro.config.mjs" del={5-7} ins={9}
import { defineConfig } from "astro/config";
import netlify from "@astrojs/netlify/functions";

export default defineConfig({
     build: {
        split: true
     },
     adapter: netlify({
        functionPerRoute: true
     }),
});
```

### åºŸå¼ƒï¼š`markdown.drafts`

åœ¨ Astro v2.x ä¸­ï¼Œ`markdown.drafts` é…ç½®å…è®¸ä½ åœ¨è¿è¡Œå¼€å‘æœåŠ¡å™¨æ—¶æ‹¥æœ‰è‰ç¨¿é¡µé¢ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸ä¼šæ„å»ºã€‚

Astro v3.0 åºŸå¼ƒäº†è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œæ˜¯ä½¿ç”¨å†…å®¹é›†åˆçš„æ–¹æ³•æ¥å¤„ç†è‰ç¨¿é¡µé¢ï¼Œé€šè¿‡æ‰‹åŠ¨è¿‡æ»¤æ¥å®ç°ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°æ§åˆ¶è¿™ä¸ªåŠŸèƒ½ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ä¸ºäº†ç»§ç»­å°†ä½ é¡¹ç›®ä¸­çš„æŸäº›é¡µé¢æ ‡è®°ä¸ºè‰ç¨¿ï¼Œè¯· [è¿ç§»åˆ°å†…å®¹é›†åˆ](/zh-cn/guides/content-collections/#ä»åŸºäºæ–‡ä»¶çš„è·¯ç”±è¿ç§»)ï¼Œå¹¶ä½¿ç”¨ `draft: true` frontmatter å±æ€§ [æ‰‹åŠ¨è¿‡æ»¤é¡µé¢](/zh-cn/guides/content-collections/#ç­›é€‰é›†åˆæŸ¥è¯¢)ã€‚

### åºŸå¼ƒï¼šåœ¨ç«¯ç‚¹ï¼ˆendpointsï¼‰ä¸­è¿”å›ç®€å•å¯¹è±¡

åœ¨ Astro v2.x ä¸­ï¼Œç«¯ç‚¹ï¼ˆendpointsï¼‰å¯ä»¥è¿”å›ä¸€ä¸ªç®€å•çš„å¯¹è±¡ï¼Œå®ƒä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª JSON å“åº”ã€‚

Astro v3.0 åºŸå¼ƒäº†è¿™ç§è¡Œä¸ºï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ä¸€ä¸ª `Response` å¯¹è±¡ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

æ›´æ–°ä½ çš„ç«¯ç‚¹ï¼ˆendpointsï¼‰ï¼Œç›´æ¥è¿”å›ä¸€ä¸ª `Response` å¯¹è±¡ã€‚

```ts title="endpoint.json.ts" del={2} ins={3}
export async function GET() {
  return { body: { "title": "Bob's blog" }};
  return new Response(JSON.stringify({ "title": "Bob's blog" }));
}
```

å¦‚æœä½ ç¡®å®éœ€è¦ä¿ç•™ä»¥å‰çš„æ ¼å¼ï¼Œä½ å¯ä»¥ä½¿ç”¨ `ResponseWithEncoding` å¯¹è±¡ï¼Œä½†å®ƒä¼šåœ¨å°†æ¥è¢«å¼ƒç”¨ã€‚

```ts title="endpoint.json.ts" del={2} ins={3}
export async function GET() {
  return { body: { "title": "Bob's blog" } };
  return new ResponseWithEncoding({ body: { "title": "Bob's blog" }});
}
```

### é»˜è®¤å€¼æ”¹å˜ï¼štsconfig.json é¢„è®¾é‡Œçš„ `verbatimModuleSyntax`

åœ¨ Astro v2.x ä¸­ï¼Œ[`verbatimModuleSyntax`](https://www.typescriptlang.org/tsconfig#verbatimModuleSyntax) é»˜è®¤æ˜¯å…³é—­çš„ï¼Œåœ¨ `strict` é¢„è®¾ä¸­å®ƒçš„ TypeScript 4.x ç­‰ä»·è®¾ç½®é¡¹ `importsNotUsedAsValues` æ˜¯å¯ç”¨çš„ã€‚

åœ¨ Astro v3.0 ä¸­ï¼Œæ‰€æœ‰é¢„è®¾éƒ½å¯ç”¨äº† `verbatimModuleSyntax`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

è¿™ä¸ªé€‰é¡¹ä½¿å¾—ç±»å‹å¯¼å…¥å¿…é¡»ä½¿ç”¨ `import type` è¯­æ³•ã€‚

```astro title="src/components/MyAstroComponent.astro" "type"
---
import { type CollectionEntry, getEntry } from "astro:content";
---
```

è™½ç„¶æˆ‘ä»¬å»ºè®®ä¿æŒæ­¤è®¾ç½®é¡¹ä¸ºå¯ç”¨çŠ¶æ€å¹¶ï¼ˆåƒä¸Šé¢å±•ç¤ºçš„é‚£æ ·ï¼‰ä½¿ç”¨ `import type` æ¥å¯¼å…¥ç±»å‹ï¼Œå¦‚æœå‡ºç°äº†ä»»ä½•é—®é¢˜ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ `tsconfig.json` ä¸­è®¾ç½® `verbatimModuleSyntax: false` æ¥ç¦ç”¨å®ƒã€‚

```json title="tsconfig.json" "false"
{
  "compilerOptions": {
    "verbatimModuleSyntax": false
  }
}
```

### é»˜è®¤å€¼æ”¹å˜ï¼šç«¯å£ `3000`

åœ¨ Astro v2.x ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒAstro è¿è¡Œåœ¨ `3000` ç«¯å£ä¸Šã€‚

Astro v3.0 å°† [é»˜è®¤ç«¯å£](/zh-cn/reference/cli-reference/#--port-number) æ›´æ”¹ä¸º `4321`ã€‚ğŸš€

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

æ›´æ–°ä»»ä½•ç°æœ‰çš„å¼•ç”¨ `localhost:3000`ï¼Œä¾‹å¦‚åœ¨æµ‹è¯•æˆ–åœ¨ä½ çš„ `README` ä¸­ï¼Œä»¥åæ˜ æ–°çš„ç«¯å£ `localhost:4321`ã€‚

### é»˜è®¤å€¼æ”¹å˜ï¼šimport.meta.env.BASE_URL `trailingSlash`

åœ¨ Astro v2.x ä¸­ï¼Œé™¤é [`trailingSlash`](/zh-cn/reference/configuration-reference/#trailingslash) è¢«è®¾ç½®ä¸º `never`ï¼Œå¦åˆ™ `import.meta.env.BASE_URL` æ€»æ˜¯è¢«è®¾ç½®æˆä»¥æ–œæ  `/` ç»“å°¾çš„ [`base`](/zh-cn/reference/configuration-reference/#base)ã€‚ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹å¦‚æœ `base` ä¸æ˜¯ä»¥æ–œæ ç»“å°¾çš„ï¼ŒAstro ä¼šå¸®ä½ æ·»åŠ ä¸€ä¸ªã€‚

Astro v3.0 ä¸­çš„ `import.meta.env.BASE_URL` é»˜è®¤æƒ…å†µä¸‹ä¸å†ç»™ `base` æ·»åŠ æ–œæ ï¼Œä¹Ÿä¸ä¼šåœ¨è®¾ç½® `trailingSlash: "ignore"` æ—¶æ·»åŠ æ–œæ ã€‚`trailingSlash: "always"` å’Œ `trailingSlash: "never"` çš„è¡Œä¸ºä¿æŒä¸å˜ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ çš„ `base` å·²ç»ä»¥æ–œæ ç»“å°¾ï¼Œæˆ–ä½ çš„ `trailingSlash` è®¾ç½®ä¸º `always` æˆ– `never`ï¼Œåˆ™ä¸éœ€è¦æ›´æ”¹ã€‚

å¦‚æœä½ çš„ `base` ä¸ä»¥æ–œæ ç»“å°¾ **å¹¶ä¸”** ä½ å¸Œæœ› `import.meta.env.BASE_URL` ä¸ä»¥å‰ä¿æŒä¸€è‡´ï¼Œè¯·åœ¨ `base` åæ·»åŠ ä¸€ä¸ªæ–œæ ã€‚

```js title="astro.config.mjs" del={4} ins={5}
import { defineConfig } from "astro/config";

export default defineConfig({
  base: 'my-base',
  base: 'my-base/',
});
```

### é»˜è®¤å€¼æ”¹å˜ï¼š`compressHTML`

åœ¨ Astro v2.x ä¸­ï¼Œåªæœ‰å½“ [`compressHTML`](/zh-cn/reference/configuration-reference/#compresshtml) æ˜ç¡®è®¾ç½®ä¸º `true` æ—¶ï¼ŒAstro æ‰ä¼šå‹ç¼©ä½ å‘å‡ºçš„ HTMLã€‚é»˜è®¤å€¼æ›¾ç»æ˜¯ `false`ã€‚

Astro v3.0 ç°åœ¨é»˜è®¤å‹ç¼©äº§å‡ºçš„ HTMLã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ä½ å¯ä»¥ä»ä½ çš„é…ç½®ä¸­åˆ é™¤ `compressHTML: true`ï¼Œå› ä¸ºè¿™æ˜¯æ–°çš„é»˜è®¤è¡Œä¸ºã€‚

```js title="astro.config.mjs" del={4}
import { defineConfig } from "astro/config";

export default defineConfig({
  compressHTML: true
})
```

ä½ ç°åœ¨å¿…é¡»è®¾ç½® `compressHTML: false` æ¥ç¦ç”¨ HTML å‹ç¼©ã€‚

### é»˜è®¤å€¼æ”¹å˜ï¼š`scopedStyleStrategy`

åœ¨ Astro v2.x ä¸­ï¼Œ[`scopedStyleStrategy`](/zh-cn/reference/configuration-reference/#scopedstylestrategy) çš„é»˜è®¤å€¼æ˜¯ `"where"`ã€‚

Astro v3.0 å¼•å…¥äº†ä¸€ä¸ªæ–°çš„é»˜è®¤å€¼ï¼š`"attribute"`ã€‚ç°åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ ·å¼ä½¿ç”¨ `data-*` å±æ€§ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

ä¸ºäº†ä¿ç•™ä½ é¡¹ç›®çš„å½“å‰ [æ ·å¼ä½œç”¨åŸŸ](/zh-cn/guides/styling/#ä½œç”¨åŸŸæ ·å¼)ï¼Œè¯·ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸ºä»¥å‰çš„é»˜è®¤å€¼ï¼š

```js title="astro.config.mjs" ins={4}
import { defineConfig } from "astro/config";

export default defineConfig({
  scopedStyleStrategy: "where"
})
```

### é»˜è®¤å€¼æ”¹å˜ï¼š`inlineStyleSheets`

åœ¨ Astro v2.x ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é¡¹ç›®æ ·å¼è¡¨éƒ½ä½œä¸º `link` æ ‡ç­¾è¾“å‡ºã€‚ä½ å¯ä»¥é€šè¿‡è®¾ç½®ä¸º `"always"` ä½¿å®ƒä»¬æ€»æ˜¯å†…è”åˆ° `<style>` æ ‡ç­¾ä¸­ï¼Œæˆ–è€…è®¾ç½®ä¸º `"auto"` å†é€šè¿‡ [`build.inlineStylesheets`](/zh-cn/reference/configuration-reference/#buildinlinestylesheets) è®¾ç½®é¡¹æ¥ä»…å†…è”å°äºæŸä¸ªå¤§å°çš„æ ·å¼è¡¨ã€‚é»˜è®¤è®¾ç½®æ›¾ç»ä¸º `"never"`ã€‚

Astro v3.0 å°† `inlineStylesheets` çš„é»˜è®¤å€¼æ›´æ”¹ä¸º `"auto"`ã€‚é»˜è®¤æƒ…å†µä¸‹å°äº `ViteConfig.build.assetsInlineLimit`ï¼ˆé»˜è®¤å€¼ï¼š4kbï¼‰çš„æ ·å¼è¡¨è¢«å†…è”ï¼Œå…¶ä»–é¡¹ç›®æ ·å¼å°†ä»¥å¤–éƒ¨æ ·å¼è¡¨çš„å½¢å¼è¾“å‡ºã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ
å¦‚æœä½ æƒ³ä¿ç•™ä½ é¡¹ç›®çš„å½“å‰è¡Œä¸ºï¼Œè¯·å°† `build.inlineStylesheets` è®¾ç½®ä¸ºä»¥å‰çš„é»˜è®¤å€¼ `"never"`ï¼š

```js title="astro.config.mjs" ins={4-6}
import { defineConfig } from "astro/config";

export default defineConfig({
	 build: {
    inlineStylesheets: "never"
  }
})
```

### é»˜è®¤å€¼æ”¹å˜ï¼šå›¾åƒæœåŠ¡

åœ¨ Astro v2.x ä¸­ï¼ŒSquoosh æ˜¯[é»˜è®¤çš„å›¾åƒå¤„ç†æœåŠ¡](/zh-cn/guides/images/#é»˜è®¤å›¾åƒæœåŠ¡)ã€‚

Astro v3.0 å°† Sharp ä½œä¸ºé»˜è®¤çš„å›¾åƒå¤„ç†æœåŠ¡ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªé…ç½®é€‰é¡¹æ¥ä½¿ç”¨ Squooshã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

:::note
å½“ä½¿ç”¨åƒ `pnpm` è¿™æ ·çš„ [ä¸¥æ ¼åŒ…ç®¡ç†å™¨](https://pnpm.io/pnpm-vs-npm#npms-flat-tree) æ—¶ï¼Œå³ä½¿ Sharp å·²ç»æ˜¯ Astro çš„ä¾èµ–é¡¹ï¼Œä½ ä¹Ÿå¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£… Sharp åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼š

```bash
pnpm install sharp
```
:::

å¦‚æœä½ å¸Œæœ›ç»§ç»­ä½¿ç”¨ Squoosh æ¥è½¬æ¢ä½ çš„å›¾åƒï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é…ç½®æ›´æ–°ä½ çš„é…ç½®ï¼š

```ts title="astro.config.mjs" ins={4-6}
import { defineConfig, squooshImageService } from "astro/config";

export default defineConfig({
  image: {
    service: squooshImageService(),
  }
})
```

### ä¿®æ”¹ï¼šHTTP è¯·æ±‚æ–¹æ³•æ¡ˆä¾‹

åœ¨ Astro v2.x ä¸­ï¼Œ[HTTP è¯·æ±‚æ–¹æ³•](/zh-cn/core-concepts/endpoints/#http-æ–¹æ³•) ä½¿ç”¨å°å†™å‡½æ•°åç§°ç¼–å†™ï¼š`get`ã€`post`ã€`put`ã€`all` å’Œ `del`ã€‚

Astro v3.0 ä½¿ç”¨å¤§å†™å‡½æ•°åç§°ï¼Œä½¿ç”¨ `DELETE` è€Œä¸æ˜¯ `del`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

é‡å‘½åæ‰€æœ‰çš„å‡½æ•°åä¸ºå®ƒä»¬çš„å¤§å†™å½¢å¼ï¼š

- `get` æ”¹ä¸º `GET`
- `post` æ”¹ä¸º `POST`
- `put` æ”¹ä¸º `PUT`
- `all` æ”¹ä¸º `ALL`
- `del` æ”¹ä¸º `DELETE`

```js title="endpoint.ts" del={1} ins={2}
export function get() {
export function GET() {
    return new Response(JSON.stringify({ "title": "Bob's blog" }));
}
```

### ä¿®æ”¹ï¼šå¤šä¸ª JSX æ¡†æ¶é…ç½®

åœ¨ Astro v2.x ä¸­ï¼Œä½ å¯ä»¥åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å¤šä¸ª JSX æ¡†æ¶é›†æˆï¼ˆReactã€Solidã€Preactï¼‰è€Œä¸éœ€è¦æŒ‡å®šå“ªäº›æ–‡ä»¶å±äºå“ªä¸ªæ¡†æ¶ã€‚

Astro v3.0 ç°åœ¨è¦æ±‚ä½ åœ¨æœ‰å¤šä¸ª JSX æ¡†æ¶é›†æˆæ—¶ï¼Œä½¿ç”¨æ–°çš„ `include` å’Œ `exclude` é›†æˆé…ç½®é€‰é¡¹æ¥æŒ‡å®šä½ çš„æ–‡ä»¶ä½¿ç”¨å“ªä¸ªæ¡†æ¶ã€‚è¿™ä½¿å¾— Astro æ›´å¥½åœ°æ”¯æŒå•æ¡†æ¶ä½¿ç”¨ï¼Œä»¥åŠ React Fast Refresh ç­‰é«˜çº§åŠŸèƒ½ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

å¦‚æœä½ åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å¤šä¸ª JSX æ¡†æ¶é›†æˆï¼Œè¯·å°† `include`ï¼ˆå’Œå¯é€‰çš„ `exclude`ï¼‰è®¾ç½®ä¸ºæ–‡ä»¶æˆ–æ–‡ä»¶å¤¹çš„è·¯å¾„æ•°ç»„ã€‚å¯ç”¨é€šé…ç¬¦æ¥åŒ…å«å¤šä¸ªæ–‡ä»¶è·¯å¾„ã€‚

æˆ‘ä»¬å»ºè®®å°†å¸¸è§çš„æ¡†æ¶ç»„ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼ˆä¾‹å¦‚ `/components/react/` å’Œ `/components/solid/`ï¼‰ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°æŒ‡å®šä½ çš„åŒ…å«å†…å®¹ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ï¼š

```js ins={13,16,19}
import { defineConfig } from 'astro/config';
import preact from '@astrojs/preact';
import react from '@astrojs/react';
import svelte from '@astrojs/svelte';
import vue from '@astrojs/vue';
import solid from '@astrojs/solid-js';

export default defineConfig({
  // å¯ç”¨å¤šä¸ªæ¡†æ¶æ¥æ”¯æŒæ‰€æœ‰ä¸åŒç±»å‹çš„ç»„ä»¶ã€‚
  // å¦‚æœä½ åªä½¿ç”¨ä¸€ä¸ª JSX æ¡†æ¶ï¼Œåˆ™ä¸éœ€è¦ `include`ï¼
  integrations: [
    preact({
      include: ['**/preact/*'],
    }),
    react({
      include: ['**/react/*'],
    }),
    solid({
      include: ['**/solid/*'],
    }),
  ],
});
```

### ä¿®æ”¹ï¼š`Astro.cookies.get(key)` å¯ä»¥è¿”å› `undefined`

åœ¨ Astro v2.x ä¸­ï¼Œ[`Astro.cookies.get(key)`](/zh-cn/reference/api-reference/#astrocookies) å³ä½¿ cookie ä¸å­˜åœ¨ä¹Ÿä¼šè¿”å›ä¸€ä¸ª [`AstroCookie` å¯¹è±¡](/zh-cn/reference/api-reference/#astrocookie)ã€‚è¦æ£€æŸ¥å®ƒæ˜¯å¦å­˜åœ¨ï¼Œä½ éœ€è¦ä½¿ç”¨ `Astro.cookies.has(key)`ã€‚

Astro v3.0 ä¸­ï¼Œå¦‚æœ cookie ä¸å­˜åœ¨ï¼Œ`Astro.cookies.get(key)` ä¼šè¿”å› `undefined`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

è¿™ä¸ªä¿®æ”¹ä¸ä¼šå½±å“ä»»ä½•åœ¨è°ƒç”¨ `Astro.cookies.get(key)` ä¹‹å‰ç”¨ `Astro.cookies.has(key)` æ£€æŸ¥ cookie æ˜¯å¦å­˜åœ¨çš„ä»£ç ï¼Œä½†ç°åœ¨ä¸å†éœ€è¦æ£€æŸ¥ã€‚

ä½ å¯ä»¥å®‰å…¨çš„åˆ é™¤ä»»ä½•ä½¿ç”¨ `has()` æ¥æ£€æŸ¥ cookie æ˜¯å¦å­˜åœ¨çš„ä»£ç ï¼š

```js del={1-3} ins={5-7}
if (Astro.cookies.has(id)) {
  const id = Astro.cookies.get(id)!;
}

const id = Astro.cookies.get(id);
if (id) {
}
```

### ä¿®æ”¹ï¼šä»¥ç¼–ç¨‹æ–¹å¼è¿è¡Œ Astro CLI

åœ¨ Astro v2.x ä¸­ï¼Œ`"astro"` åŒ…çš„å…¥å£ç‚¹ç›´æ¥å¯¼å‡ºå¹¶è¿è¡Œ Astro CLIã€‚åœ¨å®è·µä¸­ä¸å»ºè®®ä»¥è¿™ç§æ–¹å¼è¿è¡Œ Astroã€‚

Astro v3.0 ä»å…¥å£ç‚¹ä¸­åˆ é™¤äº† CLIï¼Œå¹¶å¯¼å‡ºäº†ä¸€ç»„æ–°çš„å®éªŒæ€§ JavaScript APIï¼ŒåŒ…æ‹¬ `dev()`ã€`build()`ã€`preview()` å’Œ `sync()`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

è¦ [ä»¥ç¼–ç¨‹æ–¹å¼è¿è¡Œ Astro CLI](/zh-cn/reference/cli-reference/#é«˜çº§-apiå®éªŒæ€§)ï¼Œè¯·ä½¿ç”¨æ–°çš„å®éªŒæ€§ JavaScript APIï¼š

```js
import { dev, build } from "astro";

// å¯åŠ¨ Astro å¼€å‘æœåŠ¡å™¨
const devServer = await dev();
await devServer.stop();

// æ„å»º Astro é¡¹ç›®
await build();
```


### ä¿®æ”¹ï¼šå†…éƒ¨ Astro API å…¥å£æ–‡ä»¶å¯¼å‡ºè·¯å¾„

åœ¨ Astro v2.x ä¸­ï¼Œä½ å¯ä»¥ä» `astro/internal/*` å’Œ `astro/runtime/server/*` å¯¼å…¥å†…éƒ¨ Astro APIã€‚

Astro v3.0 åˆ é™¤äº†è¿™ä¸¤ä¸ªå…¥å£æ–‡ä»¶ï¼Œè€Œæ˜¯ä½¿ç”¨ç°æœ‰çš„ `astro/runtime/*` å…¥å£æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œè¿˜ä¸ºç¼–è¯‘å™¨çš„è¿è¡Œæ—¶ä»£ç å¯¼å‡ºäº†ä¸€ä¸ªæ–°çš„ `astro/compiler-runtime`ã€‚

#### æˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

è¿™äº›æ˜¯ Astro å†…éƒ¨ API çš„å…¥å£æ–‡ä»¶ï¼Œä¸åº”è¯¥å½±å“ä½ çš„é¡¹ç›®ã€‚ä½†å¦‚æœä½ ç¡®å®ä½¿ç”¨äº†è¿™äº›å…¥å£æ–‡ä»¶ï¼Œè¯·æŒ‰ç…§ä¸‹é¢çš„è¯´æ˜æ›´æ–°ï¼š

```js del={1,4,10} ins={2,5,11}
import 'astro/internal/index.js';
import 'astro/runtime/server/index.js';

import 'astro/server/index.js';
import 'astro/runtime/server/index.js';
```

```js ins={5} del={4}
import { transform } from '@astrojs/compiler';

const result = await transform(source, {
  internalURL: 'astro/runtime/server/index.js',
  internalURL: 'astro/compiler-runtime',
  // ...
});
```

## ç¤¾åŒºèµ„æº

çŸ¥é“ä¸€ä¸ªå¥½çš„ Astro v3.0 èµ„æºï¼Ÿ[ç¼–è¾‘æ­¤é¡µé¢](https://github.com/withastro/docs/edit/main/src/content/docs/zh-cn/guides/upgrade-to/v3.mdx) å¹¶åœ¨ä¸‹é¢æ·»åŠ é“¾æ¥ï¼

## å·²çŸ¥é—®é¢˜

ç›®å‰æ²¡æœ‰å·²çŸ¥çš„é—®é¢˜ã€‚
