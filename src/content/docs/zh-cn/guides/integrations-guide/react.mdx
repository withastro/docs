---
type: integration
title: '@astrojs/react'
sidebar:
  label: React
description: äº†è§£å¦‚ä½•ä½¿ç”¨ @astrojs/react æ¡†æ¶é›†æˆæ¥æ‰©å±• Astro é¡¹ç›®ä¸­çš„ç»„ä»¶æ”¯æŒã€‚
githubIntegrationURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/react/'
category: renderer
i18nReady: true
---
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import Since from '~/components/Since.astro';

**[Astro é›†æˆ][astro-integration]** ä¸ºä½ çš„ [React](https://react.dev/) ç»„ä»¶å®ç°æ¸²æŸ“å’Œå®¢æˆ·ç«¯æ°´åˆã€‚

## å®‰è£…

Astro åŒ…å«äº†ä¸€ä¸ª `astro add` å‘½ä»¤ï¼Œç”¨äºè‡ªåŠ¨è®¾ç½®å®˜æ–¹é›†æˆã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥æ”¹ä¸º[æ‰‹åŠ¨å®‰è£…é›†æˆ](#æ‰‹åŠ¨å®‰è£…)ã€‚

è¦å®‰è£… `@astrojs/react`ï¼Œè¯·åœ¨ä½ çš„é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹å‘½ä»¤å¹¶æ ¹æ®æç¤ºæ“ä½œï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npx astro add react
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm astro add react
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn astro add react
  ```
  </Fragment>
</PackageManagerTabs>

å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œ[è¯·éšæ—¶åœ¨ GitHub ä¸Šå‘æˆ‘ä»¬æŠ¥å‘Š](https://github.com/withastro/astro/issues)å¹¶å°è¯•ä¸‹é¢çš„æ‰‹åŠ¨å®‰è£…æ­¥éª¤ã€‚

### æ‰‹åŠ¨å®‰è£…

é¦–å…ˆï¼Œå®‰è£… `@astrojs/react` åŒ…:

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install @astrojs/react
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add @astrojs/react
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add @astrojs/react
  ```
  </Fragment>
</PackageManagerTabs>

å¤§å¤šæ•°åŒ…ç®¡ç†å™¨ä¹Ÿä¼šå®‰è£…ç›¸å…³çš„å¯¹ç­‰ä¾èµ–ã€‚å¦‚æœåœ¨å¯åŠ¨ Astro æ—¶çœ‹åˆ° `Cannot find package 'react'`ï¼ˆæˆ–ç±»ä¼¼ï¼‰çš„è­¦å‘Šï¼Œä½ éœ€è¦å®‰è£… `react` å’Œ `react-dom`ï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```sh
  npm install react react-dom @types/react @types/react-dom
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```sh
  pnpm add react react-dom @types/react @types/react-dom
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```sh
  yarn add react react-dom @types/react @types/react-dom
  ```
  </Fragment>
</PackageManagerTabs>

ç„¶åï¼Œä½¿ç”¨ `integrations` å±æ€§å°†æ­¤é›†æˆåº”ç”¨åˆ°ä½ çš„ `astro.config.*` æ–‡ä»¶ä¸­ï¼š

```js ins="react()" ins={2} title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';
export default defineConfig({
  // ...
  integrations: [react()],
});
```

ç„¶åæ·»åŠ ä¸‹é¢çš„ä»£ç åˆ° `tsconfig.json` æ–‡ä»¶ä¸­ã€‚

```json title="tsconfig.json" ins={5-8}
{
  "extends": "astro/tsconfigs/strict",
  "include": [".astro/types.d.ts", "**/*"],
  "exclude": ["dist"],
  "compilerOptions": {
    "jsx": "react-jsx",
    "jsxImportSource": "react"
  }
}
```

## å…¥é—¨æŒ‡å—

è¦åœ¨ Astro ä¸­ä½¿ç”¨ä½ çš„ç¬¬ä¸€ä¸ª React ç»„ä»¶ï¼Œè¯·å‰å¾€æˆ‘ä»¬çš„[UI æ¡†æ¶æ–‡æ¡£][astro-ui-frameworks]ã€‚ä½ å°†äº†è§£ï¼š

* ğŸ“¦ æ¡†æ¶ç»„ä»¶å¦‚ä½•è¢«åŠ è½½ï¼Œ
* ğŸ’§ å®¢æˆ·ç«¯æ°´åˆé€‰é¡¹ï¼Œä»¥åŠ
* ğŸ¤ æœ‰æœºä¼šå°†ä¸åŒçš„æ¡†æ¶æ··åˆå’ŒåµŒå¥—

## ä½¿ç”¨ `useActionState()` é›†æˆ Actions

`@astrojs/react` é›†æˆæä¾›äº†ä¸¤ä¸ªå‡½æ•°ï¼š`withState()` å’Œ `getActionState()` æ¥ä¸ [Astro Actions][astro-actions] ä¸€èµ·ä½¿ç”¨ã€‚

è¿™äº›å‡½æ•°ä¸ React çš„ `useActionState()` é’©å­ä¸€èµ·ä½¿ç”¨ï¼Œç”¨äºåœ¨è§¦å‘è¡¨å•æäº¤æ—¶è¯»å–å’Œæ›´æ–°å®¢æˆ·ç«¯çŠ¶æ€ã€‚

### `withState()`

<p>

**ç±»å‹ï¼š** `(action: FormFn<T>) => (state: T, formData: FormData) => FormFn<T>`<br />
<Since v="4.4.0" pkg="@astrojs/react" />
</p>

ä½ å¯ä»¥å°† `withState()` å’Œä½ æƒ³è¦è§¦å‘çš„ action ä¼ é€’ç»™ React çš„ `useActionState()` hook ä½œä¸ºè¡¨å• action å‡½æ•°ã€‚ä¸‹é¢çš„ç¤ºä¾‹å°† `like` action ä¼ é€’ç»™å¢åŠ è®¡æ•°å™¨ï¼Œå¹¶å°†åˆå§‹çŠ¶æ€è®¾ä¸º `0` ä¸ªç‚¹èµã€‚

```jsx title="Like.tsx" ins={2,7} "useActionState"
import { actions } from 'astro:actions';
import { withState } from '@astrojs/react/actions';
import { useActionState } from "react";

export function Like({ postId }: { postId: string }) {
  const [state, action, pending] = useActionState(
    withState(actions.like),
    { data: 0, error: undefined }, // åˆå§‹ç‚¹èµå’Œé”™è¯¯
  );

  return (
    <form action={action}>
      <input type="hidden" name="postId" value={postId} />
      <button disabled={pending}>{state.data} â¤ï¸</button>
    </form>
  );
}
```

`withState()` å‡½æ•°ä¼šå°† action çš„ç±»å‹ä¸ React çš„æœŸæœ›åŒ¹é…ï¼Œå¹¶ä¿ç•™ç”¨äºæ¸è¿›å¢å¼ºçš„å…ƒæ•°æ®ï¼Œä½¿å…¶å³ä½¿åœ¨ç”¨æˆ·è®¾å¤‡ç¦ç”¨ JavaScript æ—¶ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œã€‚

### `getActionState()`

<p>

**ç±»å‹ï¼š** `(context: ActionAPIContext) => Promise<T>`<br />
<Since v="4.4.0" pkg="@astrojs/react" />
</p>

ä½ å¯ä»¥åœ¨ action `handler` ä¸­é€šè¿‡ `getActionState()` è®¿é—® `useActionState()` å­˜å‚¨çš„çŠ¶æ€ã€‚å®ƒæ¥å— [Astro API ä¸Šä¸‹æ–‡](/zh-cn/reference/api-reference/#ä¸Šä¸‹æ–‡å¯¹è±¡)ï¼Œå¹¶å¯é€‰åœ°å¯¹ç»“æœåº”ç”¨ç±»å‹ã€‚

ä¸‹é¢çš„ç¤ºä¾‹è·å–è®¡æ•°å™¨ä¸­å½“å‰çš„ç‚¹èµæ•°çš„å€¼ï¼Œç±»å‹ä¸º numberï¼Œä»¥ä¾¿åˆ›å»ºä¸€ä¸ªé€’å¢çš„ `like` actionï¼š

```ts title="actions.ts" ins={3,11}
import { defineAction, type SafeResult } from 'astro:actions';
import { z } from 'astro:schema';
import { getActionState } from '@astrojs/react/actions';

export const server = {
  like: defineAction({
    input: z.object({
      postId: z.string(),
    }),
    handler: async ({ postId }, ctx) => {
      const { data: currentLikes = 0, error } = await getActionState<SafeResult<any, number>>(ctx);

      // å¤„ç†é”™è¯¯
      if (error) throw error;

      // å†™å…¥æ•°æ®åº“
      return currentLikes + 1;
    },
  })
};
```

## é€‰é¡¹

### ç»„åˆå¤šä¸ª JSX æ¡†æ¶

å½“ä½ åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨å¤šä¸ª JSX æ¡†æ¶ï¼ˆReactã€Preactã€Solidï¼‰æ—¶ï¼ŒAstro éœ€è¦ç¡®å®šæ¯ä¸ªç»„ä»¶åº”è¯¥ä½¿ç”¨å“ªä¸ª JSX æ¡†æ¶çš„è½¬æ¢å™¨ï¼ˆtransformationï¼‰ã€‚å¦‚æœä½ åªå‘ä½ çš„é¡¹ç›®ä¸­æ·»åŠ äº†ä¸€ä¸ª JSX æ¡†æ¶é›†æˆï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦é¢å¤–çš„é…ç½®ã€‚

ä½¿ç”¨ `include`ï¼ˆå¿…å¡«ï¼‰å’Œ `exclude`ï¼ˆå¯é€‰ï¼‰é…ç½®é€‰é¡¹æ¥æŒ‡å®šå“ªäº›æ–‡ä»¶å±äºå“ªä¸ªæ¡†æ¶ã€‚ä¸ºä½ ä½¿ç”¨çš„æ¯ä¸ªæ¡†æ¶æä¾›ä¸€ä¸ªæ–‡ä»¶æˆ–/å’Œæ–‡ä»¶å¤¹æ•°ç»„ã€‚é€šé…ç¬¦å¯ç”¨äºåŒ…å«å¤šä¸ªæ–‡ä»¶è·¯å¾„ã€‚

æˆ‘ä»¬å»ºè®®å°†æ¯ä¸ªæ¡†æ¶çš„ç»„ä»¶æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼ˆä¾‹å¦‚ `/components/react/` å’Œ `/components/solid/`ï¼‰ï¼Œä»¥ä¾¿æ›´å®¹æ˜“åœ°æŒ‡å®šä½ çš„åŒ…å«å†…å®¹ï¼Œä½†è¿™ä¸æ˜¯å¿…éœ€çš„ï¼š

```js title="astro.config.mjs"
import { defineConfig } from 'astro/config';
import preact from '@astrojs/preact';
import react from '@astrojs/react';
import svelte from '@astrojs/svelte';
import vue from '@astrojs/vue';
import solid from '@astrojs/solid-js';

export default defineConfig({
  // å¯ç”¨å¤šä¸ªæ¡†æ¶æ¥æ”¯æŒæ‰€æœ‰ä¸åŒç±»å‹çš„ç»„ä»¶ã€‚
  // å¦‚æœä½ åªä½¿ç”¨ä¸€ä¸ª JSX æ¡†æ¶ï¼Œåˆ™ä¸éœ€è¦ `include`ï¼
  integrations: [
    preact({
      include: ['**/preact/*'],
    }),
    react({
      include: ['**/react/*'],
    }),
    solid({
      include: ['**/solid/*'],
    }),
  ],
});
```

### è§£æå­å…ƒç´ 

ä» Astro ç»„ä»¶ä¼ é€’ç»™ React ç»„ä»¶çš„å­å…ƒç´ å°†è¢«è§£æä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ React èŠ‚ç‚¹ã€‚

ä¾‹å¦‚ï¼Œä¸‹é¢çš„ `<ReactComponent />` åªä¼šæ¥æ”¶ä¸€ä¸ªå­å…ƒç´ ï¼š

```astro
---
import ReactComponent from './ReactComponent';
---
<ReactComponent>
  <div>one</div>
  <div>two</div>
</ReactComponent>
```

å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ª*æœŸæœ›*èƒ½ä¼ é€’å¤šä¸ªå­å…ƒç´ çš„åº“ï¼Œä¾‹å¦‚å°†æŸäº›å…ƒç´ æ”¾ç½®åœ¨ä¸åŒçš„ä½ç½®ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°é—®é¢˜ã€‚

ä½ å¯ä»¥è®¾ç½®å®éªŒæ€§æ ‡å¿— `experimentalReactChildren`ï¼Œå‘Šè¯‰ Astro å°†å­å…ƒç´ å§‹ç»ˆä½œä¸º React è™šæ‹Ÿ DOM èŠ‚ç‚¹ä¼ é€’ç»™ Reactã€‚è™½ç„¶è¿™æ ·åšä¼šæœ‰ä¸€äº›è¿è¡Œæ—¶æˆæœ¬ï¼Œä½†æœ‰åŠ©äºä¿æŒå…¼å®¹æ€§ã€‚

ä½ å¯ä»¥åœ¨ React é›†æˆçš„é…ç½®ä¸­å¯ç”¨æ­¤é€‰é¡¹ï¼š

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

export default defineConfig({
  // ...
  integrations: [
    react({
      experimentalReactChildren: true,
    }),
  ],
});
```

### ç¦ç”¨æµå¼ä¼ è¾“ï¼ˆå®éªŒæ€§ï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼ŒAstro ä¼šæµå¼ä¼ è¾“ React ç»„ä»¶çš„è¾“å‡ºã€‚ä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡å¯ç”¨ `experimentalDisableStreaming` é€‰é¡¹æ¥ç¦ç”¨è¯¥è¡Œä¸ºã€‚è¿™å¯¹äºä¸ºä¸èƒ½å¾ˆå¥½åœ°ä¸æµå¼ä¼ è¾“ä¸€èµ·ä½¿ç”¨çš„åº“ï¼ˆå¦‚æŸäº› CSS-in-JS è§£å†³æ–¹æ¡ˆï¼‰æä¾›æ”¯æŒæ¥è¯´ï¼Œç‰¹åˆ«æœ‰ç”¨ã€‚

è¦ç¦ç”¨ä½ é¡¹ç›®ä¸­çš„æ‰€æœ‰ React ç»„ä»¶çš„æµå¼ä¼ è¾“ï¼Œè¯·ä½¿ç”¨ `experimentalDisableStreaming: true` æ¥é…ç½® `@astrojs/react`ï¼š

```js title="astro.config.mjs" ins={8}
import { defineConfig } from 'astro/config';
import react from '@astrojs/react';

export default defineConfig({
  // ...
  integrations: [
    react({
      experimentalDisableStreaming: true,
    })
  ]
});
```

[astro-integration]: /zh-cn/guides/integrations-guide/

[astro-ui-frameworks]: /zh-cn/guides/framework-components/#ä½¿ç”¨æ¡†æ¶ç»„ä»¶

[astro-actions]: /zh-cn/guides/actions/
