---
type: integration
title: '@astrojs/markdoc'
description: å­¦ä¹ å¦‚ä½•åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ @astrojs/markdoc é›†æˆã€‚
githubURL: 'https://github.com/withastro/astro/tree/main/packages/integrations/markdoc/'
hasREADME: true
category: other
i18nReady: true
---

è¿™ä¸ª **[Astro é›†æˆ][astro-integration]** å…è®¸ä½¿ç”¨ [Markdoc](https://markdoc.dev/) æ¥åˆ›å»ºç»„ä»¶ã€é¡µé¢å’Œå†…å®¹é›†åˆæ¡ç›®ã€‚

## ä¸ºä»€ä¹ˆæ˜¯ Markdocï¼Ÿ

Markdoc å…è®¸ä½ ä½¿ç”¨ [Astro ç»„ä»¶][astro-components] å¢å¼º Markdownã€‚å¦‚æœä½ å·²ç»ä½¿ç”¨ Markdoc ç¼–å†™äº†ç°æœ‰å†…å®¹ï¼Œæ­¤é›†æˆå…è®¸ä½ ä½¿ç”¨å†…å®¹é›†åˆå°†è¿™äº›æ–‡ä»¶å¸¦åˆ° Astro é¡¹ç›®ä¸­ã€‚

## å®‰è£…

### å¿«é€Ÿå®‰è£…

`astro add` å‘½ä»¤è¡Œå·¥å…·å¯ä»¥è‡ªåŠ¨ä¸ºä½ å®‰è£…ã€‚åœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€ã€‚ï¼ˆå¦‚æœä½ ä¸ç¡®å®šä½ ä½¿ç”¨çš„æ˜¯å“ªä¸ªåŒ…ç®¡ç†å™¨ï¼Œè¯·è¿è¡Œç¬¬ä¸€ä¸ªå‘½ä»¤ã€‚ï¼‰ç„¶åï¼ŒæŒ‰ç…§æç¤ºæ“ä½œï¼Œåœ¨ç»ˆç«¯ä¸­è¾“å…¥ "y"ï¼ˆæ„æ€æ˜¯ "yes"ï¼‰ã€‚

```sh
# ä½¿ç”¨ NPM
npx astro add markdoc
# ä½¿ç”¨ Yarn
yarn astro add markdoc
# ä½¿ç”¨ PNPM
pnpm astro add markdoc
```

å¦‚æœä½ é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œ[è¯·éšæ—¶åœ¨ GitHub ä¸Šå‘æˆ‘ä»¬æŠ¥å‘Š](https://github.com/withastro/astro/issues)ï¼Œå¹¶å°è¯•ä¸‹é¢çš„æ‰‹åŠ¨å®‰è£…æ­¥éª¤ã€‚

### æ‰‹åŠ¨å®‰è£…

é¦–å…ˆï¼Œä½¿ç”¨ä½ çš„åŒ…ç®¡ç†å™¨å®‰è£… `@astrojs/markdoc` åŒ…ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ npm æˆ–è€…ä¸ç¡®å®šï¼Œè¯·åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```sh
npm install @astrojs/markdoc
```

ç„¶åï¼Œåœ¨ä½ çš„ `astro.config.*` æ–‡ä»¶ä¸­ä½¿ç”¨ `integrations` å±æ€§åº”ç”¨è¿™ä¸ªé›†æˆï¼š

```diff lang="js" "markdoc()"
  // astro.config.mjs
  import { defineConfig } from 'astro/config';
+ import markdoc from '@astrojs/markdoc';
  export default defineConfig({
    // ...
    integrations: [markdoc()],
    //             ^^^^^^^^^
  });
```

### ç¼–è¾‘å™¨é›†æˆ

[VS Code](https://code.visualstudio.com/) é»˜è®¤æ”¯æŒ Markdownã€‚ä½†æ˜¯ï¼Œä¸ºäº†æ”¯æŒ Markdoc ç¼–è¾‘å™¨ï¼Œä½ å¯èƒ½å¸Œæœ›åœ¨ VSCode é…ç½®ä¸­æ·»åŠ ä»¥ä¸‹è®¾ç½®ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç¼–å†™ Markdoc æ–‡ä»¶æ—¶æä¾›ç±»ä¼¼ Markdown çš„ç¼–è¾‘å™¨ä½“éªŒã€‚

```json title=".vscode/settings.json"
{
  "files.associations": {
    "*.mdoc": "markdown"
  }
}
```

## ç”¨æ³•

Markdoc æ–‡ä»¶åªèƒ½åœ¨å†…å®¹é›†åˆä¸­ä½¿ç”¨ã€‚ä½¿ç”¨ `.mdoc` æ‰©å±•åå°†æ¡ç›®æ·»åŠ åˆ°ä»»ä½•å†…å®¹é›†åˆä¸­ï¼š

```sh
src/content/docs/
  why-markdoc.mdoc
  quick-start.mdoc
```

ç„¶åï¼Œä½¿ç”¨ [å†…å®¹é›†åˆ API](/zh-cn/guides/content-collections/#æŸ¥è¯¢é›†åˆ) æŸ¥è¯¢ä½ çš„é›†åˆï¼š

```astro
---
import { getEntryBySlug } from 'astro:content';

const entry = await getEntryBySlug('docs', 'why-markdoc');
const { Content } = await entry.render();
---

<!--ä½¿ç”¨ `data` è®¿é—® frontmatter å±æ€§`-->
<h1>{entry.data.title}</h1>
<!--ä½¿ç”¨ Content ç»„ä»¶æ¸²æŸ“ Markdoc å†…å®¹-->
<Content />
```

ğŸ“š äº†è§£æ›´å¤šå…³äº [Astro å†…å®¹é›†åˆæ–‡æ¡£][astro-content-collections] çš„ä¿¡æ¯ã€‚

## Markdoc é…ç½®

`@astrojs/markdoc` æä¾›äº†é…ç½®é€‰é¡¹ï¼Œä»¥ä½¿ç”¨ Markdoc çš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶å°† UI ç»„ä»¶è¿æ¥åˆ°ä½ çš„å†…å®¹ã€‚

### å°† Astro ç»„ä»¶ä½œä¸º Markdoc æ ‡ç­¾

ä½ å¯ä»¥é…ç½® [Markdoc æ ‡ç­¾][markdoc-tags]ï¼Œå°†å…¶æ˜ å°„åˆ° `.astro` ç»„ä»¶ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `markdoc.config.mjs|ts` æ–‡ä»¶å¹¶é…ç½® `tag` å±æ€§æ¥æ·»åŠ æ–°çš„æ ‡ç­¾ã€‚

è¿™ä¸ªä¾‹å­æ¸²æŸ“äº†ä¸€ä¸ª `Aside` ç»„ä»¶ï¼Œå¹¶å…è®¸ä¼ é€’ä¸€ä¸ª `type` å­—ç¬¦ä¸²å±æ€§ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, component } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  tags: {
    aside: {
      render: component('./src/components/Aside.astro'),
      attributes: {
        // Markdoc è¦æ±‚æ¯ä¸ªå±æ€§éƒ½æœ‰ç±»å‹å®šä¹‰ã€‚
        // è¿™äº›åº”è¯¥åæ˜ ä½ æ­£åœ¨æ¸²æŸ“çš„ç»„ä»¶çš„ `Props` ç±»å‹
        // æŸ¥çœ‹ Markdoc çš„å±æ€§å®šä¹‰æ–‡æ¡£ï¼š
        // https://markdoc.dev/docs/attributes#defining-attributes
        type: { type: String },
      },
    },
  },
});
```

ç°åœ¨ï¼Œè¿™ä¸ªç»„ä»¶å¯ä»¥åœ¨ä½ çš„ Markdoc æ–‡ä»¶ä¸­ä½¿ç”¨ `{% aside %}` æ ‡ç­¾ã€‚å­å…ƒç´ å°†è¢«ä¼ é€’ç»™ä½ çš„ç»„ä»¶çš„é»˜è®¤æ’æ§½ï¼š

```md
# æ¬¢è¿æ¥åˆ° Markdoc ğŸ‘‹

{% aside type="tip" %}

ä½¿ç”¨åƒè¿™ç§èŠ±å“¨çš„â€œasideâ€æ ‡ç­¾ä¸ºä½ çš„æ–‡æ¡£æ·»åŠ ä¸€äº› _èŠ±æ´»_ã€‚

{% /aside %}
```

### ä½¿ç”¨ npm åŒ…å’Œ TypeScript æ–‡ä»¶ä¸­çš„ Astro ç»„ä»¶

ä½ å¯èƒ½éœ€è¦åœ¨ TypeScript æˆ– JavaScript æ–‡ä»¶ä¸­ä½¿ç”¨ Astro ç»„ä»¶ã€‚å½“ä½¿ç”¨ npm åŒ…å’Œè®¾è®¡ç³»ç»Ÿæ—¶ï¼Œè¿™æ˜¯å¾ˆå¸¸è§çš„ã€‚

ä½ å¯ä»¥å°†å¯¼å…¥åç§°ä½œä¸º `component()` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, component } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  tags: {
    tabs: {
      render: component('@astrojs/starlight/components', 'Tabs'),
    },
  },
});
```

è¿™å°†åœ¨å†…éƒ¨ç”Ÿæˆä»¥ä¸‹å¯¼å…¥è¯­å¥ï¼š

```ts
import { Tabs } from '@astrojs/starlight/components';
```

### è‡ªå®šä¹‰æ ‡é¢˜

`@astrojs/markdoc` ä¼šè‡ªåŠ¨ä¸ºä½ çš„æ ‡é¢˜æ·»åŠ é”šç‚¹é“¾æ¥ï¼Œå¹¶ä¸”é€šè¿‡ [å†…å®¹é›†åˆ API ç”Ÿæˆä¸€ä¸ª `headings` åˆ—è¡¨](/zh-cn/guides/content-collections/#å°†å†…å®¹æ¸²æŸ“æˆ-html)ã€‚ä¸ºäº†è¿›ä¸€æ­¥è‡ªå®šä¹‰æ ‡é¢˜çš„æ¸²æŸ“æ–¹å¼ï¼Œä½ å¯ä»¥å°† Astro ç»„ä»¶ [ä½œä¸º Markdoc èŠ‚ç‚¹][markdoc-nodes] åº”ç”¨ã€‚

æ­¤ç¤ºä¾‹ä½¿ç”¨ `render` å±æ€§æ¸²æŸ“ `Heading.astro` ç»„ä»¶ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, nodes, component } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  nodes: {
    heading: {
      ...nodes.heading, // ä¿ç•™é»˜è®¤é”šç‚¹é“¾æ¥ç”Ÿæˆ
      render: component('./src/components/Heading.astro'),
    },
  },
});
```

æ‰€æœ‰çš„ Markdown æ ‡é¢˜éƒ½ä¼šæ¸²æŸ“ `Heading.astro` ç»„ä»¶ï¼Œå¹¶å°†ä»¥ä¸‹ `attributes` ä½œä¸ºç»„ä»¶çš„ props ä¼ é€’ï¼š

*   `level: number` æ ‡é¢˜çº§åˆ« 1 - 6
*   `id: string` ä»æ ‡é¢˜çš„æ–‡æœ¬å†…å®¹ç”Ÿæˆçš„ `id`ã€‚è¿™å¯¹åº”äº [å†…å®¹ `render()` å‡½æ•°ç”Ÿæˆçš„ `slug`](/zh-cn/guides/content-collections/#å°†å†…å®¹æ¸²æŸ“æˆ-html)ã€‚

ä¾‹å¦‚ï¼Œæ ‡é¢˜ `### Level 3 heading!` å°†ä¼šä¼ é€’ `level: 3` å’Œ `id: 'level-3-heading'` ä½œä¸ºç»„ä»¶çš„ propsã€‚

### è¯­æ³•é«˜äº®

`@astrojs/markdoc` æä¾›äº† [Shiki](https://github.com/shikijs/shiki) å’Œ [Prism](https://github.com/PrismJS) æ‰©å±•æ¥é«˜äº®ä½ çš„ä»£ç å—ã€‚

#### Shiki

ä½¿ç”¨ `extends` å±æ€§å°† `shiki()` æ‰©å±•åº”ç”¨åˆ°ä½ çš„ Markdoc é…ç½®ä¸­ï¼Œä½ å¯ä»¥é€‰æ‹©ä¼ é€’ä¸€ä¸ª shiki é…ç½®å¯¹è±¡ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig } from '@astrojs/markdoc/config';
import shiki from '@astrojs/markdoc/shiki';

export default defineMarkdocConfig({
  extends: [
    shiki({
      // ä» Shiki çš„å†…ç½®ä¸»é¢˜ä¸­è¿›è¡Œé€‰æ‹©ï¼ˆæˆ–æ·»åŠ ä½ è‡ªå·±çš„ä¸»é¢˜ï¼‰
      // é»˜è®¤ï¼š'github-dark'
      // https://github.com/shikijs/shiki/blob/main/docs/themes.md
      theme: 'dracula',
      // å¯ç”¨å•è¯æŠ˜å ä»¥é˜²æ­¢æ°´å¹³æ»šåŠ¨
      // é»˜è®¤ï¼šfalse
      wrap: true,
      // ä¼ å…¥è‡ªå®šä¹‰è¯­è¨€
      // æ³¨æ„ï¼šShiki å†…ç½®äº†è®¸å¤šçš„ langsï¼ŒåŒ…æ‹¬ `.astro`ï¼
      // https://github.com/shikijs/shiki/blob/main/docs/languages.md
      langs: [],
    }),
  ],
});
```

#### Prism

ä½¿ç”¨ `extends` å±æ€§å°† `prism()` æ‰©å±•åº”ç”¨åˆ°ä½ çš„ Markdoc é…ç½®ä¸­ã€‚

```js
// markdoc.config.mjs
import { defineMarkdocConfig } from '@astrojs/markdoc/config';
import prism from '@astrojs/markdoc/prism';

export default defineMarkdocConfig({
  extends: [prism()],
});
```

ğŸ“š è¦äº†è§£å¦‚ä½•é…ç½® Prism æ ·å¼è¡¨ï¼Œ[è¯·çœ‹æˆ‘ä»¬çš„è¯­æ³•é«˜äº®æŒ‡å—](/zh-cn/guides/markdown-content/#prism-é…ç½®)ã€‚

### è®¾ç½®æ ¹ HTML å…ƒç´ 

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMarkdoc ä¼šä½¿ç”¨ `<article>` æ ‡ç­¾åŒ…è£…æ–‡æ¡£ã€‚è¿™å¯ä»¥ä» `document` Markdoc èŠ‚ç‚¹ä¸­æ›´æ”¹ã€‚è¿™ä¸ªèŠ‚ç‚¹æ¥å—ä¸€ä¸ª HTML å…ƒç´ åç§°ï¼Œæˆ–è€…å¦‚æœä½ æƒ³åˆ é™¤åŒ…è£…å…ƒç´ çš„è¯ï¼Œå¯ä»¥ä¼ é€’ `null`ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, nodes } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  nodes: {
    document: {
      ...nodes.document, // åº”ç”¨é»˜è®¤çš„å…¶ä»–é…ç½®é¡¹
      render: null, // é»˜è®¤ 'article'
    },
  },
});
```

### è‡ªå®šä¹‰ Markdoc èŠ‚ç‚¹ / å…ƒç´ 

ä½ å¯èƒ½æƒ³è¦å°†æ ‡å‡†çš„ Markdown å…ƒç´ ï¼Œä¾‹å¦‚æ®µè½å’ŒåŠ ç²—æ–‡æœ¬ï¼Œæ¸²æŸ“ä¸º Astro ç»„ä»¶ã€‚ä¸ºæ­¤ï¼Œä½ å¯ä»¥é…ç½®ä¸€ä¸ª [Markdoc èŠ‚ç‚¹][markdoc-nodes]ã€‚å¦‚æœç»™å®šçš„èŠ‚ç‚¹æ¥æ”¶åˆ°å±æ€§ï¼Œå®ƒä»¬å¯å°†ä½œä¸ºç»„ä»¶ props æ¥ä½¿ç”¨ã€‚

è¿™ä¸ªä¾‹å­ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ `Quote.astro` ç»„ä»¶æ¸²æŸ“å¼•ç”¨å—ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, nodes, component } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  nodes: {
    blockquote: {
      ...nodes.blockquote, // åº”ç”¨é»˜è®¤çš„å…¶ä»–é…ç½®é¡¹
      render: component('./src/components/Quote.astro'),
    },
  },
});
```

ğŸ“š [åœ¨ä»–ä»¬çš„æ–‡æ¡£ä¸­æ‰¾åˆ° Markdoc çš„æ‰€æœ‰å†…ç½®èŠ‚ç‚¹å’ŒèŠ‚ç‚¹å±æ€§ã€‚](https://markdoc.dev/docs/nodes#built-in-nodes)

### ä½¿ç”¨å®¢æˆ·ç«¯ UI ç»„ä»¶

æ ‡ç­¾å’ŒèŠ‚ç‚¹ä»…é™äº `.astro` æ–‡ä»¶ã€‚è¦åœ¨ Markdoc ä¸­åµŒå…¥å®¢æˆ·ç«¯ UI ç»„ä»¶ï¼Œè¯· [ä½¿ç”¨ä¸€ä¸ªåŒ…è£…å™¨ `.astro` ç»„ä»¶æ¥æ¸²æŸ“æ¡†æ¶ç»„ä»¶](/zh-cn/core-concepts/framework-components/#åµŒå¥—æ¡†æ¶ç»„ä»¶) å’Œä½ æƒ³è¦çš„ `client:` æŒ‡ä»¤ã€‚

æ­¤ç¤ºä¾‹ä½¿ç”¨ `ClientAside.astro` ç»„ä»¶åŒ…è£… React `Aside.tsx` ç»„ä»¶ï¼š

```astro
---
// src/components/ClientAside.astro
import Aside from './Aside';
---

<Aside {...Astro.props} client:load />
```

è¿™ä¸ª Astro ç»„ä»¶ç°åœ¨å¯ä»¥ä¼ é€’ç»™ä½ çš„é…ç½®ä¸­çš„ä»»ä½• [æ ‡ç­¾][markdoc-tags] æˆ– [èŠ‚ç‚¹][markdoc-nodes] çš„ `render` å±æ€§ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig, component } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  tags: {
    aside: {
      render: component('./src/components/ClientAside.astro'),
      attributes: {
        type: { type: String },
      },
    },
  },
});
```

### Markdoc é…ç½®

`markdoc.config.mjs|ts` æ–‡ä»¶æ¥å— [æ‰€æœ‰ Markdoc é…ç½®é€‰é¡¹](https://markdoc.dev/docs/config)ï¼ŒåŒ…æ‹¬ [æ ‡ç­¾](https://markdoc.dev/docs/tags) å’Œ [å‡½æ•°](https://markdoc.dev/docs/functions)ã€‚

ä½ å¯ä»¥ä» `markdoc.config.mjs|ts` æ–‡ä»¶çš„é»˜è®¤å¯¼å‡ºä¸­ä¼ é€’è¿™äº›é€‰é¡¹ï¼š

```js
// markdoc.config.mjs
import { defineMarkdocConfig } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  functions: {
    getCountryEmoji: {
      transform(parameters) {
        const [country] = Object.values(parameters);
        const countryToEmojiMap = {
          japan: 'ğŸ‡¯ğŸ‡µ',
          spain: 'ğŸ‡ªğŸ‡¸',
          france: 'ğŸ‡«ğŸ‡·',
        };
        return countryToEmojiMap[country] ?? 'ğŸ³';
      },
    },
  },
});
```

ç°åœ¨ï¼Œä½ å¯ä»¥ä»ä»»ä½• Markdoc å†…å®¹æ¡ç›®ä¸­è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼š

```md
Â¡Hola {% getCountryEmoji("spain") %}!
```

ğŸ“š [æŸ¥çœ‹ Markdoc æ–‡æ¡£](https://markdoc.dev/docs/functions#creating-a-custom-function) äº†è§£æ›´å¤šå…³äºåœ¨ä½ çš„å†…å®¹ä¸­ä½¿ç”¨å˜é‡æˆ–å‡½æ•°çš„ä¿¡æ¯ã€‚

### Markdoc è¯­è¨€æœåŠ¡å™¨

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ VS Codeï¼Œæœ‰ä¸€ä¸ªå®˜æ–¹çš„ [Markdoc è¯­è¨€æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=Stripe.markdoc-language-support)ï¼Œå®ƒåŒ…æ‹¬äº†ä¸ºé…ç½®çš„æ ‡ç­¾æä¾›è¯­æ³•é«˜äº®å’Œè‡ªåŠ¨å®Œæˆã€‚[åœ¨ GitHub ä¸ŠæŸ¥çœ‹è¯­è¨€æœåŠ¡å™¨](https://github.com/markdoc/language-server.git) çš„æ›´å¤šä¿¡æ¯ã€‚

è¦è®¾ç½®è¿™ä¸ªæ‰©å±•ï¼Œåˆ›å»ºä¸€ä¸ª `markdoc.config.json` æ–‡ä»¶åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼Œå†…å®¹å¦‚ä¸‹ï¼š
```json
[
  {
    "id": "my-site",
    "path": "src/content",
    "schema": {
      "path": "markdoc.config.mjs",
      "type": "esm",
      "property": "default",
      "watch": true
    }
  }
]
```
`schema` å±æ€§ åŒ…å«äº†ä¸º Astro å†…å®¹é›†åˆé…ç½®è¯­è¨€æœåŠ¡å™¨çš„æ‰€æœ‰ä¿¡æ¯ã€‚å®ƒæ¥å—ä»¥ä¸‹å±æ€§ï¼š
*   `path`: é…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚
*   `type`: é…ç½®æ–‡ä»¶ä½¿ç”¨çš„æ¨¡å—ç±»å‹ï¼ˆ`esm` å…è®¸ `import` è¯­æ³•ï¼‰ã€‚
*   `property`: åŒ…å«é…ç½®å¯¹è±¡çš„å¯¼å‡ºå±æ€§åç§°ã€‚
*   `watch`: å‘Šè¯‰æœåŠ¡å™¨ç›‘å¬é…ç½®ä¸­çš„æ›´æ”¹ã€‚
é¡¶çº§ `path` å±æ€§å‘Šè¯‰æœåŠ¡å™¨å†…å®¹ä½äºå“ªé‡Œã€‚ç”±äº Markdoc æ˜¯ç‰¹å®šäºå†…å®¹é›†åˆçš„ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ `src/content`ã€‚

### ä¼ é€’ Markdoc å˜é‡

ä½ å¯èƒ½éœ€è¦å°† [å˜é‡][markdoc-variables] ä¼ é€’ç»™ä½ çš„å†…å®¹ã€‚å½“ä¼ é€’ SSR å‚æ•°æ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œæ¯”å¦‚ A/B æµ‹è¯•ã€‚

å˜é‡å¯ä»¥é€šè¿‡ `Content` ç»„ä»¶ä½œä¸º props ä¼ é€’ï¼š

```astro
---
import { getEntryBySlug } from 'astro:content';

const entry = await getEntryBySlug('docs', 'why-markdoc');
const { Content } = await entry.render();
---

<!--å°†`abTest`å‚æ•°ä½œä¸ºå˜é‡ä¼ é€’-->
<Content abTestGroup={Astro.params.abTestGroup} />
```

ç°åœ¨ï¼Œ`abTestGroup` å¯ä»¥ä½œä¸ºå˜é‡åœ¨ `docs/why-markdoc.mdoc` ä¸­ä½¿ç”¨ï¼š

```md
{% if $abTestGroup === 'image-optimization-lover' %}

è®©æˆ‘å‘Šè¯‰ä½ å…³äºå›¾åƒä¼˜åŒ–...

{% /if %}
```

è¦ä½¿å˜é‡å¯¹æ‰€æœ‰ Markdoc æ–‡ä»¶å…¨å±€å¯ç”¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ `markdoc.config.mjs|ts` ä¸­çš„ `variables` å±æ€§ï¼š

```js
import { defineMarkdocConfig } from '@astrojs/markdoc/config';

export default defineMarkdocConfig({
  variables: {
    environment: process.env.IS_PROD ? 'prod' : 'dev',
  },
});
```

### ä»ä½ çš„ Markdoc å†…å®¹ä¸­è®¿é—® frontmatter

è¦è®¿é—® frontmatterï¼Œä½ å¯ä»¥åœ¨æ¸²æŸ“å†…å®¹çš„åœ°æ–¹å°†æ¡ç›® `data` å±æ€§ [ä½œä¸ºå˜é‡](#ä¼ é€’-markdoc-å˜é‡) ä¼ é€’ï¼š

```astro
---
import { getEntry } from 'astro:content';

const entry = await getEntry('docs', 'why-markdoc');
const { Content } = await entry.render();
---

<Content frontmatter={entry.data} />
```

è¿™æ ·å°±å¯ä»¥åœ¨ä½ çš„ Markdoc ä¸­ä½œä¸º `$frontmatter` è®¿é—®ã€‚

## é›†æˆé…ç½®é€‰é¡¹

Astro Markdoc é›†æˆå¤„ç†äº†åœ¨ `markdoc.config.js` æ–‡ä»¶ä¸­ä¸å¯ç”¨çš„ Markdoc é€‰é¡¹å’ŒåŠŸèƒ½çš„é…ç½®ã€‚

### `allowHTML`

å…è®¸åœ¨ Markdoc æ ‡ç­¾å’ŒèŠ‚ç‚¹æ—è¾¹ç¼–å†™ HTML æ ‡è®°ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMarkdoc ä¸ä¼šå°† HTML æ ‡è®°è¯†åˆ«ä¸ºè¯­ä¹‰å†…å®¹ã€‚

è¦å®ç°æ›´æ¥è¿‘ Markdown çš„ä½“éªŒï¼Œå…¶ä¸­ HTML å…ƒç´ å¯ä»¥ä¸ä½ çš„å†…å®¹ä¸€èµ·ä½¿ç”¨ï¼Œè¯·å°† `allowHTML:true` ä½œä¸º `markdoc` é›†æˆé€‰é¡¹è®¾ç½®ã€‚è¿™å°†åœ¨ Markdoc æ ‡è®°ä¸­å¯ç”¨ HTML è§£æã€‚

```diff lang="js" "allowHTML: true"
  // astro.config.mjs
  import { defineConfig } from 'astro/config';
  import markdoc from '@astrojs/markdoc';

  export default defineConfig({
    // ...
+   integrations: [markdoc({ allowHTML: true })],
    //                       ^^^^^^^^^^^^^^^
  });
```

:::caution
å½“ `allowHTML` è¢«å¯ç”¨æ—¶ï¼ŒMarkdoc æ–‡æ¡£ä¸­çš„ HTML æ ‡è®°å°†è¢«æ¸²æŸ“ä¸ºå®é™…çš„ HTML å…ƒç´ ï¼ˆåŒ…æ‹¬ `<script>`ï¼‰ï¼Œè¿™å°†ä½¿ XSS ç­‰æ”»å‡»å‘é‡æˆä¸ºå¯èƒ½ã€‚ç¡®ä¿ä»»ä½• HTML æ ‡è®°æ¥è‡ªå¯ä¿¡çš„æ¥æºã€‚
:::

## ç¤ºä¾‹

*   [Astro Markdoc å…¥é—¨æ¨¡æ¿](https://github.com/withastro/astro/tree/latest/examples/with-markdoc) å±•ç¤ºäº†å¦‚ä½•åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­ä½¿ç”¨ Markdoc æ–‡ä»¶ã€‚

## æ•…éšœæ’é™¤

å¯»æ±‚å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹ [Discord](https://astro.build/chat) ä¸Šçš„ `#support` é¢‘é“ã€‚æˆ‘ä»¬å‹å¥½çš„æ”¯æŒå°ç»„æˆå‘˜åœ¨è¿™é‡Œå¸®åŠ©ä½ ï¼

ä½ è¿˜å¯ä»¥æŸ¥çœ‹æˆ‘ä»¬çš„ [Astro é›†æˆæ–‡æ¡£][astro-integration] äº†è§£æ›´å¤šå…³äºé›†æˆçš„ä¿¡æ¯ã€‚

## è´¡çŒ®

è¿™ä¸ªé¡¹ç›®ç”± Astro æ ¸å¿ƒå›¢é˜Ÿç»´æŠ¤ã€‚æ¬¢è¿æäº¤ issue æˆ– PRï¼

## æ›´æ–°æ—¥å¿—

æŸ¥çœ‹ [CHANGELOG.md](https://github.com/withastro/astro/tree/main/packages/integrations/markdoc/CHANGELOG.md), äº†è§£æœ¬é›†æˆçš„å˜æ›´å†å²ã€‚

[astro-integration]: /zh-cn/guides/integrations-guide/

[astro-components]: /zh-cn/core-concepts/astro-components/

[astro-content-collections]: /zh-cn/guides/content-collections/

[markdoc-tags]: https://markdoc.dev/docs/tags

[markdoc-nodes]: https://markdoc.dev/docs/nodes

[markdoc-variables]: https://markdoc.dev/docs/variables
