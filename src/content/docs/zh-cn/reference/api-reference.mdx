---
title: API å‚è€ƒ
---
import Since from '~/components/Since.astro';
import PackageManagerTabs from '~/components/tabs/PackageManagerTabs.astro'
import Badge from '~/components/Badge.astro';


## `Astro` global

`Astro` global åœ¨ `.astro` æ–‡ä»¶çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ä¸­éƒ½å¯ç”¨ã€‚å®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š

### `Astro.glob()`

`Astro.glob()` å¯ä»¥åœ¨é™æ€ç½‘ç«™ setup ä¸­åŠ è½½æœ¬åœ°æ–‡ä»¶ï¼š

```astro
---
// ./src/components/my-component.astro
const posts = await Astro.glob('../pages/post/*.md'); // è¿”å›ä½äº ./src/pages/post/*.md çš„æ•°ç»„å¹¶å­˜å‚¨åœ¨å¸¸é‡ posts ä¸­
---

<div>
{posts.slice(0, 3).map((post) => (
  <article>
    <h1>{post.frontmatter.title}</h1>
    <p>{post.frontmatter.description}</p>
    <a href={post.frontmatter.url}>Read more</a>
  </article>
))}
</div>
```

`.glob()` åªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼šä½ æƒ³å¯¼å…¥çš„æœ¬åœ°æ–‡ä»¶ç›¸å¯¹ glob URLã€‚å®ƒæ˜¯å¼‚æ­¥çš„å¹¶è¿”å›æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„åŒ…å«åŒ¹é…æ–‡ä»¶çš„å¯¼å‡ºå†…å®¹ã€‚

`.glob()` ä¸æ¥å—ä½¿ç”¨å˜é‡æˆ–å­—ç¬¦ä¸²è¿›è¡Œæ’å€¼ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯é™æ€å¯åˆ†æçš„ã€‚(å‚è§[æ•…éšœæ’æŸ¥](/zh-cn/guides/troubleshooting/#æ”¯æŒçš„å€¼)ä»¥äº†è§£è§£å†³æ–¹æ³•)ã€‚è¿™æ˜¯å› ä¸º `Astro.glob()` æ˜¯ Vite çš„ [`import.meta.glob()`](https://cn.vitejs.dev/guide/features.html#glob-import) çš„åŒ…è£…å™¨ã€‚

:::note
ä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­ä½¿ç”¨ `import.meta.glob()`ã€‚ä½ å¯èƒ½æƒ³åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¿™æ ·åšï¼š

- ä½ åœ¨ä¸€ä¸ªä¸æ˜¯ `.astro` çš„æ–‡ä»¶ä¸­éœ€è¦è¿™ä¸ªåŠŸèƒ½ï¼Œæ¯”å¦‚ä¸€ä¸ª API è·¯ç”±ã€‚`Astro.glob()` åªåœ¨ `.astro` æ–‡ä»¶ä¸­å¯ç”¨ï¼Œè€Œ `import.meta.glob()` åœ¨é¡¹ç›®çš„ä»»ä½•åœ°æ–¹éƒ½å¯ç”¨ã€‚
- ä½ ä¸å¸Œæœ›ç«‹å³åŠ è½½æ¯ä¸ªæ–‡ä»¶ã€‚`import.meta.glob()` å¯ä»¥è¿”å›å¯¼å…¥æ–‡ä»¶å†…å®¹çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯è¿”å›å†…å®¹æœ¬èº«ã€‚è¯·æ³¨æ„ï¼Œæ­¤å¯¼å…¥åŒ…æ‹¬ä»»ä½•å¯¼å…¥æ–‡ä»¶çš„æ‰€æœ‰æ ·å¼å’Œè„šæœ¬ã€‚æ— è®ºæ–‡ä»¶æ˜¯å¦è¢«å®é™…ä½¿ç”¨ï¼Œè¿™äº›æ ·å¼å’Œè„šæœ¬éƒ½å°†è¢«æ†ç»‘å¹¶æ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œå› ä¸ºè¿™æ˜¯ç”±é™æ€åˆ†æå†³å®šçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ã€‚
- ä½ æƒ³è®¿é—®æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ã€‚`import.meta.glob()` è¿”å›æ–‡ä»¶è·¯å¾„åˆ°å…¶å†…å®¹çš„æ˜ å°„ï¼Œè€Œ `Astro.glob()` è¿”å›å†…å®¹çš„åˆ—è¡¨ã€‚
- ä½ æƒ³ä¼ é€’å¤šç§æ¨¡å¼ï¼›ä¾‹å¦‚ï¼Œä½ æƒ³æ·»åŠ ä¸€ä¸ªâ€œè´Ÿæ¨¡å¼â€ï¼Œè¿‡æ»¤æ‰æŸäº›æ–‡ä»¶ã€‚`import.meta.glob()` å¯ä»¥é€‰æ‹©æ¥å— glob å­—ç¬¦ä¸²æ•°ç»„ï¼Œè€Œä¸æ˜¯å•ä¸ªå­—ç¬¦ä¸²ã€‚

åœ¨ [Vite æ–‡æ¡£](https://cn.vitejs.dev/guide/features.html#glob-import)ä¸­é˜…è¯»æ›´å¤šå†…å®¹ã€‚
:::

#### Markdown æ–‡ä»¶

Markdown æ–‡ä»¶æœ‰ä»¥ä¸‹æ¥å£ï¼š

```ts
export interface MarkdownInstance<T extends Record<string, any>> {
  /* åœ¨æ­¤æ–‡ä»¶çš„ YAML frontmatter ä¸­æŒ‡å®šçš„ä»»ä½•æ•°æ® */
 frontmatter: T;
  /* è¯¥æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ */
 file: string;
  /* è¯¥æ–‡ä»¶çš„æ¸²æŸ“è·¯å¾„ */
 url: string | undefined;
  /* æ¸²æŸ“æ­¤æ–‡ä»¶å†…å®¹çš„ Astro ç»„ä»¶ */
 Content: AstroComponent;
  /* è¿”å›è¯¥æ–‡ä»¶ä¸­ h1...h6 å…ƒç´ æ•°ç»„çš„å‡½æ•° */
 getHeadings(): Promise<{ depth: number; slug: string; text: string }[]>;
}
```

ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ TypeScript æ³›å‹æŒ‡å®š `frontmatter` å˜é‡ç±»å‹ï¼š

```astro
---
interface Frontmatter {
  title: string;
  description?: string;
}
const posts = await Astro.glob<Frontmatter>('../pages/post/*.md');
---

<ul>
  {posts.map(post => <li>{post.frontmatter.title}</li>)}
</ul>
```

#### Astro æ–‡ä»¶

Astro æ–‡ä»¶å…·æœ‰ä»¥ä¸‹æ¥å£ï¼š

```ts
export interface AstroInstance {
  /* æ­¤æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ */
  file: string;
  /* æ­¤æ–‡ä»¶çš„ URLï¼ˆå¦‚æœå®ƒåœ¨ pages ç›®å½•ä¸­ï¼‰*/
	url: string | undefined;
	default: AstroComponent;
}
```

#### å…¶å®ƒæ–‡ä»¶

å…¶ä»–æ–‡ä»¶å¯èƒ½æœ‰å„ç§ä¸åŒçš„æ¥å£ï¼Œä½†å¦‚æœä½ ä¸çŸ¥é“æ–‡ä»¶ç±»å‹åŒ…å«ä»€ä¹ˆï¼Œé‚£ä¹ˆ `Astro.glob()` å¯ä»¥æ¥å— TypeScript æ³›å‹ã€‚

```ts
---
interface CustomDataFile {
  default: Record<string, any>;
}
const data = await Astro.glob<CustomDataFile>('../data/**/*.js');
---
```

### `Astro.props`

`Astro.props` æ˜¯ä¸€ä¸ªåŒ…å«ä»»ä½•ä½œä¸º[ç»„ä»¶å±æ€§](/zh-cn/core-concepts/astro-components/#ç»„ä»¶å‚æ•°)ä¼ é€’çš„å€¼çš„å¯¹è±¡ã€‚`.md` å’Œ `.mdx` æ–‡ä»¶çš„å¸ƒå±€ç»„ä»¶æ¥æ”¶ä½œä¸ºå‚æ•°çš„ frontmatter å€¼ã€‚

```astro {3}
---
// ./src/components/Heading.astro
const { title, date } = Astro.props;
---
<div>
    <h1>{title}</h1>
    <p>{date}</p>
</div>
```

```astro /title=".+"/ /date=".+"/
---
// ./src/pages/index.astro
import Heading from '../components/Heading.astro';
---
<Heading title="æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« " date="09 Aug 2022" />
```

ğŸ“š è¿›ä¸€æ­¥äº†è§£ [Markdown å’Œ MDX å¸ƒå±€](/zh-cn/guides/markdown-content/#frontmatter-layout)å¦‚ä½•å¤„ç† propsã€‚

ğŸ“š äº†è§£å¦‚ä½•ä¸ºä½ çš„ props æ·»åŠ  [TypeScript ç±»å‹å®šä¹‰](/zh-cn/guides/typescript/#ç»„ä»¶å‚æ•°)ã€‚



### `Astro.params`

`Astro.params` æ˜¯ä¸€ä¸ªåŒ…å«ä¸æ­¤è¯·æ±‚åŒ¹é…çš„åŠ¨æ€è·¯ç”±æ®µçš„å€¼çš„å¯¹è±¡ã€‚

åœ¨é™æ€æ„å»ºä¸­ï¼Œè¿™å°†æ˜¯ `getStaticPaths()` è¿”å›çš„`params`ï¼Œç”¨äºé¢„æ¸²æŸ“[åŠ¨æ€è·¯ç”±](/zh-cn/core-concepts/routing/#åŠ¨æ€è·¯ç”±).ã€‚

åœ¨ SSR æ„å»ºä¸­ï¼Œè¿™å¯ä»¥æ˜¯ä¸åŠ¨æ€è·¯ç”±æ¨¡å¼ä¸­çš„è·¯å¾„æ®µåŒ¹é…çš„ä»»ä½•å€¼ã€‚

```astro title="src/pages/posts/[id].astro"
---
export function getStaticPaths() {
  return [
    { params: { id: '1' } },
    { params: { id: '2' } },
    { params: { id: '3' } }
  ];
}

const { id } = Astro.params;
---
<h1>{id}</h1>
```

å¦è§ï¼š[`params`](#params)

### `Astro.request`

`Astro.request` æ˜¯æ ‡å‡†çš„ [Request](https://developer.mozilla.org/zh-CN/docs/Web/API/Request) å¯¹è±¡ã€‚å®ƒå¯ä»¥ç”¨æ¥è·å–è¯·æ±‚çš„ `url`ã€`headers`ã€`method`ï¼Œç”šè‡³æ˜¯ `body`ã€‚å¯ä»¥ä½¿ç”¨ `new URL(Astro.request.url)` æ¥è·å¾—é“¾æ¥å¯¹è±¡ã€‚

```astro
<p>Received a {Astro.request.method} request to "{Astro.request.url}".</p>
<p>Received request headers: <code>{JSON.stringify(Object.fromEntries(Astro.request.headers))}</code>
```

å¦è§ï¼š[`Astro.url`](#astrourl)

:::note
é»˜è®¤çš„ `output: static` é€‰é¡¹ä¸­ï¼Œ`Astro.request.url` ä¸åŒ…å«æœç´¢å‚æ•°ï¼Œå¦‚ `?foo=bar`ï¼Œå› ä¸ºåœ¨é™æ€æ„å»ºä¸­ä¸å¯èƒ½æå‰ç¡®å®šè¿™äº›å‚æ•°ã€‚ä½†æ˜¯åœ¨ `output: 'server'` æ¨¡å¼ä¸‹ï¼Œ`Astro.request.url` å¯ä»¥åŒ…å«æœç´¢å‚æ•°ï¼Œå› ä¸ºå®ƒå¯ä»¥ä»æœåŠ¡å™¨è¯·æ±‚ä¸­ç¡®å®šã€‚
:::

### `Astro.response`

`Astro.response` æ˜¯æ ‡å‡†çš„ [ResponseInit](https://developer.mozilla.org/zh-CN/docs/Web/API/Response/Response#init) å¯¹è±¡ï¼Œå®ƒå…·æœ‰ä»¥ä¸‹ç»“æ„ï¼š

- `status`ï¼šå“åº”çš„çŠ¶æ€ç ï¼Œä¾‹å¦‚ `200`ã€‚
- `statusText`ï¼šå“åº”çŠ¶æ€ç ä¸ä¹‹ç›¸å¯¹åº”çš„çŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚ `OK`ã€‚
- `headers`ï¼šä¸€ä¸ªèƒ½è®©ä½ ä¸ºå“åº”è®¾ç½® HTTP å¤´éƒ¨çš„ [`Headers`](https://developer.mozilla.org/zh-CN/docs/Web/API/Headers) å®ä¾‹ã€‚

æ‰€ä»¥ `Astro.response` ä¹Ÿç”¨äºè®¾ç½®é¡µé¢å“åº”çš„ `status`ã€`statusText` å’Œ `headers`ã€‚

```astro
---
if(condition) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}
---
```

æˆ–è€…è®¾ç½® headerï¼š

```astro
---
Astro.response.headers.set('Set-Cookie', 'a=b; Path=/;');
---
```

### `Astro.cookies`

<Since v="1.4.0" />

`Astro.cookies` åŒ…å«ç”¨äºåœ¨[æœåŠ¡ç«¯æ¸²æŸ“](/zh-cn/guides/server-side-rendering/)æ¨¡å¼ä¸‹è¯»å–å’Œæ“ä½œ cookie çš„å·¥å…·æ–¹æ³•ã€‚


|å&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç§°  | ç±»&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å‹                                                         | æ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿°                                                         |
| :-------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| `get`      | `(key: string) => AstroCookie`                               | è·å– [`AstroCookie`](#astrocookie) å¯¹è±¡å½¢å¼çš„ cookieï¼Œè¯¥å¯¹è±¡åŒ…å«`value`å’Œç”¨äºå°† cookie è½¬æ¢ä¸ºéå­—ç¬¦ä¸²ç±»å‹çš„å·¥å…·æ–¹æ³•ã€‚ |
| `has`     | `(key: string) => boolean`                                   | cookie æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœè¿™ä¸ª cookie å·²ç»é€šè¿‡`Astro.cookies.set()`è®¾ç½®ï¼Œè¿™å°†è¿”å› trueï¼Œå¦åˆ™å®ƒå°†æ£€æŸ¥ `Astro.request` ä¸­çš„ cookiesã€‚ |
| `set`     | `(key: string, value: string \| number \| boolean \| object, options?: CookieOptions) => void` | å°† cookie `key` è®¾ç½®ä¸ºç»™å®šçš„å€¼ã€‚è¿™å°†è¯•å›¾æŠŠ cookie çš„å€¼è½¬æ¢ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é€‰é¡¹æä¾›äº†è®¾ç½® [cookie åŠŸèƒ½](https://www.npmjs.com/package/cookie#options-1)çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `maxAge` æˆ– `httpOnlyã€‚` |
| `delete`  | `(key: string, options?: CookieDeleteOptions) => void`       | å°† Cookie æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚å°† Cookie æ ‡è®°ä¸ºå·²åˆ é™¤ã€‚ä¸€æ—¦ cookie è¢«åˆ é™¤ï¼Œ`Astro.cookies.has()` å°†è¿”å› `false`ï¼Œ`Astro.cookies.get()` å°†è¿”å›ä¸€ä¸ªå€¼ä¸º `undefined` çš„ [`AstroCookie`](#astrocookie)ã€‚é€‰é¡¹å…è®¸è®¾ç½®è¦åˆ é™¤çš„ Cookie çš„`domain`å’Œ`path`ã€‚ |
| `headers` | `() => Iterator<string>`                                     | è·å–å°†ä¸å“åº”ä¸€èµ·å‘é€çš„ `Set-Cookie` çš„ header çš„å€¼ã€‚         |

#### `AstroCookie`

é€šè¿‡ `Astro.cookies.get()` è·å– cookie è¿”å›ä¸€ä¸ª `AstroCookie` ç±»å‹ã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç»“æ„ã€‚

| å&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç§°                |         ç±»&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å‹          | æ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;è¿°                                                                                                         |
| :----------------  | :-------------------: | :----------------------------------------------------------------------------------------------------------- |
| `value`            | `string \| undefined`                      | cookie çš„åŸå§‹å­—ç¬¦ä¸²å€¼          |
| `json`             | `() => Record<string, any>`                       | é€šè¿‡ `JSON.parse()` è§£æ cookie å€¼ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœ cookie å€¼ä¸æ˜¯æœ‰æ•ˆçš„ JSONï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚        |
| `number`           | `() => number` | å°† cookie å€¼è§£æä¸ºæ•°å­—ã€‚å¦‚æœä¸æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œåˆ™è¿”å› NaNã€‚  |
| `boolean`          | `() => boolean` | è½¬æ¢ cookie çš„å€¼ä¸º boolean ç±»å‹ã€‚  |




### `Astro.redirect()`

`Astro.redirect()` å…è®¸ä½ é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚

é¡µé¢ï¼ˆè€Œä¸æ˜¯å­ç»„ä»¶ï¼‰å¿…é¡» `return` `Astro.redirect()` çš„ç»“æœï¼Œä»¥ä¾¿é‡å®šå‘å‘ç”Ÿã€‚

```astro title="src/pages/account.astro" {8}
---
import { isLoggedIn } from '../utils';

const cookie = Astro.request.headers.get('cookie');

// å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™å°†å…¶é‡å®šå‘åˆ°ç™»å½•é¡µé¢
if (!isLoggedIn(cookie)) {
  return Astro.redirect('/login');
}
---
```

### `Astro.canonicalURL`

:::caution[åºŸå¼ƒ]
ä½¿ç”¨ [`Astro.url`](#astrourl) æ¥æ„å»ºä½ è‡ªå·±çš„æ ‡å‡†é“¾æ¥ã€‚
:::

å½“å‰é¡µé¢çš„[æ ‡å‡†é“¾æ¥][canonical]ã€‚

### `Astro.url`

<Since v="1.0.0-rc" />

[URL](https://developer.mozilla.org/zh-CN/docs/Web/API/URL )å¯¹è±¡ï¼Œç”±å½“å‰ `Astro.request.url` çš„é“¾æ¥å­—ç¬¦ä¸²å€¼æ„æˆã€‚å¯¹äºä¸è¯·æ±‚çš„é“¾æ¥çš„ä¸ªåˆ«å±æ€§è¿›è¡Œäº¤äº’æ˜¯æœ‰ç”¨çš„ï¼Œå¦‚è·¯å¾„åå’Œèµ·æºã€‚

ç›¸å½“äºåš `new URL(Astro.request.url)`ã€‚

```astro
<h1>å½“å‰é“¾æ¥æ˜¯ï¼š{Astro.url}</h1>
<h1>å½“å‰é“¾æ¥è·¯å¾„åæ˜¯ï¼š{Astro.url.pathname}</h1>
<h1>å½“å‰é“¾æ¥æºæ˜¯ï¼š{Astro.url.origin}</h1>
```

ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ `Astro.url` æ¥åˆ›å»ºæ–°çš„é“¾æ¥ï¼Œå¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ ç»™ [`new URL()`](https://developer.mozilla.org/zh-CN/docs/Web/API/URL/URL)ã€‚

```astro
---
// ç¤ºä¾‹ï¼šä½¿ç”¨ä½ çš„ç”Ÿäº§åŸŸåæ„å»ºä¸€ä¸ªè§„èŒƒçš„URL
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// ç¤ºä¾‹ï¼šä½¿ç”¨ä½ ç›®å‰çš„åŸŸåæ„å»ºä¸€ä¸ªç”¨äº SEO meta æ ‡ç­¾çš„URL
const socialImageURL = new URL('/images/preview.png', Astro.url);
---
<link rel="canonical" href={canonicalURL} />
<meta property="og:image" content={socialImageURL} />
```

### `Astro.clientAddress`

<Since v="1.0.0-rc" />

æŒ‡å®šè¯·æ±‚çš„ [IP åœ°å€](https://en.wikipedia.org/wiki/IP_address)ã€‚è¿™ä¸ªå±æ€§åªåœ¨ä¸º SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰æ„å»ºæ—¶å¯ç”¨ï¼Œä¸åº”è¯¥ç”¨äºé™æ€ç½‘ç«™ã€‚

```astro
---
const ip = Astro.clientAddress;
---

<div>ä½ çš„ IP åœ°å€æ˜¯ï¼š<span class="address">{ ip }</span></div>
```

### `Astro.site`

`Astro.site` è¿”å›æ ¹æ® Astro é…ç½®ä¸­çš„ `site` ç”Ÿæˆçš„ `URL`ã€‚å¦‚æœæœªå®šä¹‰ Astro é…ç½®ä¸­çš„ `site`ï¼Œ`Astro.site` ä¹Ÿä¸ä¼šè¢«å®šä¹‰ã€‚

### `Astro.generator`

<Since v="1.0.0" />

`Astro.generator` æ˜¯ä¸ªä¾¿æ·æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ·»åŠ ä¸ä½ å½“å‰ Astro ç‰ˆæœ¬ä¸€è‡´çš„ [`<meta name="generator">`](https://html.spec.whatwg.org/multipage/semantics.html#meta-generator) æ ‡ç­¾ã€‚å®ƒéµå¾ªçš„æ ¼å¼æ˜¯ `"Astro v1.x.x"`ã€‚

```astro mark="Astro.generator"
<html>
  <head>
    <meta name="generator" content={Astro.generator} />
  </head>
  <body>
    <footer>
      <p>ç”± <a href="https://astro.build">{Astro.generator}</a> æ„å»º</p>
    </footer>
  </body>
</html>
```

### `Astro.slots`

`Astro.slots` åŒ…å«ä¿®æ”¹ Astro ç»„ä»¶æ’æ§½çš„å·¥å…·å‡½æ•°ã€‚

#### `Astro.slots.has()`

**ç±»å‹ï¼š**`(slotName: string) => boolean`

ä½ å¯ä»¥ä½¿ç”¨ `Astro.slots.has()` æ£€æŸ¥ç‰¹å®šæ’æ§½åç§°çš„å†…å®¹æ˜¯å¦å­˜åœ¨ã€‚å½“ä½ æƒ³è¦åŒ…è£…æ’æ§½å†…å®¹ï¼Œä½†åªæƒ³åœ¨ä½¿ç”¨æ’æ§½æ—¶å‘ˆç°åŒ…è£…å™¨å…ƒç´ æ—¶ï¼Œè¿™ä¼šå¾ˆæœ‰ç”¨ã€‚

```astro
---
---
<slot />

{Astro.slots.has('more') && (
  <aside>
    <h2>More</h2>
    <slot name="more" />
  </aside>
)}
```

#### `Astro.slots.render()`

**ç±»å‹ï¼š**`(slotName: string, args?: any[]) => Promise<string>`

ä½ å¯ä»¥ä½¿ç”¨ `Astro.slots.render()` å°†æ’æ§½çš„å†…å®¹å¼‚æ­¥æ¸²æŸ“ä¸º HTML å­—ç¬¦ä¸²ã€‚

```astro
---
const html = await Astro.slots.render('default');
---
<Fragment set:html={html} />
```

:::note
è¿™æ˜¯é’ˆå¯¹é«˜çº§ç”¨ä¾‹çš„ï¼åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨ [`<slot />` å…ƒç´ ](/zh-cn/core-concepts/astro-components/#æ’æ§½)å‘ˆç°æ’æ§½å†…å®¹ä¼šæ›´ç®€å•ã€‚
:::

`Astro.slots.render()` è¿˜å¯ä»¥æ¥å—ç¬¬äºŒä¸ªå‚æ•°ï¼šä¸€ä¸ªå‚æ•°æ•°ç»„ï¼Œè¯¥å‚æ•°æ•°ç»„å°†è¢«è½¬å‘ç»™ä»»ä½•å‡½æ•°å­ç»„ä»¶ã€‚è¿™å¯¹äºè‡ªå®šä¹‰å®ç”¨ç¨‹åºç»„ä»¶å¾ˆæœ‰ç”¨ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œè¿™ä¸ª `<Shout />` ç»„ä»¶å°†å®ƒçš„ `message` å±æ€§è½¬æ¢ä¸ºå¤§å†™ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™é»˜è®¤æ’æ§½ï¼š

```astro title="src/components/Shout.astro" "await Astro.slots.render('default', [message])"
---
const message = Astro.props.message.toUpperCase();
let html = '';
if (Astro.slots.has('default')) {
  html = await Astro.slots.render('default', [message]);
}
---
<Fragment set:html={html} />
```

ä½œä¸º `<Shout />` çš„å­çº§ä¼ é€’çš„å›è°ƒå‡½æ•°å°†ä¼šæ¥æ”¶åˆ°å¤§å†™çš„ `message` å‚æ•°ï¼š

```astro title="src/pages/index.astro"
---
import Shout from "../components/Shout.astro";
---
<Shout message="slots!">
  {(message) => <div>{message}</div>}
</Shout>

<!-- æ¸²æŸ“æˆ <div>SLOTS!</div> -->
```

### `Astro.self`

`Astro.self` å…è®¸ Astro ç»„ä»¶è¢«é€’å½’è°ƒç”¨ã€‚è¿™ä½¿å¾—ä½ å¯ä»¥é€šè¿‡åœ¨ç»„ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨ `<Astro.self>` ä»è‡ªèº«å†…éƒ¨æ¸²æŸ“ Astro ç»„ä»¶ã€‚è¿™å¯¹éå†å¤§å‹æ•°æ®å­˜å‚¨å’ŒåµŒå¥—æ•°æ®ç»“æ„å¾ˆæœ‰å¸®åŠ©ã€‚

```astro
---
// NestedList.astro
const { items } = Astro.props;
---
<ul class="nested-list">
  {items.map((item) => (
    <li>
      <!-- å¦‚æœæœ‰åµŒå¥—çš„æ•°æ®ç»“æ„ï¼Œå°†æ¸²æŸ“ `<Astro.self>` -->
      <!-- å¹¶å¯ä»¥é€šè¿‡é€’å½’è°ƒç”¨æ¥ä¼ é€’å‚æ•° -->
      {Array.isArray(item) ? (
        <Astro.self items={item} />
      ) : (
        item
      )}
    </li>
  ))}
</ul>
```

ç„¶åï¼Œè¿™ä¸ªç»„ä»¶å¯ä»¥è¿™æ ·ç”¨ï¼š

```astro
---
import NestedList from './NestedList.astro';
---
<NestedList items={['A', ['B', 'C'], 'D']} />
```

ä¹‹åå°†ä¼šæ¸²æŸ“è¿™æ ·çš„ HTMLï¼š

```html
<ul class="nested-list">
  <li>A</li>
  <li>
    <ul class="nested-list">
      <li>B</li>
      <li>C</li>
    </ul>
  </li>
  <li>D</li>
</ul>
```

### `Astro.locals`

`Astro.locals` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«æ¥è‡ªä¸­é—´ä»¶çš„ [`context.locals`](#contextlocals)å¯¹è±¡çš„ä»»ä½•å€¼ã€‚ä½¿ç”¨è¯¥å¯¹è±¡å¯è®¿é—®ä¸­é—´ä»¶åœ¨æ‚¨çš„ `.astro` æ–‡ä»¶ä¸­è¿”å›çš„æ•°æ®ã€‚

```astro title="src/pages/Orders.astro"
---
const title = Astro.locals.welcomeTitle();
const orders = Array.from(Astro.locals.orders.entries());
---
<h1>{title}</h1>
<ul>
    {orders.map(order => {
        return <li>{ /* æ¯å•éƒ½æœ‰æ”¶è· */ }</li>
    })}
</ul>
```

## ç«¯ç‚¹ä¸Šä¸‹æ–‡

[ç«¯ç‚¹å‡½æ•°](/zh-cn/core-concepts/endpoints/)æ¥æ”¶ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ã€‚å®ƒä¸è®¸å¤š `Astro` å…¨å±€å±æ€§ç›¸ä¼¼ã€‚

```ts title="endpoint.json.ts"
import type { APIContext } from 'astro';

export function GET(context: APIContext) {
  // ...
}
```

### `context.params`

`context.params` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸æ­¤è¯·æ±‚åŒ¹é…çš„åŠ¨æ€è·¯ç”±æ®µçš„å€¼ã€‚

åœ¨é™æ€æ„å»ºä¸­ï¼Œè¿™å°†æ˜¯ç”¨äºé¢„æ¸²æŸ“[åŠ¨æ€è·¯ç”±](/zh-cn/core-concepts/routing/#åŠ¨æ€è·¯ç”±)çš„ `getStaticPaths()` è¿”å›çš„ `params`ã€‚

åœ¨ SSR æ„å»ºä¸­ï¼Œè¿™å¯ä»¥æ˜¯ä¸åŠ¨æ€è·¯ç”±æ¨¡å¼ä¸­çš„è·¯å¾„æ®µåŒ¹é…çš„ä»»ä½•å€¼ã€‚


```ts title="src/pages/posts/[id].json.ts"
import type { APIContext } from 'astro';

export function getStaticPaths() {
  return [
    { params: { id: '1' } },
    { params: { id: '2' } },
    { params: { id: '3' } }
  ];
}

export function GET({ params }: APIContext) {
	return {
		body: JSON.stringify({ id: params.id })
	};
}
```

å¦è§ï¼š[`params`](#params)

### `context.props`

`context.props` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä» `getStaticPaths()` ä¼ é€’çš„ä»»ä½• `props`ã€‚ç”±äºåœ¨ä¸º SSR æ„å»ºæ—¶ä¸ä½¿ç”¨ `getStaticPaths()`ï¼Œå› æ­¤ `context.props` ä»…åœ¨é™æ€æ„å»ºä¸­å¯ç”¨ã€‚

```ts title="src/pages/posts/[id].json.ts"
import type { APIContext } from 'astro';

export function getStaticPaths() {
  return [
    { params: { id: '1' }, props: { author: 'Blu' } },
    { params: { id: '2' }, props: { author: 'Erika' } },
    { params: { id: '3' }, props: { author: 'Matthew' } }
  ];
}

export function GET({ props }: APIContext) {
	return {
		body: JSON.stringify({ author: props.author }),
	};
}
```

å¦è§ï¼š[é€šè¿‡`props`ä¼ é€’æ•°æ®](#é€šè¿‡-props-ä¼ é€’æ•°æ®)

### `context.request`

ä¸€ä¸ªæ ‡å‡†çš„ [Request](https://developer.mozilla.org/zh-CN/docs/Web/API/Request) å¯¹è±¡ã€‚å®ƒå¯ä»¥ç”¨æ¥è·å–è¯·æ±‚çš„ `url`ã€`headers`ã€`method` ç”šè‡³æ˜¯ `body`ã€‚

```ts
import type { APIContext } from 'astro';

export function GET({ request }: APIContext) {
  return {
    body: `Hello ${request.url}`
  }
}
```

å¦è§ï¼š[Astro.request](#astrorequest)

### `context.cookies`

`context.cookies` åŒ…å«ç”¨äºè¯»å–å’Œæ“ä½œ cookie çš„å·¥å…·ã€‚

å¦è§ï¼š[Astro.cookies](#astrocookies)

### `context.url`

`context.url` æ˜¯ä¸€ä¸ª [URL](https://developer.mozilla.org/zh-CN/docs/Web/API/URL) å¯¹è±¡ï¼Œå®ƒæ˜¯ä»å½“å‰ `context.request.url` URL å­—ç¬¦ä¸²å€¼æ„é€ çš„ã€‚

å¦è§ï¼š[Astro.url](#astrourl)

### `context.clientAddress`

æŒ‡å®šè¯·æ±‚çš„ [IP åœ°å€](https://en.wikipedia.org/wiki/IP_address)ã€‚æ­¤å±æ€§ä»…åœ¨æ„å»º SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰æ—¶å¯ç”¨ï¼Œä¸åº”ç”¨äºé™æ€ç«™ç‚¹ã€‚

```ts
import type { APIContext } from 'astro';

export function GET({ clientAddress }: APIContext) {
  return {
    body: `Your IP address is: ${clientAddress}`
  }
}
```

å¦è§ï¼š[Astro.clientAddress](#astroclientaddress)


### `context.site`

`context.site` è¿”å›ä¸€ä¸ªç”± Astro é…ç½®ä¸­çš„ `site` ç”Ÿæˆçš„ `URL`ã€‚å¦‚æœæœªå®šä¹‰ï¼Œåˆ™å°†è¿”å›ä» `localhost` ç”Ÿæˆçš„ URLã€‚

å¦è§ï¼š[Astro.site](#astrosite)

### `context.generator`

`context.generator` æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•ï¼Œç”¨äºæŒ‡ç¤ºé¡¹ç›®æ­£åœ¨è¿è¡Œçš„ Astro ç‰ˆæœ¬ã€‚å®ƒéµå¾ª `"Astro v1.x.x"` çš„æ ¼å¼ã€‚


```ts title="src/pages/site-info.json.ts"
import type { APIContext } from 'astro';

export function GET({ generator, site }: APIContext) {
  const body = JSON.stringify({ generator, site });
  return new Response(body);
}
```

å¦è§ï¼š[Astro.generator](#astrogenerator)

### `context.redirect()`

`context.redirect()` è¿”å›ä¸€ä¸ª [Response](https://developer.mozilla.org/zh-CN/docs/Web/API/Response) å¯¹è±¡ï¼Œå…è®¸ä½ é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ã€‚æ­¤å‡½æ•°ä»…åœ¨æ„å»º SSRï¼ˆæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼‰æ—¶å¯ç”¨ï¼Œä¸åº”ç”¨äºé™æ€ç«™ç‚¹ã€‚

```ts
import type { APIContext } from 'astro';

export function GET({ redirect }: APIContext) {
  return redirect('/login', 302);
}
```

å¦è§ï¼š[`Astro.redirect()`](#astroredirect)

### `context.locals`

`context.locals` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºåœ¨è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸå†…å­˜å‚¨å’Œè®¿é—®ä»»æ„ä¿¡æ¯ã€‚

ä¸­é—´ä»¶å‡½æ•°å¯ä»¥è¯»å†™`context.locals`çš„å€¼ï¼š

```ts title="src/middleware.ts"
import type { MiddlewareResponseHandler } from 'astro';

export const onRequest: MiddlewareResponseHandler = ({ locals }, next) => {
  if (!locals.title) {
    locals.title = "Default Title";
  }
  return next();
}
```

API ç«¯ç‚¹åªèƒ½ä» `context.locals`ä¸­è¯»å–ä¿¡æ¯ï¼š

```ts title="src/pages/hello.ts"
import type { APIContext } from 'astro';

export function get({ locals }: APIContext) {
  return {
    body: locals.title // "é»˜è®¤æ ‡é¢˜"
  }
}
```

å¦è§ï¼š[`Astro.locals`](#astrolocals)

## `getStaticPaths()`

å¦‚æœé¡µé¢åœ¨æ–‡ä»¶åä¸­ä½¿ç”¨åŠ¨æ€å‚æ•°ï¼Œè¯¥ç»„ä»¶å°†éœ€è¦å¯¼å‡ºä¸€ä¸ª `getStaticPaths()` å‡½æ•°ã€‚

å¿…é¡»è¦æœ‰è¯¥å‡½æ•°ï¼Œå› ä¸º Astro æ˜¯é™æ€ç«™ç‚¹ç”Ÿæˆå™¨ã€‚è¿™æ„å‘³ç€æ•´ä¸ªç½‘ç«™æ˜¯é¢„æ„å»ºçš„ã€‚å¦‚æœ Astro ä¸çŸ¥é“åœ¨æ„å»ºæ—¶ç”Ÿæˆä»€ä¹ˆé¡µé¢ï¼Œä½ çš„ç”¨æˆ·åœ¨è®¿é—®ä½ çš„ç½‘ç«™æ—¶å°±çœ‹ä¸åˆ°å®ƒã€‚

```astro
---
export async function getStaticPaths() {
  return [
    { params: { /* å¿…éœ€ */ }, props: { /* å¯é€‰ */ } },
    { params: { ... } },
    { params: { ... } },
    // ...
  ];
}
---
<!-- ä½ çš„ HTML æ¨¡æ¿åœ¨è¿™é‡Œ -->
```

`getStaticPaths()` å‡½æ•°åº”è¯¥è¿”å›å¯¹è±¡æ•°ç»„ï¼Œä»¥ç¡®å®šå“ªäº›è·¯å¾„ä¼šè¢« Astro é¢„æ¸²æŸ“ã€‚

:::caution
`getStaticPaths()` å‡½æ•°åœ¨ä¼šä»»ä½•é¡µé¢åŠ è½½ä¹‹å‰ï¼Œåœ¨å®ƒè‡ªå·±çš„éš”ç¦»èŒƒå›´å†…æ‰§è¡Œä¸€æ¬¡ã€‚å› æ­¤ï¼Œé™¤äº†æ–‡ä»¶å¯¼å…¥ä¹‹å¤–ï¼Œä½ ä¸èƒ½ä»å®ƒçš„çˆ¶ä½œç”¨åŸŸä¸­å¼•ç”¨ä»»ä½•ä¸œè¥¿ã€‚å¦‚æœä½ è¿åäº†è¿™ä¸ªè¦æ±‚ï¼Œç¼–è¯‘å™¨ä¼šå‘å‡ºè­¦å‘Šã€‚
:::

### `params`

æ¯ä¸ªè¿”å›å¯¹è±¡çš„ `params` é”®éƒ½ä¼šå‘Šè¯‰ Astro è¦æ„å»ºä»€ä¹ˆè·¯ç”±ã€‚è¿”å›å‚æ•°å¿…é¡»æ˜ å°„åˆ°ä½ çš„ç»„ä»¶æ–‡ä»¶è·¯å¾„ä¸­å®šä¹‰çš„åŠ¨æ€å‚æ•°å’Œå…¶ä½™å‚æ•°ã€‚

`params` è¢«ç¼–ç åˆ°é“¾æ¥ä¸­ï¼Œæ‰€ä»¥åªèƒ½ç”±å­—ç¬¦ä¸²ä½œä¸ºå€¼ã€‚æ¯ä¸ª `params` å¯¹è±¡çš„å€¼å¿…é¡»ä¸é¡µé¢åç§°ä¸­ä½¿ç”¨çš„å‚æ•°ä¸€è‡´ã€‚

æ¯”å¦‚è¯´æœ‰ `src/pages/posts/[id].astro` é¡µé¢ã€‚å¦‚æœä½ ä»è¿™ä¸ªé¡µé¢å¯¼å‡º `getStaticPaths` å¹¶è¿”å›ä»¥ä¸‹çš„è·¯ç”±ï¼š

```astro
---
export async function getStaticPaths() {
  return [
    { params: { id: '1' } },
    { params: { id: '2' } },
    { params: { id: '3'  } }
  ];
}

const { id } = Astro.params;
---
<h1>{id}</h1>
```

ç„¶å Astro ä¼šåœ¨æ„å»ºæ—¶é™æ€åœ°ç”Ÿæˆ `posts/1`ã€`posts/2` å’Œ `posts/3`ã€‚

### é€šè¿‡ `props` ä¼ é€’æ•°æ®

ä¸ºäº†ç»™æ¯ä¸ªç”Ÿæˆçš„é¡µé¢ä¼ é€’é¢å¤–çš„æ•°æ®ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªè¿”å›çš„è·¯å¾„å¯¹è±¡ä¸Šè®¾ç½® `props` å€¼ã€‚ä¸ `params` ä¸åŒçš„æ˜¯ï¼Œ`props` æ²¡æœ‰è¢«ç¼–ç åˆ°é“¾æ¥ä¸­ï¼Œæ‰€ä»¥å¹¶ä¸å±€é™äºå­—ç¬¦ä¸²ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä½ æ ¹æ®ä»è¿œç¨‹ API è·å–çš„æ•°æ®æ¥ç”Ÿæˆé¡µé¢ã€‚ä½ å¯ä»¥å°†å®Œæ•´çš„æ•°æ®å¯¹è±¡ä¼ é€’ç»™ `getStaticPaths` ä¸­çš„é¡µé¢ç»„ä»¶ã€‚

```astro
---
export async function getStaticPaths() {
  const data = await fetch('...').then(response => response.json());

  return data.map((post) => {
    return {
      params: { id: post.id },
      props: { post },
    };
  });
}

const { id } = Astro.params;
const { post } = Astro.props;
---
<h1>{id}: {post.name}</h1>
```

ä½ ä¹Ÿå¯ä»¥ä¼ é€’æ™®é€šæ•°ç»„ï¼Œè¿™åœ¨ç”Ÿæˆæˆ–ç¼“å­˜å·²çŸ¥è·¯å¾„åˆ—è¡¨æ—¶å¯èƒ½ä¼šæœ‰å¸®åŠ©ã€‚

```astro
---
export async function getStaticPaths() {
  const posts = [
    {id: '1', category: "astro", title: "API Reference"},
    {id: '2', category: "react", title: "Creating a React Counter!"}
  ];
  return posts.map((post) => {
    return {
      params: { id: post.id },
      props: { post }
    };
  });
}
const {id} = Astro.params;
const {post} = Astro.props;
---
<body>
  <h1>{id}: {post.title}</h1>
  <h2>Category: {post.category}</h2>
</body>
```

ç„¶å Astro å°†åœ¨æ„å»ºæ—¶ä½¿ç”¨ `pages/posts/[id].astro` ä¸­çš„é¡µé¢ç»„ä»¶é™æ€åœ°ç”Ÿæˆ `posts/1` å’Œ `posts/2`ã€‚é¡µé¢å¯ä»¥ä½¿ç”¨ `Astro.props` å¼•ç”¨è¿™äº›æ•°æ®ã€‚

### `paginate()`

åˆ†é¡µæ˜¯ Astro é€šè¿‡ `paginate()` å‡½æ•°åŸç”Ÿæ”¯æŒç½‘ç«™çš„å¸¸è§ç”¨ä¾‹ã€‚`paginate()` å°†è‡ªåŠ¨ç”Ÿæˆæ•°ç»„ï¼Œä»`getStaticPaths()`è¿”å›ï¼Œä¸ºåˆ†é¡µé›†åˆçš„æ¯ä¸ªé¡µé¢åˆ›å»ºä¸€ä¸ª URLã€‚é¡µé¢ç¼–å·å°†ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œé¡µé¢æ•°æ®å°†ä½œä¸º`page`é“å…·ä¼ é€’ã€‚

```js
export async function getStaticPaths({ paginate }) {
  // ç”¨ fetch()ã€Astro.glob() ç­‰åŠ è½½ä½ çš„æ•°æ®
  const response = await fetch(`https://pokeapi.co/api/v2/pokemon?limit=150`);
  const result = await response.json();
  const allPokemon = result.results;

  // è¿”å›åŒ…å«åˆ†é¡µçš„æ‰€æœ‰å¸–å­çš„è·¯ç”±é›†åˆ
  return paginate(allPokemon, { pageSize: 10 });
}

// å¦‚æœè®¾ç½®æ­£ç¡®ï¼Œç°åœ¨é¡µé¢å·²ç»å…·å¤‡äº†æ¸²æŸ“å•é¡µæ‰€éœ€çš„ä¸€åˆ‡å‚æ•°ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚
const { page } = Astro.props;
```

`paginate()`ï¼šå‡å®šæ–‡ä»¶åä¸º `[page].astro` æˆ– `[...page].astro`ã€‚`page` å‚æ•°å°†æ˜¯é“¾æ¥ä¸­çš„é¡µæ•°ã€‚

- `/posts/[page].astro`ï¼šä¼šäº§ç”Ÿ `/posts/1`ã€`/posts/2`ã€`/posts/3` ç­‰é“¾æ¥ã€‚
- `/posts/[...page].astro`ï¼šå°†äº§ç”Ÿ `/posts`ã€`/posts/2`
`/posts/3` ç­‰é“¾æ¥ã€‚

`paginate()` å‡½æ•°å…·æœ‰ä»¥ä¸‹å‚æ•°ï¼š
-  `pageSize` - æ¯é¡µæ˜¾ç¤ºçš„é¡¹ç›®æ•°
-  `params` - ç”¨äºåˆ›å»ºåŠ¨æ€è·¯ç”±çš„é™„åŠ å‚æ•°
-  `props` - åœ¨æ¯ä¸ªé¡µé¢ä¸Šå¯ç”¨çš„é™„åŠ å±æ€§

#### `page` åˆ†é¡µå‚æ•°

åˆ†é¡µä¼šç»™æ¯ä¸ªæ¸²æŸ“çš„é¡µé¢ä¼ é€’ `page` å‚æ•°ï¼Œä»£è¡¨åˆ†é¡µé›†åˆä¸­çš„å•é¡µæ•°æ®ã€‚è¿™åŒ…æ‹¬ä½ åˆ†é¡µçš„æ•°æ®ï¼ˆ`page.data`ï¼‰ä»¥åŠè¯¥é¡µçš„å…ƒæ•°æ®ï¼ˆ`page.url`ã€`page.start`ã€`page.end`ã€`page.total` ç­‰ï¼‰ã€‚è¿™äº›å…ƒæ•°æ®å¯¹è¯¸å¦‚â€œä¸‹ä¸€é¡µâ€æŒ‰é’®æˆ–â€œæ˜¾ç¤º 100 ä¸ªä¸­å‰åä¸ªâ€çš„ä¿¡æ¯å¾ˆæœ‰ç”¨ã€‚

| å&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç§°               |         ç±»å‹          | æè¿°                                                                                                         |
| :----------------- | :-------------------: | :----------------------------------------------------------------------------------------------------------- |
| `page.data`        |        `Array`        | ä» `data()` ä¸­è¿”å›å½“å‰é¡µé¢æ•°æ®æ•°ç»„                                                                           |
| `page.start`       |       `number`        | å½“å‰é¡µç¬¬ä¸€ä¸ªé¡¹ç›®çš„ç´¢å¼•ï¼Œä» `0` å¼€å§‹ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœ `pageSize: 25`ï¼Œç¬¬ä¸€é¡µè¯¥å€¼æœª `0`ï¼Œç¬¬äºŒé¡µä¸º`25`ï¼Œä»¥æ­¤ç±»æ¨ï¼‰ã€‚ |
| `page.end`         |       `number`        | å½“å‰é¡µé¢æœ€åä¸€ä¸ªé¡¹ç›®çš„ç´¢å¼•                                                                               |
| `page.size`        |       `number`        | æ¯ä¸ªé¡µé¢æœ‰å¤šå°‘é¡¹ç›®                                                                                        |
| `page.total`       |       `number`        | æ‰€æœ‰é¡¹ç›®çš„æ€»æ•°é‡                                                                                    |
| `page.currentPage` |       `number`        | å½“å‰é¡µç ï¼Œä» `1` å¼€å§‹                                                                                        |
| `page.lastPage`    |       `number`        | æ€»é¡µæ•°                                                                                   |
| `page.url.current` |       `string`        | è·å–å½“å‰é¡µé¢çš„é“¾æ¥ï¼ˆå¯¹è§„èŒƒé“¾æ¥å¾ˆæœ‰ç”¨ï¼‰ã€‚                                                  |
| `page.url.prev`    | `string \| undefined` | è·å–ä¸Šä¸€é¡µé“¾æ¥ï¼ˆå¦‚æœåœ¨é¦–é¡µï¼Œå°†æ˜¯`undefined`ï¼‰ã€‚                                         |
| `page.url.next`    | `string \| undefined` | è·å–ä¸‹ä¸€é¡µé“¾æ¥ï¼ˆå¦‚æœæ²¡æœ‰æ›´å¤šçš„é¡µé¢ï¼Œå°†æ˜¯`undefined`ï¼‰                                         |

## `import.meta`

æ‰€æœ‰ ESM æ¨¡å—éƒ½åŒ…å« `import.meta` å±æ€§ã€‚Astro åŸºäº [Vite](https://cn.vitejs.dev/guide/env-and-mode.html) å¢åŠ äº† `import.meta.env`ã€‚

**`import.meta.env.SSR`** å¯ä»¥ç”¨æ¥äº†è§£æœåŠ¡å™¨ä¸Šæ¸²æŸ“æ—¶é•¿ã€‚æœ‰æ—¶ä½ å¯èƒ½æƒ³è¦ä¸åŒçš„é€»è¾‘ï¼Œä¾‹å¦‚ï¼ŒæŸä¸ªç»„ä»¶åº”è¯¥åªåœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼š

```jsx
export default function () {
  return import.meta.env.SSR ? <div class="spinner"></div> : <FancyComponent />;
}
```

## å›¾åƒï¼ˆ`astro:assets`ï¼‰

### getImage()

:::caution
`getImage()` ä¾èµ–äºä»…åœ¨æœåŠ¡å™¨ä¸Šå¯ç”¨çš„ APIï¼Œå½“åœ¨å®¢æˆ·ç«¯ä½¿ç”¨æ—¶ä¼šå¯¼è‡´æ„å»ºå¤±è´¥ã€‚
:::

`getImage()`å‡½æ•°æ—¨åœ¨ç”Ÿæˆç”¨äºåœ¨ HTML ä¹‹å¤–çš„å…¶ä»–åœ°æ–¹æ‰€ä½¿ç”¨çš„å›¾åƒï¼Œä¾‹å¦‚åœ¨ [API è·¯ç”±](/zh-cn/core-concepts/endpoints/#æœåŠ¡å™¨ç«¯ç‚¹api-è·¯ç”±) ä¸­ã€‚å®ƒè¿˜å…è®¸ä½ åˆ›å»ºè‡ªå®šä¹‰çš„ `<Image />` ç»„ä»¶ã€‚

`getImage()` å‡½æ•°æ¥å—ä¸€ä¸ªé€‰é¡¹å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«ä¸ [Image ç»„ä»¶ç›¸åŒçš„å±æ€§](#å±æ€§)ï¼ˆé™¤äº† `alt`ï¼‰ã€‚

```astro
---
import { getImage } from "astro:assets";
import myBackground from "../background.png"
const optimizedBackground = await getImage({src: myBackground, format: 'avif'})
---
<div style={`background-image: url(${optimizedBackground.src});`}></div>
```

å®ƒè¿”å›äº†ä¸€ä¸ªåŒ…å«äº†å¦‚ä¸‹å±æ€§çš„å¯¹è±¡ï¼š

```js
{
  options: {...} // è¢«ä¼ é€’çš„åŸå§‹å‚æ•°
  src: "https//..." // ç”Ÿæˆå›¾ç‰‡çš„è·¯å¾„
  attributes: {...} // é¢å¤–çš„ HTML å±æ€§ï¼Œç”¨äºæ¸²æŸ“å›¾åƒï¼ˆå¦‚å®½åº¦ã€é«˜åº¦ã€æ ·å¼ç­‰ï¼‰
}
```

## å†…å®¹é›†åˆï¼ˆ`astro:content`ï¼‰

<p>
  <Since v="2.0.0" />
</p>

å†…å®¹é›†åˆæä¾›äº† API æ¥é…ç½®å’ŒæŸ¥è¯¢ `src/content/` ä¸­çš„ Markdown æˆ– MDX æ–‡æ¡£ã€‚æœ‰å…³åŠŸèƒ½å’Œç”¨æ³•ç¤ºä¾‹ï¼Œè¯·å‚è€ƒ[å†…å®¹é›†åˆæŒ‡å—](/zh-cn/guides/content-collections/)ã€‚

### `defineCollection()`

`defineCollection()` æ˜¯ä¸€ä¸ªç”¨äºåœ¨ `src/content/config.*` æ–‡ä»¶ä¸­é…ç½®é›†åˆçš„å·¥å…·å‡½æ•°ã€‚

```ts
// src/content/config.ts
import { z, defineCollection } from 'astro:content';
const blog = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    permalink: z.string().optional(),
  }),
});

// å°†å®šä¹‰çš„é›†åˆå…¬å¼€ç»™ Astro
// é€šè¿‡ `collections` å¯¼å‡º
export const collections = { blog };
```

è¿™ä¸ªå‡½æ•°æ¥å—ä»¥ä¸‹å±æ€§ï¼š
#### `type`

<Since v="2.5" />


**ç±»å‹ï¼š** `'content' | 'data'`  
**é»˜è®¤ï¼š** `'content'`

`type` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç”¨äºå®šä¹‰å­˜å‚¨åœ¨é›†åˆä¸­çš„æ¡ç›®çš„ç±»å‹ï¼š

- `'content'` - ç”¨äºå†…å®¹åˆ›ä½œæ ¼å¼ï¼Œå¦‚ Markdown (`.md`)ã€MDX (`.mdx`) æˆ– Markdoc (`.mdoc`)
- `'data'` - ç”¨äº JSON (`.json`) æˆ– YAML (`.yaml`) ç­‰çº¯æ•°æ®æ ¼å¼

:::tip
è¿™æ„å‘³ç€é›†åˆ**ä¸èƒ½**å­˜å‚¨å†…å®¹å’Œæ•°æ®æ ¼å¼çš„æ··åˆã€‚æ‚¨å¿…é¡»æŒ‰ç±»å‹å°†è¿™äº›æ¡ç›®åˆ†å‰²æˆå•ç‹¬çš„é›†åˆã€‚
:::

#### `schema`

**ç±»å‹ï¼š**`TSchema extends ZodType`

`schema` æ˜¯ä¸€ä¸ªå¯é€‰çš„ Zod å¯¹è±¡ï¼Œç”¨äºé…ç½®é›†åˆçš„æ–‡æ¡£ frontmatter çš„ç±»å‹å’Œå½¢çŠ¶ã€‚æ¯ä¸ªå€¼å¿…é¡»ä½¿ç”¨ [Zod éªŒè¯å™¨](https://github.com/colinhacks/zod)

æœ‰å…³ç¤ºä¾‹è¯·[å‚è€ƒ `å†…å®¹é›†åˆ`æŒ‡å—](/zh-cn/guides/content-collections/#å®šä¹‰é›†åˆæ¨¡å¼) 

### `reference()`

**Typeï¼š** `(collection: string) => ZodEffects<ZodString, { collection, id: string } | { collection, slug: string }>`

åœ¨å†…å®¹é…ç½®ä¸­ä½¿ç”¨ `reference()` å‡½æ•°æ¥å®šä¹‰ä»ä¸€ä¸ªé›†åˆåˆ°å¦ä¸€ä¸ªé›†åˆçš„å…³ç³»æˆ– "å¼•ç”¨"ã€‚è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªé›†åˆåç§°ï¼Œå¹¶éªŒè¯å†…å®¹å‰ç½®äº‹é¡¹æˆ–æ•°æ®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ¡ç›®æ ‡è¯†ç¬¦ã€‚

æ­¤ç¤ºä¾‹å®šä¹‰äº†ä»åšå®¢ä½œè€…åˆ° "ä½œè€… "é›†åˆçš„å¼•ç”¨ï¼Œä»¥åŠåˆ°åŒä¸€ "åšå®¢ "é›†åˆçš„ç›¸å…³æ–‡ç« æ•°ç»„çš„å¼•ç”¨ï¼š

```ts
import { defineCollection, reference, z } from 'astro:content';

const blog = defineCollection({
  type: 'content',
  schema: z.object({
    // é€šè¿‡ "id "ä» "ä½œè€… "é›†åˆä¸­å¼•ç”¨å•ä¸ªä½œè€…
    author: reference('authors'),
    // æŒ‰ "slug "ä» "blog "é›†åˆä¸­å¼•ç”¨ç›¸å…³å¸–å­æ•°ç»„
    relatedPosts: z.array(reference('blog')),
  })
});

const authors = defineCollection({
  type: 'data',
  schema: z.object({ /* ... */ })
});

export const collections = { blog, authors };
```

æœ‰å…³ç¤ºä¾‹è¯·[å‚è€ƒ `å†…å®¹é›†åˆ`æŒ‡å—](/zh-cn/guides/content-collections/#å®šä¹‰é›†åˆå¼•ç”¨).

### `getCollection()`

**ç±»å‹ï¼š**`(collection: string, filter?: (entry: CollectionEntry<collection>) => boolean) => CollectionEntry<collection>[]`

`getCollection()` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºé€šè¿‡é›†åˆåç§°æ£€ç´¢å†…å®¹é›†åˆæ¡ç›®åˆ—è¡¨ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¿”å›é›†åˆä¸­çš„æ‰€æœ‰é¡¹ç›®ï¼Œå¹¶æ¥å—å¯é€‰çš„ `filter` å‡½æ•°æ¥ç¼©å°æ¡ç›®å±æ€§ã€‚è¿™å…è®¸æ‚¨æ ¹æ® `id`ã€`slug` æˆ– frontmatter å€¼ï¼ˆé€šè¿‡ `data` å¯¹è±¡ï¼‰æŸ¥è¯¢é›†åˆä¸­çš„æŸäº›é¡¹ç›®ã€‚

```astro
---
import { getCollection } from 'astro:content';

// è·å– `src/content/blog/` ä¸­çš„æ‰€æœ‰æ¡ç›®
const allBlogPosts = await getCollection('blog');

// ä»…è¿”å› frontmatter ä¸­ `draft: true` çš„æ¡ç›®
const draftBlogPosts = await getCollection('blog', ({ data }) => {
  return data.draft === true;
});
---
```

æœ‰å…³ç¤ºä¾‹è¯·[å‚è€ƒ `å†…å®¹é›†åˆ`æŒ‡å—](/zh-cn/guides/content-collections/#æŸ¥è¯¢é›†åˆ) ä»¥è·å–ç¤ºä¾‹ç”¨æ³•ã€‚

### `getEntry()`

<p>
  <Since v="2.5.0" />
</p>

**Typesï¼š**

- `(collection: string, contentSlugOrDataId: string) => CollectionEntry<collection>`
- `({ collection: string, id: string }) => CollectionEntry<collection>`
- `({ collection: string, slug: string }) => CollectionEntry<collection>`

`getEntry()` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯é€šè¿‡é›†åˆåç§°å’Œæ¡ç›® `id` ï¼ˆå¯¹äº `type: 'data'` é›†åˆï¼‰æˆ–æ¡ç›® `slug` ï¼ˆå¯¹äº `type: 'content'` é›†åˆï¼‰æ£€ç´¢å•ä¸ªé›†åˆæ¡ç›®ã€‚`getEntry()`ä¹Ÿå¯ç”¨äºè·å–å¼•ç”¨æ¡ç›®ï¼Œä»¥è®¿é—®`data`ã€`body`æˆ–`render()`å±æ€§ï¼š

```astro
---
import { getEntry } from 'astro:content';

// å¾—åˆ° `src/content/blog/enterprise.md`
const enterprisePost = await getEntry('blog', 'enterprise');

// å¾—åˆ° `src/content/captains/picard.yaml`
const picardProfile = await getEntry('captains', 'picard');

// å¾—åˆ° the profile referenced by `data.captain`
const enterpriseCaptainProfile = await getEntry(enterprise.data.captain);
---
```

æœ‰å…³`å†…å®¹é›†åˆ`çš„ç¤ºä¾‹ï¼Œè¯·å‚è€ƒ [æŸ¥è¯¢é›†åˆæ¡ç›®](/zh-cn/guides/content-collections/#æŸ¥è¯¢é›†åˆ).

### `getEntries()`

<p>
  <Since v="2.5" />
</p>

**Typesï¼š**

- `(Array<{ collection: string, id: string }>) => Array<CollectionEntry<collection>>`
- `(Array<{ collection: string, slug: string }>) => Array<CollectionEntry<collection>>`

`getEntries()` æ˜¯ä¸€ä¸ªä»åŒä¸€é›†åˆä¸­æ£€ç´¢å¤šä¸ªé›†åˆæ¡ç›®çš„å‡½æ•°ã€‚è¿™å¯¹äº[è¿”å›å¼•ç”¨æ¡ç›®çš„æ•°ç»„](/zh-cn/guides/content-collections/#å®šä¹‰é›†åˆå¼•ç”¨)è®¿é—®å…¶å…³è”çš„`data`ã€`body`å’Œ`render()`å±æ€§éå¸¸æœ‰ç”¨ã€‚

```astro
---
import { getEntries } from 'astro:content';

const enterprisePost = await getEntry('blog', 'enterprise');

// è·å–ç”± `data.relatedPosts` å¼•ç”¨çš„ç›¸å…³å¸–å­
const enterpriseRelatedPosts = await getEntries(enterprisePost.data.relatedPosts);
---
```


### `getEntryBySlug()`

**ç±»å‹ï¼š**`(collection: string, slug: string) => CollectionEntry<collection>`
:::caution[å·²åœç”¨]
ä½¿ç”¨ [`getEntry()`å‡½æ•°](#getentry) æŸ¥è¯¢å†…å®¹æ¡ç›®ã€‚è¯¥å‡½æ•°æ¥å—ä¸ `getEntryBySlug()` ç›¸åŒçš„å‚æ•°ï¼Œå¹¶æ”¯æŒé€šè¿‡ `id` æŸ¥è¯¢ JSON æˆ– YAML é›†åˆã€‚
:::

`getEntryBySlug()` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºé€šè¿‡é›†åˆåç§°å’Œæ¡ç›® `slug` æ£€ç´¢å•ä¸ªé›†åˆæ¡ç›®ã€‚

```astro
---
import { getEntryBySlug } from 'astro:content';

const enterprise = await getEntryBySlug('blog', 'enterprise');
---
```
æœ‰å…³ç¤ºä¾‹è¯·[å‚è€ƒ `å†…å®¹é›†åˆ`æŒ‡å—](/zh-cn/guides/content-collections/#æŸ¥è¯¢é›†åˆ) ä»¥è·å–ç¤ºä¾‹ç”¨æ³•ã€‚

### é›†åˆæ¡ç›®ç±»å‹

[`getCollection()`](#getcollection)å’Œ [`getEntryBySlug()`](#getentrybyslug) å‡½æ•°éƒ½ä¼šè¿”å› `CollectionEntry` ç±»å‹çš„æ¡ç›®ã€‚è¿™ä¸ªç±»å‹å¯ä»¥ä» `astro:content` ä¸­è·å–ï¼š

```ts
import type { CollectionEntry } from 'astro:content';
```

`CollectionEntry<TCollectionName>` ç±»å‹æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰ä»¥ä¸‹å€¼ã€‚ `TCollectionName` æ˜¯æ‚¨æ­£åœ¨æŸ¥è¯¢çš„é›†åˆçš„åç§°ï¼ˆä¾‹å¦‚ `CollectionEntry<'blog'>`ï¼‰ã€‚

#### `id`

**é€‚ç”¨äºï¼š** `type: 'content'` and `type: 'data'` é›†åˆ

**ç¤ºä¾‹ç±»å‹ï¼š**
  - content collections: `'entry-1.md' | 'entry-2.md' | ...`
  - data collections: `'author-1' | 'author-2' | ...`

ä¸€ä¸ªä½¿ç”¨ç›¸å¯¹äº `src/content/[collection]` çš„æ–‡ä»¶è·¯å¾„çš„å”¯ä¸€ IDã€‚æ ¹æ®é›†åˆæ¡ç›®æ–‡ä»¶è·¯å¾„æšä¸¾æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦ä¸²å€¼ã€‚è¯·æ³¨æ„ï¼Œ[`ç±»å‹: 'content'`](#type) çš„é›†åˆåœ¨å…¶ ID ä¸­åŒ…å«æ–‡ä»¶æ‰©å±•åï¼Œè€Œå®šä¹‰ä¸º `type: 'data'` çš„é›†åˆåˆ™ä¸åŒ…å«ã€‚

#### `collection`

**é€‚ç”¨äºï¼š** `type: 'content'` and `type: 'data'` é›†åˆ 

**ç¤ºä¾‹ç±»å‹ï¼š** `'blog' | 'authors' | ...`

src/content/` ä¸‹é¡¶çº§æ–‡ä»¶å¤¹çš„åç§°ï¼Œæ¡ç›®ä½äºè¯¥æ–‡ä»¶å¤¹ä¸­ã€‚è¯¥åç§°ç”¨äºåœ¨æ¨¡å¼å’ŒæŸ¥è¯¢å‡½æ•°ä¸­å¼•ç”¨é›†åˆã€‚


#### `data`
**é€‚ç”¨äºï¼š** `type: 'content'` and `type: 'data'` é›†åˆ 

**ç±»å‹ï¼š**`CollectionSchema<TCollectionName>`

ä¸€ä¸ªä»é›†åˆæ¨¡å¼æ¨æ–­å‡ºçš„ frontmatter å±æ€§å¯¹è±¡ï¼ˆ[å‚è€ƒ `defineCollection()`](#definecollection)ï¼‰ã€‚å¦‚æœæ²¡æœ‰é…ç½®æ¨¡å¼ï¼Œåˆ™é»˜è®¤ä¸º `any`ã€‚

#### `slug`

**é€‚ç”¨äºï¼š** ä»…ä»… `type: 'content'` é›†åˆ

**ç¤ºä¾‹ç±»å‹ï¼š** `'entry-1' | 'entry-2' | ...`

å¯ç”¨äº Markdown æˆ– MDX æ–‡æ¡£çš„ URL æ ‡å¤´ã€‚é»˜è®¤ä¸ºä¸å«æ–‡ä»¶æ‰©å±•åçš„ "id"ï¼Œä½†å¯ä»¥é€šè¿‡åœ¨æ–‡ä»¶çš„ frontmatter ä¸­è®¾ç½®[`slug`å±æ€§](/zh-cn/guides/content-collections/#å®šä¹‰è‡ªå®šä¹‰-slugs)æ¥è¦†ç›–ã€‚

#### `body`
**é€‚ç”¨äºï¼š** ä»… `type: 'content'` é›†åˆ

**ç±»å‹ï¼š**`string`

ä¸€ä¸ªåŒ…å« Markdown æˆ– MDX æ–‡æ¡£åŸå§‹æœªç¼–è¯‘çš„ body çš„å­—ç¬¦ä¸²ã€‚

#### `render()`

**é€‚ç”¨äºï¼š** ä»… `type: 'content'` é›†åˆ

**ç±»å‹ï¼š**`() => Promise<RenderedEntry>`

ä¸€ä¸ªç”¨äºç¼–è¯‘ç»™å®šçš„ Markdown æˆ– MDX æ–‡æ¡£ä»¥è¿›è¡Œæ¸²æŸ“çš„å‡½æ•°ã€‚å®ƒè¿”å›ä»¥ä¸‹å±æ€§ï¼š

- `<Content />` - ç”¨äºåœ¨ Astro æ–‡ä»¶ä¸­æ¸²æŸ“æ–‡æ¡£å†…å®¹çš„ç»„ä»¶ã€‚
- `headings` - ç”Ÿæˆçš„æ ‡é¢˜åˆ—è¡¨ï¼Œ[ä¸ Astro çš„ `getHeadings()` å·¥å…·å‡½æ•°ç›¸åŒ](/zh-cn/guides/markdown-content/#å¯¼å‡ºçš„å±æ€§) åœ¨ Markdown å’Œ MDX å¯¼å…¥ä¸­ã€‚
- `remarkPluginFrontmatter ` - åœ¨åº”ç”¨ [remark æˆ– rehype æ’ä»¶](/zh-cn/guides/markdown-content/#ä»¥ç¼–ç¨‹æ–¹å¼ä¿®æ”¹-frontmatter)åä¿®æ”¹åçš„ frontmatter å¯¹è±¡ã€‚è®¾ç½®ä¸ºç±»å‹ `any`ã€‚

```astro
---
import { getEntryBySlug } from 'astro:content';
const entry = await getEntryBySlug('blog', 'entry-1');

const { Content, headings, remarkPluginFrontmatter } = await entry.render();
---
```

æœ‰å…³ç¤ºä¾‹è¯·[å‚è€ƒ `å†…å®¹é›†åˆ`æŒ‡å—](/zh-cn/guides/content-collections/#å°†å†…å®¹æ¸²æŸ“æˆ-html) ä»¥è·å–ç¤ºä¾‹ç”¨æ³•ã€‚

### å…¶ä»–å†…å®¹é›†åˆç±»å‹

`astro:content` æ¨¡å—ä¹Ÿå¯¼å‡ºäº†ä»¥ä¸‹ç±»å‹ï¼Œä¾›ä½ åœ¨ Astro é¡¹ç›®ä¸­ä½¿ç”¨ï¼š

#### `CollectionKey`

è¿™æ˜¯ä¸€ä¸ªåœ¨ `src/content/config.*` æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰é›†åˆåç§°çš„å­—ç¬¦ä¸²è”åˆç±»å‹ã€‚å½“å®šä¹‰ä¸€ä¸ªå¯ä»¥æ¥å—ä»»ä½•é›†åˆåç§°çš„é€šç”¨å‡½æ•°æ—¶ï¼Œè¿™ä¸ªç±»å‹å¾ˆæœ‰ç”¨ã€‚

```ts
import type { CollectionKey, getCollection } from 'astro:content';

async function getCollection(collection: CollectionKey) {
  return getCollection(collection);
}
```

#### `ContentCollectionKey`

ä¸€ä¸ªåœ¨ `src/content/config.*` æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰ `type: 'content'` é›†åˆåç§°çš„å­—ç¬¦ä¸²è”åˆç±»å‹ã€‚

#### `DataCollectionKey`

ä¸€ä¸ªåœ¨ `src/content/config.*` æ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰ `type: 'data'` é›†åˆåç§°çš„å­—ç¬¦ä¸²è”åˆç±»å‹ã€‚

#### `SchemaContext`

å³ `defineCollection` åœ¨ `schema` å‡½æ•°å½¢çŠ¶ä¸­æ‰€ä½¿ç”¨çš„ `context` å¯¹è±¡ã€‚å½“ä¸ºå¤šä¸ªé›†åˆæ„å»ºå¯é‡ç”¨çš„æ¨¡å¼æ—¶ï¼Œè¿™ä¸ªç±»å‹å¾ˆæœ‰ç”¨ã€‚

å®ƒåŒ…æ‹¬äº†ä»¥ä¸‹å±æ€§ï¼š

- `image()` æ¨¡å¼è¾…åŠ©å·¥å…·å…è®¸ä½  [åœ¨å†…å®¹é›†åˆä¸­ä½¿ç”¨æœ¬åœ°å›¾ç‰‡](/zh-cn/guides/images/#å†…å®¹é›†åˆä¸­çš„å›¾åƒ)ã€‚

```ts
import type { SchemaContext } from 'astro:content';

export const imageSchema = ({ image }: SchemaContext) =>
    z.object({
        image: image(),
        description: z.string().optional(),
    });

const blog = defineCollection({
  type: 'content',
  schema: ({ image }) => z.object({
    title: z.string(),
    permalink: z.string().optional(),
    image: imageSchema({ image })
  }),
});
```

## å†…ç½®ç»„ä»¶

Astro åŒ…æ‹¬å‡ ä¸ªå†…ç½®çš„ç»„ä»¶ä¾›ä½ åœ¨ä½ çš„é¡¹ç›®ä¸­ä½¿ç”¨ã€‚åœ¨ `.astro` æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡ `import {} from 'astro:components';` å¼•ç”¨æ‰€æœ‰çš„å†…ç½®ç»„ä»¶ã€‚

### `<Code />`

```astro 'theme="dark-plus"' /wrap\b/ /(inline) \/>/
---
import { Code } from 'astro:components';
---
<!-- ä½¿ç”¨è¯­æ³•å‡¸æ˜¾éƒ¨åˆ† JavaScript ä»£ç -->
<Code code={`const foo = 'bar';`} lang="js" />
<!-- å¯é€‰ï¼šå®šåˆ¶ä½ çš„ä¸»é¢˜ -->
<Code code={`const foo = 'bar';`} lang="js" theme="dark-plus" />
<!-- å¯é€‰ï¼šå¯ç”¨æ–‡å­—åŒ…è£… -->
<Code code={`const foo = 'bar';`} lang="js" wrap />
<!-- Optional: Output inline code. -->
<p>
  <Code code={`const foo = 'bar';`} lang="js" inline />
  will be rendered inline.
</p>
```

è¯¥ç»„ä»¶åœ¨æ„å»ºæ—¶ä¸ºä»£ç å—æä¾›è¯­æ³•é«˜äº®ï¼ˆä¸åŒ…æ‹¬å®¢æˆ·ç«¯ JavaScriptï¼‰ã€‚è¯¥ç»„ä»¶ç”± Shiki é©±åŠ¨ï¼Œå®ƒæ”¯æŒæ‰€æœ‰æµè¡Œçš„[ä¸»é¢˜](https://github.com/shikijs/shiki/blob/main/docs/themes.md)å’Œ[è¯­è¨€](https://github.com/shikijs/shiki/blob/main/docs/languages.md)ã€‚å¦å¤–ï¼Œä½ å¯ä»¥é€šè¿‡ç»™ `theme` å’Œ `lang` ä¼ é€’è‡ªå®šä¹‰ä¸»é¢˜å’Œè¯­è¨€åˆ†åˆ«æ·»åŠ å®ƒä»¬ã€‚

### `<Fragment />`

ä¸€ä¸ªä¸ [`set:*` æŒ‡ä»¤](/zh-cn/reference/directives-reference/#sethtml) ä¸€èµ·ä½¿ç”¨çš„ç»„ä»¶ï¼Œç”¨äºæ¸²æŸ“ HTML å†…å®¹è€Œä¸æ·»åŠ ä»»ä½•é¢å¤–çš„åŒ…è£¹å…ƒç´ ã€‚

```astro title="src/components/SetHtml.astro" "Fragment"
---
const htmlString = '<p>Raw HTML content</p>';
---
<Fragment set:html={htmlString} />
```

è¯·å‚è§åœ¨ Astro è¯­æ³•ä¸­ä½¿ç”¨[ç‰‡æ®µ](/zh-cn/core-concepts/astro-syntax/#ç‰‡æ®µ)çš„æ›´å¤šä¿¡æ¯ã€‚

### `<Prism />`


è¦å®‰è£… `Prism` é«˜äº®å™¨ç»„ä»¶ï¼Œéœ€è¦**å…ˆå®‰è£…** `@astrojs/prism` åŒ…ï¼š

<PackageManagerTabs>
  <Fragment slot="npm">
  ```shell
  npm i @astrojs/prism
  ```
  </Fragment>
  <Fragment slot="pnpm">
  ```shell
  pnpm i @astrojs/prism
  ```
  </Fragment>
  <Fragment slot="yarn">
  ```shell
  yarn add @astrojs/prism
  ```
  </Fragment>
</PackageManagerTabs>


```astro
---
import { Prism } from '@astrojs/prism';
---
<Prism lang="js" code={`const foo = 'bar';`} />
```

è¿™ä¸ªç»„ä»¶é€šè¿‡åº”ç”¨ Prism çš„ CSS ç±»ä¸ºä»£ç å—æä¾›ç‰¹å®šè¯­è¨€çš„è¯­æ³•é«˜äº®ã€‚æ³¨æ„ï¼Œ**ä½ éœ€è¦æä¾› Prism çš„ CSS æ ·å¼è¡¨**ï¼ˆæˆ–ç”¨è‡ªå·±çš„ï¼‰ï¼Œä»¥å¯ç”¨è¯­æ³•é«˜äº®ï¼å‚è§ [Prism é…ç½®éƒ¨åˆ†](/zh-cn/guides/markdown-content/#prism-é…ç½®)äº†è§£æ›´å¤šç»†èŠ‚ã€‚

å‚è§ [Prism æ”¯æŒçš„è¯­è¨€åˆ—è¡¨](https://prismjs.com/#supported-languages)ï¼Œåœ¨é‚£é‡Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ç§è¯­è¨€çš„å¯¹åº”åˆ«åã€‚è€Œä¸”ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ `lang="astro"` æ¥å±•ç¤º Astro ä»£ç å—ï¼

### `<Image />`

```astro title="src/components/MyComponent.astro"
---
// å¯¼å…¥å›¾åƒç»„ä»¶å’Œå›¾ç‰‡
import { Image } from 'astro:assets';
import myImage from "../assets/my_image.png"; // Image is 1600x900
---
<!-- `alt` åœ¨ Image ç»„ä»¶ä¸­æ˜¯å¿…éœ€çš„å±æ€§ -->
<Image src={myImage} alt="A description of my image." />
```

```html
<!-- è¾“å‡º -->
<!-- Image ç»„ä»¶å·²ç»è¿‡ä¼˜åŒ–ï¼Œå¹¶ä¸”å¯¹åº”çš„å±æ€§ä¹Ÿè¢«å¼ºåˆ¶ä½¿ç”¨ã€‚ -->
<img
  src="/_astro/my_image.hash.webp"
  width="1600"
  height="900"
  decoding="async"
  loading="lazy"
  alt="A description of my image."
/>
```
#### å±æ€§

- srcï¼ˆå¿…éœ€çš„ï¼‰
- altï¼ˆå¿…éœ€çš„ï¼‰
- width å’Œ heightï¼ˆå¯¹ `public/` å’Œè¿œç¨‹å›¾åƒè€Œè¨€æ˜¯å¿…éœ€çš„ï¼‰
- format
- quality
- densities
- widths

é™¤äº†ä¸Šè¿°å±æ€§ä¹‹å¤–ï¼Œ`<Image />` ç»„ä»¶è¿˜æ¥å— HTML `<img>` æ ‡ç­¾æ¥å—çš„æ‰€æœ‰å±æ€§ã€‚

è¯¦è§[å›¾åƒæŒ‡å—](/zh-cn/guides/images/#image--astroassets)ã€‚

### `<Picture />`

<Since v="3.3.0" /> <Badge>å®éªŒæ€§</Badge>

ä½¿ç”¨å†…ç½®çš„ `<Picture />` Astro ç»„ä»¶æ¥å±•ç¤ºå…·æœ‰å¤šç§æ ¼å¼å’Œï¼ˆæˆ–ï¼‰å°ºå¯¸çš„å“åº”å¼å›¾åƒã€‚

```astro title="src/pages/index.astro"
---
import { Picture } from 'astro:assets';
import myImage from "../assets/my_image.png"; // å›¾åƒçš„åˆ†è¾¨ç‡ä¸º 1600x900
---
<!-- åœ¨å›¾ç‰‡ç»„ä»¶ä¸Š `alt` å±æ€§æ˜¯å¿…éœ€çš„ -->
<Picture src={myImage} formats={['avif', 'webp']} alt="A description of my image." />
```

```html
<!-- è¾“å‡º -->
<picture>
  <source srcset="/_astro/my_image.hash.avif" type="image/avif" />
  <source srcset="/_astro/my_image.hash.webp" type="image/webp" />
  <img
    src="/_astro/my_image.hash.png"
    width="1600"
    height="900"
    decoding="async"
    loading="lazy"
    alt="A description of my image."
  />
</picture>
```

è¯¦è§[å›¾åƒæŒ‡å—](/zh-cn/guides/images/#picture-)ã€‚

#### å±æ€§

`<Picture />` æ¥å— `<Image />` ç»„ä»¶çš„æ‰€æœ‰å±æ€§ï¼Œä»¥åŠä»¥ä¸‹å±æ€§ï¼š

##### `formats`

ä¸€ä¸ªå›¾åƒæ ¼å¼çš„æ•°ç»„ï¼Œç”¨äº `<source>` æ ‡ç­¾ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒè¢«è®¾ç½®ä¸º `['webp']`ã€‚

##### `fallbackFormat`

ç”¨äºä½œä¸º `<img>` æ ‡ç­¾çš„å›é€€å€¼çš„æ ¼å¼ã€‚å¯¹äºé™æ€å›¾åƒï¼Œé»˜è®¤ä¸º `.png`ï¼›å¯¹äºåŠ¨ç”»å›¾åƒï¼Œé»˜è®¤ä¸º `.gif`ï¼›å¯¹äº SVG æ–‡ä»¶ï¼Œé»˜è®¤ä¸º `.svg`ã€‚

##### `pictureAttributes`

ä¸€ä¸ªè¢«æ·»åŠ åˆ° `<picture>` æ ‡ç­¾çš„å±æ€§å¯¹è±¡ã€‚ä½¿ç”¨è¯¥å±æ€§å¯å°†å±æ€§åº”ç”¨äºå¤–éƒ¨çš„ `<picture>` å…ƒç´ æœ¬èº«ã€‚é™¤äº†ç”¨äºå›¾åƒè½¬æ¢çš„å±æ€§å¤–ï¼Œç›´æ¥åº”ç”¨äº `<Picture />` ç»„ä»¶çš„å±æ€§å°†åº”ç”¨äºå†…éƒ¨çš„ `<img>` å…ƒç´ ã€‚


### `<Content />`

ä¸€ä¸ªé€šç”¨ç»„ä»¶ï¼Œç”¨äºå‘ˆç° [å†…å®¹é›†åˆæ¡ç›®](/zh-cn/guides/content-collections/#ä»€ä¹ˆæ˜¯å†…å®¹é›†åˆ) çš„å†…å®¹ã€‚

é¦–å…ˆï¼Œä½¿ç”¨ `getCollection()` æˆ– `getEntry()` æŸ¥è¯¢ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ç›®ã€‚ç„¶åï¼Œ`entry.render()` å‡½æ•°å¯ä»¥è¿”å› `<Content />` ç»„ä»¶ï¼Œä»¥ä¾›åœ¨ `.astro` æ–‡ä»¶æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚

```astro title="src/pages/render-example.astro" {4, 7}
---
import { getEntry } from 'astro:content';
const entry = await getEntry('blog', 'post-1');
const { Content } = await entry.render();
---
<p>Published on: {entry.data.published.toDateString()}</p>
<Content />
```

### `<ViewTransitions />`

åœ¨æ¯ä¸ªå¸Œæœ›åº”ç”¨è§†å›¾è¿‡æ¸¡åŠ¨ç”»çš„é¡µé¢ä¸Šï¼Œé€šè¿‡å¯¼å…¥å¹¶å°† `<ViewTransitions />` è·¯ç”±ç»„ä»¶æ·»åŠ åˆ° `<head>` ä¸­ï¼Œæ¥é€‰æ‹©ä½¿ç”¨å•ä¸ªé¡µé¢ä¸Šçš„è§†å›¾è¿‡æ¸¡åŠ¨ç”»ã€‚

```astro title="src/pages/index.astro" ins={2,7}
---
import { ViewTransitions } from 'astro:transitions';
---
<html lang="en">
  <head>
    <title>My Homepage</title>
    <ViewTransitions />
  </head>
  <body>
    <h1>Welcome to my website!</h1>
  </body>
</html>
```

æŸ¥çœ‹æ›´å¤šå…³äºå¦‚ä½•[æ§åˆ¶è·¯ç”±å™¨](/zh-cn/guides/view-transitions/#è·¯ç”±å™¨æ§åˆ¶)å’Œå‘é¡µé¢å…ƒç´ å’Œç»„ä»¶æ·»åŠ [è¿‡æ¸¡åŠ¨ç”»æŒ‡ä»¤](/zh-cn/guides/view-transitions/#è¿‡æ¸¡åŠ¨ç”»æŒ‡ä»¤)çš„ä¿¡æ¯ã€‚

### `<Debug />`

```astro
---
import { Debug } from 'astro:components';
const serverObject = {
  a: 0,
  b: "string",
  c: {
    nested: "object"
  }
}
---
<Debug {serverObject} />
```

è¿™ä¸ªç»„ä»¶æä¾›äº†æ— éœ€ JavaScript åœ¨å®¢æˆ·ç«¯æ£€æŸ¥æ•°å€¼çš„æ–¹æ³•ã€‚

[canonical]: https://en.wikipedia.org/wiki/Canonical_link_element
