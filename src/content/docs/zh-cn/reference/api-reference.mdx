---
title: Astro æ¸²æŸ“ä¸Šä¸‹æ–‡
sidebar:
  label: æ¸²æŸ“ä¸Šä¸‹æ–‡
i18nReady: true
tableOfContents:
  minHeadingLevel: 2
  maxHeadingLevel: 4
---
import Since from '~/components/Since.astro';
import { Tabs, TabItem } from '@astrojs/starlight/components';
import ReadMore from '~/components/ReadMore.astro';

æ¸²æŸ“é¡µé¢æ—¶ï¼ŒAstro æä¾›äº†ç‰¹å®šäºå½“å‰æ¸²æŸ“çš„è¿è¡Œæ—¶ APIã€‚è¿™åŒ…æ‹¬å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œä¾‹å¦‚å½“å‰é¡µé¢çš„ URLï¼Œä»¥åŠæ‰§è¡Œæ“ä½œï¼ˆå¦‚é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼‰çš„ APIã€‚

åœ¨ `.astro` ç»„ä»¶ä¸­ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡å¯ä»¥ä» `Astro` å…¨å±€å¯¹è±¡ä¸­è·å–ã€‚ç«¯ç‚¹å‡½æ•°ä¹Ÿä¼šä»¥è¿™ä¸ªç›¸åŒçš„ä¸Šä¸‹æ–‡å¯¹è±¡ä½œä¸ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå‚æ•°è¢«è°ƒç”¨ï¼Œå…¶å±æ€§ä¸ Astro å…¨å±€å±æ€§ç›¸åŒã€‚

æŸäº›å±æ€§ä»…åœ¨æŒ‰éœ€æ¸²æŸ“çš„è·¯ç”±ä¸Šå¯ç”¨ï¼Œæˆ–åœ¨é¢„æ¸²æŸ“é¡µé¢ä¸ŠåŠŸèƒ½æœ‰é™ã€‚

`Astro` å…¨å±€å¯¹è±¡åœ¨æ‰€æœ‰ `.astro` æ–‡ä»¶ä¸­éƒ½å¯ç”¨ã€‚åœ¨ [ç«¯ç‚¹å‡½æ•°](/zh-cn/guides/endpoints/) ä¸­ä½¿ç”¨ `context` å¯¹è±¡æ¥æä¾›é™æ€æœåŠ¡æˆ–å®æ—¶æœåŠ¡å™¨ç«¯ç‚¹ï¼Œåœ¨ [ä¸­é—´ä»¶](/zh-cn/guides/middleware/) ä¸­æ³¨å…¥é¡µé¢æˆ–ç«¯ç‚¹å³å°†æ¸²æŸ“æ—¶çš„è¡Œä¸ºã€‚

## ä¸Šä¸‹æ–‡å¯¹è±¡

ä»¥ä¸‹å±æ€§å¯ç”¨äº `Astro` å…¨å±€å¯¹è±¡ï¼ˆä¾‹å¦‚ `Astro.props`ã€`Astro.redirect()`ï¼‰ä»¥åŠä¼ é€’ç»™ç«¯ç‚¹å‡½æ•°å’Œä¸­é—´ä»¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆä¾‹å¦‚ `context.props`ã€`context.redirect()`ï¼‰ã€‚

### `props`

`props` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ä½œä¸º [ç»„ä»¶å‚æ•°](/zh-cn/basics/astro-components/#ç»„ä»¶å‚æ•°) ä¼ é€’çš„ä»»ä½•å€¼ã€‚

```astro {3}
---
// src/components/Heading.astro
const { title, date } = Astro.props;
---
<div>
  <h1>{title}</h1>
  <p>{date}</p>
</div>
```

```astro "title=" "date="
---
// src/pages/index.astro
import Heading from '../components/Heading.astro';
---
<Heading title="My First Post" date="09 Aug 2022" />
```

<ReadMore>è¯¦ç»†äº†è§£ [Markdown å’Œ MDX å¸ƒå±€](/zh-cn/guides/markdown-content/#frontmatter-layout-å±æ€§) å¦‚ä½•å¤„ç† propsã€‚</ReadMore>


`props` å¯¹è±¡è¿˜åŒ…å«ä» `getStaticPaths()` ä¼ é€’çš„ä»»ä½• `props`ï¼Œç”¨äºæ¸²æŸ“é™æ€è·¯ç”±ã€‚

<Tabs>
  <TabItem label="Astro.props">
    ```astro title="src/pages/posts/[id].astro" "props:" {11}
    ---
    export function getStaticPaths() {
      return [
        { params: { id: '1' }, props: { author: 'Blu' } },
        { params: { id: '2' }, props: { author: 'Erika' } },
        { params: { id: '3' }, props: { author: 'Matthew' } }
      ];
    }

    const { id } = Astro.params;
    const { author } = Astro.props;
    ---
    ```
  </TabItem>
  <TabItem label="context.props">
    ```ts title="src/pages/posts/[id].json.ts" "props:" {11-15}
    import type { APIContext } from 'astro';

    export function getStaticPaths() {
      return [
        { params: { id: '1' }, props: { author: 'Blu' } },
        { params: { id: '2' }, props: { author: 'Erika' } },
        { params: { id: '3' }, props: { author: 'Matthew' } }
      ];
    }

    export function GET({ props }: APIContext) {
      return new Response(
        JSON.stringify({ author: props.author }),
      );
    }
    ```
  </TabItem>

</Tabs>

å¦è§ï¼š[ä½¿ç”¨ `props` ä¼ é€’æ•°æ®](/zh-cn/reference/routing-reference/#é€šè¿‡-props-ä¼ é€’æ•°æ®)

### `params`

`params` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†è¯·æ±‚åŒ¹é…çš„åŠ¨æ€è·¯ç”±æ®µçš„å€¼ã€‚å®ƒçš„é”®å¿…é¡»ä¸é¡µé¢æˆ–ç«¯ç‚¹æ–‡ä»¶è·¯å¾„ä¸­çš„ [å‚æ•°](/zh-cn/guides/routing/#åŠ¨æ€è·¯ç”±) åŒ¹é…ã€‚

åœ¨é™æ€æ„å»ºä¸­ï¼Œè¿™å°†æ˜¯ `getStaticPaths()` è¿”å›çš„ `params`ï¼Œç”¨äºé¢„æ¸²æŸ“ [åŠ¨æ€è·¯ç”±](/zh-cn/guides/routing/#åŠ¨æ€è·¯ç”±)ï¼š

<Tabs>
  <TabItem label="Astro.params">
    ```astro title="src/pages/posts/[id].astro" {9} "params:"
    ---
    export function getStaticPaths() {
      return [
        { params: { id: '1' } },
        { params: { id: '2' } },
        { params: { id: '3' } }
      ];
    }
    const { id } = Astro.params;
    ---
    <h1>{id}</h1>
    ```
  </TabItem>
  <TabItem label="context.params">
    ```ts title="src/pages/posts/[id].json.ts" "params:" {11-15}
    import type { APIContext } from 'astro';

    export function getStaticPaths() {
      return [
        { params: { id: '1' } },
        { params: { id: '2' } },
        { params: { id: '3' } }
      ];
    }

    export function GET({ params }: APIContext) {
      return new Response(
        JSON.stringify({ id: params.id }),
      );
    }
    ```
  </TabItem>
</Tabs>


å½“æŒ‰éœ€æ¸²æŸ“è·¯ç”±æ—¶ï¼Œ`params` å¯ä»¥æ˜¯ä¸åŠ¨æ€è·¯ç”±æ¨¡å¼ä¸­çš„è·¯å¾„æ®µåŒ¹é…çš„ä»»ä½•å€¼ã€‚

```astro title="src/pages/posts/[id].astro" "Astro.params"
---
import { getPost } from '../api';

const post = await getPost(Astro.params.id);

// æ²¡æœ‰æ‰¾åˆ°åŒ¹é… ID çš„æ–‡ç« 
if (!post) {
  return Astro.redirect("/404")
}
---
<html>
  <h1>{post.name}</h1>
</html>
```

å¦è§ï¼š[`params`](/zh-cn/reference/routing-reference/#params)

### `url`

<p>

**ç±»å‹ï¼š** `URL`<br />
<Since v="1.0.0" />
</p>

`url` æ˜¯ä¸€ä¸ªä»å½“å‰ `request.url` å€¼æ„é€ çš„ [URL](https://developer.mozilla.org/zh-CN/docs/Web/API/URL) å¯¹è±¡ã€‚å®ƒå¯¹äºä¸è¯·æ±‚ URL çš„å„ä¸ªå±æ€§è¿›è¡Œäº¤äº’éå¸¸æœ‰ç”¨ï¼Œä¾‹å¦‚ pathname å’Œ originã€‚

`Astro.url` ç›¸å½“äº `new URL(Astro.request.url)`ã€‚

åœ¨å¼€å‘æ¨¡å¼ä¸‹ `url` æ˜¯ä¸€ä¸ª `localhost` URLã€‚åœ¨æ„å»ºç«™ç‚¹æ—¶ï¼Œé¢„æ¸²æŸ“è·¯ç”±å°†æ ¹æ® [`site`](/zh-cn/reference/configuration-reference/#site) å’Œ [`base`](/zh-cn/reference/configuration-reference/#base) é€‰é¡¹ç”Ÿæˆ URLã€‚å¦‚æœæœªé…ç½® `site`ï¼Œæ„å»ºæœŸé—´é¢„æ¸²æŸ“é¡µé¢å°†æ”¶åˆ° `localhost` URLã€‚

```astro title="src/pages/index.astro" "Astro.url"
<h1>å½“å‰ URL æ˜¯ï¼š{Astro.url}</h1>
<h1>å½“å‰ URL çš„ pathname æ˜¯ï¼š{Astro.url.pathname}</h1>
<h1>å½“å‰ URL çš„ origin æ˜¯ï¼š{Astro.url.origin}</h1>
```

ä½ è¿˜å¯ä»¥ä½¿ç”¨ `url` é€šè¿‡å°†å…¶ä½œä¸ºå‚æ•°ä¼ é€’ç»™ [`new URL()`](https://developer.mozilla.org/zh-CN/docs/Web/API/URL/URL) æ¥åˆ›å»ºæ–°çš„ URLã€‚

```astro title="src/pages/index.astro" "Astro.url"
---
// ç¤ºä¾‹ï¼šä½¿ç”¨ä½ çš„ç”Ÿäº§åŸŸåæ„å»ºä¸€ä¸ªè§„èŒƒ URL
const canonicalURL = new URL(Astro.url.pathname, Astro.site);
// ç¤ºä¾‹ï¼šä½¿ç”¨ä½ çš„å½“å‰åŸŸåæ„å»º SEO meta æ ‡ç­¾çš„ URL
const socialImageURL = new URL('/images/preview.png', Astro.url);
---
<link rel="canonical" href={canonicalURL} />
<meta property="og:image" content={socialImageURL} />
```

### `site`

<p>

**ç±»å‹ï¼š** `URL | undefined`
</p>

`site` æ˜¯ä¸€ä¸ªä»ä½ çš„ Astro é…ç½®ä¸­çš„ `site` æ„é€ çš„ `URL`ã€‚å¦‚æœä½ æ²¡æœ‰åœ¨ Astro é…ç½®ä¸­è®¾ç½® [`site`](/zh-cn/reference/configuration-reference/#site) çš„å€¼ï¼Œå®ƒå°†è¿”å› `undefined`ã€‚

```astro title="src/pages/index.astro" "Astro.site"
<link
    rel="alternate"
    type="application/rss+xml"
    title="ç½‘ç«™æ ‡é¢˜"
    href={new URL("rss.xml", Astro.site)}
/>
```

### `clientAddress`

<p>

**ç±»å‹ï¼š** `string`<br />
<Since v="1.0.0" />
</p>

`clientAddress` æŒ‡å®šè¯·æ±‚çš„ [IP åœ°å€](https://en.wikipedia.org/wiki/IP_address)ã€‚æ­¤å±æ€§ä»…é€‚ç”¨äºæŒ‰éœ€æ¸²æŸ“çš„è·¯ç”±ï¼Œä¸èƒ½åœ¨é¢„æ¸²æŸ“é¡µé¢ä¸Šä½¿ç”¨ã€‚

<Tabs>
  <TabItem label="Astro.clientAddress">
    ```astro title="src/pages/ip-address.astro" "Astro.clientAddress"
    ---
    export const prerender = false; // 'server' æ¨¡å¼ä¸‹ä¸éœ€è¦
    ---

    <div>Your IP address is: <span class="address">{Astro.clientAddress}</span></div>
    ```
  </TabItem>
  <TabItem label="context.clientAddress">
    ```ts title="src/pages/ip-address.ts" "clientAddress"
    export const prerender = false; // 'server' æ¨¡å¼ä¸‹ä¸éœ€è¦
    import type { APIContext } from 'astro';

    export function GET({ clientAddress }: APIContext) {
      return new Response(`Your IP address is: ${clientAddress}`);
    }
    ```
  </TabItem>
</Tabs>


### `isPrerendered`

<p>

**ç±»å‹ï¼š** `boolean`<br />
<Since v="5.0.0" />
</p>

è¡¨ç¤ºå½“å‰é¡µé¢æ˜¯å¦é¢„æ¸²æŸ“çš„å¸ƒå°”å€¼ã€‚

ä½ å¯ä»¥ä½¿ç”¨æ­¤å±æ€§åœ¨ä¸­é—´ä»¶ä¸­è¿è¡Œæ¡ä»¶é€»è¾‘ï¼Œä¾‹å¦‚ï¼Œä»¥é¿å…è®¿é—®é¢„æ¸²æŸ“é¡µé¢ä¸­çš„æ ‡å¤´ã€‚

### `generator`

<p>

**ç±»å‹ï¼š** `string`<br />
<Since v="1.0.0" />
</p>

`generator` æä¾›äº†ä½ çš„é¡¹ç›®å½“å‰è¿è¡Œçš„ Astro ç‰ˆæœ¬ã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ä½ å½“å‰çš„ Astro ç‰ˆæœ¬æ·»åŠ ä¸€ä¸ª [`<meta name="generator">`](https://html.spec.whatwg.org/multipage/semantics.html#meta-generator) æ ‡ç­¾ã€‚å®ƒéµå¾ªæ ¼å¼ `"Astro v5.x.x"`ã€‚

<Tabs>
  <TabItem label="Astro.generator">
    ```astro title="src/pages/site-info.astro" "Astro.generator"
    <html>
      <head>
        <meta name="generator" content={Astro.generator} />
      </head>
      <body>
        <footer>
          <p>Built with <a href="https://astro.build">{Astro.generator}</a></p>
        </footer>
      </body>
    </html>
    ```
  </TabItem>
  <TabItem label="context.generator">
    ```ts title="src/pages/site-info.json.ts" "generator"
    import type { APIContext } from 'astro';

    export function GET({ generator, site }: APIContext) {
      const body = JSON.stringify({ generator, site });
      return new Response(body);
    }
    ```
  </TabItem>
</Tabs>

### `request`

<p>

**ç±»å‹ï¼š** `Request`
</p>

`request` æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ [Request](https://developer.mozilla.org/zh-CN/docs/Web/API/Request) å¯¹è±¡ã€‚å®ƒå¯ä»¥ç”¨äºè·å–è¯·æ±‚çš„ `url`ã€`headers`ã€`method`ï¼Œç”šè‡³è¯·æ±‚çš„ bodyã€‚

<Tabs>
  <TabItem label="Astro.request">
    ```astro wrap title="src/pages/index.astro" "Astro.request"
    <p>æ”¶åˆ°ä¸€ä¸ª {Astro.request.method} è¯·æ±‚åˆ° "{Astro.request.url}".</p>
    <p>æ”¶åˆ°è¯·æ±‚çš„ headers:</p>
    <p><code>{JSON.stringify(Object.fromEntries(Astro.request.headers))}</code></p>
    ```
  </TabItem>
  <TabItem label="context.request">
    ```ts "request"
    import type { APIContext } from 'astro';

    export function GET({ request }: APIContext) {
      return new Response(`Hello ${request.url}`);
    }
    ```
  </TabItem>
</Tabs>

:::note
åœ¨é¢„æ¸²æŸ“é¡µé¢ä¸Šï¼Œ`request.url` ä¸åŒ…å«æœç´¢å‚æ•°ï¼Œå¦‚ `?type=new`ï¼Œå› ä¸ºåœ¨é™æ€æ„å»ºæœŸé—´æ— æ³•æå‰ç¡®å®šå®ƒä»¬ã€‚ç„¶è€Œï¼Œåœ¨æŒ‰éœ€æ¸²æŸ“çš„é¡µé¢ä¸Šï¼Œ`request.url` åŒ…å«æœç´¢å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ä»æœåŠ¡å™¨è¯·æ±‚ä¸­ç¡®å®šã€‚
:::

### `response`

<p>

**ç±»å‹ï¼š** `ResponseInit & { readonly headers: Headers }`
</p>

`response` æ˜¯ä¸€ä¸ªæ ‡å‡†çš„ `ResponseInit` å¯¹è±¡ã€‚å®ƒæœ‰ä»¥ä¸‹ç»“æ„ã€‚

 - `status`ï¼šå“åº”çš„çŠ¶æ€ç ï¼Œä¾‹å¦‚ `200`ã€‚
 - `statusText`ï¼šä¸çŠ¶æ€ç å…³è”çš„çŠ¶æ€æ¶ˆæ¯ï¼Œä¾‹å¦‚ `'OK'`ã€‚
 - `headers`ï¼šå¯ç”¨äºè®¾ç½®å“åº”çš„ HTTP å¤´çš„ [`Headers`](https://developer.mozilla.org/zh-CN/docs/Web/API/Headers) å®ä¾‹ã€‚

`Astro.response` å¸¸ç”¨äºä¸ºé¡µé¢çš„å“åº”è®¾ç½® `status`ã€`statusText` å’Œ `headers`ã€‚


```astro "Astro.response"
---
if (condition) {
  Astro.response.status = 404;
  Astro.response.statusText = 'Not found';
}
---
```

æˆ–è€…è®¾ç½®ä¸€ä¸ªæ ‡å¤´ï¼š

```astro "Astro.response"
---
Astro.response.headers.set('Set-Cookie', 'a=b; Path=/;');
---
```

### `redirect()`

<p>

**ç±»å‹ï¼š** `(path: string, status?: number) => Response`
<Since v="1.5.0" />
</p>

`redirect()` è¿”å›ä¸€ä¸ª [Response](https://developer.mozilla.org/zh-CN/docs/Web/API/Response) å¯¹è±¡ï¼Œå…è®¸ä½ é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œå¹¶å¯é€‰åœ°æä¾›ä¸€ä¸ª [HTTP å“åº”çŠ¶æ€ç ](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status#é‡å®šå‘æ¶ˆæ¯) ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚

é¡µé¢ï¼ˆè€Œä¸æ˜¯å­ç»„ä»¶ï¼‰å¿…é¡» `return` `Astro.redirect()` çš„ç»“æœæ‰èƒ½è¿›è¡Œé‡å®šå‘ã€‚

å¯¹äºé™æ€ç”Ÿæˆçš„è·¯ç”±ï¼Œè¿™å°†ä½¿ç”¨ [`<meta http-equiv="refresh">` æ ‡ç­¾](https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/meta#http-equiv) è¿›è¡Œå®¢æˆ·ç«¯é‡å®šå‘ï¼Œä¸æ”¯æŒçŠ¶æ€ç ã€‚

å¯¹äºåŠ¨æ€æ¸²æŸ“çš„è·¯ç”±ï¼Œæ”¯æŒåœ¨é‡å®šå‘æ—¶è®¾ç½®è‡ªå®šä¹‰çŠ¶æ€ç ã€‚å¦‚æœæœªæŒ‡å®šï¼Œé‡å®šå‘å°†ä½¿ç”¨ `302` çŠ¶æ€ç ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªå°†ç”¨æˆ·é‡å®šå‘åˆ°ç™»å½•é¡µé¢çš„ç¤ºä¾‹ï¼š

<Tabs>
  <TabItem label="Astro.redirect()">
    ```astro title="src/pages/account.astro" {8} "Astro.redirect"
    ---
    import { isLoggedIn } from '../utils';

    const cookie = Astro.request.headers.get('cookie');

    // å¦‚æœç”¨æˆ·æœªç™»å½•ï¼Œåˆ™å°†å…¶é‡å®šå‘åˆ°ç™»å½•é¡µé¢
    if (!isLoggedIn(cookie)) {
      return Astro.redirect('/login');
    }
    ---
    
    <p>ç”¨æˆ·ä¿¡æ¯</p>
    ```
  </TabItem>
  <TabItem label="context.redirect()">
    ```ts "redirect"
    import type { APIContext } from 'astro';

    export function GET({ redirect, request }: APIContext) {
      const cookie = request.headers.get('cookie');
      if (!isLoggedIn(cookie)) {
        return redirect('/login', 302);
      } else {
        // è¿”å›ç”¨æˆ·ä¿¡æ¯
      }
    }
    ```
  </TabItem>
</Tabs>


### `rewrite()`

<p>

**ç±»å‹ï¼š** `(rewritePayload: string | URL | Request) => Promise<Response>`<br />
<Since v="4.13.0" />
</p>

`rewrite()` å…è®¸ä½ åœ¨ä¸é‡å®šå‘æµè§ˆå™¨åˆ°æ–°é¡µé¢çš„æƒ…å†µä¸‹ä»ä¸åŒçš„ URL æˆ–è·¯å¾„æä¾›å†…å®¹ã€‚

æ­¤æ–¹æ³•æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ª `URL` æˆ–ä¸€ä¸ª `Request` ä½œä¸ºè·¯å¾„çš„ä½ç½®ã€‚

ä½¿ç”¨å­—ç¬¦ä¸²æä¾›æ˜¾å¼è·¯å¾„ï¼š

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/index.astro" "Astro.rewrite"
    ---
    return Astro.rewrite("/login")
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts "rewrite"
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite('/login');
    }
    ```
  </TabItem>
</Tabs>

å½“ä½ éœ€è¦æ„é€ é‡å†™çš„ URL è·¯å¾„æ—¶ï¼Œä½¿ç”¨ `URL` ç±»å‹ã€‚ä¸‹é¢çš„ç¤ºä¾‹é€šè¿‡ä»ç›¸å¯¹è·¯å¾„ `"../"` åˆ›å»ºä¸€ä¸ªæ–°çš„ URL æ¥æ¸²æŸ“é¡µé¢çš„çˆ¶è·¯å¾„ï¼š

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/blog/index.astro"
    ---
    return Astro.rewrite(new URL("../", Astro.url))
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite(new URL("../", Astro.url));
    }
    ```
  </TabItem>
</Tabs>

ä½¿ç”¨ `Request` ç±»å‹å®Œå…¨æ§åˆ¶å‘é€åˆ°æ–°è·¯å¾„çš„æœåŠ¡å™¨çš„ `Request`ã€‚ä»¥ä¸‹ç¤ºä¾‹å‘é€ä¸€ä¸ªè¯·æ±‚ä»¥æ¸²æŸ“çˆ¶é¡µé¢ï¼ŒåŒæ—¶æä¾› headersï¼š

<Tabs syncKey="rewrite">
  <TabItem label="Astro.rewrite()">
    ```astro title="src/pages/blog/index.astro"
    ---
    return Astro.rewrite(new Request(new URL("../", Astro.url), {
      headers: {
        "x-custom-header": JSON.stringify(Astro.locals.someValue)
      }
    }))
    ---
    ```
  </TabItem>
  <TabItem label="context.rewrite()">
    ```ts
    import type { APIContext } from 'astro';

    export function GET({ rewrite }: APIContext) {
      return rewrite(new Request(new URL("../", Astro.url), {
        headers: {
          "x-custom-header": JSON.stringify(Astro.locals.someValue)
        }
      }));
    }
    ```
  </TabItem>
</Tabs>

### `originPathname`

<p>

**ç±»å‹ï¼š** `string`<br />
<Since v="5.0.0" />
</p>

`originPathname` å®šä¹‰äº†è¯·æ±‚çš„åŸå§‹è·¯å¾„åï¼Œå³é‡å†™åº”ç”¨ä¹‹å‰çš„è·¯å¾„åã€‚

<Tabs>
  <TabItem label="Astro.originPathname">
  	```astro title="src/pages/404.astro"
    <p>åŸå§‹è·¯å¾„æ˜¯ {Astro.originPathname}</p>
    <p>é‡å†™åçš„è·¯å¾„æ˜¯ {Astro.url.pathname}</p>
    ```
  </TabItem>
  <TabItem label="context.originPathname">
    ```ts title="src/middleware.ts"
    import { defineMiddleware } from 'astro:middleware';

    export const onRequest = defineMiddleware(async (context, next) => {
      // åœ¨ä»»ä½•é‡å†™ä¹‹å‰è®°å½•åŸå§‹è·¯å¾„å
      recordPageVisit(context.originPathname);
      return next();
    });
  ```
  </TabItem>
</Tabs>

### `locals`

<p>

<Since v="2.4.0" />
</p>

`locals` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨äºåœ¨è¯·æ±‚çš„ç”Ÿå‘½å‘¨æœŸä¸­å­˜å‚¨å’Œè®¿é—®ä»»æ„ä¿¡æ¯ã€‚`Astro.locals` æ˜¯ä¸€ä¸ªåŒ…å«ç”±ä¸­é—´ä»¶è®¾ç½®çš„ `context.locals` å¯¹è±¡ä¸­çš„ä»»ä½•å€¼çš„å¯¹è±¡ã€‚ä½¿ç”¨å®ƒåœ¨ `.astro` æ–‡ä»¶ä¸­è®¿é—®ä¸­é—´ä»¶è¿”å›çš„æ•°æ®ã€‚

ä¸­é—´ä»¶å‡½æ•°å¯ä»¥è¯»å–å’Œå†™å…¥ `context.locals` çš„å€¼ï¼š

```ts title="src/middleware.ts" "locals"
import type { MiddlewareHandler } from 'astro';

export const onRequest: MiddlewareHandler = ({ locals }, next) => {
  if (!locals.title) {
    locals.title = "Default Title";
  }
  return next();
}
```

Astro ç»„ä»¶å’Œ API ç«¯ç‚¹å¯ä»¥åœ¨æ¸²æŸ“æ—¶ä» `locals` ä¸­è¯»å–å€¼ï¼š

<Tabs>
  <TabItem label="Astro.locals">
    ```astro title="src/pages/Orders.astro" "Astro.locals"
    ---
    const title = Astro.locals.title;
    ---
    <h1>{title}</h1>
    ```
  </TabItem>
  <TabItem label="context.locals">
    ```ts title="src/pages/hello.ts" "locals"
    import type { APIContext } from 'astro';

    export function GET({ locals }: APIContext) {
      return new Response(locals.title); // "Default Title"
    }
    ```
  </TabItem>
</Tabs>

### `preferredLocale`

<p>

**ç±»å‹ï¼š** `string | undefined`<br />
<Since v="3.5.0" />
</p>

`preferredLocale` æ˜¯ä¸€ä¸ªè®¡ç®—å€¼ï¼Œç”¨äºæ‰¾åˆ°è®¿é—®è€…çš„æµè§ˆå™¨è¯­è¨€é¦–é€‰é¡¹å’Œä½ çš„ç«™ç‚¹æ”¯æŒçš„è¯­è¨€ç¯å¢ƒä¹‹é—´çš„æœ€ä½³åŒ¹é…ã€‚

å®ƒé€šè¿‡æ£€æŸ¥ [`i18n.locales`](/zh-cn/reference/configuration-reference/#i18nlocales) æ•°ç»„ä¸­é…ç½®çš„è¯­è¨€ç¯å¢ƒå’Œç”¨æˆ·æµè§ˆå™¨æ”¯æŒçš„è¯­è¨€ç¯å¢ƒï¼ˆé€šè¿‡ `Accept-Language` å¤´ï¼‰æ¥è®¡ç®—ã€‚å¦‚æœæ²¡åŒ¹é…åˆ°ï¼Œåˆ™è¯¥å€¼ä¸º `undefined`ã€‚

æ­¤å±æ€§ä»…é€‚ç”¨äºæŒ‰éœ€æ¸²æŸ“çš„è·¯ç”±ï¼Œä¸èƒ½åœ¨é¢„æ¸²æŸ“çš„é™æ€é¡µé¢ä¸Šä½¿ç”¨ã€‚

### `preferredLocaleList`

<p>

**ç±»å‹ï¼š** `string[] | undefined`<br />
<Since v="3.5.0" />
</p>

`preferredLocaleList` è¡¨ç¤ºæµè§ˆå™¨è¯·æ±‚çš„æ‰€æœ‰è¯­è¨€ç¯å¢ƒå’Œä½ çš„ç½‘ç«™æ”¯æŒçš„æ‰€æœ‰è¯­è¨€ç¯å¢ƒä¹‹é—´çš„å…¼å®¹è¯­è¨€åˆ—è¡¨ã€‚è¿™å°†ç”Ÿæˆä½ çš„ç½‘ç«™å’Œè®¿é—®è€…ä¹‹é—´æ‰€æœ‰å…¼å®¹è¯­è¨€çš„åˆ—è¡¨ã€‚

å¦‚æœåœ¨ä½ çš„ locales æ•°ç»„ä¸­æ‰¾ä¸åˆ°æµè§ˆå™¨è¯·æ±‚çš„ä»»ä½•è¯­è¨€ï¼Œåˆ™è¯¥å€¼ä¸º `[]`ã€‚è¿™å‘ç”Ÿåœ¨ä½ ä¸æ”¯æŒè®¿é—®è€…çš„ä»»ä½•é¦–é€‰è¯­è¨€æ—¶ã€‚

å¦‚æœä½ çš„æµè§ˆå™¨æ²¡æœ‰æŒ‡å®šä»»ä½•é¦–é€‰è¯­è¨€ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°†æ˜¯ [`i18n.locales`](/zh-cn/reference/configuration-reference/#i18nlocales)ï¼šæ‰€æœ‰æ”¯æŒçš„è¯­è¨€ç¯å¢ƒå°†è¢«è®¤ä¸ºæ˜¯è®¿é—®è€…æ²¡æœ‰é¦–é€‰é¡¹çš„é¦–é€‰è¯­è¨€ã€‚

æ­¤å±æ€§ä»…é€‚ç”¨äºæŒ‰éœ€æ¸²æŸ“çš„è·¯ç”±ï¼Œä¸èƒ½åœ¨é¢„æ¸²æŸ“çš„é™æ€é¡µé¢ä¸Šä½¿ç”¨ã€‚

### `currentLocale`

<p>

**ç±»å‹ï¼š** `string | undefined`<br />
<Since v="3.5.6" />
</p>

ä½¿ç”¨ä½ çš„ `locales` é…ç½®ä¸­æŒ‡å®šçš„è¯­æ³•ä»å½“å‰ URL è®¡ç®—çš„è¯­è¨€ç¯å¢ƒã€‚å¦‚æœ URL ä¸åŒ…å« `/[locale]/` å‰ç¼€ï¼Œåˆ™è¯¥å€¼å°†é»˜è®¤ä¸º [`i18n.defaultLocale`](/zh-cn/reference/configuration-reference/#i18ndefaultlocale)ã€‚

### `getActionResult()`

<p>
**ç±»å‹ï¼š** `(action: TAction) => ActionReturnType<TAction> | undefined`<br />
<Since v="4.15.0" />
</p>

`getActionResult()` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºè¿”å› [Action](/zh-cn/guides/actions/) æäº¤çš„ç»“æœã€‚å®ƒæ¥å—ä¸€ä¸ª Action å‡½æ•°ä½œä¸ºå‚æ•°ï¼ˆä¾‹å¦‚ `actions.logout`ï¼‰ï¼Œå¹¶åœ¨æ¥æ”¶åˆ°æäº¤æ—¶è¿”å›ä¸€ä¸ª `data` æˆ– `error` å¯¹è±¡ã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å› `undefined`ã€‚

```astro title="src/pages/index.astro" "Astro.getActionResult"
---
import { actions } from 'astro:actions';

const result = Astro.getActionResult(actions.logout);
---

<form action={actions.logout}>
  <button type="submit">ç™»å‡º</button>
</form>
{result?.error && <p>ç™»å‡ºå¤±è´¥ã€‚è¯·é‡è¯•ã€‚</p>}
```

### `callAction()`

<p>
<Since v="4.15.0" />
</p>

`callAction()` æ˜¯ä¸€ä¸ªç”¨äºç›´æ¥ä»ä½ çš„ Astro ç»„ä»¶è°ƒç”¨ Action å¤„ç†ç¨‹åºçš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ª Action å‡½æ•°ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆä¾‹å¦‚ `actions.logout`ï¼‰ï¼Œå¹¶å°† action æ¥æ”¶çš„ä»»ä½•è¾“å…¥ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚å®ƒå°† action çš„ç»“æœä½œä¸ºä¸€ä¸ª promise è¿”å›ã€‚

```astro title="src/pages/index.astro" "Astro.callAction"
---
import { actions } from 'astro:actions';

const { data, error } = await Astro.callAction(actions.logout, { userId: '123' });
---
```

### `routePattern`

<p>

**ç±»å‹ï¼š** `string`<br />
<Since v="5.0.0" />
</p>

è·¯ç”±æ¨¡å¼è´Ÿè´£ç”Ÿæˆå½“å‰é¡µé¢æˆ–è·¯ç”±ã€‚åœ¨åŸºäºæ–‡ä»¶çš„è·¯ç”±ä¸­ï¼Œè¿™ç±»ä¼¼äºç”¨äºåˆ›å»ºè·¯ç”±çš„é¡¹ç›®ä¸­çš„æ–‡ä»¶è·¯å¾„ã€‚å½“é›†æˆä¸ºä½ çš„é¡¹ç›®åˆ›å»ºè·¯ç”±æ—¶ï¼Œ`context.routePattern` ä¸ `injectRoute.pattern` çš„å€¼ç›¸åŒã€‚

è¯¥å€¼å°†ä»¥æ–œæ å¼€å¤´ï¼Œå¹¶ç±»ä¼¼äºç›¸å¯¹äº `src/pages/` æ–‡ä»¶å¤¹çš„é¡µé¢ç»„ä»¶çš„è·¯å¾„ï¼Œä¸åŒ…æ‹¬æ–‡ä»¶æ‰©å±•åã€‚

ä¾‹å¦‚ï¼Œæ–‡ä»¶ `src/pages/en/blog/[slug].astro` å°†è¿”å› `/en/blog/[slug]` ä½œä¸º `routePattern`ã€‚è¯¥æ–‡ä»¶ç”Ÿæˆçš„ç«™ç‚¹ä¸Šçš„æ¯ä¸ªé¡µé¢ï¼ˆä¾‹å¦‚ `/en/blog/post-1/`ã€`/en/blog/post-2/` ç­‰ï¼‰éƒ½å…±äº«ç›¸åŒçš„ `routePattern` å€¼ã€‚å¯¹äº `index.*` è·¯ç”±ï¼Œè·¯ç”±æ¨¡å¼ä¸ä¼šåŒ…å«å•è¯ "index." ä¾‹å¦‚ï¼Œ`src/pages/index.astro` å°†è¿”å› `/`ã€‚

ä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªå±æ€§æ¥äº†è§£å“ªä¸ªè·¯ç”±æ­£åœ¨æ¸²æŸ“ä½ çš„ç»„ä»¶ã€‚è¿™ä½¿ä½ å¯ä»¥å°†ç±»ä¼¼ç”Ÿæˆçš„é¡µé¢ URL ä¸€èµ·è¿›è¡Œå®šä½æˆ–åˆ†æã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æœ‰æ¡ä»¶åœ°æ¸²æŸ“æŸäº›ä¿¡æ¯ï¼Œæˆ–æ”¶é›†å…³äºå“ªäº›è·¯ç”±é€Ÿåº¦è¾ƒæ…¢çš„æŒ‡æ ‡ã€‚

### `cookies`

<p>

**ç±»å‹ï¼š** `AstroCookies`<br />
<Since v="1.4.0" />
</p>

`cookies` åŒ…å«ç”¨äºè¯»å–å’Œæ“ä½œ [æŒ‰éœ€æ¸²æŸ“çš„è·¯ç”±](/zh-cn/guides/on-demand-rendering/) çš„ cookie çš„å·¥å…·å‡½æ•°ã€‚

#### Cookie å·¥å…·å‡½æ•°

##### `cookies.get()`

<p>

**ç±»å‹ï¼š** <code>(key: string, options?: <a href="#astrocookiegetoptions">AstroCookieGetOptions</a>) => <a href="#astrocookie-ç±»å‹">AstroCookie</a> | undefined</code>
</p>

è·å– cookie ä½œä¸º [`AstroCookie`](#astrocookie-ç±»å‹) å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å« `value` å’Œå°† cookie è½¬æ¢ä¸ºéå­—ç¬¦ä¸²ç±»å‹çš„å·¥å…·å‡½æ•°ã€‚

##### `cookies.has()`

<p>

**ç±»å‹ï¼š** <code>(key: string, options?: <a href="#astrocookiegetoptions">AstroCookieGetOptions</a>) => boolean</code>
</p>

æ£€æŸ¥ cookie æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœ cookie æ˜¯é€šè¿‡ `Astro.cookies.set()` è®¾ç½®çš„ï¼Œè¿™å°†è¿”å› `true`ï¼Œå¦åˆ™ï¼Œå®ƒå°†æ£€æŸ¥ `Astro.request` ä¸­çš„ cookieã€‚

##### `cookies.set()`

<p>

**ç±»å‹ï¼š** <code>(key: string, value: string | object, options?: <a href="#astrocookiesetoptions">AstroCookieSetOptions</a>) => void</code>
</p>

è®¾ç½® cookie `key` ä¸ºç»™å®šçš„å€¼ã€‚è¿™å°†å°è¯•å°† cookie å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚é€‰é¡¹æä¾›äº†è®¾ç½® [cookie ç‰¹æ€§](https://www.npmjs.com/package/cookie#options-1) çš„æ–¹æ³•ï¼Œä¾‹å¦‚ `maxAge` æˆ– `httpOnly`ã€‚

##### `cookies.delete()`

<p>

**ç±»å‹ï¼š** `(key: string, options?: AstroCookieDeleteOptions) => void`
</p>

é€šè¿‡å°†è¿‡æœŸæ—¥æœŸè®¾ç½®ä¸ºè¿‡å»ï¼ˆUnix æ—¶é—´ä¸­çš„ 0ï¼‰æ¥ä½¿ cookie å¤±æ•ˆã€‚

ä¸€æ—¦ cookie è¢« "åˆ é™¤"ï¼ˆè¿‡æœŸï¼‰ï¼Œ`Astro.cookies.has()` å°†è¿”å› `false`ï¼Œ`Astro.cookies.get()` å°†è¿”å›ä¸€ä¸ª `value` ä¸º `undefined` çš„ [`AstroCookie`](#astrocookie-ç±»å‹)ã€‚åˆ é™¤ cookie æ—¶å¯ç”¨çš„é€‰é¡¹æœ‰ï¼š`domain`ã€`path`ã€`httpOnly`ã€`sameSite` å’Œ `secure`ã€‚

##### `cookies.merge()`

<p>

**ç±»å‹ï¼š** `(cookies: AstroCookies) => void`
</p>

å°†æ–°çš„ `AstroCookies` å®ä¾‹åˆå¹¶åˆ°å½“å‰å®ä¾‹ä¸­ã€‚ä»»ä½•æ–° cookie å°†è¢«æ·»åŠ åˆ°å½“å‰å®ä¾‹ä¸­ï¼Œä»»ä½•å…·æœ‰ç›¸åŒåç§°çš„ cookie å°†è¦†ç›–ç°æœ‰å€¼ã€‚

##### `cookies.headers()`

<p>

**ç±»å‹ï¼š** `() => Iterator<string>`
</p>

è·å–å°†ä¸å“åº”ä¸€èµ·å‘é€çš„ `Set-Cookie` çš„æ ‡å¤´å€¼ã€‚

#### `AstroCookie` ç±»å‹

é€šè¿‡ `Astro.cookies.get()` è·å– cookie è¿”å›çš„ç±»å‹ã€‚å®ƒå…·æœ‰ä»¥ä¸‹å±æ€§ï¼š

##### `value`

<p>

**ç±»å‹ï¼š** `string`
</p>

cookie çš„åŸå§‹å­—ç¬¦ä¸²å€¼ã€‚

##### `json`

<p>

**ç±»å‹ï¼š** `() => Record<string, any>`
</p>

é€šè¿‡ `JSON.parse()` è§£æ cookie å€¼ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœ cookie å€¼ä¸æ˜¯æœ‰æ•ˆçš„ JSONï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚

##### `number`

<p>

**ç±»å‹ï¼š** `() => number`
</p>

å°† cookie å€¼è§£æä¸ºæ•°å­—ã€‚å¦‚æœä¸æ˜¯æœ‰æ•ˆçš„æ•°å­—ï¼Œåˆ™è¿”å› NaNã€‚

##### `boolean`

<p>

**ç±»å‹ï¼š** `() => boolean`
</p>

å°† cookie å€¼è½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚

#### `AstroCookieGetOptions`

<p><Since v="4.1.0"/></p>

`AstroCookieGetOption` æ¥å£å…è®¸ä½ åœ¨è·å– cookie æ—¶æŒ‡å®šé€‰é¡¹ã€‚

##### `decode`

<p>
**ç±»å‹ï¼š** `(value: string) => string`
</p>

å…è®¸è‡ªå®šä¹‰ cookie ååºåˆ—åŒ–ä¸ºå€¼çš„æ–¹å¼ã€‚

#### `AstroCookieSetOptions`

<p><Since v="4.1.0"/></p>

`AstroCookieSetOptions` æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åœ¨è®¾ç½® cookie æ—¶ä¼ é€’ç»™ `Astro.cookies.set()`ï¼Œä»¥è‡ªå®šä¹‰ cookie çš„åºåˆ—åŒ–æ–¹å¼ã€‚

##### `domain`

<p>

**ç±»å‹ï¼š** `string`
</p>

æŒ‡å®š domainã€‚å¦‚æœæœªè®¾ç½® domainï¼Œå¤§å¤šæ•°å®¢æˆ·ç«¯å°†è§£é‡Šä¸ºåº”ç”¨äºå½“å‰åŸŸã€‚

##### `expires`

<p>

**ç±»å‹ï¼š** `Date`
</p>

æŒ‡å®š cookie è¿‡æœŸçš„æ—¥æœŸã€‚

##### `httpOnly`

<p>

**ç±»å‹ï¼š** `boolean`
</p>

å¦‚æœè®¾ç½®ä¸º `true`ï¼Œåˆ™ cookie å°†ä¸ä¼šåœ¨å®¢æˆ·ç«¯ä¸Šå¯è®¿é—®ã€‚

##### `maxAge`

<p>

**ç±»å‹ï¼š** `number`
</p>

æŒ‡å®šä¸€ä¸ªä»¥ç§’ä¸ºå•ä½çš„æ•°å­—ï¼Œè¡¨ç¤º cookie æœ‰æ•ˆçš„æ—¶é—´ã€‚

##### `path`

<p>

**ç±»å‹ï¼š** `string`
</p>

æŒ‡å®š cookie åº”ç”¨çš„åŸŸçš„å­è·¯å¾„ã€‚

##### `partitioned`

<p>

**ç±»å‹ï¼š** `boolean`<br />
<Since v="5.17.0" />
</p>

å¦‚æœè®¾ç½®ä¸º trueï¼Œåˆ™ cookie æ˜¯ä¸€ä¸ª [åˆ†åŒº cookie](https://developer.mozilla.org/en-US/docs/Web/Privacy/Guides/Privacy_sandbox/Partitioned_cookies)ã€‚åˆ†åŒº cookie åªèƒ½åœ¨è®¾ç½®å®ƒä»¬çš„é¡¶çº§ç«™ç‚¹çš„ä¸Šä¸‹æ–‡ä¸­è¯»å–ï¼Œè¿™å¯ä»¥é˜»æ­¢è·¨ç«™ç‚¹è·Ÿè¸ªï¼ŒåŒæ—¶ä»ç„¶å¯ç”¨ç¬¬ä¸‰æ–¹ cookie çš„åˆæ³•ç”¨é€”ã€‚

åˆ†åŒº cookie å¿…é¡»è®¾ç½® `secure: true`ã€‚

##### `sameSite`

<p>

**ç±»å‹ï¼š** `boolean | 'lax' | 'none' | 'strict'`
</p>

æŒ‡å®š [SameSite](https://datatracker.ietf.org/doc/html/draft-ietf-httpbis-rfc6265bis-09#section-5.4.7) cookie æ ‡å¤´çš„å€¼ã€‚

##### `secure`

<p>

**ç±»å‹ï¼š** `boolean`
</p>

å¦‚æœä¸º `true`ï¼Œåˆ™ cookie ä»…åœ¨ https ç«™ç‚¹ä¸Šè®¾ç½®ã€‚

##### `encode`

<p>

**ç±»å‹ï¼š** `(value: string) => string`
</p>

å…è®¸è‡ªå®šä¹‰ cookie åºåˆ—åŒ–ä¸ºå€¼çš„æ–¹å¼ã€‚

### `session`

<p>

**ç±»å‹ï¼š** `AstroSession`

<Since v="5.7.0" />

</p>

`session` æ˜¯ä¸€ä¸ªå…è®¸åœ¨ [æŒ‰éœ€æ¸²æŸ“è·¯ç”±](/zh-cn/guides/on-demand-rendering/) çš„å¤šä¸ªè¯·æ±‚é—´å­˜å‚¨æ•°æ®çš„å¯¹è±¡ã€‚å…¶é€šè¿‡ä¸€ä¸ªä»…åŒ…å«ä¼šè¯ ID çš„ Cookie å®ç°å…³è”ï¼Œæ•°æ®æœ¬èº«å¹¶ä¸å­˜å‚¨äº Cookie ä¸­ã€‚

ä¼šè¯ï¼ˆsessionï¼‰ä¼šåœ¨é¦–æ¬¡è¢«ä½¿ç”¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶è®¾ç½®å¯¹åº”çš„ä¼šè¯ Cookieã€‚å¦‚æœæœªé…ç½®ä¼šè¯å­˜å‚¨ï¼Œåˆæˆ–è€…æ˜¯å½“å‰è·¯ç”±ä¸ºé¢„æ¸²æŸ“æ¨¡å¼ï¼Œ`session` å¯¹è±¡éƒ½ä¼šæ˜¯ `undefined`ï¼Œå½“ä½ å°è¯•è®¿é—®æ—¶ï¼Œæ—¥å¿—å°†ä¼šè®°å½•é”™è¯¯ã€‚

æœ‰å…³å¦‚ä½•åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­ä½¿ç”¨ä¼šè¯ï¼Œè¯·å‚é˜… [ä¼šè¯æŒ‡å—](/zh-cn/guides/sessions/) ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚

#### `get()`

<p>

**ç±»å‹ï¼š** `(key: string) => Promise<any>`

</p>

è¿”å›ä¼šè¯ä¸­ç»™å®šé”®çš„å€¼ã€‚å¦‚æœè¯¥é”®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› `undefined`ã€‚

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/components/Cart.astro" "Astro.session?.get('cart')"
    ---
    const cart = await Astro.session?.get('cart');
    ---
    <button>ğŸ›’ {cart?.length}</button>
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/cart.ts" "session.get('cart')"
    import type { APIContext } from 'astro';

    export async function GET({ session }: APIContext) {
      const cart = await session.get('cart');
      return Response.json({ cart });
    }
    ```

  </TabItem>
</Tabs>

#### `set()`

<p>

**ç±»å‹ï¼š** `(key: string, value: any, options?: { ttl: number }) => void`

</p>

è®¾ç½®ä¼šè¯ä¸­ç»™å®šé”®çš„å€¼ã€‚è¯¥å€¼å¯ä»¥æ˜¯ä»»ä½•å¯åºåˆ—åŒ–ç±»å‹ã€‚è¯¥æ–¹æ³•æ˜¯åŒæ­¥çš„ï¼Œè¯¥å€¼å¯ç«‹å³ç”¨äºæ£€ç´¢ï¼Œä½†æ˜¯ç›´åˆ°è¯·æ±‚ç»“æŸä¹‹å‰ï¼Œè¯¥æ–¹æ³•æ‰èƒ½ä¿å­˜åˆ°åç«¯ã€‚

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/products/[slug].astro" "Astro.session?.set('lastViewedProduct', slug)"
    ---
    const { slug } = Astro.params;
    Astro.session?.set('lastViewedProduct', slug);
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/add-to-cart.ts" "session.set('cart', cart)"
    import type { APIContext } from 'astro';

    export async function POST({ session, request }: APIContext) {
      const cart = await session.get('cart');
      const newItem = await request.json();
      cart.push(newItem);
      // ä¿å­˜æ›´æ–°åçš„è´­ç‰©è½¦è‡³ä¼šè¯
      session.set('cart', cart);
      return Response.json({ cart });
    }
    ```

  </TabItem>
</Tabs>

#### `regenerate()`

<p>

**ç±»å‹ï¼š** `() => void`

</p>

é‡æ–°ç”Ÿæˆä¼šè¯ IDã€‚æœ€ä½³å®è·µæ˜¯åœ¨ç”¨æˆ·ç™»å½•æˆ–å‡çº§æƒé™æ—¶è°ƒç”¨æ­¤æ–¹æ³•ï¼Œä»¥é˜²æ­¢ä¼šè¯å›ºå®šæ”»å‡»ã€‚

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/welcome.astro" "Astro.session?.regenerate()"
    ---
    Astro.session?.regenerate();
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/login.ts" "session.regenerate()"
    import type { APIContext } from 'astro';

    export async function POST({ session }: APIContext) {
      // å¯¹ç”¨æˆ·è¿›è¡Œèº«ä»½éªŒè¯...
      doLogin();
      // é‡æ–°ç”Ÿæˆä¼šè¯ ID ä»¥é˜²æ­¢ä¼šè¯å›ºå®šæ”»å‡»
      session.regenerate();
      return Response.json({ success: true });
    }
    ```

  </TabItem>
</Tabs>

#### `destroy()`

<p>

**ç±»å‹ï¼š** `() => void`

</p>

é”€æ¯ä¼šè¯ï¼Œä»åç«¯åˆ é™¤ Cookie å’Œå¯¹è±¡ã€‚å½“ç”¨æˆ·é€€å‡ºç™»å½•æˆ–ä¼šè¯æ— æ•ˆæ—¶åº”è°ƒç”¨æ­¤æ–¹æ³•ã€‚

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/logout.astro" "Astro.session?.destroy()"
    ---
    Astro.session?.destroy();
    return Astro.redirect('/login');
    ---
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/logout.ts" "session.destroy()"
    import type { APIContext } from 'astro';

    export async function POST({ session }: APIContext) {
      session.destroy();
      return Response.json({ success: true });
    }
    ```

  </TabItem>
</Tabs>

#### `load()`

<p>

**ç±»å‹ï¼š** `(id: string) => Promise<void>`
</p>

é€šè¿‡ ID æ¥åŠ è½½ä¼šè¯ã€‚åœ¨æ­£å¸¸ä½¿ç”¨ä¸­ï¼Œä¼šè¯å°†è‡ªåŠ¨ä»è¯·æ±‚ Cookie åŠ è½½ï¼Œä½†è¯¥æ–¹æ³•å¯ç”¨äºä»å…¶ä»– ID æ¥åŠ è½½ä¼šè¯ã€‚å¦‚æœä½ æ‰“ç®—è‡ªå·±å¤„ç†ä¼šè¯ IDï¼Œåˆæˆ–è€…ä½ æƒ³åœ¨ä¸ä½¿ç”¨ cookie çš„æƒ…å†µä¸‹è·Ÿè¸ªä¼šè¯ï¼Œè¯¥æ–¹æ³•éå¸¸æœ‰æ•ˆã€‚

<Tabs>
  <TabItem label="Astro.session">
    ```astro title="src/pages/cart.astro" "Astro.session?.load('session-id')"
    ---
    // ä»è¯·æ±‚å¤´è€Œä¸æ˜¯ Cookie åŠ è½½ä¼šè¯
    const sessionId = Astro.request.headers.get('x-session-id');
    await Astro.session?.load(sessionId);
    const cart = await Astro.session?.get('cart');
    ---
    <h1>ä½ çš„è´­ç‰©è½¦</h1>
    <ul>
      {cart?.map((item) => (
        <li>{item.name}</li>
      ))}
    </ul>
    ```
  </TabItem>
  <TabItem label="context.session">
    ```ts title="src/pages/api/load-session.ts" "session.load('session-id')"
    import type { APIRoute } from 'astro';

    export const GET: APIRoute = async ({ session, request }) => {
      // ä»è¯·æ±‚å¤´è€Œä¸æ˜¯ Cookie åŠ è½½ä¼šè¯
      const sessionId = request.headers.get('x-session-id');
      await session.load(sessionId);
      const cart = await session.get('cart');
      return Response.json({ cart });
    };
    ```

  </TabItem>

</Tabs>

### åºŸå¼ƒçš„å¯¹è±¡å±æ€§

#### `Astro.glob()`

:::caution[åœ¨ v5.0 ä¸­åºŸå¼ƒ]
ä½¿ç”¨ [Vite çš„ `import.meta.glob`](https://cn.vite.dev/guide/features.html#glob-import) æŸ¥è¯¢é¡¹ç›®æ–‡ä»¶ã€‚

`Astro.glob('../pages/post/*.md')` å¯ä»¥æ›¿æ¢ä¸ºï¼š

`Object.values(import.meta.glob('../pages/post/*.md', { eager: true }));`

æ›´å¤šä¿¡æ¯å’Œç”¨æ³•è¯·å‚é˜… [å¯¼å…¥æŒ‡å—](/zh-cn/guides/imports/#importmetaglob)ã€‚
:::

`Astro.glob()` æ˜¯ä¸€ç§å°†è®¸å¤šæœ¬åœ°æ–‡ä»¶åŠ è½½åˆ°ä½ çš„é™æ€ç«™ç‚¹è®¾ç½®ä¸­çš„æ–¹æ³•ã€‚

```astro
---
// src/components/my-component.astro
const posts = await Astro.glob('../pages/post/*.md'); // è¿”å›ä½äº ./src/pages/post/*.md ä¸­çš„æ–‡ç« æ•°ç»„ã€‚
---

<div>
{posts.slice(0, 3).map((post) => (
  <article>
    <h2>{post.frontmatter.title}</h2>
    <p>{post.frontmatter.description}</p>
    <a href={post.url}>Read more</a>
  </article>
))}
</div>
```

`.glob()` åªæœ‰ä¸€ä¸ªå‚æ•°ï¼šä½ æƒ³å¯¼å…¥çš„æœ¬åœ°æ–‡ä»¶ç›¸å¯¹ glob URLã€‚å®ƒæ˜¯å¼‚æ­¥çš„ï¼Œå¹¶è¿”å›åŒ¹é…æ–‡ä»¶çš„å¯¼å‡ºæ•°ç»„ã€‚

`.glob()` ä¸æ¥å—å˜é‡æˆ–å­—ç¬¦ä¸²æ’å€¼ï¼Œå› ä¸ºå®ƒä»¬æ— æ³•é™æ€åˆ†æã€‚ (è¯·å‚é˜… [å¯¼å…¥æŒ‡å—](/zh-cn/guides/imports/#æ”¯æŒçš„å€¼) äº†è§£è§£å†³æ–¹æ³•ã€‚) è¿™æ˜¯å› ä¸º `Astro.glob()` æ˜¯ Vite çš„ [`import.meta.glob()`](https://cn.vite.dev/guide/features.html#glob-import) çš„å°è£…ã€‚

:::note
ä½ å¯ä»¥åœ¨ä½ çš„ Astro é¡¹ç›®ä¸­ä½¿ç”¨ `import.meta.glob()` æœ¬èº«ã€‚ä½ å¯èƒ½æƒ³åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¿™æ ·åšï¼š

- ä½ éœ€è¦åœ¨ä¸æ˜¯ `.astro` æ–‡ä»¶çš„æ–‡ä»¶ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œä¾‹å¦‚ API è·¯ç”±ã€‚`Astro.glob()` ä»…åœ¨ `.astro` æ–‡ä»¶ä¸­å¯ç”¨ï¼Œè€Œ `import.meta.glob()` å¯åœ¨é¡¹ç›®ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚
- ä½ ä¸æƒ³ç«‹å³åŠ è½½æ¯ä¸ªæ–‡ä»¶ã€‚`import.meta.glob()` å¯ä»¥è¿”å›å¯¼å…¥æ–‡ä»¶å†…å®¹çš„å‡½æ•°ï¼Œè€Œä¸æ˜¯è¿”å›å†…å®¹æœ¬èº«ã€‚è¯·æ³¨æ„ï¼Œæ­¤å¯¼å…¥åŒ…æ‹¬æ‰€æœ‰å¯¼å…¥æ–‡ä»¶çš„æ ·å¼å’Œè„šæœ¬ã€‚è¿™äº›å°†è¢«æ‰“åŒ…å¹¶æ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œæ— è®ºæ–‡ä»¶æ˜¯å¦å®é™…ä½¿ç”¨ï¼Œå› ä¸ºè¿™æ˜¯é€šè¿‡é™æ€åˆ†æå†³å®šçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶å†³å®šçš„ã€‚
- ä½ æƒ³è¦è®¿é—®æ¯ä¸ªæ–‡ä»¶çš„è·¯å¾„ã€‚`import.meta.glob()` è¿”å›æ–‡ä»¶è·¯å¾„åˆ°å†…å®¹çš„æ˜ å°„ï¼Œè€Œ `Astro.glob()` è¿”å›å†…å®¹åˆ—è¡¨ã€‚
- ä½ æƒ³è¦ä¼ é€’å¤šä¸ªæ¨¡å¼ï¼›ä¾‹å¦‚ï¼Œä½ æƒ³è¦æ·»åŠ ä¸€ä¸ª â€œè´Ÿæ¨¡å¼â€ï¼Œç”¨äºè¿‡æ»¤æ‰æŸäº›æ–‡ä»¶ã€‚`import.meta.glob()` å¯ä»¥é€‰æ‹©æ¥å—ä¸€ä¸ª glob å­—ç¬¦ä¸²æ•°ç»„ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

åœ¨ [Vite æ–‡æ¡£](https://cn.vite.dev/guide/features.html#glob-import) ä¸­é˜…è¯»æ›´å¤šã€‚
:::

##### Markdown æ–‡ä»¶

ä½¿ç”¨ `Astro.glob()` åŠ è½½çš„ Markdown æ–‡ä»¶è¿”å›ä»¥ä¸‹ `MarkdownInstance` æ¥å£ï¼š

```ts
export interface MarkdownInstance<T extends Record<string, any>> {
  /* åœ¨æ­¤æ–‡ä»¶çš„ YAML/TOML frontmatter ä¸­æŒ‡å®šçš„ä»»ä½•æ•°æ® */
 frontmatter: T;
  /* è¯¥æ–‡ä»¶çš„æ–‡ä»¶ç»å¯¹è·¯å¾„ */
 file: string;
  /* è¯¥æ–‡ä»¶çš„æ¸²æŸ“è·¯å¾„ */
 url: string | undefined;
  /* æ¸²æŸ“æ­¤æ–‡ä»¶å†…å®¹çš„ Astro ç»„ä»¶ */
 Content: AstroComponentFactory;
 /** (ä»…é™ Markdown) Markdown æ–‡ä»¶çš„åŸå§‹å†…å®¹ï¼Œä¸åŒ…æ‹¬å¸ƒå±€ HTML å’Œ YAML/TOML frontmatter */
 rawContent(): string;
 /* (ä»…é™ Markdown) Markdown æ–‡ä»¶ç¼–è¯‘åçš„ HTMLï¼Œä¸åŒ…æ‹¬å¸ƒå±€ HTML */
 compiledContent(): string;
 /* è¿”å›è¯¥æ–‡ä»¶ä¸­ h1...h6 å…ƒç´ æ•°ç»„çš„å‡½æ•° */
 getHeadings(): Promise<{ depth: number; slug: string; text: string }[]>;
 default: AstroComponentFactory;
}
```

ä½ å¯ä»¥é€‰æ‹©ä½¿ç”¨ TypeScript æ³›å‹æŒ‡å®š `frontmatter` å˜é‡ç±»å‹ï¼š

```astro
---
interface Frontmatter {
  title: string;
  description?: string;
}
const posts = await Astro.glob<Frontmatter>('../pages/post/*.md');
---

<ul>
  {posts.map(post => <li>{post.frontmatter.title}</li>)}
</ul>
```

##### Astro æ–‡ä»¶

Astro æ–‡ä»¶å…·æœ‰ä»¥ä¸‹æ¥å£ï¼š

```ts
export interface AstroInstance {
  /* æ­¤æ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„ */
  file: string;
  /* æ­¤æ–‡ä»¶çš„ URLï¼ˆå¦‚æœå®ƒåœ¨ pages ç›®å½•ä¸­ï¼‰*/
  url: string | undefined;
  default: AstroComponentFactory;
}
```

##### å…¶ä»–æ–‡ä»¶

å…¶ä»–æ–‡ä»¶å¯èƒ½æœ‰å„ç§ä¸åŒçš„æ¥å£ï¼Œä½†å¦‚æœä½ ä¸çŸ¥é“æ–‡ä»¶ç±»å‹åŒ…å«ä»€ä¹ˆï¼Œé‚£ä¹ˆ `Astro.glob()` å¯ä»¥æ¥å— TypeScript æ³›å‹ã€‚

```ts
---
interface CustomDataFile {
  default: Record<string, any>;
}
const data = await Astro.glob<CustomDataFile>('../data/**/*.js');
---
```
